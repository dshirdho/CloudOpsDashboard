{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "![alt text](https://raw.githubusercontent.com/dshirdho/CloudOpsDashboard/main/CloudOps%20Dashboard%20Header%20V2.0.png)"
            },
            "customWidth": "85",
            "name": "text - 5"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "7d5928d4-e7ef-403b-b1fb-25ea9a277450",
                  "version": "KqlParameterItem/1.0",
                  "name": "recommendation",
                  "type": 10,
                  "description": "This will Provide recommendation to Improvise the Estate of Cloud Adoption",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{ \"value\": \"Yes\", \"label\": \"Yes\"},\r\n {\"value\": \"No\", \"label\": \"No\", \"selected\":true }]"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "15",
            "name": "parameters - 9 - Copy"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "paragraph",
              "links": [
                {
                  "id": "fcc4c05c-1689-4398-a092-a483a28736a3",
                  "cellValue": "tabname",
                  "linkTarget": "parameter",
                  "linkLabel": "Home",
                  "subTarget": "home",
                  "preText": "",
                  "style": "secondary",
                  "linkIsContextBlade": true
                },
                {
                  "id": "a03ef6e9-da8e-49dd-971f-380d3ea610af",
                  "cellValue": "tabname",
                  "linkTarget": "parameter",
                  "linkLabel": "Compute",
                  "subTarget": "compute",
                  "style": "secondary"
                },
                {
                  "id": "e7cca35d-5cc6-4bc6-8263-15bb81a7e130",
                  "cellValue": "tabname",
                  "linkTarget": "parameter",
                  "linkLabel": "Network",
                  "subTarget": "network",
                  "style": "secondary"
                },
                {
                  "id": "63fd2935-049d-4adf-a2a0-462fa0a61e26",
                  "cellValue": "tabname",
                  "linkTarget": "parameter",
                  "linkLabel": "Database",
                  "subTarget": "database",
                  "style": "secondary"
                },
                {
                  "id": "96fbe457-5a17-40e6-a830-aa45d061eb30",
                  "cellValue": "tabname",
                  "linkTarget": "parameter",
                  "linkLabel": "PaaS",
                  "subTarget": "PaaS",
                  "style": "secondary"
                },
                {
                  "id": "34ef28cb-af71-427c-8340-e79dd387d61c",
                  "cellValue": "tabname",
                  "linkTarget": "parameter",
                  "linkLabel": "Backup",
                  "subTarget": "backup",
                  "style": "secondary"
                },
                {
                  "id": "76a94f32-33f6-49b9-aa43-bb012c568a8e",
                  "cellValue": "tabname",
                  "linkTarget": "parameter",
                  "linkLabel": "Patching",
                  "subTarget": "patching",
                  "style": "secondary"
                },
                {
                  "id": "d7774b35-04f7-43ef-9138-a835f8adb6b7",
                  "cellValue": "tabname",
                  "linkTarget": "parameter",
                  "linkLabel": "Observability",
                  "subTarget": "observability",
                  "style": "secondary",
                  "icon": "Globe"
                },
                {
                  "id": "fe2dedff-699d-4230-b0d4-ea34e5609d70",
                  "cellValue": "tabname",
                  "linkTarget": "parameter",
                  "linkLabel": "IAM",
                  "subTarget": "iam",
                  "style": "secondary"
                },
                {
                  "id": "bffa5718-0a3f-43c5-83ed-9afcea6918ba",
                  "cellValue": "tabname",
                  "linkTarget": "parameter",
                  "linkLabel": "Advisory",
                  "subTarget": "advisory",
                  "style": "secondary"
                },
                {
                  "id": "96381f8b-8501-49a1-9098-48479c5166e8",
                  "cellValue": "tabname",
                  "linkTarget": "parameter",
                  "linkLabel": "Azure Health",
                  "subTarget": "servicehealth",
                  "style": "secondary"
                }
              ]
            },
            "customWidth": "80",
            "name": "links - 3",
            "styleSettings": {
              "padding": "0"
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "8bf9cc0a-096d-438c-8b4c-1705b1d12a4e",
                  "version": "KqlParameterItem/1.0",
                  "name": "Subscription",
                  "type": 6,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "includeAll": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "value": [
                    "/subscriptions/b17d03eb-4598-4cc2-9046-83a94e7c56ee"
                  ]
                },
                {
                  "id": "5dcc9ec9-4066-4673-a4df-e75464fdfcd8",
                  "version": "KqlParameterItem/1.0",
                  "name": "ResourceGroup",
                  "label": "RG",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "resources\r\n| distinct resourceGroup",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ]
                  },
                  "defaultValue": "value::all",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "18",
            "name": "parameters - 9",
            "styleSettings": {
              "margin": "-7px"
            }
          },
          {
            "type": 1,
            "content": {
              "json": "<hr>"
            },
            "name": "text - 10"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resourcecontainers\r\n| where type == \"microsoft.resources/subscriptions\"\r\n| summarize c = count()\r\n| extend Item = \"Subscriptions\",  Key = 1\r\n",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Item",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "ResourceFlat",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "c",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        }
                      },
                      "showBorder": false
                    },
                    "textSettings": {
                      "style": "bignumber"
                    }
                  },
                  "customWidth": "20",
                  "name": "Subscription"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources\r\n| summarize count()\r\n\r\n| extend Item = \"Resources\",  Key = 1\r\n",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Item",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "resource",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        }
                      },
                      "showBorder": false,
                      "size": "auto"
                    },
                    "textSettings": {
                      "style": "bignumber"
                    }
                  },
                  "customWidth": "20",
                  "name": "Resources"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resourcecontainers\r\n| where type == \"microsoft.resources/subscriptions/resourcegroups\"\r\n| summarize c = count()\r\n| extend Item = \"Resource Group\",  Key = 1\r\n",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Item",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "Restore",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "c",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        }
                      },
                      "showBorder": false,
                      "size": "auto"
                    },
                    "textSettings": {
                      "style": "bignumber"
                    }
                  },
                  "customWidth": "20",
                  "name": "Resource Group"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources\r\n| summarize taggedresources = countif(tags != '' ), untaggedresources=countif(tags == '' ),total=count()\r\n| extend pertaggedresources= taggedresources*1.0/total*100,title = \"Tagged Resources\"\r\n",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Running_vm_Percentage",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 4
                            }
                          }
                        }
                      ]
                    },
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "title",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "Tags",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "pertaggedresources",
                        "formatter": 12,
                        "formatOptions": {
                          "min": 95,
                          "max": 100,
                          "palette": "redGreen",
                          "compositeBarSettings": {
                            "labelText": "",
                            "columnSettings": []
                          }
                        },
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumSignificantDigits": 4
                          }
                        }
                      },
                      "showBorder": false,
                      "sortCriteriaField": "Running_vm_Percentage",
                      "size": "auto"
                    },
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "PowerState",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "count_",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "xAxis": "taggedresources"
                    },
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "sizeSettings": "Running_vm_Percentage",
                      "sizeAggregation": "Sum",
                      "legendMetric": "Running_vm_Percentage",
                      "legendAggregation": "Sum",
                      "itemColorSettings": {
                        "type": "heatmap",
                        "colorAggregation": "Sum",
                        "nodeColorField": "Running_vm_Percentage",
                        "heatmapPalette": "greenRed"
                      }
                    }
                  },
                  "customWidth": "20",
                  "name": "query - 0 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n| where type =~ 'microsoft.security/securescores'\r\n| where properties.score.current > 0 and properties.environment == 'Azure' and name != 'scoreGraceExcluded'\r\n| extend scoreXweight = todouble(properties.score.percentage) * todouble(properties.weight)\r\n| summarize topi = sum(scoreXweight), bottomi = sum(todouble(properties.weight))\r\n| extend securescore = 100*(topi/bottomi)\r\n| extend Item = \"Security Score\",  Key = 1",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Item",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "HeartPulse",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "securescore",
                        "formatter": 12,
                        "formatOptions": {
                          "min": 95,
                          "max": 100,
                          "palette": "redGreen"
                        },
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 0
                          }
                        }
                      },
                      "showBorder": false,
                      "size": "auto"
                    }
                  },
                  "customWidth": "20",
                  "name": "query - 0"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr>"
                  },
                  "name": "text - 4 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "summarize count() by type\r\n| project type, total=count_\r\n| top 10 by total",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "type",
                        "formatter": 16,
                        "formatOptions": {
                          "showIcon": true
                        }
                      },
                      "leftContent": {
                        "columnMatch": "total",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": false
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "microsoft.compute/virtualmachines/extensions",
                          "label": "Extension"
                        },
                        {
                          "seriesName": "microsoft.compute/disks",
                          "label": "Disk"
                        },
                        {
                          "seriesName": "microsoft.network/networkinterfaces",
                          "label": "NIC"
                        },
                        {
                          "seriesName": "microsoft.compute/snapshots",
                          "label": "Snapshots"
                        },
                        {
                          "seriesName": "microsoft.network/networksecuritygroups",
                          "label": "NSG"
                        }
                      ]
                    }
                  },
                  "customWidth": "60",
                  "name": "query - 10"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr>"
                  },
                  "name": "text - 4"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "Resource By Location",
                          "style": "upsell"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "summarize count() by location | project  location, total=count_ ",
                          "size": 3,
                          "color": "purple",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "map",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "location",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "total",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 2,
                            "topContent": {
                              "columnMatch": "location",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "total",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "nodeIdField": "total",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "mapSettings": {
                            "locInfo": "AzureLoc",
                            "locInfoColumn": "location",
                            "sizeSettings": "total",
                            "sizeAggregation": "Sum",
                            "labelSettings": "location",
                            "legendMetric": "total",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "nodeColorField": "total",
                              "colorAggregation": "Sum",
                              "type": "heatmap",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "name": "Resource By Location"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "![alt text](https://raw.githubusercontent.com/dshirdho/CloudOpsDashboard/main/highlyrecommended.png)\r\n<hr>\r\nCloudOps Recommended to assess geographical distribution of your Azure resources against the Business Continuity KPI to avoid the outage during the region disaster.\r\n\r\nBenefit : Highly Available & Fault Tolerant infrastructure. \r\n"
                        },
                        "conditionalVisibility": {
                          "parameterName": "recommendation",
                          "comparison": "isEqualTo",
                          "value": "Yes"
                        },
                        "name": "text - 2"
                      }
                    ]
                  },
                  "customWidth": "70",
                  "name": "Location Summary",
                  "styleSettings": {
                    "margin": "2px"
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "Top Subscriptions with Resource Count",
                          "style": "upsell"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers  | where type =~ 'Microsoft.Resources/subscriptions' \r\n| project SubscriptionName = name, subscriptionId\r\n | join (Resources| summarize resourceCount=count() by subscriptionId) on subscriptionId\r\n |project-away subscriptionId1,subscriptionId",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "labelSettings": [
                              {
                                "columnId": "SubscriptionName",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "resourceCount",
                                "label": "Resources"
                              }
                            ]
                          },
                          "sortBy": [],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "SubscriptionName",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": false
                              }
                            },
                            "leftContent": {
                              "columnMatch": "resourceCount",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "SubscriptionName",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "resourceCount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "Subscription"
                      }
                    ]
                  },
                  "customWidth": "30",
                  "name": "Top Subscriptions"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tabname",
              "comparison": "isEqualTo",
              "value": "home"
            },
            "name": "Home"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resourcecontainers\r\n| where type == \"microsoft.resources/subscriptions\"\r\n| summarize c = count()\r\n| extend Item = \"Subscriptions\",  Key = 1\r\n",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Item",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "ResourceFlat",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "c",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        }
                      },
                      "showBorder": false
                    },
                    "textSettings": {
                      "style": "bignumber"
                    }
                  },
                  "customWidth": "20",
                  "name": "Subscription"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources\r\n| summarize count()\r\n\r\n| extend Item = \"Resources\",  Key = 1\r\n",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Item",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "resource",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        }
                      },
                      "showBorder": false,
                      "size": "auto"
                    },
                    "textSettings": {
                      "style": "bignumber"
                    }
                  },
                  "customWidth": "20",
                  "name": "Resources"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resourcecontainers\r\n| where type == \"microsoft.resources/subscriptions/resourcegroups\"\r\n| summarize c = count()\r\n| extend Item = \"Resource Group\",  Key = 1\r\n",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Item",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "Restore",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "c",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        }
                      },
                      "showBorder": false,
                      "size": "auto"
                    },
                    "textSettings": {
                      "style": "bignumber"
                    }
                  },
                  "customWidth": "20",
                  "name": "Resource Group"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources\r\n| summarize taggedresources = countif(tags != '' ), untaggedresources=countif(tags == '' ),total=count()\r\n| extend pertaggedresources= taggedresources*1.0/total*100,title = \"Tagged Resources\"\r\n",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Running_vm_Percentage",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 4
                            }
                          }
                        }
                      ]
                    },
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "title",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "Tags",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "pertaggedresources",
                        "formatter": 12,
                        "formatOptions": {
                          "min": 95,
                          "max": 100,
                          "palette": "redGreen",
                          "compositeBarSettings": {
                            "labelText": "",
                            "columnSettings": []
                          }
                        },
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumSignificantDigits": 4
                          }
                        }
                      },
                      "showBorder": false,
                      "sortCriteriaField": "Running_vm_Percentage",
                      "size": "auto"
                    },
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "PowerState",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "count_",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "xAxis": "taggedresources"
                    },
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "sizeSettings": "Running_vm_Percentage",
                      "sizeAggregation": "Sum",
                      "legendMetric": "Running_vm_Percentage",
                      "legendAggregation": "Sum",
                      "itemColorSettings": {
                        "type": "heatmap",
                        "colorAggregation": "Sum",
                        "nodeColorField": "Running_vm_Percentage",
                        "heatmapPalette": "greenRed"
                      }
                    }
                  },
                  "customWidth": "20",
                  "name": "query - 0 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n| where type =~ 'microsoft.security/securescores'\r\n| where properties.score.current > 0 and properties.environment == 'Azure' and name != 'scoreGraceExcluded'\r\n| extend scoreXweight = todouble(properties.score.percentage) * todouble(properties.weight)\r\n| summarize topi = sum(scoreXweight), bottomi = sum(todouble(properties.weight))\r\n| extend securescore = 100*(topi/bottomi)\r\n| extend Item = \"Security Score\",  Key = 1",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Item",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "HeartPulse",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "securescore",
                        "formatter": 12,
                        "formatOptions": {
                          "min": 95,
                          "max": 100,
                          "palette": "redGreen"
                        },
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 0
                          }
                        }
                      },
                      "showBorder": false,
                      "size": "auto"
                    }
                  },
                  "customWidth": "20",
                  "name": "query - 0"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr>"
                  },
                  "name": "text - 4 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "summarize count() by type\r\n| project type, total=count_\r\n| top 10 by total",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "type",
                        "formatter": 16,
                        "formatOptions": {
                          "showIcon": true
                        }
                      },
                      "leftContent": {
                        "columnMatch": "total",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": false
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "microsoft.compute/virtualmachines/extensions",
                          "label": "Extension"
                        },
                        {
                          "seriesName": "microsoft.compute/disks",
                          "label": "Disk"
                        },
                        {
                          "seriesName": "microsoft.network/networkinterfaces",
                          "label": "NIC"
                        },
                        {
                          "seriesName": "microsoft.compute/snapshots",
                          "label": "Snapshots"
                        },
                        {
                          "seriesName": "microsoft.network/networksecuritygroups",
                          "label": "NSG"
                        }
                      ]
                    }
                  },
                  "customWidth": "60",
                  "name": "query - 10"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr>"
                  },
                  "name": "text - 4"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "Resource By Location",
                          "style": "upsell"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "summarize count() by location | project  location, total=count_ ",
                          "size": 3,
                          "color": "purple",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "map",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "location",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "total",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 2,
                            "topContent": {
                              "columnMatch": "location",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "total",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "nodeIdField": "total",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "mapSettings": {
                            "locInfo": "AzureLoc",
                            "locInfoColumn": "location",
                            "sizeSettings": "total",
                            "sizeAggregation": "Sum",
                            "labelSettings": "location",
                            "legendMetric": "total",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "nodeColorField": "total",
                              "colorAggregation": "Sum",
                              "type": "heatmap",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "name": "Resource By Location"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "![alt text](https://raw.githubusercontent.com/dshirdho/CloudOpsDashboard/main/highlyrecommended.png)\r\n<hr>\r\nCloudOps Recommended to assess geographical distribution of your Azure resources against the Business Continuity KPI to avoid the outage during the region disaster.\r\n\r\nBenefit : Highly Available & Fault Tolerant infrastructure. \r\n"
                        },
                        "conditionalVisibility": {
                          "parameterName": "recommendation",
                          "comparison": "isEqualTo",
                          "value": "Yes"
                        },
                        "name": "text - 2"
                      }
                    ]
                  },
                  "customWidth": "70",
                  "name": "Location Summary",
                  "styleSettings": {
                    "margin": "2px"
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "Top Subscriptions with Resource Count",
                          "style": "upsell"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers  | where type =~ 'Microsoft.Resources/subscriptions' \r\n| project SubscriptionName = name, subscriptionId\r\n | join (Resources| summarize resourceCount=count() by subscriptionId) on subscriptionId\r\n |project-away subscriptionId1,subscriptionId",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "labelSettings": [
                              {
                                "columnId": "SubscriptionName",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "resourceCount",
                                "label": "Resources"
                              }
                            ]
                          },
                          "sortBy": [],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "SubscriptionName",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": false
                              }
                            },
                            "leftContent": {
                              "columnMatch": "resourceCount",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "SubscriptionName",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "resourceCount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "Subscription"
                      }
                    ]
                  },
                  "customWidth": "30",
                  "name": "Top Subscriptions"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tabname",
              "comparison": "isEqualTo",
              "value": ""
            },
            "name": "Home - without Clicking Tab"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "e704bff1-46f3-4e50-88f9-9e34b6f6e413",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Summary",
                        "subTarget": "computesummary",
                        "preText": "",
                        "style": "secondary"
                      },
                      {
                        "id": "23807e3d-1010-4478-a42a-52d538db957c",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Compute State",
                        "subTarget": "computestate",
                        "style": "secondary"
                      },
                      {
                        "id": "3c15b98d-6b63-4c5f-bb67-082050ca3961",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Compute Availability",
                        "subTarget": "computeavailability",
                        "style": "link"
                      },
                      {
                        "id": "0ad70c03-7fc0-4f4f-a723-bf497b672096",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Compute Performance",
                        "subTarget": "computeperformance",
                        "style": "link"
                      },
                      {
                        "id": "2132eec6-01cf-425e-b2e9-3dafa929b3e6",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "VM Performance",
                        "subTarget": "vmperformance",
                        "style": "link"
                      },
                      {
                        "id": "701655a4-7a1a-41fb-bb80-43ffb068070c",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Performance Counter",
                        "subTarget": "performancecounter",
                        "style": "link"
                      },
                      {
                        "id": "ad6e718f-4398-4a27-9a89-479bbf417d30",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Volume Performance",
                        "subTarget": "volumeperformance",
                        "style": "link"
                      },
                      {
                        "id": "773bdcf6-a52a-4f54-a825-08206f58bf84",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Top 5",
                        "subTarget": "top5",
                        "style": "link"
                      },
                      {
                        "id": "ce5a83be-c28d-43a7-ae33-a0bdb0f1b7b8",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Azure VM Inventory",
                        "subTarget": "computeinventory",
                        "style": "link"
                      },
                      {
                        "id": "dec87f42-19d3-4f97-b574-78771760a408",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Arc VM Inventory",
                        "subTarget": "azurearcvm",
                        "style": "link"
                      },
                      {
                        "id": "f7123a75-2f46-46e9-902d-03bcb0a8c89d",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Volumes Inventory",
                        "subTarget": "volumes",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 0"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<hr>"
                  },
                  "name": "text - 2"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type has \"microsoft\"\r\n| extend type = case(\r\n             \r\n              type == 'microsoft.compute/availabilitysets', \"Availability Set\",\r\n               type == 'microsoft.containerregistry/registries', \"Container Registry\", \r\n                type == 'microsoft.containerinstance/containergroups', \"Container Groups\", \r\n             type == 'microsoft.compute/virtualmachines', \"Virtual Machines\",\r\n             type == 'microsoft.compute/images', \"Images\",\r\n             type == 'microsoft.compute/galleries/images/versions', \"Image Version\",\r\n            \r\n              strcat(\"Not Translated: \", type))\r\n| summarize count() by type\r\n| where type !has \"Not Translated\"",
                          "size": 4,
                          "color": "green",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "type",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "name": "query - 4"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources\r\n| where type =~ 'Microsoft.Compute/virtualMachines'\r\n| summarize count() by tostring(properties.storageProfile.osDisk.osType)",
                          "size": 4,
                          "title": "Virtual machines by OS",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "PowerState",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "textSettings": {
                            "style": "bignumber"
                          }
                        },
                        "customWidth": "25",
                        "name": "VM Count - By OS",
                        "styleSettings": {
                          "margin": "2px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "where type =~ 'Microsoft.Compute/virtualmachines'\r\n| summarize count() by location\r\n| project location, total=count_",
                          "size": 4,
                          "title": "Virtual machines by Location",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "PowerState",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "textSettings": {
                            "style": "bignumber"
                          }
                        },
                        "customWidth": "25",
                        "name": "VM Count - By  Location",
                        "styleSettings": {
                          "margin": "2px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources\r\n|where type =~ 'microsoft.compute/virtualMachines' \r\n| summarize count() by tostring(properties.storageProfile.imageReference.offer)",
                          "size": 4,
                          "title": "Virtual Machines By IMAGE",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "properties_storageProfile_imageReference_offer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "count_",
                            "sizeAggregation": "Sum",
                            "legendMetric": "count_",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "count_",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "Vm by Images",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| extend osType = coalesce(tostring(properties.osName), tostring(properties.osType), tostring(properties.storageProfile.osDisk.osType))\r\n| summarize\r\narcLinux = countif(type =~ \"microsoft.hybridcompute/machines\" and osType =~ \"Linux\"),\r\narcWindows = countif(type =~ \"microsoft.hybridcompute/machines\" and osType =~ \"Windows\")\r\n| project machinePack = pack( \"Arc enabled servers-Linux\", arcLinux, \"Arc enabled servers-Windows\", arcWindows)\r\n| mv-expand machinePack\r\n| extend machine = tostring(bag_keys(machinePack)[0])\r\n| extend count_ = tolong(machinePack[machine])\r\n| project machine, count_ ",
                          "size": 4,
                          "title": "Arc Servers",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false
                          },
                          "graphSettings": {
                            "type": 0
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "azureLinux",
                            "sizeAggregation": "Sum",
                            "legendMetric": "azureLinux",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "azureLinux",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 0",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "where type =~ 'microsoft.compute/virtualMachines' | summarize count() by tostring(properties.hardwareProfile.vmSize)",
                          "size": 3,
                          "title": "Virtual Machines By Instance Family",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "properties_hardwareProfile_vmSize",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "name": "query - 4",
                        "styleSettings": {
                          "margin": "2px",
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "computesummary"
                  },
                  "name": "ComputeSummary"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources\r\n| where type == 'microsoft.compute/virtualmachines'\r\n| summarize count() by PowerState = tostring(properties.extended.instanceView.powerState.code)",
                          "size": 4,
                          "title": "Virtual machines by State",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "PowerState",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "PowerState/running",
                                "color": "green"
                              },
                              {
                                "seriesName": "PowerState/deallocated",
                                "color": "redBright"
                              }
                            ]
                          },
                          "textSettings": {
                            "style": "bignumber"
                          }
                        },
                        "customWidth": "33",
                        "name": "VM Count - By State",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n\r\n| extend statuso = iff(isnull(properties.extended.instanceView.powerState.displayStatus), (properties.status), (properties.extended.instanceView.powerState.displayStatus))\r\n| where isnotnull(statuso)\r\n| summarize count() by tostring(statuso)",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "statuso",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "name": "query - 6"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources\r\n| where type =~ 'Microsoft.Compute/virtualMachines'\r\n| where properties.extended.instanceView.powerState.code != 'PowerState/running'\r\n| project vmName = name,id",
                          "size": 3,
                          "color": "redBright",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "id",
                              "formatter": 13,
                              "formatOptions": {
                                "linkColumn": "vmName",
                                "linkTarget": "RequestDetails",
                                "showIcon": true
                              }
                            },
                            "leftContent": {
                              "columnMatch": "vmName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "failed",
                                    "text": "Powered Off"
                                  }
                                ]
                              }
                            },
                            "showBorder": true
                          },
                          "graphSettings": {
                            "type": 2,
                            "topContent": {
                              "columnMatch": "vmName",
                              "formatter": 5
                            },
                            "nodeIdField": "vmName",
                            "sourceIdField": "vmName",
                            "targetIdField": "vmName",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": {
                              "nodeColorField": "vmName",
                              "type": 3,
                              "thresholdsGrid": [
                                {
                                  "operator": "startsWith"
                                },
                                {
                                  "operator": "Default",
                                  "thresholdValue": null,
                                  "representation": "redBright"
                                }
                              ]
                            },
                            "hivesMargin": 2
                          }
                        },
                        "name": "Down Virtual Machines"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "computestate"
                  },
                  "name": "Compute State"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "7bd0f21c-30f8-44e1-9e91-f9e87118bea9",
                              "version": "KqlParameterItem/1.0",
                              "name": "VirtualMachines",
                              "label": "Virtual Machines",
                              "type": 5,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "where type =~ 'microsoft.compute/virtualmachines'\r\n\t| order by name asc\r\n\t| extend Rank = row_number()\r\n\t| project value = id, label = id, selected = Rank <= 25",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1",
                                  "value::5",
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "920babe0-e044-45a5-bbfe-cc6ddfb12679",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ],
                                "allowCustom": true
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 604800000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook3b24e62e-148a-4851-b277-a94d17c8f89e",
                          "version": "MetricsItem/2.0",
                          "size": 3,
                          "chartType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "metricScope": 0,
                          "resourceParameter": "VirtualMachines",
                          "resourceIds": [
                            "{VirtualMachines}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--VmAvailabilityMetric",
                              "aggregation": 4
                            }
                          ],
                          "gridFormatType": 1,
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Name",
                              "formatter": 13,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "leftContent": {
                              "columnMatch": "Value",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "percent",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": false
                          },
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Name",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Metric",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Metric ID",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Aggregation",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Segment Field",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Segment",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Value",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0.98,
                                  "max": 1,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "percent"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Timeline",
                                "formatter": 10,
                                "formatOptions": {
                                  "min": 0.98,
                                  "max": 1,
                                  "palette": "redGreen"
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "sortBy": [
                              {
                                "itemKey": "$gen_heatmap_Value_8",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Subscription",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "Name",
                                "label": "VM Name"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_heatmap_Value_8",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "name": "metric - 1"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "computeavailability"
                  },
                  "name": "Compute Availability"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "7bd0f21c-30f8-44e1-9e91-f9e87118bea9",
                              "version": "KqlParameterItem/1.0",
                              "name": "VirtualMachines",
                              "label": "Virtual Machines",
                              "type": 5,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "where type =~ 'microsoft.compute/virtualmachines'\r\n\t| order by name asc\r\n\t| extend Rank = row_number()\r\n\t| project value = id, label = id, selected = Rank <= 25",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "920babe0-e044-45a5-bbfe-cc6ddfb12679",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 5184000000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "loadType": "always",
                          "items": [
                            {
                              "type": 10,
                              "content": {
                                "chartId": "workbookdb19a8d8-91af-44ea-951d-5ffa133b2ebe",
                                "version": "MetricsItem/2.0",
                                "size": 2,
                                "chartType": 0,
                                "resourceType": "microsoft.compute/virtualmachines",
                                "metricScope": 0,
                                "resourceParameter": "VirtualMachines",
                                "resourceIds": [
                                  "{VirtualMachines}"
                                ],
                                "timeContextFromParameter": "TimeRange",
                                "timeContext": {
                                  "durationMs": 5184000000
                                },
                                "metrics": [
                                  {
                                    "namespace": "microsoft.compute/virtualmachines",
                                    "metric": "microsoft.compute/virtualmachines--VmAvailabilityMetric",
                                    "aggregation": 4
                                  },
                                  {
                                    "namespace": "microsoft.compute/virtualmachines",
                                    "metric": "microsoft.compute/virtualmachines--Percentage CPU",
                                    "aggregation": 4
                                  },
                                  {
                                    "namespace": "microsoft.compute/virtualmachines",
                                    "metric": "microsoft.compute/virtualmachines--Disk Read Bytes",
                                    "aggregation": 1
                                  },
                                  {
                                    "namespace": "microsoft.compute/virtualmachines",
                                    "metric": "microsoft.compute/virtualmachines--Disk Write Bytes",
                                    "aggregation": 1
                                  },
                                  {
                                    "namespace": "microsoft.compute/virtualmachines",
                                    "metric": "microsoft.compute/virtualmachines--Network In Total",
                                    "aggregation": 1
                                  },
                                  {
                                    "namespace": "microsoft.compute/virtualmachines",
                                    "metric": "microsoft.compute/virtualmachines--Network Out Total",
                                    "aggregation": 1
                                  },
                                  {
                                    "namespace": "microsoft.compute/virtualmachines",
                                    "metric": "microsoft.compute/virtualmachines--Percentage CPU",
                                    "aggregation": 3,
                                    "columnName": "CPU Max"
                                  }
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "Subscription",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Name",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--VmAvailabilityMetric",
                                      "formatter": 8,
                                      "formatOptions": {
                                        "min": 0.99,
                                        "max": 1,
                                        "palette": "redGreen"
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "percent"
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--VmAvailabilityMetric Timeline",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--Percentage CPU",
                                      "formatter": 8,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "blue",
                                        "linkTarget": "WorkbookTemplate",
                                        "linkIsContextBlade": true,
                                        "workbookContext": {
                                          "componentIdSource": "column",
                                          "componentId": "Name",
                                          "resourceIdsSource": "column",
                                          "resourceIds": "Name",
                                          "templateIdSource": "static",
                                          "templateId": "Community-Workbooks/Virtual Machines/Virtual machine details",
                                          "typeSource": "static",
                                          "type": "workbook",
                                          "gallerySource": "static",
                                          "gallery": "microsoft.compute/virtualmachines",
                                          "locationSource": "default"
                                        }
                                      },
                                      "numberFormat": {
                                        "unit": 1,
                                        "options": {
                                          "style": "decimal",
                                          "maximumFractionDigits": 1
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--Percentage CPU Timeline",
                                      "formatter": 21,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "blue"
                                      }
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--Disk Read Bytes|microsoft.compute/virtualmachines--Disk Write Bytes",
                                      "formatter": 8,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "yellow"
                                      },
                                      "numberFormat": {
                                        "unit": 2,
                                        "options": {
                                          "style": "decimal",
                                          "maximumFractionDigits": 1
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--Disk Read Bytes Timeline",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--Disk Write Bytes Timeline",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--Network In Total|microsoft.compute/virtualmachines--Network Out Total",
                                      "formatter": 8,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "orange"
                                      },
                                      "numberFormat": {
                                        "unit": 2,
                                        "options": {
                                          "style": "decimal",
                                          "maximumFractionDigits": 1
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--Network In Total Timeline",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--Network Out Total Timeline",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "CPU Max Timeline",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "{VirtualMachines:resourcegroup}",
                                      "formatter": 14,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 10000,
                                  "filter": true,
                                  "labelSettings": [
                                    {
                                      "columnId": "Subscription",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "Name",
                                      "label": "Storage Name"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--VmAvailabilityMetric",
                                      "label": "VM Availability Metric (Preview) (Average)"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--VmAvailabilityMetric Timeline",
                                      "label": "VM Availability Metric (Preview) Timeline"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Percentage CPU",
                                      "label": "Percentage CPU (Average)"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Percentage CPU Timeline",
                                      "label": "Percentage CPU Timeline"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Disk Read Bytes",
                                      "label": "Disk Read Bytes (Sum)"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Disk Read Bytes Timeline",
                                      "label": "Disk Read Bytes Timeline"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Disk Write Bytes",
                                      "label": "Disk Write Bytes (Sum)"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Disk Write Bytes Timeline",
                                      "label": "Disk Write Bytes Timeline"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Network In Total",
                                      "label": "Network In Total (Sum)"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Network In Total Timeline",
                                      "label": "Network In Total Timeline"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Network Out Total",
                                      "label": "Network Out Total (Sum)"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Network Out Total Timeline",
                                      "label": "Network Out Total Timeline"
                                    },
                                    {
                                      "columnId": "CPU Max",
                                      "label": "CPU Max"
                                    },
                                    {
                                      "columnId": "CPU Max Timeline",
                                      "label": "CPU Max Timeline"
                                    }
                                  ]
                                },
                                "sortBy": [],
                                "showExportToExcel": true
                              },
                              "conditionalVisibility": {
                                "parameterName": "test",
                                "comparison": "isEqualTo",
                                "value": "false"
                              },
                              "showPin": true,
                              "name": "Azure Monitor VM Key Metrics"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "advisorresources\r\n| where type == 'microsoft.advisor/recommendations'\r\n| where properties.category == 'Cost'\r\n| extend\r\n    resourceid = tolower(tostring(properties.resourceMetadata.resourceId)),\r\n    savings = todouble(properties.extendedProperties.savingsAmount),\r\n    solution = tostring(properties.shortDescription.solution),\r\n    currency = tostring(properties.extendedProperties.savingsCurrency)\r\n| where resourceid in~ ({VirtualMachines})\r\n| extend action = strcat(\"Resize \", properties.extendedProperties.currentSku, \" to \", properties.extendedProperties.targetSku)\r\n| project resourceid, action",
                                "size": 0,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "test",
                                "comparison": "isEqualTo",
                                "value": "false"
                              },
                              "name": "Azure Advisor"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Resources\r\n| where id in~ ({VirtualMachines})\r\n| extend resourceid = tolower(id)\r\n| project Resource = id, Subscription = subscriptionId, ['Resource group'] = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup), Location = location, Size = properties.hardwareProfile.vmSize",
                                "size": 0,
                                "exportToExcelOptions": "all",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "Resource",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "Subscription",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Resource group",
                                      "formatter": 5
                                    }
                                  ]
                                },
                                "sortBy": []
                              },
                              "conditionalVisibility": {
                                "parameterName": "test",
                                "comparison": "isEqualTo",
                                "value": "false"
                              },
                              "name": "Resource graph query"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\",\"mergeType\":\"leftouter\",\"leftTable\":\"Resource graph query\",\"rightTable\":\"Azure Advisor\",\"leftColumn\":\"Resource\",\"rightColumn\":\"resourceid\"},{\"id\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\",\"mergeType\":\"leftouter\",\"leftTable\":\"Resource graph query\",\"rightTable\":\"Azure Monitor VM Key Metrics\",\"leftColumn\":\"Resource\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[Resource graph query].Resource\",\"mergedName\":\"Resource\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Resource graph query].Subscription\",\"mergedName\":\"Subscription\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Resource graph query].Resource group\",\"mergedName\":\"Resource group\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Resource graph query].Location\",\"mergedName\":\"Location\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Resource graph query].Size\",\"mergedName\":\"Size\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Azure Advisor].resourceid\",\"mergedName\":\"resourceid\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Azure Advisor].currency\",\"mergedName\":\"currency\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].Subscription\",\"mergedName\":\"Subscription1\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].Name\",\"mergedName\":\"Name\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Percentage CPU\",\"mergedName\":\"Percentage CPU (Average)\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Percentage CPU Timeline\",\"mergedName\":\"Percentage CPU (Average) Timeline\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].CPU Max\",\"mergedName\":\"Percentage CPU (Max)\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].CPU Max Timeline\",\"mergedName\":\"Percentage CPU (Max) Timeline\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Disk Read Bytes\",\"mergedName\":\"Disk Read Bytes (Sum)\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Disk Read Bytes Timeline\",\"mergedName\":\"Disk Read Bytes Timeline\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Disk Write Bytes\",\"mergedName\":\"Disk Write Bytes (Sum)\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Disk Write Bytes Timeline\",\"mergedName\":\"Disk Write Bytes Timeline\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Network In Total\",\"mergedName\":\"Network In Total (Sum)\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Network In Total Timeline\",\"mergedName\":\"Network In Total Timeline\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Network Out Total\",\"mergedName\":\"Network Out Total (Sum)\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Network Out Total Timeline\",\"mergedName\":\"Network Out Total Timeline\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Advisor].solution\",\"mergedName\":\"Azure Advisor Solution\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Azure Advisor].savings\",\"mergedName\":\"Azure Advisor Saving\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Azure Advisor].action\",\"mergedName\":\"Azure Advisor recommended action\",\"fromId\":\"unknown\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--VmAvailabilityMetric\",\"mergedName\":\"microsoft.compute/virtualmachines--VmAvailabilityMetric\",\"fromId\":\"unknown\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--VmAvailabilityMetric Timeline\",\"mergedName\":\"microsoft.compute/virtualmachines--VmAvailabilityMetric Timeline\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 3].resourceid\"},{\"originalName\":\"[query - 3].currency\"}]}",
                                "size": 3,
                                "queryType": 7,
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "Resource",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Subscription",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Resource group",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Location",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "resourceid",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Subscription1",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Name",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Percentage CPU (Average)",
                                      "formatter": 8,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "blue"
                                      },
                                      "numberFormat": {
                                        "unit": 1,
                                        "options": {
                                          "style": "decimal",
                                          "useGrouping": false,
                                          "maximumFractionDigits": 1
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "Percentage CPU (Average) Timeline",
                                      "formatter": 21,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "blue"
                                      }
                                    },
                                    {
                                      "columnMatch": "Percentage CPU (Max)",
                                      "formatter": 8,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "blue"
                                      },
                                      "numberFormat": {
                                        "unit": 1,
                                        "options": {
                                          "style": "decimal",
                                          "maximumFractionDigits": 1
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "Percentage CPU (Max) Timeline",
                                      "formatter": 21,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "blue"
                                      }
                                    },
                                    {
                                      "columnMatch": "Disk Read Bytes (Sum)",
                                      "formatter": 8,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "yellow"
                                      },
                                      "numberFormat": {
                                        "unit": 2,
                                        "options": {
                                          "style": "decimal",
                                          "maximumSignificantDigits": 1
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "Disk Read Bytes Timeline",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Disk Write Bytes (Sum)",
                                      "formatter": 8,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "yellow"
                                      },
                                      "numberFormat": {
                                        "unit": 2,
                                        "options": {
                                          "style": "decimal",
                                          "maximumFractionDigits": 1
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "Disk Write Bytes Timeline",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Network In Total (Sum)",
                                      "formatter": 8,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "orange"
                                      },
                                      "numberFormat": {
                                        "unit": 2,
                                        "options": {
                                          "style": "decimal",
                                          "maximumSignificantDigits": 1
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "Network In Total Timeline",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Network Out Total (Sum)",
                                      "formatter": 8,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "orange"
                                      },
                                      "numberFormat": {
                                        "unit": 2,
                                        "options": {
                                          "style": "decimal",
                                          "maximumFractionDigits": 1
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "Network Out Total Timeline",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "currency",
                                      "formatter": 5
                                    }
                                  ],
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "Subscription"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "Name"
                                  }
                                }
                              },
                              "showPin": false,
                              "name": "Merge ARG and Advisor"
                            }
                          ]
                        },
                        "name": "Details"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "parameters": [
                                  {
                                    "id": "7bd0f21c-30f8-44e1-9e91-f9e87118bea9",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "VirtualMachines",
                                    "label": "Virtual Machines",
                                    "type": 5,
                                    "isRequired": true,
                                    "multiSelect": true,
                                    "quote": "'",
                                    "delimiter": ",",
                                    "query": "where type =~ 'microsoft.compute/virtualmachines'\r\n\t| order by name asc\r\n\t| extend Rank = row_number()\r\n\t| project value = id, label = id, selected = Rank <= 25",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "typeSettings": {
                                      "additionalResourceOptions": [
                                        "value::1",
                                        "value::5",
                                        "value::all"
                                      ],
                                      "showDefault": false
                                    },
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "defaultValue": "value::5",
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "value": null
                                  },
                                  {
                                    "id": "920babe0-e044-45a5-bbfe-cc6ddfb12679",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "TimeRange",
                                    "label": "Time Range",
                                    "type": 4,
                                    "typeSettings": {
                                      "selectableValues": [
                                        {
                                          "durationMs": 300000
                                        },
                                        {
                                          "durationMs": 900000
                                        },
                                        {
                                          "durationMs": 1800000
                                        },
                                        {
                                          "durationMs": 3600000
                                        },
                                        {
                                          "durationMs": 14400000
                                        },
                                        {
                                          "durationMs": 43200000
                                        },
                                        {
                                          "durationMs": 86400000
                                        },
                                        {
                                          "durationMs": 172800000
                                        },
                                        {
                                          "durationMs": 259200000
                                        },
                                        {
                                          "durationMs": 604800000
                                        },
                                        {
                                          "durationMs": 1209600000
                                        },
                                        {
                                          "durationMs": 2419200000
                                        },
                                        {
                                          "durationMs": 2592000000
                                        },
                                        {
                                          "durationMs": 5184000000
                                        },
                                        {
                                          "durationMs": 7776000000
                                        }
                                      ],
                                      "allowCustom": true
                                    },
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "value": {
                                      "durationMs": 604800000
                                    }
                                  }
                                ],
                                "style": "pills",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources"
                              },
                              "name": "parameters - 1"
                            },
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "loadType": "always",
                                "items": [
                                  {
                                    "type": 10,
                                    "content": {
                                      "chartId": "workbookdb19a8d8-91af-44ea-951d-5ffa133b2ebe",
                                      "version": "MetricsItem/2.0",
                                      "size": 2,
                                      "chartType": 0,
                                      "resourceType": "microsoft.compute/virtualmachines",
                                      "metricScope": 0,
                                      "resourceParameter": "VirtualMachines",
                                      "resourceIds": [
                                        "{VirtualMachines}"
                                      ],
                                      "timeContextFromParameter": "TimeRange",
                                      "timeContext": {
                                        "durationMs": 604800000
                                      },
                                      "metrics": [
                                        {
                                          "namespace": "microsoft.compute/virtualmachines",
                                          "metric": "microsoft.compute/virtualmachines--Available Memory Bytes",
                                          "aggregation": 4,
                                          "columnName": "Available Memory (Avg)"
                                        },
                                        {
                                          "namespace": "microsoft.compute/virtualmachines",
                                          "metric": "microsoft.compute/virtualmachines--Available Memory Bytes",
                                          "aggregation": 2,
                                          "columnName": "Available Memory (Min)"
                                        },
                                        {
                                          "namespace": "microsoft.compute/virtualmachines",
                                          "metric": "microsoft.compute/virtualmachines--Available Memory Bytes",
                                          "aggregation": 3,
                                          "columnName": "Available Memory (Max)"
                                        }
                                      ],
                                      "resourceLimit": 10000,
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "Subscription",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Name",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "microsoft.compute/virtualmachines--Percentage CPU",
                                            "formatter": 8,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "blue",
                                              "linkTarget": "WorkbookTemplate",
                                              "linkIsContextBlade": true,
                                              "workbookContext": {
                                                "componentIdSource": "column",
                                                "componentId": "Name",
                                                "resourceIdsSource": "column",
                                                "resourceIds": "Name",
                                                "templateIdSource": "static",
                                                "templateId": "Community-Workbooks/Virtual Machines/Virtual machine details",
                                                "typeSource": "static",
                                                "type": "workbook",
                                                "gallerySource": "static",
                                                "gallery": "microsoft.compute/virtualmachines",
                                                "locationSource": "default"
                                              }
                                            },
                                            "numberFormat": {
                                              "unit": 1,
                                              "options": {
                                                "style": "decimal",
                                                "maximumFractionDigits": 1
                                              }
                                            }
                                          },
                                          {
                                            "columnMatch": "microsoft.compute/virtualmachines--Percentage CPU Timeline",
                                            "formatter": 21,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "blue"
                                            }
                                          },
                                          {
                                            "columnMatch": "CPU Max Timeline",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Available Memory (Avg)",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "palette": "blue"
                                            },
                                            "numberFormat": {
                                              "unit": 2,
                                              "options": {
                                                "style": "decimal",
                                                "maximumFractionDigits": 2
                                              }
                                            }
                                          },
                                          {
                                            "columnMatch": "Available Memory (Avg) Timeline",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Available Memory (Min)",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "palette": "blue"
                                            },
                                            "numberFormat": {
                                              "unit": 2,
                                              "options": {
                                                "style": "decimal"
                                              }
                                            }
                                          },
                                          {
                                            "columnMatch": "Available Memory (Min) Timeline",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Available Memory (Max)",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "palette": "blue"
                                            },
                                            "numberFormat": {
                                              "unit": 2,
                                              "options": {
                                                "style": "decimal"
                                              }
                                            }
                                          },
                                          {
                                            "columnMatch": "Available Memory (Max) Timeline",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "microsoft.compute/virtualmachines--Disk Read Bytes|microsoft.compute/virtualmachines--Disk Write Bytes",
                                            "formatter": 8,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "yellow"
                                            },
                                            "numberFormat": {
                                              "unit": 2,
                                              "options": {
                                                "style": "decimal",
                                                "maximumFractionDigits": 1
                                              }
                                            }
                                          },
                                          {
                                            "columnMatch": "microsoft.compute/virtualmachines--Disk Read Bytes Timeline",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "microsoft.compute/virtualmachines--Disk Write Bytes Timeline",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "microsoft.compute/virtualmachines--Network In Total|microsoft.compute/virtualmachines--Network Out Total",
                                            "formatter": 8,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "orange"
                                            },
                                            "numberFormat": {
                                              "unit": 2,
                                              "options": {
                                                "style": "decimal",
                                                "maximumFractionDigits": 1
                                              }
                                            }
                                          },
                                          {
                                            "columnMatch": "microsoft.compute/virtualmachines--Network In Total Timeline",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "microsoft.compute/virtualmachines--Network Out Total Timeline",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "{VirtualMachines:resourcegroup}",
                                            "formatter": 14,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "microsoft.compute/virtualmachines--Available Memory Bytes",
                                            "formatter": 1,
                                            "numberFormat": {
                                              "unit": 5,
                                              "options": {
                                                "style": "decimal"
                                              }
                                            }
                                          }
                                        ],
                                        "rowLimit": 10000,
                                        "filter": true,
                                        "labelSettings": [
                                          {
                                            "columnId": "Subscription",
                                            "label": "Subscription"
                                          },
                                          {
                                            "columnId": "Name",
                                            "label": "Storage Name"
                                          },
                                          {
                                            "columnId": "Available Memory (Avg)",
                                            "label": "Available Memory (Avg)"
                                          },
                                          {
                                            "columnId": "Available Memory (Avg) Timeline",
                                            "label": "Available Memory (Avg) Timeline"
                                          },
                                          {
                                            "columnId": "Available Memory (Min)",
                                            "label": "Available Memory (Min)"
                                          },
                                          {
                                            "columnId": "Available Memory (Min) Timeline",
                                            "label": "Available Memory (Min) Timeline"
                                          },
                                          {
                                            "columnId": "Available Memory (Max)",
                                            "label": "Available Memory (Max)"
                                          },
                                          {
                                            "columnId": "Available Memory (Max) Timeline",
                                            "label": "Available Memory (Max) Timeline"
                                          }
                                        ]
                                      },
                                      "sortBy": [],
                                      "showExportToExcel": true
                                    },
                                    "conditionalVisibility": {
                                      "parameterName": "test",
                                      "comparison": "isEqualTo",
                                      "value": "false"
                                    },
                                    "showPin": true,
                                    "name": "Azure Monitor VM Key Metrics"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "advisorresources\r\n| where type == 'microsoft.advisor/recommendations'\r\n| where properties.category == 'Cost'\r\n| extend\r\n    resourceid = tolower(tostring(properties.resourceMetadata.resourceId)),\r\n    savings = todouble(properties.extendedProperties.savingsAmount),\r\n    solution = tostring(properties.shortDescription.solution),\r\n    currency = tostring(properties.extendedProperties.savingsCurrency)\r\n| where resourceid in~ ({VirtualMachines})\r\n| extend action = strcat(\"Resize \", properties.extendedProperties.currentSku, \" to \", properties.extendedProperties.targetSku)\r\n| project resourceid, action\r\n| union\r\nadvisorresources\r\n| extend resourceid = tolower(properties.resourceMetadata.resourceId)\r\n| extend category = properties.category\r\n| extend Recommendations = strcat(\"[\",properties.impact,\"] : [\", properties.category,\"] : \",properties.shortDescription.solution)  \r\n| where resourceid contains ('virtualmachine')\r\n| where category != 'Security'\r\n| summarize action = strcat_array(make_list(Recommendations), \"\\n\") by resourceid",
                                      "size": 0,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "action",
                                            "formatter": 5
                                          }
                                        ],
                                        "rowLimit": 10000
                                      }
                                    },
                                    "conditionalVisibility": {
                                      "parameterName": "test",
                                      "comparison": "isEqualTo",
                                      "value": "false"
                                    },
                                    "name": "Azure Advisor"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "Resources\r\n| where id in~ ({VirtualMachines})\r\n| extend resourceid = tolower(id)\r\n| project Resource = id, Subscription = subscriptionId, ['Resource group'] = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup), Location = location, Size = properties.hardwareProfile.vmSize,Platform=properties.storageProfile.osDisk.osType",
                                      "size": 0,
                                      "exportToExcelOptions": "all",
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "Resource",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "Subscription",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Resource group",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Location",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "Size",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "Platform",
                                            "formatter": 1
                                          }
                                        ],
                                        "rowLimit": 10000
                                      },
                                      "sortBy": []
                                    },
                                    "conditionalVisibility": {
                                      "parameterName": "test",
                                      "comparison": "isEqualTo",
                                      "value": "false"
                                    },
                                    "name": "Resource graph query"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\",\"mergeType\":\"leftouter\",\"leftTable\":\"Resource graph query\",\"rightTable\":\"Azure Advisor\",\"leftColumn\":\"Resource\",\"rightColumn\":\"resourceid\"},{\"id\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\",\"mergeType\":\"leftouter\",\"leftTable\":\"Resource graph query\",\"rightTable\":\"Azure Monitor VM Key Metrics\",\"leftColumn\":\"Resource\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[Resource graph query].Resource\",\"mergedName\":\"Resource\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Resource graph query].Subscription\",\"mergedName\":\"Subscription\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Resource graph query].Resource group\",\"mergedName\":\"Resource group\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Resource graph query].Location\",\"mergedName\":\"Location\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Resource graph query].Platform\",\"mergedName\":\"Platform\",\"fromId\":\"unknown\"},{\"originalName\":\"[Resource graph query].Size\",\"mergedName\":\"Size\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Azure Advisor].resourceid\",\"mergedName\":\"resourceid\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Azure Advisor].currency\",\"mergedName\":\"currency\",\"fromId\":\"2a962bc4-6379-4ff9-a467-0f4745ef7354\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].Subscription\",\"mergedName\":\"Subscription1\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].Name\",\"mergedName\":\"Name\",\"fromId\":\"594addb0-aa79-49ad-8a5b-99025e63f0d2\"},{\"originalName\":\"[Resource graph query].properties\",\"mergedName\":\"properties\",\"fromId\":\"unknown\"},{\"originalName\":\"[Resource graph query].properties_storageProfile_osDisk_osType\",\"mergedName\":\"properties_storageProfile_osDisk_osType\",\"fromId\":\"unknown\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].Available Memory (Avg)\",\"mergedName\":\"Average\",\"fromId\":\"unknown\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].Available Memory (Avg) Timeline\",\"mergedName\":\"Average % Rate\",\"fromId\":\"unknown\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].Available Memory (Min)\",\"mergedName\":\"Minimum\",\"fromId\":\"unknown\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].Available Memory (Min) Timeline\",\"mergedName\":\"Minimum % Rate\",\"fromId\":\"unknown\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].Available Memory (Max)\",\"mergedName\":\"Maximum\",\"fromId\":\"unknown\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].Available Memory (Max) Timeline\",\"mergedName\":\"Maximum % Rate\",\"fromId\":\"unknown\"},{\"originalName\":\"[Resource graph query].properties_hardwareProfile\",\"mergedName\":\"properties_hardwareProfile\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 3].resourceid\"},{\"originalName\":\"[query - 3].currency\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Disk Read Bytes\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Disk Read Bytes Timeline\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Disk Write Bytes Timeline\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Disk Write Bytes\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Network In Total\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Network In Total Timeline\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Network Out Total\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Network Out Total Timeline\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Percentage CPU\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].microsoft.compute/virtualmachines--Percentage CPU Timeline\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].CPU Max\"},{\"originalName\":\"[Azure Monitor VM Key Metrics].CPU Max Timeline\"},{\"originalName\":\"[Azure Advisor].solution\"},{\"originalName\":\"[Azure Advisor].action\"},{\"originalName\":\"[Azure Advisor].savings\"}]}",
                                      "size": 3,
                                      "showRefreshButton": true,
                                      "showExportToExcel": true,
                                      "queryType": 7,
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "Resource",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "Subscription",
                                            "formatter": 15,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true,
                                              "customColumnWidthSetting": "20ch"
                                            }
                                          },
                                          {
                                            "columnMatch": "Resource group",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Location",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "Size",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "resourceid",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Subscription1",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Name",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Average",
                                            "formatter": 8,
                                            "formatOptions": {
                                              "palette": "grayBlue"
                                            },
                                            "numberFormat": {
                                              "unit": 2,
                                              "options": {
                                                "style": "decimal",
                                                "maximumFractionDigits": 2
                                              }
                                            }
                                          },
                                          {
                                            "columnMatch": "Average % Rate",
                                            "formatter": 10,
                                            "formatOptions": {
                                              "palette": "gray"
                                            }
                                          },
                                          {
                                            "columnMatch": "Minimum",
                                            "formatter": 8,
                                            "formatOptions": {
                                              "palette": "blueGreen"
                                            },
                                            "numberFormat": {
                                              "unit": 2,
                                              "options": {
                                                "style": "decimal",
                                                "maximumFractionDigits": 2
                                              }
                                            }
                                          },
                                          {
                                            "columnMatch": "Minimum % Rate",
                                            "formatter": 21,
                                            "formatOptions": {
                                              "palette": "gray"
                                            }
                                          },
                                          {
                                            "columnMatch": "Maximum",
                                            "formatter": 8,
                                            "formatOptions": {
                                              "palette": "orange"
                                            },
                                            "numberFormat": {
                                              "unit": 2,
                                              "options": {
                                                "style": "decimal",
                                                "maximumFractionDigits": 2
                                              }
                                            }
                                          },
                                          {
                                            "columnMatch": "Maximum % Rate",
                                            "formatter": 10,
                                            "formatOptions": {
                                              "palette": "gray"
                                            }
                                          },
                                          {
                                            "columnMatch": "currency",
                                            "formatter": 5
                                          }
                                        ],
                                        "rowLimit": 10000
                                      }
                                    },
                                    "showPin": false,
                                    "name": "Merge ARG and Advisor"
                                  }
                                ]
                              },
                              "name": "Details"
                            }
                          ]
                        },
                        "name": "Compute Performance."
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "computeperformance"
                  },
                  "name": "Compute Performance"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "7bd0f21c-30f8-44e1-9e91-f9e87118bea9",
                              "version": "KqlParameterItem/1.0",
                              "name": "VirtualMachines",
                              "label": "Virtual Machines",
                              "type": 5,
                              "isRequired": true,
                              "query": "where type =~ 'microsoft.compute/virtualmachines'\r\n\t| order by name asc\r\n\t| extend Rank = row_number()\r\n\t| project value = id, label = id, selected = Rank <= 25",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": "/subscriptions/b17d03eb-4598-4cc2-9046-83a94e7c56ee/resourceGroups/vpk-eun-pr-spk-nondmz-rg/providers/Microsoft.Compute/virtualMachines/svbe-ompsbt01"
                            },
                            {
                              "id": "920babe0-e044-45a5-bbfe-cc6ddfb12679",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 259200000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VMComputer\r\n|distinct   _ResourceId ,Computer,DependencyAgentVersion,  VirtualMachineType,Type,AzureSize,AzureResourceGroup,AzureLocation\r\n",
                          "size": 3,
                          "title": "VM Overview",
                          "color": "green",
                          "queryType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "crossComponentResources": [
                            "{VirtualMachines}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "labelSettings": [
                              {
                                "columnId": "DependencyAgentVersion",
                                "label": "Dependency Agent Version"
                              },
                              {
                                "columnId": "VirtualMachineType",
                                "label": "Type"
                              },
                              {
                                "columnId": "Type",
                                "label": "VM Type"
                              },
                              {
                                "columnId": "AzureSize",
                                "label": "Size"
                              },
                              {
                                "columnId": "AzureResourceGroup",
                                "label": "Resource Group"
                              },
                              {
                                "columnId": "AzureLocation",
                                "label": "Location"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "resource",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "CpuSpeed",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "CpuSpeed",
                            "sizeAggregation": "Sum",
                            "legendMetric": "CpuSpeed",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "CpuSpeed",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "name": "VM Details - Copy",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook6dbb939e-9520-4f5c-a155-09a72e9c80bf",
                          "version": "MetricsItem/2.0",
                          "size": 1,
                          "chartType": 2,
                          "color": "green",
                          "resourceType": "microsoft.compute/virtualmachines",
                          "metricScope": 0,
                          "resourceParameter": "VirtualMachines",
                          "resourceIds": [
                            "{VirtualMachines}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 259200000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--VmAvailabilityMetric",
                              "aggregation": 4,
                              "splitBy": null
                            }
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource"
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--VmAvailabilityMetric Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--VmAvailabilityMetric",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": null
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "labelSettings": [
                              {
                                "columnId": "Subscription",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "Name",
                                "label": "Storage Name"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--VmAvailabilityMetric",
                                "label": "VM Availability Metric (Preview) (Average)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--VmAvailabilityMetric Timeline",
                                "label": "VM Availability Metric (Preview) Timeline"
                              }
                            ]
                          }
                        },
                        "name": "metric - 16 - Copy",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook6dbb939e-9520-4f5c-a155-09a72e9c80bf",
                          "version": "MetricsItem/2.0",
                          "size": 3,
                          "chartType": -1,
                          "color": "green",
                          "resourceType": "microsoft.compute/virtualmachines",
                          "metricScope": 0,
                          "resourceParameter": "VirtualMachines",
                          "resourceIds": [
                            "{VirtualMachines}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeGrain": "PT5M",
                          "metrics": [
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--VmAvailabilityMetric",
                              "aggregation": 4
                            }
                          ],
                          "title": "Availability",
                          "gridFormatType": 1,
                          "tileSettings": {
                            "titleContent": {
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "Value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "style": "percent",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": false
                          },
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource"
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--VmAvailabilityMetric Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--VmAvailabilityMetric",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": null
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "labelSettings": [
                              {
                                "columnId": "Subscription",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "Name",
                                "label": "Storage Name"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--VmAvailabilityMetric",
                                "label": "VM Availability Metric (Preview) (Average)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--VmAvailabilityMetric Timeline",
                                "label": "VM Availability Metric (Preview) Timeline"
                              }
                            ]
                          }
                        },
                        "customWidth": "40",
                        "name": "metric - 16"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Update\r\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification) by Computer, SourceComputerId, Product, ProductArch, _ResourceId\r\n| where UpdateState=~\"Needed\"\r\n| project Product, ProductArch, Classification, Computer, _ResourceId\r\n| summarize count() by _ResourceId",
                                "size": 0,
                                "timeContextFromParameter": "TimeRange",
                                "queryType": 0,
                                "resourceType": "microsoft.resources/subscriptions",
                                "crossComponentResources": [
                                  "{VirtualMachines}"
                                ],
                                "visualization": "table",
                                "graphSettings": {
                                  "type": 2,
                                  "topContent": {
                                    "columnMatch": "Computer",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "count_",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "nodeIdField": "Computer",
                                  "graphOrientation": 3,
                                  "showOrientationToggles": false,
                                  "nodeSize": null,
                                  "staticNodeSize": 100,
                                  "colorSettings": {
                                    "nodeColorField": "count_",
                                    "type": 4,
                                    "heatmapPalette": "greenRed",
                                    "heatmapMin": 0,
                                    "heatmapMax": 5,
                                    "emptyValueColor": "green"
                                  },
                                  "hivesMargin": 5
                                }
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "Number of Patches"
                            },
                            {
                              "type": 10,
                              "content": {
                                "chartId": "workbook2932b309-c598-450d-bcd3-c0acbf6b821a",
                                "version": "MetricsItem/2.0",
                                "size": 0,
                                "chartType": 0,
                                "resourceType": "microsoft.compute/virtualmachines",
                                "metricScope": 0,
                                "resourceParameter": "VirtualMachines",
                                "resourceIds": [
                                  "{VirtualMachines}"
                                ],
                                "timeContextFromParameter": "TimeRange",
                                "timeContext": {
                                  "durationMs": 259200000
                                },
                                "metrics": [
                                  {
                                    "namespace": "microsoft.compute/virtualmachines",
                                    "metric": "microsoft.compute/virtualmachines--Percentage CPU",
                                    "aggregation": 4
                                  }
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "Subscription",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Name",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource"
                                      }
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--Percentage CPU Timeline",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--Percentage CPU",
                                      "formatter": 1,
                                      "numberFormat": {
                                        "unit": 1,
                                        "options": null
                                      }
                                    }
                                  ],
                                  "rowLimit": 10000,
                                  "labelSettings": [
                                    {
                                      "columnId": "Subscription",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "Name",
                                      "label": "Storage Name"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Percentage CPU",
                                      "label": "Percentage CPU (Average)"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Percentage CPU Timeline",
                                      "label": "Percentage CPU Timeline"
                                    }
                                  ]
                                }
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tab Name",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "Virtual Machine List"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"c5b3741f-00a8-46fd-8e7d-8b6e2d0010f8\",\"mergeType\":\"leftouter\",\"leftTable\":\"Virtual Machine List\",\"rightTable\":\"Number of Patches\",\"leftColumn\":\"Name\",\"rightColumn\":\"_ResourceId\"}],\"projectRename\":[{\"originalName\":\"[Virtual Machine List].Subscription\",\"mergedName\":\"Subscription Name\",\"fromId\":\"c5b3741f-00a8-46fd-8e7d-8b6e2d0010f8\"},{\"originalName\":\"[Virtual Machine List].Name\",\"mergedName\":\"Virtual Machine Name\",\"fromId\":\"c5b3741f-00a8-46fd-8e7d-8b6e2d0010f8\"},{\"originalName\":\"[Number of Patches].count_\",\"mergedName\":\"Number Of Patches\",\"fromId\":\"c5b3741f-00a8-46fd-8e7d-8b6e2d0010f8\"},{\"originalName\":\"[VM List].microsoft.compute/virtualmachines--Percentage CPU\"},{\"originalName\":\"[VM List].microsoft.compute/virtualmachines--Percentage CPU Timeline\"},{\"originalName\":\"[num of patches]._ResourceId\"},{\"originalName\":\"[Virtual Machine List].microsoft.compute/virtualmachines--Percentage CPU Timeline\"},{\"originalName\":\"[Virtual Machine List].microsoft.compute/virtualmachines--Percentage CPU\"},{\"originalName\":\"[Number of Patches]._ResourceId\"}]}",
                                "size": 3,
                                "title": "Patching Status",
                                "queryType": 7,
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "Number Of Patches",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "==",
                                          "thresholdValue": "0",
                                          "representation": "success",
                                          "text": "Patched"
                                        },
                                        {
                                          "operator": ">",
                                          "thresholdValue": "0",
                                          "representation": "4",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "success",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "showBorder": false,
                                  "size": "auto"
                                },
                                "graphSettings": {
                                  "type": 2,
                                  "topContent": {
                                    "columnMatch": "Virtual Machine Name",
                                    "formatter": 13,
                                    "formatOptions": {
                                      "linkTarget": null,
                                      "showIcon": false
                                    }
                                  },
                                  "centerContent": {
                                    "columnMatch": "Number Of Patches",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal"
                                      },
                                      "emptyValCustomText": "0"
                                    }
                                  },
                                  "nodeIdField": "Virtual Machine Name",
                                  "graphOrientation": 3,
                                  "showOrientationToggles": false,
                                  "nodeSize": null,
                                  "staticNodeSize": 100,
                                  "colorSettings": {
                                    "nodeColorField": "Number Of Patches",
                                    "type": 4,
                                    "heatmapPalette": "greenRed",
                                    "heatmapMin": 0,
                                    "heatmapMax": 1,
                                    "emptyValueColor": "green"
                                  },
                                  "hivesMargin": 2
                                }
                              },
                              "customWidth": "40",
                              "showPin": false,
                              "name": "query - 2"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "group - 4"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VMComputer\r\n|distinct  AzureUpdateDomain,AzureFaultDomain,  tostring(Ipv4Addresses), tostring(Ipv4DefaultGateways), tostring(Ipv4SubnetMasks),tostring(MacAddresses)\r\n",
                          "size": 3,
                          "title": "Configuration & Network Details",
                          "color": "green",
                          "queryType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "crossComponentResources": [
                            "{VirtualMachines}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "labelSettings": [
                              {
                                "columnId": "AzureUpdateDomain",
                                "label": "Update Domain"
                              },
                              {
                                "columnId": "AzureFaultDomain",
                                "label": "Fault Domain"
                              },
                              {
                                "columnId": "Ipv4Addresses",
                                "label": "IP"
                              },
                              {
                                "columnId": "Ipv4DefaultGateways",
                                "label": "Gateway"
                              },
                              {
                                "columnId": "Ipv4SubnetMasks",
                                "label": "Subnet Mask"
                              },
                              {
                                "columnId": "MacAddresses",
                                "label": "MAC Address"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "resource",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "CpuSpeed",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "CpuSpeed",
                            "sizeAggregation": "Sum",
                            "legendMetric": "CpuSpeed",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "CpuSpeed",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "name": "Netowrking Details",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VMComputer\r\n|distinct  OperatingSystemFamily, OperatingSystemFullName\r\n",
                          "size": 3,
                          "title": "OS Details",
                          "color": "green",
                          "queryType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "crossComponentResources": [
                            "{VirtualMachines}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "labelSettings": [
                              {
                                "columnId": "OperatingSystemFamily",
                                "label": "OS"
                              },
                              {
                                "columnId": "OperatingSystemFullName",
                                "label": "Version"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "OperatingSystemFamily",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "orange"
                              }
                            },
                            "leftContent": {
                              "columnMatch": "OperatingSystemFullName"
                            },
                            "showBorder": false,
                            "size": "auto"
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "CpuSpeed",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "CpuSpeed",
                            "sizeAggregation": "Sum",
                            "legendMetric": "CpuSpeed",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "CpuSpeed",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "OS Details",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VMComputer\r\n|distinct   PhysicalMemoryMB ,Cpus,CpuSpeed",
                          "size": 3,
                          "title": "Capacity Details",
                          "color": "green",
                          "queryType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "crossComponentResources": [
                            "{VirtualMachines}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "labelSettings": [
                              {
                                "columnId": "PhysicalMemoryMB",
                                "label": "Memory (MB)"
                              },
                              {
                                "columnId": "Cpus",
                                "label": "CPU"
                              },
                              {
                                "columnId": "CpuSpeed",
                                "label": "CPU Speed"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "resource",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "CpuSpeed",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "CpuSpeed",
                            "sizeAggregation": "Sum",
                            "legendMetric": "CpuSpeed",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "CpuSpeed",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "VM Name - Copy - Copy - Copy",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook9661841b-f22f-4597-8eef-dc179ad740b5",
                          "version": "MetricsItem/2.0",
                          "size": 3,
                          "chartType": -1,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "metricScope": 0,
                          "resourceParameter": "VirtualMachines",
                          "resourceIds": [
                            "{VirtualMachines}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 259200000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Network In Total",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Network Out Total",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--OS Disk Write Operations/Sec",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--OS Disk Read Operations/Sec",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Data Disk Write Operations/Sec",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Disk Read Operations/Sec",
                              "aggregation": 4
                            }
                          ],
                          "gridFormatType": 1,
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Metric",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": false
                              }
                            },
                            "subtitleContent": {
                              "columnMatch": "Aggregation"
                            },
                            "leftContent": {
                              "columnMatch": "Value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": false
                          },
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "name": "VM Metrics",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookaa8f3450-485a-4c8e-87db-f85a1c96594d",
                          "version": "MetricsItem/2.0",
                          "size": 3,
                          "chartType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "metricScope": 0,
                          "resourceParameter": "VirtualMachines",
                          "resourceIds": [
                            "{VirtualMachines}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 259200000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage",
                              "aggregation": 2
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage",
                              "aggregation": 3
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage",
                              "aggregation": 2
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage",
                              "aggregation": 3
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage",
                              "aggregation": 4
                            }
                          ],
                          "title": "IOPS",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage Timeline",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 10000,
                            "sortBy": [
                              {
                                "itemKey": "$gen_link_Name_1",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Subscription",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "Name",
                                "label": "Storage Name"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage",
                                "label": "OS Disk IOPS (AVG)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage Timeline",
                                "label": "OS Disk IOPS Consumed Percentage Timeline"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage",
                                "label": "OS Disk IOPS (AVG)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage Timeline",
                                "label": "OS Disk IOPS Consumed Percentage Timeline"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage",
                                "label": "OS Disk IOPS (AVG)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage Timeline",
                                "label": "OS Disk IOPS Consumed Percentage Timeline"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage",
                                "label": "Data Disk IOPS Consumed Percentage (Min)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage Timeline",
                                "label": "Data Disk IOPS Consumed Percentage Timeline"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage",
                                "label": "Data Disk IOPS Consumed Percentage (Min)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage Timeline",
                                "label": "Data Disk IOPS Consumed Percentage Timeline"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage",
                                "label": "Data Disk IOPS Consumed Percentage (Min)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage Timeline",
                                "label": "Data Disk IOPS Consumed Percentage Timeline"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_link_Name_1",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "name": "metric - 5",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookdb898a17-dacf-4b8e-ab4e-7d6b023a81c2",
                          "version": "MetricsItem/2.0",
                          "size": 3,
                          "chartType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "metricScope": 0,
                          "resourceParameter": "VirtualMachines",
                          "resourceIds": [
                            "{VirtualMachines}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 259200000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--OS Disk Read Operations/Sec",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--OS Disk Write Operations/Sec",
                              "aggregation": 4
                            }
                          ],
                          "title": "OS Disk Read and Write Operations",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk Target IOPS",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk Target IOPS Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk Target IOPS",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk Target IOPS Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/disks-Disk Performance-Composite Disk Read Operations/sec Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/disks-Disk Performance-Composite Disk Read Operations/sec",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 31,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Metric",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Aggregation",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Value",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Timeline",
                                "formatter": 9
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk Read Operations/Sec",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 31,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk Read Operations/Sec",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 31,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk Write Operations/Sec",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 31,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk Write Operations/Sec",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 31,
                                  "options": null
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "labelSettings": [
                              {
                                "columnId": "Subscription",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "Name",
                                "label": "Storage Name"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--OS Disk Read Operations/Sec",
                                "label": "OS Disk Read Operations/Sec (Average)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--OS Disk Read Operations/Sec Timeline",
                                "label": "OS Disk Read Operations/Sec Timeline"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--OS Disk Write Operations/Sec",
                                "label": "OS Disk Write Operations/Sec (Average)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--OS Disk Write Operations/Sec Timeline",
                                "label": "OS Disk Write Operations/Sec Timeline"
                              }
                            ]
                          }
                        },
                        "name": "metric - 2 - Copy",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookdb898a17-dacf-4b8e-ab4e-7d6b023a81c2",
                          "version": "MetricsItem/2.0",
                          "size": 3,
                          "chartType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "metricScope": 0,
                          "resourceParameter": "VirtualMachines",
                          "resourceIds": [
                            "{VirtualMachines}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 259200000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Data Disk Read Operations/Sec",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Data Disk Write Operations/Sec",
                              "aggregation": 4
                            }
                          ],
                          "title": "Data Disk Read and Write Operations",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk Target IOPS",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk Target IOPS Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk IOPS Consumed Percentage Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk Target IOPS",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk Target IOPS Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk IOPS Consumed Percentage Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/disks-Disk Performance-Composite Disk Read Operations/sec Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/disks-Disk Performance-Composite Disk Read Operations/sec",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 31,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Metric",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Aggregation",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Value",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Timeline",
                                "formatter": 9
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk Read Operations/Sec",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 31,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk Read Operations/Sec",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 31,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Data Disk Write Operations/Sec",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 31,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--OS Disk Write Operations/Sec",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 31,
                                  "options": null
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "labelSettings": [
                              {
                                "columnId": "Subscription",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "Name",
                                "label": "Storage Name"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Data Disk Read Operations/Sec",
                                "label": "Data Disk Read Operations/Sec (Average)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Data Disk Read Operations/Sec Timeline",
                                "label": "Data Disk Read Operations/Sec (Average) Timeline"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Data Disk Write Operations/Sec",
                                "label": "Data Disk Write Operations/Sec (Average)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Data Disk Write Operations/Sec Timeline",
                                "label": "Data Disk Write Operations/Sec (Average) Timeline"
                              }
                            ]
                          }
                        },
                        "name": "metric - 2 - Copy - Copy",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook95f2a469-3090-4fe7-878b-b0cc0d88a646",
                          "version": "MetricsItem/2.0",
                          "size": 4,
                          "chartType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "metricScope": 0,
                          "resourceParameter": "VirtualMachines",
                          "resourceIds": [
                            "{VirtualMachines}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 259200000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Percentage CPU",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Disk Read Bytes",
                              "aggregation": 1
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Disk Write Bytes",
                              "aggregation": 1
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Network In Total",
                              "aggregation": 1
                            },
                            {
                              "namespace": "microsoft.compute/virtualmachines",
                              "metric": "microsoft.compute/virtualmachines--Network Out Total",
                              "aggregation": 1
                            }
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Name",
                              "formatter": 13
                            },
                            "leftContent": {
                              "columnMatch": "Value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "resourceLimit": 10000,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 5,
                                "formatOptions": {
                                  "linkTarget": "Resource"
                                }
                              },
                              {
                                "columnMatch": "Metric",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Aggregation",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Value",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Timeline",
                                "formatter": 9,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              },
                              {
                                "columnMatch": "-- Group By --",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Percentage CPU",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "linkTarget": "WorkbookTemplate",
                                  "workbookContext": {
                                    "componentIdSource": "column",
                                    "componentId": "Name",
                                    "resourceIdsSource": "column",
                                    "resourceIds": "Name",
                                    "templateIdSource": "static",
                                    "templateId": "COS//Virtual Machines/Virtual machine details",
                                    "typeSource": "static",
                                    "type": "workbook",
                                    "gallerySource": "static",
                                    "gallery": "microsoft.compute/virtualmachines",
                                    "locationSource": "default"
                                  }
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Percentage CPU Timeline",
                                "formatter": 21,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue"
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Disk Read Bytes",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "yellow"
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Disk Read Bytes Timeline",
                                "formatter": 5,
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Disk Write Bytes",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "yellow"
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Disk Write Bytes Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Network In Total",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "orange"
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Network In Total Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Network Out Total",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 2,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.compute/virtualmachines--Network Out Total Timeline",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 10000,
                            "sortBy": [
                              {
                                "itemKey": "$gen_heatmap_microsoft.compute/virtualmachines--Percentage CPU_2",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Subscription",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "Name",
                                "label": "Storage Name"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Percentage CPU",
                                "label": "Percentage CPU (Average)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Percentage CPU Timeline",
                                "label": "Percentage CPU Timeline"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Disk Read Bytes",
                                "label": "Disk Read Bytes (Sum)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Disk Read Bytes Timeline",
                                "label": "Disk Read Bytes Timeline"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Disk Write Bytes",
                                "label": "Disk Write Bytes (Sum)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Disk Write Bytes Timeline",
                                "label": "Disk Write Bytes Timeline"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Network In Total",
                                "label": "Network In Total (Sum)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Network In Total Timeline",
                                "label": "Network In Total Timeline"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Network Out Total",
                                "label": "Network Out Total (Sum)"
                              },
                              {
                                "columnId": "microsoft.compute/virtualmachines--Network Out Total Timeline",
                                "label": "Network Out Total Timeline"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_heatmap_microsoft.compute/virtualmachines--Percentage CPU_2",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "name": "metric - 4",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Virtual Machine available memory \r\n// Virtual Machine available memory. \r\nInsightsMetrics\r\n\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"Memory\"\r\n| where Name == \"AvailableMB\"\r\n| summarize avg(Val) by bin(TimeGenerated, 5m), Computer\r\n| render timechart ",
                          "size": 1,
                          "title": "Available Memory",
                          "color": "orange",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "crossComponentResources": [
                            "{VirtualMachines}"
                          ],
                          "visualization": "timechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "avg_Val",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "avg_Val",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "avg_Val",
                            "sizeAggregation": "Sum",
                            "legendMetric": "avg_Val",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "avg_Val",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 4"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Chart CPU usage trends by computer\r\n// Calculate CPU usage patterns over the last hour, chart by percentiles.\r\nInsightsMetrics\r\n\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"Processor\"\r\n| where Name == \"UtilizationPercentage\"\r\n| summarize avg(Val) by bin(TimeGenerated, 5m), Computer //split up by computer\r\n| render timechart",
                          "size": 1,
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "crossComponentResources": [
                            "{VirtualMachines}"
                          ]
                        },
                        "customWidth": "50",
                        "name": "query - 5"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VMConnection\r\n| where TimeGenerated {TimeRange}\r\n| summarize Data=sum(BytesReceived + BytesSent ), Sent=sum(BytesSent), Received=sum(BytesReceived) by Computer\r\n| project Computer=strcat('💻 ', Computer), Data, Received, Sent\r\n| sort by Data desc",
                          "size": 3,
                          "title": "VM (Network Traffic)",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "crossComponentResources": [
                            "{VirtualMachines}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Data",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Sent",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "orange",
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Received",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "green",
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 9"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VMConnection\r\n| where TimeGenerated {TimeRange}\r\n| summarize Data=sum(BytesReceived + BytesSent), Received=sum(BytesReceived), Sent=sum(BytesSent), Sessions=dcount(ConnectionId) by RemoteIp, RemoteCountry\r\n| project   RemoteIp=strcat('🌐 ', RemoteIp), Data, Received, Sent, Sessions, RemoteCountry\r\n| sort by Data desc",
                          "size": 3,
                          "title": "Top Destinations (Remote IPs)",
                          "noDataMessage": "No destination traffic found",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "crossComponentResources": [
                            "{VirtualMachines}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Data",
                                "formatter": 8,
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Received",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "green"
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Sent",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "orange"
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Sessions",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "purple"
                                },
                                "numberFormat": {
                                  "unit": 17,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "RemoteCountry"
                              ]
                            },
                            "labelSettings": [
                              {
                                "columnId": "RemoteIp",
                                "label": "Remote IP"
                              },
                              {
                                "columnId": "RemoteCountry",
                                "label": "Remote Country"
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 11"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VMBoundPort\n| where Ip != \"127.0.0.1\"\n| summarize BytesSent=sum(BytesSent), BytesReceived=sum(BytesReceived), LinksEstablished=sum(LinksEstablished), LinksTerminated=sum(LinksTerminated), arg_max(TimeGenerated, LinksLive) by Computer, ProcessName, Ip, Port, IsWildcardBind\n| project-away TimeGenerated\n| order by BytesSent desc",
                          "size": 3,
                          "title": "VM Traffic to Ports",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.compute/virtualmachines",
                          "crossComponentResources": [
                            "{VirtualMachines}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "BytesSent",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "orange"
                                },
                                "numberFormat": {
                                  "unit": 17,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "BytesReceived",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "green"
                                },
                                "numberFormat": {
                                  "unit": 17,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "LinksEstablished",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blueDark"
                                }
                              },
                              {
                                "columnMatch": "LinksTerminated",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blueDark"
                                }
                              },
                              {
                                "columnMatch": "LinksLive",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blueDark"
                                }
                              },
                              {
                                "columnMatch": "Group",
                                "formatter": 1
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "ProcessName",
                                "label": "Process Name"
                              },
                              {
                                "columnId": "Ip",
                                "label": "IP Address"
                              },
                              {
                                "columnId": "IsWildcardBind",
                                "label": "Is  WildCard Bind ?"
                              },
                              {
                                "columnId": "BytesSent",
                                "label": "Bytes Sent"
                              },
                              {
                                "columnId": "BytesReceived",
                                "label": "Bytes Recieved"
                              },
                              {
                                "columnId": "LinksEstablished",
                                "label": "Links Established"
                              },
                              {
                                "columnId": "LinksTerminated",
                                "label": "Links Terminated"
                              },
                              {
                                "columnId": "LinksLive",
                                "label": "Links Live"
                              }
                            ]
                          }
                        },
                        "name": "query - 2"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "vmperformance"
                  },
                  "name": "VM Performance"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "7d3239b1-19a0-44fd-a771-df82340e0d88",
                              "version": "KqlParameterItem/1.0",
                              "name": "DefaultResource",
                              "type": 5,
                              "value": "value::1",
                              "isHiddenWhenLocked": true,
                              "typeSettings": {
                                "resourceTypeFilter": {
                                  "microsoft.resources/subscriptions": true,
                                  "microsoft.resources/resourcegroups": true
                                },
                                "additionalResourceOptions": [
                                  "value::1"
                                ]
                              }
                            },
                            {
                              "id": "0caf61ec-d776-4642-8553-5293060a62c7",
                              "version": "KqlParameterItem/1.0",
                              "name": "ContextFree",
                              "type": 1,
                              "query": "{\"version\":\"1.0.0\",\"content\":\"\\\"{DefaultResource}\\\"\"}",
                              "isHiddenWhenLocked": true,
                              "queryType": 8
                            },
                            {
                              "id": "6e82c4c1-769e-4549-bd80-b356ef999efa",
                              "version": "KqlParameterItem/1.0",
                              "name": "Selection",
                              "type": 1,
                              "query": "take 1\r\n| extend x = split ({DefaultResource:value}, '/')\r\n| project value = tostring(pack('sub', x[2], 'rg', case(x[4] != 'null', x[4], ''), 'vm', case(x[8] != 'null', x[8], '')))",
                              "crossComponentResources": [
                                "value::selected"
                              ],
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "ff31cd1b-224e-42bd-8d65-f803ca13ce13",
                              "version": "KqlParameterItem/1.0",
                              "name": "Resources",
                              "label": "Virtual machines",
                              "type": 5,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "Resources \r\n| where resourceGroup in~({ResourceGroup}) and type in~('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets')\r\n| project id, name, selected=false, group=iff(type =~ \"microsoft.compute/virtualmachines\", \"Virtual machines\", \"Virtual machine scale sets\")",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::5",
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::5",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "feb5ccab-6fe6-4c5f-9161-ca0e412bd637",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time range",
                              "type": 4,
                              "value": {
                                "durationMs": 1800000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  }
                                ],
                                "allowCustom": true
                              }
                            },
                            {
                              "id": "d643672d-1bc2-497d-a5ce-20f631ee9399",
                              "version": "KqlParameterItem/1.0",
                              "name": "ResourceScope",
                              "type": 7,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "Resources\r\n| take 1\r\n| project x = dynamic([\"microsoft.compute/virtualmachines\", \"microsoft.compute/virtualmachinescalesets\", \"microsoft.resources/resourcegroups\", \"microsoft.resources/subscriptions\"])\r\n| mvexpand x to typeof(string)\r\n| extend jkey = 1\r\n| join kind = inner (Resources \r\n| where id in~ ({Resources})\r\n| summarize Subs = dcount(subscriptionId), resourceGroups = dcount(resourceGroup), resourceCount = count()\r\n| extend jkey = 1) on jkey\r\n| project x, label = 'x', selected = case(x in ('microsoft.compute/virtualmachinescalesets', 'microsoft.compute/virtualmachines') and resourceCount <= 5, true, x == 'microsoft.resources/resourcegroups' and resourceGroups <= 3 and resourceCount > 5, true, x == 'microsoft.resources/subscriptions' and resourceGroups > 3 and resourceCount > 5, true, false)\r\n",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "isHiddenWhenLocked": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "1a0a93cf-0406-40d1-80e1-572b1a8d640e",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeGrain",
                              "type": 2,
                              "isRequired": true,
                              "value": "30m",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"1 minute\",\r\n        \"value\": \"1m\"\r\n    },\r\n    {\r\n        \"label\": \"5 minutes\",\r\n        \"value\": \"5m\"\r\n    },\r\n    {\r\n        \"label\": \"15 minutes\",\r\n        \"value\": \"15m\"\r\n    },\r\n    {\r\n        \"label\": \"30 minutes\",\r\n        \"value\": \"30m\"\r\n    },\r\n    {\r\n        \"label\": \"1 hour\",\r\n        \"value\": \"1h\"\r\n    }\r\n]"
                            },
                            {
                              "id": "112823d7-bf58-4604-a299-78ccc5899516",
                              "version": "KqlParameterItem/1.0",
                              "name": "LineChartQuerySnippet",
                              "type": 1,
                              "query": "print(\"bin(TimeGenerated, {TimeGrain}), ResourceName | render linechart\")",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "7055a395-0d53-4724-93ad-15e03d4e2ffa",
                              "version": "KqlParameterItem/1.0",
                              "name": "GridQuerySnippet",
                              "type": 1,
                              "value": "ResourceName",
                              "isHiddenWhenLocked": true
                            },
                            {
                              "id": "9c56155c-9a7e-41db-ac56-40cabb7d7ddf",
                              "version": "KqlParameterItem/1.0",
                              "name": "TopN",
                              "type": 1,
                              "isRequired": true,
                              "query": "print 5",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "4261aa48-5274-47a9-8642-1618c8aa7a95",
                              "version": "KqlParameterItem/1.0",
                              "name": "Mode",
                              "type": 2,
                              "isRequired": true,
                              "value": "1",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"Locked\",\r\n        \"value\": \"1\"\r\n    },\r\n    {\r\n        \"label\": \"Unlocked\",\r\n        \"value\": \"0\"\r\n    }\r\n]"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions"
                        },
                        "name": "parameters - 0"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "parameters": [
                            {
                              "id": "aa2368fc-ad30-4608-b96a-72abf7b1e1af",
                              "version": "KqlParameterItem/1.0",
                              "name": "Counter1",
                              "label": "Counter",
                              "type": 2,
                              "isRequired": true,
                              "query": "InsightsMetrics\r\n| where TimeGenerated {TimeRange}\r\n| summarize by Name, Namespace, CounterText = Name\r\n| order by Namespace asc, CounterText asc\r\n| project Counter = pack('counter', Name, 'object', Namespace), CounterText, group = Namespace",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "6a7306ea-247f-46ca-abca-501911f9e9d3",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregator1",
                              "label": "Trend Aggregator",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"Average = round(avg(Val), 2)\", \"label\":\"Average\", \"selected\":false},\r\n    { \"value\":\"P5th = round(percentile(Val, 5), 2)\", \"label\":\"P5th\", \"selected\":false},\r\n    { \"value\":\"P10th = round(percentile(Val, 10), 2)\", \"label\":\"P10th\", \"selected\":false},\r\n    { \"value\":\"P50th = round(percentile(Val, 50), 2)\", \"label\":\"P50th\", \"selected\":false},\r\n    { \"value\":\"P80th = round(percentile(Val, 80), 2)\", \"label\":\"P80th\", \"selected\":false},\r\n    { \"value\":\"P90th = round(percentile(Val, 90), 2)\", \"label\":\"P90th\", \"selected\":false},\r\n    { \"value\":\"P95th = round(percentile(Val, 95), 2)\", \"label\":\"P95th\", \"selected\":true}    \r\n]"
                            },
                            {
                              "id": "0327f26e-cdde-4b48-b512-6c35f06ad1d0",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregatorOrder1",
                              "type": 1,
                              "query": "print(iff('{TrendAggregator1:label}' == 'P5th'  or '{TrendAggregator1:label}' == 'P10th', 'asc', 'desc'))",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "d026cf36-d22e-4f92-a577-94220726ba3f",
                              "version": "KqlParameterItem/1.0",
                              "name": "Visualization",
                              "type": 2,
                              "isRequired": true,
                              "query": "datatable (value:long, Display:string, isSelected:boolean)\r\n    [0, \"Line Chart\", true,\r\n     1, \"Grid\", false]",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "a9ac011f-176f-4c31-b82e-139aba93a426",
                              "version": "KqlParameterItem/1.0",
                              "name": "Snippet1",
                              "type": 1,
                              "isRequired": true,
                              "query": "print(iff({Visualization} == 0, \"{LineChartQuerySnippet}\", \"{GridQuerySnippet}\") )",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "26106dfe-4e33-4c7c-b4b6-2eff5cc76476",
                              "version": "KqlParameterItem/1.0",
                              "name": "Unit",
                              "type": 2,
                              "value": null,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"B -> MB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"B -> GB\",\r\n        \"value\": \"/1024/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> GB\",\r\n        \"value\": \"/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> TB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Mb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Gb\",\r\n        \"value\": \"/1000/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Gb\",\r\n        \"value\": \"/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Tb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"s -> ms\",\r\n        \"value\": \"*1000\"\r\n    },\r\n    {\r\n        \"label\": \"ms -> s\",\r\n        \"value\": \"/1000\"\r\n    }\r\n]"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions"
                        },
                        "customWidth": "25",
                        "conditionalVisibility": {
                          "parameterName": "Mode",
                          "comparison": "isEqualTo",
                          "value": "0"
                        },
                        "name": "parameters - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "parameters": [
                            {
                              "id": "aa2368fc-ad30-4608-b96a-72abf7b1e1af",
                              "version": "KqlParameterItem/1.0",
                              "name": "Counter2",
                              "type": 2,
                              "isRequired": true,
                              "query": "InsightsMetrics\r\n| where TimeGenerated {TimeRange}\r\n| summarize by Name, Namespace, CounterText = Name\r\n| order by Namespace asc, CounterText asc\r\n| project Counter = pack('counter', Name, 'object', Namespace), CounterText, group = Namespace",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "value": "{\"counter\":\"AvailableMB\",\"object\":\"Memory\"}",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "6a7306ea-247f-46ca-abca-501911f9e9d3",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregator2",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"Average = round(avg(Val), 2)\", \"label\":\"Average\", \"selected\":false},\r\n    { \"value\":\"P5th = round(percentile(Val, 5), 2)\", \"label\":\"P5th\", \"selected\":false},\r\n    { \"value\":\"P10th = round(percentile(Val, 10), 2)\", \"label\":\"P10th\", \"selected\":false},\r\n    { \"value\":\"P50th = round(percentile(Val, 50), 2)\", \"label\":\"P50th\", \"selected\":false},\r\n    { \"value\":\"P80th = round(percentile(Val, 80), 2)\", \"label\":\"P80th\", \"selected\":false},\r\n    { \"value\":\"P90th = round(percentile(Val, 90), 2)\", \"label\":\"P90th\", \"selected\":false},\r\n    { \"value\":\"P95th = round(percentile(Val, 95), 2)\", \"label\":\"P95th\", \"selected\":true}    \r\n]",
                              "value": "P5th = round(percentile(Val, 5), 2)"
                            },
                            {
                              "id": "0327f26e-cdde-4b48-b512-6c35f06ad1d0",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregatorOrder2",
                              "type": 1,
                              "query": "print(iff('{TrendAggregator2:label}' == 'P5th'  or '{TrendAggregator2:label}' == 'P10th', 'asc', 'desc'))",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "bf55b759-7b6a-4ea6-8040-e3e6cc2ffe25",
                              "version": "KqlParameterItem/1.0",
                              "name": "Visualization2",
                              "type": 2,
                              "isRequired": true,
                              "query": "datatable (value:long, Display:string, isSelected:boolean)\r\n    [0, \"Line Chart\", true,\r\n     1, \"Grid\", false]",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "de7bf116-f413-457b-8c71-fb95cc6adc87",
                              "version": "KqlParameterItem/1.0",
                              "name": "Snippet2",
                              "type": 1,
                              "isRequired": true,
                              "query": "print(iff({Visualization2} == 0, \"{LineChartQuerySnippet}\", \"{GridQuerySnippet}\") )",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "2ce20c70-a462-4c7d-b5af-7f3b4cc27511",
                              "version": "KqlParameterItem/1.0",
                              "name": "Unit2",
                              "type": 2,
                              "value": null,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"B -> MB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"B -> GB\",\r\n        \"value\": \"/1024/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> GB\",\r\n        \"value\": \"/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> TB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Mb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Gb\",\r\n        \"value\": \"/1000/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Gb\",\r\n        \"value\": \"/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Tb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"s -> ms\",\r\n        \"value\": \"*1000\"\r\n    },\r\n    {\r\n        \"label\": \"ms -> s\",\r\n        \"value\": \"/1000\"\r\n    }\r\n]"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions"
                        },
                        "customWidth": "25",
                        "conditionalVisibility": {
                          "parameterName": "Mode",
                          "comparison": "isEqualTo",
                          "value": "0"
                        },
                        "name": "parameters - 3"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "parameters": [
                            {
                              "id": "aa2368fc-ad30-4608-b96a-72abf7b1e1af",
                              "version": "KqlParameterItem/1.0",
                              "name": "Counter3",
                              "type": 2,
                              "isRequired": true,
                              "query": "InsightsMetrics\r\n| where TimeGenerated {TimeRange}\r\n| summarize by Name, Namespace, CounterText = Name\r\n| order by Namespace asc, CounterText asc\r\n| project Counter = pack('counter', Name, 'object', Namespace), CounterText, group = Namespace",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "value": "{\"counter\":\"UtilizationPercentage\",\"object\":\"Processor\"}",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1"
                                ]
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "6a7306ea-247f-46ca-abca-501911f9e9d3",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregator3",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"Average = round(avg(Val), 2)\", \"label\":\"Average\", \"selected\":false},\r\n    { \"value\":\"P5th = round(percentile(Val, 5), 2)\", \"label\":\"P5th\", \"selected\":false},\r\n    { \"value\":\"P10th = round(percentile(Val, 10), 2)\", \"label\":\"P10th\", \"selected\":false},\r\n    { \"value\":\"P50th = round(percentile(Val, 50), 2)\", \"label\":\"P50th\", \"selected\":false},\r\n    { \"value\":\"P80th = round(percentile(Val, 80), 2)\", \"label\":\"P80th\", \"selected\":false},\r\n    { \"value\":\"P90th = round(percentile(Val, 90), 2)\", \"label\":\"P90th\", \"selected\":false},\r\n    { \"value\":\"P95th = round(percentile(Val, 95), 2)\", \"label\":\"P95th\", \"selected\":true}    \r\n]"
                            },
                            {
                              "id": "0327f26e-cdde-4b48-b512-6c35f06ad1d0",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregatorOrder3",
                              "type": 1,
                              "query": "print(iff('{TrendAggregator3:label}' == 'P5th'  or '{TrendAggregator3:label}' == 'P10th', 'asc', 'desc'))",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "db1c9737-0d87-41ad-8f3c-f22c853be400",
                              "version": "KqlParameterItem/1.0",
                              "name": "Visualization3",
                              "type": 2,
                              "isRequired": true,
                              "query": "datatable (value:long, Display:string, isSelected:boolean)\r\n    [0, \"Line Chart\", true,\r\n     1, \"Grid\", false]",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "82cef2b6-4ce0-4a64-bd64-017810211147",
                              "version": "KqlParameterItem/1.0",
                              "name": "Snippet3",
                              "type": 1,
                              "isRequired": true,
                              "query": "print(iff({Visualization3} == 0, \"{LineChartQuerySnippet}\", \"{GridQuerySnippet}\") )",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "def72a65-f496-4619-8fcb-85c338641907",
                              "version": "KqlParameterItem/1.0",
                              "name": "Unit3",
                              "type": 2,
                              "value": null,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"B -> MB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"B -> GB\",\r\n        \"value\": \"/1024/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> GB\",\r\n        \"value\": \"/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> TB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Mb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Gb\",\r\n        \"value\": \"/1000/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Gb\",\r\n        \"value\": \"/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Tb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"s -> ms\",\r\n        \"value\": \"*1000\"\r\n    },\r\n    {\r\n        \"label\": \"ms -> s\",\r\n        \"value\": \"/1000\"\r\n    }\r\n]"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions"
                        },
                        "customWidth": "25",
                        "conditionalVisibility": {
                          "parameterName": "Mode",
                          "comparison": "isEqualTo",
                          "value": "0"
                        },
                        "name": "parameters - 4"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "parameters": [
                            {
                              "id": "aa2368fc-ad30-4608-b96a-72abf7b1e1af",
                              "version": "KqlParameterItem/1.0",
                              "name": "Counter4",
                              "type": 2,
                              "isRequired": true,
                              "query": "InsightsMetrics\r\n| where TimeGenerated {TimeRange}\r\n| summarize by Name, Namespace, CounterText = Name\r\n| order by Namespace asc, CounterText asc\r\n| project Counter = pack('counter', Name, 'object', Namespace), CounterText, group = Namespace",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "value": "{\"counter\":\"BytesPerSecond\",\"object\":\"LogicalDisk\"}",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "6a7306ea-247f-46ca-abca-501911f9e9d3",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregator4",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"Average = round(avg(Val), 2)\", \"label\":\"Average\", \"selected\":false},\r\n    { \"value\":\"P5th = round(percentile(Val, 5), 2)\", \"label\":\"P5th\", \"selected\":false},\r\n    { \"value\":\"P10th = round(percentile(Val, 10), 2)\", \"label\":\"P10th\", \"selected\":false},\r\n    { \"value\":\"P50th = round(percentile(Val, 50), 2)\", \"label\":\"P50th\", \"selected\":false},\r\n    { \"value\":\"P80th = round(percentile(Val, 80), 2)\", \"label\":\"P80th\", \"selected\":false},\r\n    { \"value\":\"P90th = round(percentile(Val, 90), 2)\", \"label\":\"P90th\", \"selected\":false},\r\n    { \"value\":\"P95th = round(percentile(Val, 95), 2)\", \"label\":\"P95th\", \"selected\":true}    \r\n]"
                            },
                            {
                              "id": "0327f26e-cdde-4b48-b512-6c35f06ad1d0",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregatorOrder4",
                              "type": 1,
                              "query": "print(iff('{TrendAggregator4:label}' == 'P5th'  or '{TrendAggregator4:label}' == 'P10th', 'asc', 'desc'))",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "16d42161-ad5d-4bd8-9b2a-8e834e3b8fed",
                              "version": "KqlParameterItem/1.0",
                              "name": "Visualization4",
                              "type": 2,
                              "isRequired": true,
                              "query": "datatable (value:long, Display:string, isSelected:boolean)\r\n    [0, \"Line Chart\", true,\r\n     1, \"Grid\", false]",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "d768c009-20aa-4476-83cd-afacf4694818",
                              "version": "KqlParameterItem/1.0",
                              "name": "Snippet4",
                              "type": 1,
                              "isRequired": true,
                              "query": "print(iff({Visualization4} == 0, \"{LineChartQuerySnippet}\", \"{GridQuerySnippet}\") )",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "eb3e4d65-ee3c-481c-af2e-8b41e4049bf8",
                              "version": "KqlParameterItem/1.0",
                              "name": "Unit4",
                              "type": 2,
                              "value": null,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"B -> MB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"B -> GB\",\r\n        \"value\": \"/1024/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> GB\",\r\n        \"value\": \"/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> TB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Mb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Gb\",\r\n        \"value\": \"/1000/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Gb\",\r\n        \"value\": \"/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Tb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"s -> ms\",\r\n        \"value\": \"*1000\"\r\n    },\r\n    {\r\n        \"label\": \"ms -> s\",\r\n        \"value\": \"/1000\"\r\n    }\r\n]"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions"
                        },
                        "customWidth": "25",
                        "conditionalVisibility": {
                          "parameterName": "Mode",
                          "comparison": "isEqualTo",
                          "value": "0"
                        },
                        "name": "parameters - 5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<h3 style=\"margin-bottom:0;\">{Counter1:label}</h3><h4 style=\"margin-top:0;font-weight:normal;color:#777;\">{TrendAggregator1:label} {TrendAggregatorOrder1} {Unit:label}</h4>"
                        },
                        "customWidth": "25",
                        "name": "text - 5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<h3 style=\"margin-bottom:0;\">{Counter2:label}</h3><h4 style=\"margin-top:0;font-weight:normal;color:#777;\">{TrendAggregator2:label} {TrendAggregatorOrder2} {Unit2:label}</h4>"
                        },
                        "customWidth": "25",
                        "name": "text - 7"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<h3 style=\"margin-bottom:0;\">{Counter3:label}</h3><h4 style=\"margin-top:0;font-weight:normal;color:#777;\">{TrendAggregator3:label} {TrendAggregatorOrder3} {Unit3:label}</h4>"
                        },
                        "customWidth": "25",
                        "name": "text - 8"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<h3 style=\"margin-bottom:0;\">{Counter4:label}</h3><h4 style=\"margin-top:0;font-weight:normal;color:#777;\">{TrendAggregator4:label} {TrendAggregatorOrder4} {Unit4:label}</h4>"
                        },
                        "customWidth": "25",
                        "name": "text - 9"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let metric = dynamic({Counter1});\r\nlet cpuSummary=totable(InsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where _ResourceId in~ ({Resources})\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | summarize hint.shufflekey=Computer {TrendAggregator1:value} by Computer, Name\r\n    | top {TopN} by {TrendAggregator1:label} {TrendAggregatorOrder1});\r\nlet computerList=(cpuSummary \r\n    | project Computer);\r\nlet EmptyNodeIdentityAndProps = datatable(Computer:string, NodeId:string, NodeProps:dynamic, Priority: long) [];\r\nlet OmsNodeIdentityAndProps = computerList\r\n    | extend NodeId = Computer\r\n    | extend Priority = 1\r\n    | extend NodeProps = pack('type', 'StandAloneNode', 'name', Computer);\r\nlet ServiceMapNodeIdentityAndProps = VMComputer | extend ResourceId=strcat('machines/', Machine) | extend Bitness=columnifexists('Bitness', '')\r\n    | where TimeGenerated {TimeRange}\r\n    | where Computer in (computerList)\r\n    | summarize arg_max(TimeGenerated, *) by Computer\r\n    | extend AzureCloudServiceNodeIdentity = iif(isnotempty(AzureCloudServiceName), strcat(AzureCloudServiceInstanceId, '|',                     AzureCloudServiceDeployment), ''),          AzureScaleSetNodeIdentity = iif(isnotempty(AzureVmScaleSetName),              strcat(AzureVmScaleSetInstanceId, '|',                     AzureVmScaleSetDeployment), ''),          ComputerProps =              pack('type', 'StandAloneNode',                   'name', Computer,                   'mappingResourceId', ResourceId,                   'subscriptionId', AzureSubscriptionId,                   'resourceGroup', AzureResourceGroup,                   'azureResourceId', columnifexists('_ResourceId', '')),          AzureCloudServiceNodeProps =              pack('type', 'AzureCloudServiceNode',                   'cloudServiceInstanceId', AzureCloudServiceInstanceId,                   'cloudServiceRoleName', columnifexists('AzureCloudServiceRoleName', ''),                   'cloudServiceDeploymentId', AzureCloudServiceDeployment,                   'cloudServiceName', AzureCloudServiceName,                   'mappingResourceId', ResourceId),          AzureScaleSetNodeProps =               pack('type', 'AzureScaleSetNode',                   'scaleSetInstanceId', columnifexists('Computer', ''),                   'vmScaleSetDeploymentId', AzureVmScaleSetDeployment,                   'vmScaleSetName', AzureVmScaleSetName,                   'serviceFabricClusterName', AzureServiceFabricClusterName,                   'vmScaleSetResourceId', AzureVmScaleSetResourceId,                   'resourceGroupName', columnifexists('AzureResourceGroup', ''),                   'subscriptionId', columnifexists('AzureSubscriptionId', ''),                   'mappingResourceId', ResourceId)| project   Computer,            NodeId = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeIdentity,                       isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeIdentity, Computer),            NodeProps = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeProps,                          isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeProps, ComputerProps),            Priority = 2;\r\nlet NodeIdentityAndProps = union kind=inner isfuzzy = true                                  EmptyNodeIdentityAndProps, OmsNodeIdentityAndProps, ServiceMapNodeIdentityAndProps                            \r\n    | summarize arg_max(Priority, *) by Computer; \r\nlet NodeIdentityAndPropsMin = NodeIdentityAndProps\r\n    | extend Kind = iff(NodeProps.type == \"StandAloneNode\", iff(NodeProps.azureResourceId == \"\", \"Non-Azure Virtual Machine\", \"Azure Virtual Machine\"), NodeProps.type), \r\n    ResourceId = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.vmScaleSetResourceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceDeploymentId, Computer)),\r\n    ResourceName = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.scaleSetInstanceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceInstanceId, Computer))\r\n    | project Computer, Kind, ResourceId, ResourceName;\r\nInsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | where Computer in (computerList)\r\n    | join kind=leftouter (NodeIdentityAndPropsMin) on Computer\r\n    | summarize {TrendAggregator1:value}{Unit} by {Snippet1}\r\n\t\r\n",
                          "size": 0,
                          "aggregation": 3,
                          "showAnnotations": true,
                          "noDataMessage": "No computers are emitting data for this performance counter.",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/resourcegroups",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 10"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let metric = dynamic({Counter2});\r\nlet cpuSummary=totable(InsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where _ResourceId in~ ({Resources})\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | summarize hint.shufflekey=Computer {TrendAggregator2} by Computer, Name\r\n    | top {TopN} by {TrendAggregator2:label} {TrendAggregatorOrder2});\r\nlet computerList=(cpuSummary \r\n    | project Computer);\r\nlet EmptyNodeIdentityAndProps = datatable(Computer:string, NodeId:string, NodeProps:dynamic, Priority: long) [];\r\nlet OmsNodeIdentityAndProps = computerList\r\n    | extend NodeId = Computer\r\n    | extend Priority = 1\r\n    | extend NodeProps = pack('type', 'StandAloneNode', 'name', Computer);\r\nlet ServiceMapNodeIdentityAndProps = VMComputer | extend ResourceId=strcat('machines/', Machine) | extend Bitness=columnifexists('Bitness', '')\r\n    | where TimeGenerated {TimeRange}\r\n    | where Computer in (computerList)\r\n    | summarize arg_max(TimeGenerated, *) by Computer\r\n    | extend AzureCloudServiceNodeIdentity = iif(isnotempty(AzureCloudServiceName), strcat(AzureCloudServiceInstanceId, '|',                     AzureCloudServiceDeployment), ''),          AzureScaleSetNodeIdentity = iif(isnotempty(AzureVmScaleSetName),              strcat(AzureVmScaleSetInstanceId, '|',                     AzureVmScaleSetDeployment), ''),          ComputerProps =              pack('type', 'StandAloneNode',                   'name', Computer,                   'mappingResourceId', ResourceId,                   'subscriptionId', AzureSubscriptionId,                   'resourceGroup', AzureResourceGroup,                   'azureResourceId', columnifexists('_ResourceId', '')),          AzureCloudServiceNodeProps =              pack('type', 'AzureCloudServiceNode',                   'cloudServiceInstanceId', AzureCloudServiceInstanceId,                   'cloudServiceRoleName', columnifexists('AzureCloudServiceRoleName', ''),                   'cloudServiceDeploymentId', AzureCloudServiceDeployment,                   'cloudServiceName', AzureCloudServiceName,                   'mappingResourceId', ResourceId),          AzureScaleSetNodeProps =               pack('type', 'AzureScaleSetNode',                   'scaleSetInstanceId', columnifexists('Computer', ''),                   'vmScaleSetDeploymentId', AzureVmScaleSetDeployment,                   'vmScaleSetName', AzureVmScaleSetName,                   'serviceFabricClusterName', AzureServiceFabricClusterName,                   'vmScaleSetResourceId', AzureVmScaleSetResourceId,                   'resourceGroupName', columnifexists('AzureResourceGroup', ''),                   'subscriptionId', columnifexists('AzureSubscriptionId', ''),                   'mappingResourceId', ResourceId)| project   Computer,            NodeId = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeIdentity,                       isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeIdentity, Computer),            NodeProps = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeProps,                          isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeProps, ComputerProps),            Priority = 2;\r\nlet NodeIdentityAndProps = union kind=inner isfuzzy = true                                  EmptyNodeIdentityAndProps, OmsNodeIdentityAndProps, ServiceMapNodeIdentityAndProps                            \r\n    | summarize arg_max(Priority, *) by Computer; \r\nlet NodeIdentityAndPropsMin = NodeIdentityAndProps\r\n    | extend Kind = iff(NodeProps.type == \"StandAloneNode\", iff(NodeProps.azureResourceId == \"\", \"Non-Azure Virtual Machine\", \"Azure Virtual Machine\"), NodeProps.type), \r\n    ResourceId = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.vmScaleSetResourceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceDeploymentId, Computer)),\r\n    ResourceName = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.scaleSetInstanceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceInstanceId, Computer))\r\n    | project Computer, Kind, ResourceId, ResourceName;\r\nInsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | where Computer in (computerList)\r\n    | join kind=leftouter (NodeIdentityAndPropsMin) on Computer\r\n    | summarize {TrendAggregator2}{Unit2} by {Snippet2}",
                          "size": 0,
                          "aggregation": 3,
                          "showAnnotations": true,
                          "noDataMessage": "No computers are emitting data for this performance counter.",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/resourcegroups",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 11"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let metric = dynamic({Counter3});\r\nlet cpuSummary=totable(InsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where _ResourceId in~ ({Resources})\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | summarize hint.shufflekey=Computer {TrendAggregator3} by Computer, Name\r\n    | top {TopN} by {TrendAggregator3:label} {TrendAggregatorOrder3});\r\nlet computerList=(cpuSummary \r\n    | project Computer);\r\nlet EmptyNodeIdentityAndProps = datatable(Computer:string, NodeId:string, NodeProps:dynamic, Priority: long) [];\r\nlet OmsNodeIdentityAndProps = computerList\r\n    | extend NodeId = Computer\r\n    | extend Priority = 1\r\n    | extend NodeProps = pack('type', 'StandAloneNode', 'name', Computer);\r\nlet ServiceMapNodeIdentityAndProps = VMComputer | extend ResourceId=strcat('machines/', Machine) | extend Bitness=columnifexists('Bitness', '')\r\n    | where TimeGenerated {TimeRange}\r\n    | where Computer in (computerList)\r\n    | summarize arg_max(TimeGenerated, *) by Computer\r\n    | extend AzureCloudServiceNodeIdentity = iif(isnotempty(AzureCloudServiceName), strcat(AzureCloudServiceInstanceId, '|',                     AzureCloudServiceDeployment), ''),          AzureScaleSetNodeIdentity = iif(isnotempty(AzureVmScaleSetName),              strcat(AzureVmScaleSetInstanceId, '|',                     AzureVmScaleSetDeployment), ''),          ComputerProps =              pack('type', 'StandAloneNode',                   'name', Computer,                   'mappingResourceId', ResourceId,                   'subscriptionId', AzureSubscriptionId,                   'resourceGroup', AzureResourceGroup,                   'azureResourceId', columnifexists('_ResourceId', '')),          AzureCloudServiceNodeProps =              pack('type', 'AzureCloudServiceNode',                   'cloudServiceInstanceId', AzureCloudServiceInstanceId,                   'cloudServiceRoleName', columnifexists('AzureCloudServiceRoleName', ''),                   'cloudServiceDeploymentId', AzureCloudServiceDeployment,                   'cloudServiceName', AzureCloudServiceName,                   'mappingResourceId', ResourceId),          AzureScaleSetNodeProps =               pack('type', 'AzureScaleSetNode',                   'scaleSetInstanceId', columnifexists('Computer', ''),                   'vmScaleSetDeploymentId', AzureVmScaleSetDeployment,                   'vmScaleSetName', AzureVmScaleSetName,                   'serviceFabricClusterName', AzureServiceFabricClusterName,                   'vmScaleSetResourceId', AzureVmScaleSetResourceId,                   'resourceGroupName', columnifexists('AzureResourceGroup', ''),                   'subscriptionId', columnifexists('AzureSubscriptionId', ''),                   'mappingResourceId', ResourceId)| project   Computer,            NodeId = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeIdentity,                       isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeIdentity, Computer),            NodeProps = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeProps,                          isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeProps, ComputerProps),            Priority = 2;\r\nlet NodeIdentityAndProps = union kind=inner isfuzzy = true                                  EmptyNodeIdentityAndProps, OmsNodeIdentityAndProps, ServiceMapNodeIdentityAndProps                            \r\n    | summarize arg_max(Priority, *) by Computer; \r\nlet NodeIdentityAndPropsMin = NodeIdentityAndProps\r\n    | extend Kind = iff(NodeProps.type == \"StandAloneNode\", iff(NodeProps.azureResourceId == \"\", \"Non-Azure Virtual Machine\", \"Azure Virtual Machine\"), NodeProps.type), \r\n    ResourceId = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.vmScaleSetResourceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceDeploymentId, Computer)),\r\n    ResourceName = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.scaleSetInstanceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceInstanceId, Computer))\r\n    | project Computer, Kind, ResourceId, ResourceName;\r\nInsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | where Computer in (computerList)\r\n    | join kind=leftouter (NodeIdentityAndPropsMin) on Computer\r\n    | summarize {TrendAggregator3}{Unit3} by {Snippet3}",
                          "size": 0,
                          "aggregation": 3,
                          "showAnnotations": true,
                          "noDataMessage": "No computers are emitting data for this performance counter.",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/resourcegroups",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 12"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let metric = dynamic({Counter4});\r\nlet cpuSummary=totable(InsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where _ResourceId in~ ({Resources})\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | summarize hint.shufflekey=Computer {TrendAggregator4} by Computer, Name\r\n    | top {TopN} by {TrendAggregator4:label} {TrendAggregatorOrder4});\r\nlet computerList=(cpuSummary \r\n    | project Computer);\r\nlet EmptyNodeIdentityAndProps = datatable(Computer:string, NodeId:string, NodeProps:dynamic, Priority: long) [];\r\nlet OmsNodeIdentityAndProps = computerList\r\n    | extend NodeId = Computer\r\n    | extend Priority = 1\r\n    | extend NodeProps = pack('type', 'StandAloneNode', 'name', Computer);\r\nlet ServiceMapNodeIdentityAndProps = VMComputer | extend ResourceId=strcat('machines/', Machine) | extend Bitness=columnifexists('Bitness', '')\r\n    | where TimeGenerated {TimeRange}\r\n    | where Computer in (computerList)\r\n    | summarize arg_max(TimeGenerated, *) by Computer\r\n    | extend AzureCloudServiceNodeIdentity = iif(isnotempty(AzureCloudServiceName), strcat(AzureCloudServiceInstanceId, '|',                     AzureCloudServiceDeployment), ''),          AzureScaleSetNodeIdentity = iif(isnotempty(AzureVmScaleSetName),              strcat(AzureVmScaleSetInstanceId, '|',                     AzureVmScaleSetDeployment), ''),          ComputerProps =              pack('type', 'StandAloneNode',                   'name', Computer,                   'mappingResourceId', ResourceId,                   'subscriptionId', AzureSubscriptionId,                   'resourceGroup', AzureResourceGroup,                   'azureResourceId', columnifexists('_ResourceId', '')),          AzureCloudServiceNodeProps =              pack('type', 'AzureCloudServiceNode',                   'cloudServiceInstanceId', AzureCloudServiceInstanceId,                   'cloudServiceRoleName', columnifexists('AzureCloudServiceRoleName', ''),                   'cloudServiceDeploymentId', AzureCloudServiceDeployment,                   'cloudServiceName', AzureCloudServiceName,                   'mappingResourceId', ResourceId),          AzureScaleSetNodeProps =               pack('type', 'AzureScaleSetNode',                   'scaleSetInstanceId', columnifexists('Computer', ''),                   'vmScaleSetDeploymentId', AzureVmScaleSetDeployment,                   'vmScaleSetName', AzureVmScaleSetName,                   'serviceFabricClusterName', AzureServiceFabricClusterName,                   'vmScaleSetResourceId', AzureVmScaleSetResourceId,                   'resourceGroupName', columnifexists('AzureResourceGroup', ''),                   'subscriptionId', columnifexists('AzureSubscriptionId', ''),                   'mappingResourceId', ResourceId)| project   Computer,            NodeId = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeIdentity,                       isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeIdentity, Computer),            NodeProps = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeProps,                          isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeProps, ComputerProps),            Priority = 2;\r\nlet NodeIdentityAndProps = union kind=inner isfuzzy = true                                  EmptyNodeIdentityAndProps, OmsNodeIdentityAndProps, ServiceMapNodeIdentityAndProps                            \r\n    | summarize arg_max(Priority, *) by Computer; \r\nlet NodeIdentityAndPropsMin = NodeIdentityAndProps\r\n    | extend Kind = iff(NodeProps.type == \"StandAloneNode\", iff(NodeProps.azureResourceId == \"\", \"Non-Azure Virtual Machine\", \"Azure Virtual Machine\"), NodeProps.type), \r\n    ResourceId = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.vmScaleSetResourceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceDeploymentId, Computer)),\r\n    ResourceName = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.scaleSetInstanceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceInstanceId, Computer))\r\n    | project Computer, Kind, ResourceId, ResourceName;\r\nInsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | where Computer in (computerList)\r\n    | join kind=leftouter (NodeIdentityAndPropsMin) on Computer\r\n    | summarize {TrendAggregator4}{Unit4} by {Snippet4}",
                          "size": 0,
                          "aggregation": 3,
                          "showAnnotations": true,
                          "noDataMessage": "No computers are emitting data for this performance counter.",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/resourcegroups",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 13"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "parameters": [
                            {
                              "id": "aa2368fc-ad30-4608-b96a-72abf7b1e1af",
                              "version": "KqlParameterItem/1.0",
                              "name": "Counter5",
                              "type": 2,
                              "isRequired": true,
                              "query": "InsightsMetrics\r\n| where TimeGenerated {TimeRange}\r\n| summarize by Name, Namespace, CounterText = Name\r\n| order by Namespace asc, CounterText asc\r\n| project Counter = pack('counter', Name, 'object', Namespace), CounterText, group = Namespace",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "value": "{\"counter\":\"FreeSpaceMB\",\"object\":\"LogicalDisk\"}",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1"
                                ]
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "6a7306ea-247f-46ca-abca-501911f9e9d3",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregator5",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"Average = round(avg(Val), 2)\", \"label\":\"Average\", \"selected\":false},\r\n    { \"value\":\"P5th = round(percentile(Val, 5), 2)\", \"label\":\"P5th\", \"selected\":false},\r\n    { \"value\":\"P10th = round(percentile(Val, 10), 2)\", \"label\":\"P10th\", \"selected\":false},\r\n    { \"value\":\"P50th = round(percentile(Val, 50), 2)\", \"label\":\"P50th\", \"selected\":false},\r\n    { \"value\":\"P80th = round(percentile(Val, 80), 2)\", \"label\":\"P80th\", \"selected\":false},\r\n    { \"value\":\"P90th = round(percentile(Val, 90), 2)\", \"label\":\"P90th\", \"selected\":false},\r\n    { \"value\":\"P95th = round(percentile(Val, 95), 2)\", \"label\":\"P95th\", \"selected\":true}    \r\n]"
                            },
                            {
                              "id": "0327f26e-cdde-4b48-b512-6c35f06ad1d0",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregatorOrder5",
                              "type": 1,
                              "query": "print(iff('{TrendAggregator5:label}' == 'P5th'  or '{TrendAggregator5:label}' == 'P10th', 'asc', 'desc'))",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "b75e4ca5-7d71-4d29-b69e-9104934905ba",
                              "version": "KqlParameterItem/1.0",
                              "name": "Visualization5",
                              "type": 2,
                              "isRequired": true,
                              "query": "datatable (value:long, Display:string, isSelected:boolean)\r\n    [0, \"Line Chart\", true,\r\n     1, \"Grid\", false]",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "7df7ee71-c054-4a88-b8b1-33ba6dd9d70d",
                              "version": "KqlParameterItem/1.0",
                              "name": "Snippet5",
                              "type": 1,
                              "isRequired": true,
                              "query": "print(iff({Visualization5} == 0, \"{LineChartQuerySnippet}\", \"{GridQuerySnippet}\") )",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "bb81032c-59e4-417f-a5e1-fc6552c3190f",
                              "version": "KqlParameterItem/1.0",
                              "name": "Unit5",
                              "type": 2,
                              "value": null,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"B -> MB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"B -> GB\",\r\n        \"value\": \"/1024/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> GB\",\r\n        \"value\": \"/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> TB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Mb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Gb\",\r\n        \"value\": \"/1000/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Gb\",\r\n        \"value\": \"/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Tb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"s -> ms\",\r\n        \"value\": \"*1000\"\r\n    },\r\n    {\r\n        \"label\": \"ms -> s\",\r\n        \"value\": \"/1000\"\r\n    }\r\n]"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions"
                        },
                        "customWidth": "25",
                        "conditionalVisibility": {
                          "parameterName": "Mode",
                          "comparison": "isEqualTo",
                          "value": "0"
                        },
                        "name": "parameters - 14"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "parameters": [
                            {
                              "id": "aa2368fc-ad30-4608-b96a-72abf7b1e1af",
                              "version": "KqlParameterItem/1.0",
                              "name": "Counter6",
                              "type": 2,
                              "isRequired": true,
                              "query": "InsightsMetrics\r\n| where TimeGenerated {TimeRange}\r\n| summarize by Name, Namespace, CounterText = Name\r\n| order by Namespace asc, CounterText asc\r\n| project Counter = pack('counter', Name, 'object', Namespace), CounterText, group = Namespace",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "value": "{\"counter\":\"FreeSpacePercentage\",\"object\":\"LogicalDisk\"}",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1"
                                ]
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "6a7306ea-247f-46ca-abca-501911f9e9d3",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregator6",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"Average = round(avg(Val), 2)\", \"label\":\"Average\", \"selected\":false},\r\n    { \"value\":\"P5th = round(percentile(Val, 5), 2)\", \"label\":\"P5th\", \"selected\":false},\r\n    { \"value\":\"P10th = round(percentile(Val, 10), 2)\", \"label\":\"P10th\", \"selected\":false},\r\n    { \"value\":\"P50th = round(percentile(Val, 50), 2)\", \"label\":\"P50th\", \"selected\":false},\r\n    { \"value\":\"P80th = round(percentile(Val, 80), 2)\", \"label\":\"P80th\", \"selected\":false},\r\n    { \"value\":\"P90th = round(percentile(Val, 90), 2)\", \"label\":\"P90th\", \"selected\":false},\r\n    { \"value\":\"P95th = round(percentile(Val, 95), 2)\", \"label\":\"P95th\", \"selected\":true}    \r\n]"
                            },
                            {
                              "id": "0327f26e-cdde-4b48-b512-6c35f06ad1d0",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregatorOrder6",
                              "type": 1,
                              "query": "print(iff('{TrendAggregator6:label}' == 'P5th'  or '{TrendAggregator6:label}' == 'P10th', 'asc', 'desc'))",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "5b1ee58a-5d4d-4be8-b38c-3a8eb37a2f3e",
                              "version": "KqlParameterItem/1.0",
                              "name": "Visualization6",
                              "type": 2,
                              "isRequired": true,
                              "query": "datatable (value:long, Display:string, isSelected:boolean)\r\n    [0, \"Line Chart\", true,\r\n     1, \"Grid\", false]",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "d931d741-2f83-4ca0-bc2b-5c0c13fe8058",
                              "version": "KqlParameterItem/1.0",
                              "name": "Snippet6",
                              "type": 1,
                              "isRequired": true,
                              "query": "print(iff({Visualization6} == 0, \"{LineChartQuerySnippet}\", \"{GridQuerySnippet}\") )",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "ab35d419-d8c1-45be-8885-e39a55c0648d",
                              "version": "KqlParameterItem/1.0",
                              "name": "Unit6",
                              "type": 2,
                              "value": null,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"B -> MB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"B -> GB\",\r\n        \"value\": \"/1024/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> GB\",\r\n        \"value\": \"/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> TB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Mb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Gb\",\r\n        \"value\": \"/1000/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Gb\",\r\n        \"value\": \"/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Tb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"s -> ms\",\r\n        \"value\": \"*1000\"\r\n    },\r\n    {\r\n        \"label\": \"ms -> s\",\r\n        \"value\": \"/1000\"\r\n    }\r\n]"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions"
                        },
                        "customWidth": "25",
                        "conditionalVisibility": {
                          "parameterName": "Mode",
                          "comparison": "isEqualTo",
                          "value": "0"
                        },
                        "name": "parameters - 15"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "parameters": [
                            {
                              "id": "aa2368fc-ad30-4608-b96a-72abf7b1e1af",
                              "version": "KqlParameterItem/1.0",
                              "name": "Counter7",
                              "type": 2,
                              "isRequired": true,
                              "query": "InsightsMetrics\r\n| where TimeGenerated {TimeRange}\r\n| summarize by Name, Namespace, CounterText = Name\r\n| order by Namespace asc, CounterText asc\r\n| project Counter = pack('counter', Name, 'object', Namespace), CounterText, group = Namespace",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "value": "{\"counter\":\"ReadBytesPerSecond\",\"object\":\"LogicalDisk\"}",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1"
                                ]
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "6a7306ea-247f-46ca-abca-501911f9e9d3",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregator7",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"Average = round(avg(Val), 2)\", \"label\":\"Average\", \"selected\":false},\r\n    { \"value\":\"P5th = round(percentile(Val, 5), 2)\", \"label\":\"P5th\", \"selected\":false},\r\n    { \"value\":\"P10th = round(percentile(Val, 10), 2)\", \"label\":\"P10th\", \"selected\":false},\r\n    { \"value\":\"P50th = round(percentile(Val, 50), 2)\", \"label\":\"P50th\", \"selected\":false},\r\n    { \"value\":\"P80th = round(percentile(Val, 80), 2)\", \"label\":\"P80th\", \"selected\":false},\r\n    { \"value\":\"P90th = round(percentile(Val, 90), 2)\", \"label\":\"P90th\", \"selected\":false},\r\n    { \"value\":\"P95th = round(percentile(Val, 95), 2)\", \"label\":\"P95th\", \"selected\":true}    \r\n]"
                            },
                            {
                              "id": "0327f26e-cdde-4b48-b512-6c35f06ad1d0",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregatorOrder7",
                              "type": 1,
                              "query": "print(iff('{TrendAggregator7:label}' == 'P5th'  or '{TrendAggregator7:label}' == 'P10th', 'asc', 'desc'))",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "bc1291ba-dd26-4224-9b25-3a1e7b3eb024",
                              "version": "KqlParameterItem/1.0",
                              "name": "Visualization7",
                              "type": 2,
                              "isRequired": true,
                              "query": "datatable (value:long, Display:string, isSelected:boolean)\r\n    [0, \"Line Chart\", true,\r\n     1, \"Grid\", false]",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "6cc1a388-27c6-4cfe-a787-ff00cb8f4fae",
                              "version": "KqlParameterItem/1.0",
                              "name": "Snippet7",
                              "type": 1,
                              "isRequired": true,
                              "query": "print(iff({Visualization7} == 0, \"{LineChartQuerySnippet}\", \"{GridQuerySnippet}\") )",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "dce874fa-b71d-4a09-bcee-bd1b3f672f7f",
                              "version": "KqlParameterItem/1.0",
                              "name": "Unit7",
                              "type": 2,
                              "value": null,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"B -> MB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"B -> GB\",\r\n        \"value\": \"/1024/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> GB\",\r\n        \"value\": \"/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> TB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Mb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Gb\",\r\n        \"value\": \"/1000/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Gb\",\r\n        \"value\": \"/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Tb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"s -> ms\",\r\n        \"value\": \"*1000\"\r\n    },\r\n    {\r\n        \"label\": \"ms -> s\",\r\n        \"value\": \"/1000\"\r\n    }\r\n]"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions"
                        },
                        "customWidth": "25",
                        "conditionalVisibility": {
                          "parameterName": "Mode",
                          "comparison": "isEqualTo",
                          "value": "0"
                        },
                        "name": "parameters - 16"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "parameters": [
                            {
                              "id": "aa2368fc-ad30-4608-b96a-72abf7b1e1af",
                              "version": "KqlParameterItem/1.0",
                              "name": "Counter8",
                              "type": 2,
                              "isRequired": true,
                              "query": "InsightsMetrics\r\n| where TimeGenerated {TimeRange}\r\n| summarize by Name, Namespace, CounterText = Name\r\n| order by Namespace asc, CounterText asc\r\n| project Counter = pack('counter', Name, 'object', Namespace), CounterText, group = Namespace",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1"
                                ]
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "6a7306ea-247f-46ca-abca-501911f9e9d3",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregator8",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"Average = round(avg(Val), 2)\", \"label\":\"Average\", \"selected\":false},\r\n    { \"value\":\"P5th = round(percentile(Val, 5), 2)\", \"label\":\"P5th\", \"selected\":false},\r\n    { \"value\":\"P10th = round(percentile(Val, 10), 2)\", \"label\":\"P10th\", \"selected\":false},\r\n    { \"value\":\"P50th = round(percentile(Val, 50), 2)\", \"label\":\"P50th\", \"selected\":false},\r\n    { \"value\":\"P80th = round(percentile(Val, 80), 2)\", \"label\":\"P80th\", \"selected\":false},\r\n    { \"value\":\"P90th = round(percentile(Val, 90), 2)\", \"label\":\"P90th\", \"selected\":false},\r\n    { \"value\":\"P95th = round(percentile(Val, 95), 2)\", \"label\":\"P95th\", \"selected\":true}    \r\n]"
                            },
                            {
                              "id": "0327f26e-cdde-4b48-b512-6c35f06ad1d0",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregatorOrder8",
                              "type": 1,
                              "query": "print(iff('{TrendAggregator8:label}' == 'P5th'  or '{TrendAggregator8:label}' == 'P10th', 'asc', 'desc'))",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "68468652-570f-4d77-af12-a59d463d5f02",
                              "version": "KqlParameterItem/1.0",
                              "name": "Visualization8",
                              "type": 2,
                              "isRequired": true,
                              "query": "datatable (value:long, Display:string, isSelected:boolean)\r\n    [0, \"Line Chart\", true,\r\n     1, \"Grid\", false]",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "15738505-f7e6-446e-995d-280cf70dde93",
                              "version": "KqlParameterItem/1.0",
                              "name": "Snippet8",
                              "type": 1,
                              "isRequired": true,
                              "query": "print(iff({Visualization8} == 0, \"{LineChartQuerySnippet}\", \"{GridQuerySnippet}\") )",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "c78d15dd-79cb-4cd2-8749-df9d97625b31",
                              "version": "KqlParameterItem/1.0",
                              "name": "Unit8",
                              "type": 2,
                              "value": null,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"B -> MB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"B -> GB\",\r\n        \"value\": \"/1024/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> GB\",\r\n        \"value\": \"/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> TB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Mb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Gb\",\r\n        \"value\": \"/1000/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Gb\",\r\n        \"value\": \"/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Tb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"s -> ms\",\r\n        \"value\": \"*1000\"\r\n    },\r\n    {\r\n        \"label\": \"ms -> s\",\r\n        \"value\": \"/1000\"\r\n    }\r\n]"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions"
                        },
                        "customWidth": "25",
                        "conditionalVisibility": {
                          "parameterName": "Mode",
                          "comparison": "isEqualTo",
                          "value": "0"
                        },
                        "name": "parameters - 17"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<h3 style=\"margin-bottom:0;\">{Counter5:label}</h3><h4 style=\"margin-top:0;font-weight:normal;color:#777;\">{TrendAggregator5:label} {TrendAggregatorOrder5} {Unit5:label}</h4>"
                        },
                        "customWidth": "25",
                        "name": "text - 18"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<h3 style=\"margin-bottom:0;\">{Counter6:label}</h3><h4 style=\"margin-top:0;font-weight:normal;color:#777;\">{TrendAggregator6:label} {TrendAggregatorOrder6} {Unit6:label}</h4>"
                        },
                        "customWidth": "25",
                        "name": "text - 19"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<h3 style=\"margin-bottom:0;\">{Counter7:label}</h3><h4 style=\"margin-top:0;font-weight:normal;color:#777;\">{TrendAggregator7:label} {TrendAggregatorOrder7} {Unit7:label}</h4>"
                        },
                        "customWidth": "25",
                        "name": "text - 20"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<h3 style=\"margin-bottom:0;\">{Counter8:label}</h3><h4 style=\"margin-top:0;font-weight:normal;color:#777;\">{TrendAggregator8:label} {TrendAggregatorOrder8} {Unit8:label}</h4>"
                        },
                        "customWidth": "25",
                        "name": "text - 21"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let metric = dynamic({Counter5});\r\nlet cpuSummary=totable(InsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where _ResourceId in~ ({Resources})\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | summarize hint.shufflekey=Computer {TrendAggregator5} by Computer, Name\r\n    | top {TopN} by {TrendAggregator5:label} {TrendAggregatorOrder5});\r\nlet computerList=(cpuSummary \r\n    | project Computer);\r\nlet EmptyNodeIdentityAndProps = datatable(Computer:string, NodeId:string, NodeProps:dynamic, Priority: long) [];\r\nlet OmsNodeIdentityAndProps = computerList\r\n    | extend NodeId = Computer\r\n    | extend Priority = 1\r\n    | extend NodeProps = pack('type', 'StandAloneNode', 'name', Computer);\r\nlet ServiceMapNodeIdentityAndProps = VMComputer | extend ResourceId=strcat('machines/', Machine) | extend Bitness=columnifexists('Bitness', '')\r\n    | where TimeGenerated {TimeRange}\r\n    | where Computer in (computerList)\r\n    | summarize arg_max(TimeGenerated, *) by Computer\r\n    | extend AzureCloudServiceNodeIdentity = iif(isnotempty(AzureCloudServiceName), strcat(AzureCloudServiceInstanceId, '|',                     AzureCloudServiceDeployment), ''),          AzureScaleSetNodeIdentity = iif(isnotempty(AzureVmScaleSetName),              strcat(AzureVmScaleSetInstanceId, '|',                     AzureVmScaleSetDeployment), ''),          ComputerProps =              pack('type', 'StandAloneNode',                   'name', Computer,                   'mappingResourceId', ResourceId,                   'subscriptionId', AzureSubscriptionId,                   'resourceGroup', AzureResourceGroup,                   'azureResourceId', columnifexists('_ResourceId', '')),          AzureCloudServiceNodeProps =              pack('type', 'AzureCloudServiceNode',                   'cloudServiceInstanceId', AzureCloudServiceInstanceId,                   'cloudServiceRoleName', columnifexists('AzureCloudServiceRoleName', ''),                   'cloudServiceDeploymentId', AzureCloudServiceDeployment,                   'cloudServiceName', AzureCloudServiceName,                   'mappingResourceId', ResourceId),          AzureScaleSetNodeProps =               pack('type', 'AzureScaleSetNode',                   'scaleSetInstanceId', columnifexists('Computer', ''),                   'vmScaleSetDeploymentId', AzureVmScaleSetDeployment,                   'vmScaleSetName', AzureVmScaleSetName,                   'serviceFabricClusterName', AzureServiceFabricClusterName,                   'vmScaleSetResourceId', AzureVmScaleSetResourceId,                   'resourceGroupName', columnifexists('AzureResourceGroup', ''),                   'subscriptionId', columnifexists('AzureSubscriptionId', ''),                   'mappingResourceId', ResourceId)| project   Computer,            NodeId = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeIdentity,                       isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeIdentity, Computer),            NodeProps = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeProps,                          isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeProps, ComputerProps),            Priority = 2;\r\nlet NodeIdentityAndProps = union kind=inner isfuzzy = true                                  EmptyNodeIdentityAndProps, OmsNodeIdentityAndProps, ServiceMapNodeIdentityAndProps                            \r\n    | summarize arg_max(Priority, *) by Computer; \r\nlet NodeIdentityAndPropsMin = NodeIdentityAndProps\r\n    | extend Kind = iff(NodeProps.type == \"StandAloneNode\", iff(NodeProps.azureResourceId == \"\", \"Non-Azure Virtual Machine\", \"Azure Virtual Machine\"), NodeProps.type), \r\n    ResourceId = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.vmScaleSetResourceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceDeploymentId, Computer)),\r\n    ResourceName = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.scaleSetInstanceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceInstanceId, Computer))\r\n    | project Computer, Kind, ResourceId, ResourceName;\r\nInsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | where Computer in (computerList)\r\n    | join kind=leftouter (NodeIdentityAndPropsMin) on Computer\r\n    | summarize {TrendAggregator5}{Unit5} by {Snippet5}",
                          "size": 0,
                          "aggregation": 3,
                          "showAnnotations": true,
                          "noDataMessage": "No computers are emitting data for this performance counter.",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/resourcegroups",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 22"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let metric = dynamic({Counter6});\r\nlet cpuSummary=totable(InsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where _ResourceId in~ ({Resources})\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | summarize hint.shufflekey=Computer {TrendAggregator6} by Computer, Name\r\n    | top {TopN} by {TrendAggregator6:label} {TrendAggregatorOrder6});\r\nlet computerList=(cpuSummary \r\n    | project Computer);\r\nlet EmptyNodeIdentityAndProps = datatable(Computer:string, NodeId:string, NodeProps:dynamic, Priority: long) [];\r\nlet OmsNodeIdentityAndProps = computerList\r\n    | extend NodeId = Computer\r\n    | extend Priority = 1\r\n    | extend NodeProps = pack('type', 'StandAloneNode', 'name', Computer);\r\nlet ServiceMapNodeIdentityAndProps = VMComputer | extend ResourceId=strcat('machines/', Machine) | extend Bitness=columnifexists('Bitness', '')\r\n    | where TimeGenerated {TimeRange}\r\n    | where Computer in (computerList)\r\n    | summarize arg_max(TimeGenerated, *) by Computer\r\n    | extend AzureCloudServiceNodeIdentity = iif(isnotempty(AzureCloudServiceName), strcat(AzureCloudServiceInstanceId, '|',                     AzureCloudServiceDeployment), ''),          AzureScaleSetNodeIdentity = iif(isnotempty(AzureVmScaleSetName),              strcat(AzureVmScaleSetInstanceId, '|',                     AzureVmScaleSetDeployment), ''),          ComputerProps =              pack('type', 'StandAloneNode',                   'name', Computer,                   'mappingResourceId', ResourceId,                   'subscriptionId', AzureSubscriptionId,                   'resourceGroup', AzureResourceGroup,                   'azureResourceId', columnifexists('_ResourceId', '')),          AzureCloudServiceNodeProps =              pack('type', 'AzureCloudServiceNode',                   'cloudServiceInstanceId', AzureCloudServiceInstanceId,                   'cloudServiceRoleName', columnifexists('AzureCloudServiceRoleName', ''),                   'cloudServiceDeploymentId', AzureCloudServiceDeployment,                   'cloudServiceName', AzureCloudServiceName,                   'mappingResourceId', ResourceId),          AzureScaleSetNodeProps =               pack('type', 'AzureScaleSetNode',                   'scaleSetInstanceId', columnifexists('Computer', ''),                   'vmScaleSetDeploymentId', AzureVmScaleSetDeployment,                   'vmScaleSetName', AzureVmScaleSetName,                   'serviceFabricClusterName', AzureServiceFabricClusterName,                   'vmScaleSetResourceId', AzureVmScaleSetResourceId,                   'resourceGroupName', columnifexists('AzureResourceGroup', ''),                   'subscriptionId', columnifexists('AzureSubscriptionId', ''),                   'mappingResourceId', ResourceId)| project   Computer,            NodeId = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeIdentity,                       isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeIdentity, Computer),            NodeProps = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeProps,                          isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeProps, ComputerProps),            Priority = 2;\r\nlet NodeIdentityAndProps = union kind=inner isfuzzy = true                                  EmptyNodeIdentityAndProps, OmsNodeIdentityAndProps, ServiceMapNodeIdentityAndProps                            \r\n    | summarize arg_max(Priority, *) by Computer; \r\nlet NodeIdentityAndPropsMin = NodeIdentityAndProps\r\n    | extend Kind = iff(NodeProps.type == \"StandAloneNode\", iff(NodeProps.azureResourceId == \"\", \"Non-Azure Virtual Machine\", \"Azure Virtual Machine\"), NodeProps.type), \r\n    ResourceId = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.vmScaleSetResourceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceDeploymentId, Computer)),\r\n    ResourceName = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.scaleSetInstanceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceInstanceId, Computer))\r\n    | project Computer, Kind, ResourceId, ResourceName;\r\nInsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | where Computer in (computerList)\r\n    | join kind=leftouter (NodeIdentityAndPropsMin) on Computer\r\n    | summarize {TrendAggregator6}{Unit6} by {Snippet6}",
                          "size": 0,
                          "aggregation": 3,
                          "showAnnotations": true,
                          "noDataMessage": "No computers are emitting data for this performance counter.",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/resourcegroups",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 23"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let metric = dynamic({Counter7});\r\nlet cpuSummary=totable(InsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where _ResourceId in~ ({Resources})\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | summarize hint.shufflekey=Computer {TrendAggregator7} by Computer, Name\r\n    | top {TopN} by {TrendAggregator7:label} {TrendAggregatorOrder7});\r\nlet computerList=(cpuSummary \r\n    | project Computer);\r\nlet EmptyNodeIdentityAndProps = datatable(Computer:string, NodeId:string, NodeProps:dynamic, Priority: long) [];\r\nlet OmsNodeIdentityAndProps = computerList\r\n    | extend NodeId = Computer\r\n    | extend Priority = 1\r\n    | extend NodeProps = pack('type', 'StandAloneNode', 'name', Computer);\r\nlet ServiceMapNodeIdentityAndProps = VMComputer | extend ResourceId=strcat('machines/', Machine) | extend Bitness=columnifexists('Bitness', '')\r\n    | where TimeGenerated {TimeRange}\r\n    | where Computer in (computerList)\r\n    | summarize arg_max(TimeGenerated, *) by Computer\r\n    | extend AzureCloudServiceNodeIdentity = iif(isnotempty(AzureCloudServiceName), strcat(AzureCloudServiceInstanceId, '|',                     AzureCloudServiceDeployment), ''),          AzureScaleSetNodeIdentity = iif(isnotempty(AzureVmScaleSetName),              strcat(AzureVmScaleSetInstanceId, '|',                     AzureVmScaleSetDeployment), ''),          ComputerProps =              pack('type', 'StandAloneNode',                   'name', Computer,                   'mappingResourceId', ResourceId,                   'subscriptionId', AzureSubscriptionId,                   'resourceGroup', AzureResourceGroup,                   'azureResourceId', columnifexists('_ResourceId', '')),          AzureCloudServiceNodeProps =              pack('type', 'AzureCloudServiceNode',                   'cloudServiceInstanceId', AzureCloudServiceInstanceId,                   'cloudServiceRoleName', columnifexists('AzureCloudServiceRoleName', ''),                   'cloudServiceDeploymentId', AzureCloudServiceDeployment,                   'cloudServiceName', AzureCloudServiceName,                   'mappingResourceId', ResourceId),          AzureScaleSetNodeProps =               pack('type', 'AzureScaleSetNode',                   'scaleSetInstanceId', columnifexists('Computer', ''),                   'vmScaleSetDeploymentId', AzureVmScaleSetDeployment,                   'vmScaleSetName', AzureVmScaleSetName,                   'serviceFabricClusterName', AzureServiceFabricClusterName,                   'vmScaleSetResourceId', AzureVmScaleSetResourceId,                   'resourceGroupName', columnifexists('AzureResourceGroup', ''),                   'subscriptionId', columnifexists('AzureSubscriptionId', ''),                   'mappingResourceId', ResourceId)| project   Computer,            NodeId = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeIdentity,                       isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeIdentity, Computer),            NodeProps = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeProps,                          isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeProps, ComputerProps),            Priority = 2;\r\nlet NodeIdentityAndProps = union kind=inner isfuzzy = true                                  EmptyNodeIdentityAndProps, OmsNodeIdentityAndProps, ServiceMapNodeIdentityAndProps                            \r\n    | summarize arg_max(Priority, *) by Computer; \r\nlet NodeIdentityAndPropsMin = NodeIdentityAndProps\r\n    | extend Kind = iff(NodeProps.type == \"StandAloneNode\", iff(NodeProps.azureResourceId == \"\", \"Non-Azure Virtual Machine\", \"Azure Virtual Machine\"), NodeProps.type), \r\n    ResourceId = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.vmScaleSetResourceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceDeploymentId, Computer)),\r\n    ResourceName = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.scaleSetInstanceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceInstanceId, Computer))\r\n    | project Computer, Kind, ResourceId, ResourceName;\r\nInsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | where Computer in (computerList)\r\n    | join kind=leftouter (NodeIdentityAndPropsMin) on Computer\r\n    | summarize {TrendAggregator7}{Unit7} by {Snippet7}",
                          "size": 0,
                          "aggregation": 3,
                          "showAnnotations": true,
                          "noDataMessage": "No computers are emitting data for this performance counter.",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/resourcegroups",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 24"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let metric = dynamic({Counter8});\r\nlet cpuSummary=totable(InsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where _ResourceId in~ ({Resources})\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | summarize hint.shufflekey=Computer {TrendAggregator8} by Computer, Name\r\n    | top {TopN} by {TrendAggregator8:label} {TrendAggregatorOrder8});\r\nlet computerList=(cpuSummary \r\n    | project Computer);\r\nlet EmptyNodeIdentityAndProps = datatable(Computer:string, NodeId:string, NodeProps:dynamic, Priority: long) [];\r\nlet OmsNodeIdentityAndProps = computerList\r\n    | extend NodeId = Computer\r\n    | extend Priority = 1\r\n    | extend NodeProps = pack('type', 'StandAloneNode', 'name', Computer);\r\nlet ServiceMapNodeIdentityAndProps = VMComputer | extend ResourceId=strcat('machines/', Machine) | extend Bitness=columnifexists('Bitness', '')\r\n    | where TimeGenerated {TimeRange}\r\n    | where Computer in (computerList)\r\n    | summarize arg_max(TimeGenerated, *) by Computer\r\n    | extend AzureCloudServiceNodeIdentity = iif(isnotempty(AzureCloudServiceName), strcat(AzureCloudServiceInstanceId, '|',                     AzureCloudServiceDeployment), ''),          AzureScaleSetNodeIdentity = iif(isnotempty(AzureVmScaleSetName),              strcat(AzureVmScaleSetInstanceId, '|',                     AzureVmScaleSetDeployment), ''),          ComputerProps =              pack('type', 'StandAloneNode',                   'name', Computer,                   'mappingResourceId', ResourceId,                   'subscriptionId', AzureSubscriptionId,                   'resourceGroup', AzureResourceGroup,                   'azureResourceId', columnifexists('_ResourceId', '')),          AzureCloudServiceNodeProps =              pack('type', 'AzureCloudServiceNode',                   'cloudServiceInstanceId', AzureCloudServiceInstanceId,                   'cloudServiceRoleName', columnifexists('AzureCloudServiceRoleName', ''),                   'cloudServiceDeploymentId', AzureCloudServiceDeployment,                   'cloudServiceName', AzureCloudServiceName,                   'mappingResourceId', ResourceId),          AzureScaleSetNodeProps =               pack('type', 'AzureScaleSetNode',                   'scaleSetInstanceId', columnifexists('Computer', ''),                   'vmScaleSetDeploymentId', AzureVmScaleSetDeployment,                   'vmScaleSetName', AzureVmScaleSetName,                   'serviceFabricClusterName', AzureServiceFabricClusterName,                   'vmScaleSetResourceId', AzureVmScaleSetResourceId,                   'resourceGroupName', columnifexists('AzureResourceGroup', ''),                   'subscriptionId', columnifexists('AzureSubscriptionId', ''),                   'mappingResourceId', ResourceId)| project   Computer,            NodeId = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeIdentity,                       isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeIdentity, Computer),            NodeProps = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeProps,                          isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeProps, ComputerProps),            Priority = 2;\r\nlet NodeIdentityAndProps = union kind=inner isfuzzy = true                                  EmptyNodeIdentityAndProps, OmsNodeIdentityAndProps, ServiceMapNodeIdentityAndProps                            \r\n    | summarize arg_max(Priority, *) by Computer; \r\nlet NodeIdentityAndPropsMin = NodeIdentityAndProps\r\n    | extend Kind = iff(NodeProps.type == \"StandAloneNode\", iff(NodeProps.azureResourceId == \"\", \"Non-Azure Virtual Machine\", \"Azure Virtual Machine\"), NodeProps.type), \r\n    ResourceId = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.vmScaleSetResourceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceDeploymentId, Computer)),\r\n    ResourceName = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.scaleSetInstanceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceInstanceId, Computer))\r\n    | project Computer, Kind, ResourceId, ResourceName;\r\nInsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | where Computer in (computerList)\r\n    | join kind=leftouter (NodeIdentityAndPropsMin) on Computer\r\n    | summarize {TrendAggregator8}{Unit8} by {Snippet8}",
                          "size": 0,
                          "aggregation": 3,
                          "showAnnotations": true,
                          "noDataMessage": "No computers are emitting data for this performance counter.",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/resourcegroups",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 25"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "parameters": [
                            {
                              "id": "eba3fa3a-2f37-4dfb-80be-c19b680f31b0",
                              "version": "KqlParameterItem/1.0",
                              "name": "Counter9",
                              "type": 2,
                              "isRequired": true,
                              "query": "InsightsMetrics\r\n| where TimeGenerated {TimeRange}\r\n| summarize by Name, Namespace, CounterText = Name\r\n| order by Namespace asc, CounterText asc\r\n| project Counter = pack('counter', Name, 'object', Namespace), CounterText, group = Namespace",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "value": "{\"counter\":\"ReadsPerSecond\",\"object\":\"LogicalDisk\"}",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1"
                                ]
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "f3137f3e-9ff1-4a7f-b503-5b2b87431713",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregator9",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"Average = round(avg(Val), 2)\", \"label\":\"Average\", \"selected\":false},\r\n    { \"value\":\"P5th = round(percentile(Val, 5), 2)\", \"label\":\"P5th\", \"selected\":false},\r\n    { \"value\":\"P10th = round(percentile(Val, 10), 2)\", \"label\":\"P10th\", \"selected\":false},\r\n    { \"value\":\"P50th = round(percentile(Val, 50), 2)\", \"label\":\"P50th\", \"selected\":false},\r\n    { \"value\":\"P80th = round(percentile(Val, 80), 2)\", \"label\":\"P80th\", \"selected\":false},\r\n    { \"value\":\"P90th = round(percentile(Val, 90), 2)\", \"label\":\"P90th\", \"selected\":false},\r\n    { \"value\":\"P95th = round(percentile(Val, 95), 2)\", \"label\":\"P95th\", \"selected\":true}    \r\n]"
                            },
                            {
                              "id": "01a4cf96-e12f-4d2a-9cf3-25da44a6ebe4",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregatorOrder9",
                              "type": 1,
                              "query": "print(iff('{TrendAggregator9:label}' == 'P5th'  or '{TrendAggregator9:label}' == 'P10th', 'asc', 'desc'))",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "2ad65081-725a-4bc6-9198-9ab653dbb1aa",
                              "version": "KqlParameterItem/1.0",
                              "name": "Visualization9",
                              "type": 2,
                              "isRequired": true,
                              "query": "datatable (value:long, Display:string, isSelected:boolean)\r\n    [0, \"Line Chart\", true,\r\n     1, \"Grid\", false]",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "d08e406f-4725-45f5-a5ec-1aa0b6ae4afd",
                              "version": "KqlParameterItem/1.0",
                              "name": "Snippet9",
                              "type": 1,
                              "isRequired": true,
                              "query": "print(iff({Visualization5} == 0, \"{LineChartQuerySnippet}\", \"{GridQuerySnippet}\") )",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "31e0e738-54eb-4fab-92b7-ae000819fc7d",
                              "version": "KqlParameterItem/1.0",
                              "name": "Unit9",
                              "type": 2,
                              "value": null,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"B -> MB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"B -> GB\",\r\n        \"value\": \"/1024/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> GB\",\r\n        \"value\": \"/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> TB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Mb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Gb\",\r\n        \"value\": \"/1000/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Gb\",\r\n        \"value\": \"/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Tb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"s -> ms\",\r\n        \"value\": \"*1000\"\r\n    },\r\n    {\r\n        \"label\": \"ms -> s\",\r\n        \"value\": \"/1000\"\r\n    }\r\n]"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions"
                        },
                        "customWidth": "25",
                        "conditionalVisibility": {
                          "parameterName": "Mode",
                          "comparison": "isEqualTo",
                          "value": "0"
                        },
                        "name": "parameters - 26"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "parameters": [
                            {
                              "id": "aa2368fc-ad30-4608-b96a-72abf7b1e1ad",
                              "version": "KqlParameterItem/1.0",
                              "name": "Counter10",
                              "type": 2,
                              "isRequired": true,
                              "query": "InsightsMetrics\r\n| where TimeGenerated {TimeRange}\r\n| summarize by Name, Namespace, CounterText = Name\r\n| order by Namespace asc, CounterText asc\r\n| project Counter = pack('counter', Name, 'object', Namespace), CounterText, group = Namespace",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "value": "{\"counter\":\"WritesPerSecond\",\"object\":\"LogicalDisk\"}",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1"
                                ]
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "6a7306ea-247f-46ca-abca-501911f9e9dd",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregator10",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"Average = round(avg(Val), 2)\", \"label\":\"Average\", \"selected\":false},\r\n    { \"value\":\"P5th = round(percentile(Val, 5), 2)\", \"label\":\"P5th\", \"selected\":false},\r\n    { \"value\":\"P10th = round(percentile(Val, 10), 2)\", \"label\":\"P10th\", \"selected\":false},\r\n    { \"value\":\"P50th = round(percentile(Val, 50), 2)\", \"label\":\"P50th\", \"selected\":false},\r\n    { \"value\":\"P80th = round(percentile(Val, 80), 2)\", \"label\":\"P80th\", \"selected\":false},\r\n    { \"value\":\"P90th = round(percentile(Val, 90), 2)\", \"label\":\"P90th\", \"selected\":false},\r\n    { \"value\":\"P95th = round(percentile(Val, 95), 2)\", \"label\":\"P95th\", \"selected\":true}    \r\n]"
                            },
                            {
                              "id": "0327f26e-cdde-4b48-b512-6c35f06ad1dd",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregatorOrder10",
                              "type": 1,
                              "query": "print(iff('{TrendAggregator10:label}' == 'P5th'  or '{TrendAggregator10:label}' == 'P10th', 'asc', 'desc'))",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "5b1ee58a-5d4d-4be8-b38c-3a8eb37a2f3d",
                              "version": "KqlParameterItem/1.0",
                              "name": "Visualization10",
                              "type": 2,
                              "isRequired": true,
                              "query": "datatable (value:long, Display:string, isSelected:boolean)\r\n    [0, \"Line Chart\", true,\r\n     1, \"Grid\", false]",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "d931d741-2f83-4ca0-bc2b-5c0c13fe805d",
                              "version": "KqlParameterItem/1.0",
                              "name": "Snippet10",
                              "type": 1,
                              "isRequired": true,
                              "query": "print(iff({Visualization6} == 0, \"{LineChartQuerySnippet}\", \"{GridQuerySnippet}\") )",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "089bb686-434d-43ea-a958-c344763cef7f",
                              "version": "KqlParameterItem/1.0",
                              "name": "Unit10",
                              "type": 2,
                              "value": null,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"B -> MB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"B -> GB\",\r\n        \"value\": \"/1024/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> GB\",\r\n        \"value\": \"/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> TB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Mb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Gb\",\r\n        \"value\": \"/1000/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Gb\",\r\n        \"value\": \"/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Tb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"s -> ms\",\r\n        \"value\": \"*1000\"\r\n    },\r\n    {\r\n        \"label\": \"ms -> s\",\r\n        \"value\": \"/1000\"\r\n    }\r\n]"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions"
                        },
                        "customWidth": "25",
                        "conditionalVisibility": {
                          "parameterName": "Mode",
                          "comparison": "isEqualTo",
                          "value": "0"
                        },
                        "name": "parameters - 27"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "parameters": [
                            {
                              "id": "aa2368fc-ad30-4608-b96a-72abf7b1e1ad",
                              "version": "KqlParameterItem/1.0",
                              "name": "Counter11",
                              "type": 2,
                              "isRequired": true,
                              "query": "InsightsMetrics\r\n| where TimeGenerated {TimeRange}\r\n| summarize by Name, Namespace, CounterText = Name\r\n| order by Namespace asc, CounterText asc\r\n| project Counter = pack('counter', Name, 'object', Namespace), CounterText, group = Namespace",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "value": "{\"counter\":\"ReadBytesPerSecond\",\"object\":\"Network\"}",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1"
                                ]
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "6a7306ea-247f-46ca-abca-501911f9e9dd",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregator11",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"Average = round(avg(Val), 2)\", \"label\":\"Average\", \"selected\":false},\r\n    { \"value\":\"P5th = round(percentile(Val, 5), 2)\", \"label\":\"P5th\", \"selected\":false},\r\n    { \"value\":\"P10th = round(percentile(Val, 10), 2)\", \"label\":\"P10th\", \"selected\":false},\r\n    { \"value\":\"P50th = round(percentile(Val, 50), 2)\", \"label\":\"P50th\", \"selected\":false},\r\n    { \"value\":\"P80th = round(percentile(Val, 80), 2)\", \"label\":\"P80th\", \"selected\":false},\r\n    { \"value\":\"P90th = round(percentile(Val, 90), 2)\", \"label\":\"P90th\", \"selected\":false},\r\n    { \"value\":\"P95th = round(percentile(Val, 95), 2)\", \"label\":\"P95th\", \"selected\":true}    \r\n]"
                            },
                            {
                              "id": "0327f26e-cdde-4b48-b512-6c35f06ad1dd",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregatorOrder11",
                              "type": 1,
                              "query": "print(iff('{TrendAggregator11:label}' == 'P5th'  or '{TrendAggregator11:label}' == 'P10th', 'asc', 'desc'))",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "bc1291ba-dd26-4224-9b25-3a1e7b3eb02d",
                              "version": "KqlParameterItem/1.0",
                              "name": "Visualization11",
                              "type": 2,
                              "isRequired": true,
                              "query": "datatable (value:long, Display:string, isSelected:boolean)\r\n    [0, \"Line Chart\", true,\r\n     1, \"Grid\", false]",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "6cc1a388-27c6-4cfe-a787-ff00cb8f4fad",
                              "version": "KqlParameterItem/1.0",
                              "name": "Snippet11",
                              "type": 1,
                              "isRequired": true,
                              "query": "print(iff({Visualization7} == 0, \"{LineChartQuerySnippet}\", \"{GridQuerySnippet}\") )",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "77870d8a-bf65-4405-a722-fdf0826106ac",
                              "version": "KqlParameterItem/1.0",
                              "name": "Unit11",
                              "type": 2,
                              "value": null,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"B -> MB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"B -> GB\",\r\n        \"value\": \"/1024/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> GB\",\r\n        \"value\": \"/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> TB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Mb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Gb\",\r\n        \"value\": \"/1000/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Gb\",\r\n        \"value\": \"/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Tb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"s -> ms\",\r\n        \"value\": \"*1000\"\r\n    },\r\n    {\r\n        \"label\": \"ms -> s\",\r\n        \"value\": \"/1000\"\r\n    }\r\n]"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions"
                        },
                        "customWidth": "25",
                        "conditionalVisibility": {
                          "parameterName": "Mode",
                          "comparison": "isEqualTo",
                          "value": "0"
                        },
                        "name": "parameters - 28"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "parameters": [
                            {
                              "id": "aa2368fc-ad30-4608-b96a-72abf7b1e1ad",
                              "version": "KqlParameterItem/1.0",
                              "name": "Counter12",
                              "type": 2,
                              "isRequired": true,
                              "query": "InsightsMetrics\r\n| where TimeGenerated {TimeRange}\r\n| summarize by Name, Namespace, CounterText = Name\r\n| order by Namespace asc, CounterText asc\r\n| project Counter = pack('counter', Name, 'object', Namespace), CounterText, group = Namespace",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "value": "{\"counter\":\"WriteBytesPerSecond\",\"object\":\"Network\"}",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1"
                                ]
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "6a7306ea-247f-46ca-abca-501911f9e9dd",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregator12",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"Average = round(avg(Val), 2)\", \"label\":\"Average\", \"selected\":false},\r\n    { \"value\":\"P5th = round(percentile(Val, 5), 2)\", \"label\":\"P5th\", \"selected\":false},\r\n    { \"value\":\"P10th = round(percentile(Val, 10), 2)\", \"label\":\"P10th\", \"selected\":false},\r\n    { \"value\":\"P50th = round(percentile(Val, 50), 2)\", \"label\":\"P50th\", \"selected\":false},\r\n    { \"value\":\"P80th = round(percentile(Val, 80), 2)\", \"label\":\"P80th\", \"selected\":false},\r\n    { \"value\":\"P90th = round(percentile(Val, 90), 2)\", \"label\":\"P90th\", \"selected\":false},\r\n    { \"value\":\"P95th = round(percentile(Val, 95), 2)\", \"label\":\"P95th\", \"selected\":true}    \r\n]"
                            },
                            {
                              "id": "0327f26e-cdde-4b48-b512-6c35f06ad1dd",
                              "version": "KqlParameterItem/1.0",
                              "name": "TrendAggregatorOrder12",
                              "type": 1,
                              "query": "print(iff('{TrendAggregator12:label}' == 'P5th'  or '{TrendAggregator12:label}' == 'P10th', 'asc', 'desc'))",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "68468652-570f-4d77-af12-a59d463d5f0d",
                              "version": "KqlParameterItem/1.0",
                              "name": "Visualization12",
                              "type": 2,
                              "isRequired": true,
                              "query": "datatable (value:long, Display:string, isSelected:boolean)\r\n    [0, \"Line Chart\", true,\r\n     1, \"Grid\", false]",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "15738505-f7e6-446e-995d-280cf70dde9d",
                              "version": "KqlParameterItem/1.0",
                              "name": "Snippet12",
                              "type": 1,
                              "isRequired": true,
                              "query": "print(iff({Visualization8} == 0, \"{LineChartQuerySnippet}\", \"{GridQuerySnippet}\") )",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.resources/subscriptions"
                            },
                            {
                              "id": "beb8493f-b5db-4bb5-865b-c8a4fed0ca0c",
                              "version": "KqlParameterItem/1.0",
                              "name": "Unit12",
                              "type": 2,
                              "value": null,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    {\r\n        \"label\": \"B -> MB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"B -> GB\",\r\n        \"value\": \"/1024/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> GB\",\r\n        \"value\": \"/1024\"\r\n    },\r\n    {\r\n        \"label\": \"MB -> TB\",\r\n        \"value\": \"/1024/1024\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Mb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"b -> Gb\",\r\n        \"value\": \"/1000/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Gb\",\r\n        \"value\": \"/1000\"\r\n    },\r\n    {\r\n        \"label\": \"Mb -> Tb\",\r\n        \"value\": \"/1000/1000\"\r\n    },\r\n    {\r\n        \"label\": \"s -> ms\",\r\n        \"value\": \"*1000\"\r\n    },\r\n    {\r\n        \"label\": \"ms -> s\",\r\n        \"value\": \"/1000\"\r\n    }\r\n]"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions"
                        },
                        "customWidth": "25",
                        "conditionalVisibility": {
                          "parameterName": "Mode",
                          "comparison": "isEqualTo",
                          "value": "0"
                        },
                        "name": "parameters - 29"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<h3 style=\"margin-bottom:0;\">{Counter9:label}</h3><h4 style=\"margin-top:0;font-weight:normal;color:#777;\">{TrendAggregator9:label} {TrendAggregatorOrder9} {Unit9:label}</h4>"
                        },
                        "customWidth": "25",
                        "name": "text - 30"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<h3 style=\"margin-bottom:0;\">{Counter10:label}</h3><h4 style=\"margin-top:0;font-weight:normal;color:#777;\">{TrendAggregator10:label} {TrendAggregatorOrder10} {Unit10:label}</h4>"
                        },
                        "customWidth": "25",
                        "name": "text - 31"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<h3 style=\"margin-bottom:0;\">{Counter11:label}</h3><h4 style=\"margin-top:0;font-weight:normal;color:#777;\">{TrendAggregator11:label} {TrendAggregatorOrder11} {Unit11:label}</h4>"
                        },
                        "customWidth": "25",
                        "name": "text - 32"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<h3 style=\"margin-bottom:0;\">{Counter12:label}</h3><h4 style=\"margin-top:0;font-weight:normal;color:#777;\">{TrendAggregator12:label} {TrendAggregatorOrder12} {Unit12:label}</h4>"
                        },
                        "customWidth": "25",
                        "name": "text - 33"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let metric = dynamic({Counter9});\r\nlet cpuSummary=totable(InsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where _ResourceId in~ ({Resources})\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | summarize hint.shufflekey=Computer {TrendAggregator9} by Computer, Name\r\n    | top {TopN} by {TrendAggregator9:label} {TrendAggregatorOrder9});\r\nlet computerList=(cpuSummary \r\n    | project Computer);\r\nlet EmptyNodeIdentityAndProps = datatable(Computer:string, NodeId:string, NodeProps:dynamic, Priority: long) [];\r\nlet OmsNodeIdentityAndProps = computerList\r\n    | extend NodeId = Computer\r\n    | extend Priority = 1\r\n    | extend NodeProps = pack('type', 'StandAloneNode', 'name', Computer);\r\nlet ServiceMapNodeIdentityAndProps = VMComputer | extend ResourceId=strcat('machines/', Machine) | extend Bitness=columnifexists('Bitness', '')\r\n    | where TimeGenerated {TimeRange}\r\n    | where Computer in (computerList)\r\n    | summarize arg_max(TimeGenerated, *) by Computer\r\n    | extend AzureCloudServiceNodeIdentity = iif(isnotempty(AzureCloudServiceName), strcat(AzureCloudServiceInstanceId, '|',                     AzureCloudServiceDeployment), ''),          AzureScaleSetNodeIdentity = iif(isnotempty(AzureVmScaleSetName),              strcat(AzureVmScaleSetInstanceId, '|',                     AzureVmScaleSetDeployment), ''),          ComputerProps =              pack('type', 'StandAloneNode',                   'name', Computer,                   'mappingResourceId', ResourceId,                   'subscriptionId', AzureSubscriptionId,                   'resourceGroup', AzureResourceGroup,                   'azureResourceId', columnifexists('_ResourceId', '')),          AzureCloudServiceNodeProps =              pack('type', 'AzureCloudServiceNode',                   'cloudServiceInstanceId', AzureCloudServiceInstanceId,                   'cloudServiceRoleName', columnifexists('AzureCloudServiceRoleName', ''),                   'cloudServiceDeploymentId', AzureCloudServiceDeployment,                   'cloudServiceName', AzureCloudServiceName,                   'mappingResourceId', ResourceId),          AzureScaleSetNodeProps =               pack('type', 'AzureScaleSetNode',                   'scaleSetInstanceId', columnifexists('Computer', ''),                   'vmScaleSetDeploymentId', AzureVmScaleSetDeployment,                   'vmScaleSetName', AzureVmScaleSetName,                   'serviceFabricClusterName', AzureServiceFabricClusterName,                   'vmScaleSetResourceId', AzureVmScaleSetResourceId,                   'resourceGroupName', columnifexists('AzureResourceGroup', ''),                   'subscriptionId', columnifexists('AzureSubscriptionId', ''),                   'mappingResourceId', ResourceId)| project   Computer,            NodeId = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeIdentity,                       isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeIdentity, Computer),            NodeProps = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeProps,                          isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeProps, ComputerProps),            Priority = 2;\r\nlet NodeIdentityAndProps = union kind=inner isfuzzy = true                                  EmptyNodeIdentityAndProps, OmsNodeIdentityAndProps, ServiceMapNodeIdentityAndProps                            \r\n    | summarize arg_max(Priority, *) by Computer; \r\nlet NodeIdentityAndPropsMin = NodeIdentityAndProps\r\n    | extend Kind = iff(NodeProps.type == \"StandAloneNode\", iff(NodeProps.azureResourceId == \"\", \"Non-Azure Virtual Machine\", \"Azure Virtual Machine\"), NodeProps.type), \r\n    ResourceId = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.vmScaleSetResourceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceDeploymentId, Computer)),\r\n    ResourceName = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.scaleSetInstanceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceInstanceId, Computer))\r\n    | project Computer, Kind, ResourceId, ResourceName;\r\nInsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | where Computer in (computerList)\r\n    | join kind=leftouter (NodeIdentityAndPropsMin) on Computer\r\n    | summarize {TrendAggregator9}{Unit9} by {Snippet9}",
                          "size": 0,
                          "aggregation": 3,
                          "showAnnotations": true,
                          "noDataMessage": "No computers are emitting data for this performance counter.",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/resourcegroups",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 34"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let metric = dynamic({Counter10});\r\nlet cpuSummary=totable(InsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where _ResourceId in~ ({Resources})\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | summarize hint.shufflekey=Computer {TrendAggregator10} by Computer, Name\r\n    | top {TopN} by {TrendAggregator10:label} {TrendAggregatorOrder10});\r\nlet computerList=(cpuSummary \r\n    | project Computer);\r\nlet EmptyNodeIdentityAndProps = datatable(Computer:string, NodeId:string, NodeProps:dynamic, Priority: long) [];\r\nlet OmsNodeIdentityAndProps = computerList\r\n    | extend NodeId = Computer\r\n    | extend Priority = 1\r\n    | extend NodeProps = pack('type', 'StandAloneNode', 'name', Computer);\r\nlet ServiceMapNodeIdentityAndProps = VMComputer | extend ResourceId=strcat('machines/', Machine) | extend Bitness=columnifexists('Bitness', '')\r\n    | where TimeGenerated {TimeRange}\r\n    | where Computer in (computerList)\r\n    | summarize arg_max(TimeGenerated, *) by Computer\r\n    | extend AzureCloudServiceNodeIdentity = iif(isnotempty(AzureCloudServiceName), strcat(AzureCloudServiceInstanceId, '|',                     AzureCloudServiceDeployment), ''),          AzureScaleSetNodeIdentity = iif(isnotempty(AzureVmScaleSetName),              strcat(AzureVmScaleSetInstanceId, '|',                     AzureVmScaleSetDeployment), ''),          ComputerProps =              pack('type', 'StandAloneNode',                   'name', Computer,                   'mappingResourceId', ResourceId,                   'subscriptionId', AzureSubscriptionId,                   'resourceGroup', AzureResourceGroup,                   'azureResourceId', columnifexists('_ResourceId', '')),          AzureCloudServiceNodeProps =              pack('type', 'AzureCloudServiceNode',                   'cloudServiceInstanceId', AzureCloudServiceInstanceId,                   'cloudServiceRoleName', columnifexists('AzureCloudServiceRoleName', ''),                   'cloudServiceDeploymentId', AzureCloudServiceDeployment,                   'cloudServiceName', AzureCloudServiceName,                   'mappingResourceId', ResourceId),          AzureScaleSetNodeProps =               pack('type', 'AzureScaleSetNode',                   'scaleSetInstanceId', columnifexists('Computer', ''),                   'vmScaleSetDeploymentId', AzureVmScaleSetDeployment,                   'vmScaleSetName', AzureVmScaleSetName,                   'serviceFabricClusterName', AzureServiceFabricClusterName,                   'vmScaleSetResourceId', AzureVmScaleSetResourceId,                   'resourceGroupName', columnifexists('AzureResourceGroup', ''),                   'subscriptionId', columnifexists('AzureSubscriptionId', ''),                   'mappingResourceId', ResourceId)| project   Computer,            NodeId = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeIdentity,                       isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeIdentity, Computer),            NodeProps = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeProps,                          isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeProps, ComputerProps),            Priority = 2;\r\nlet NodeIdentityAndProps = union kind=inner isfuzzy = true                                  EmptyNodeIdentityAndProps, OmsNodeIdentityAndProps, ServiceMapNodeIdentityAndProps                            \r\n    | summarize arg_max(Priority, *) by Computer; \r\nlet NodeIdentityAndPropsMin = NodeIdentityAndProps\r\n    | extend Kind = iff(NodeProps.type == \"StandAloneNode\", iff(NodeProps.azureResourceId == \"\", \"Non-Azure Virtual Machine\", \"Azure Virtual Machine\"), NodeProps.type), \r\n    ResourceId = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.vmScaleSetResourceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceDeploymentId, Computer)),\r\n    ResourceName = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.scaleSetInstanceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceInstanceId, Computer))\r\n    | project Computer, Kind, ResourceId, ResourceName;\r\nInsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | where Computer in (computerList)\r\n    | join kind=leftouter (NodeIdentityAndPropsMin) on Computer\r\n    | summarize {TrendAggregator10}{Unit10} by {Snippet10}",
                          "size": 0,
                          "aggregation": 3,
                          "showAnnotations": true,
                          "noDataMessage": "No computers are emitting data for this performance counter.",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/resourcegroups",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 35"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let metric = dynamic({Counter11});\r\nlet cpuSummary=totable(InsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where _ResourceId in~ ({Resources})\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | summarize hint.shufflekey=Computer {TrendAggregator11} by Computer, Name\r\n    | top {TopN} by {TrendAggregator11:label} {TrendAggregatorOrder11});\r\nlet computerList=(cpuSummary \r\n    | project Computer);\r\nlet EmptyNodeIdentityAndProps = datatable(Computer:string, NodeId:string, NodeProps:dynamic, Priority: long) [];\r\nlet OmsNodeIdentityAndProps = computerList\r\n    | extend NodeId = Computer\r\n    | extend Priority = 1\r\n    | extend NodeProps = pack('type', 'StandAloneNode', 'name', Computer);\r\nlet ServiceMapNodeIdentityAndProps = VMComputer | extend ResourceId=strcat('machines/', Machine) | extend Bitness=columnifexists('Bitness', '')\r\n    | where TimeGenerated {TimeRange}\r\n    | where Computer in (computerList)\r\n    | summarize arg_max(TimeGenerated, *) by Computer\r\n    | extend AzureCloudServiceNodeIdentity = iif(isnotempty(AzureCloudServiceName), strcat(AzureCloudServiceInstanceId, '|',                     AzureCloudServiceDeployment), ''),          AzureScaleSetNodeIdentity = iif(isnotempty(AzureVmScaleSetName),              strcat(AzureVmScaleSetInstanceId, '|',                     AzureVmScaleSetDeployment), ''),          ComputerProps =              pack('type', 'StandAloneNode',                   'name', Computer,                   'mappingResourceId', ResourceId,                   'subscriptionId', AzureSubscriptionId,                   'resourceGroup', AzureResourceGroup,                   'azureResourceId', columnifexists('_ResourceId', '')),          AzureCloudServiceNodeProps =              pack('type', 'AzureCloudServiceNode',                   'cloudServiceInstanceId', AzureCloudServiceInstanceId,                   'cloudServiceRoleName', columnifexists('AzureCloudServiceRoleName', ''),                   'cloudServiceDeploymentId', AzureCloudServiceDeployment,                   'cloudServiceName', AzureCloudServiceName,                   'mappingResourceId', ResourceId),          AzureScaleSetNodeProps =               pack('type', 'AzureScaleSetNode',                   'scaleSetInstanceId', columnifexists('Computer', ''),                   'vmScaleSetDeploymentId', AzureVmScaleSetDeployment,                   'vmScaleSetName', AzureVmScaleSetName,                   'serviceFabricClusterName', AzureServiceFabricClusterName,                   'vmScaleSetResourceId', AzureVmScaleSetResourceId,                   'resourceGroupName', columnifexists('AzureResourceGroup', ''),                   'subscriptionId', columnifexists('AzureSubscriptionId', ''),                   'mappingResourceId', ResourceId)| project   Computer,            NodeId = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeIdentity,                       isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeIdentity, Computer),            NodeProps = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeProps,                          isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeProps, ComputerProps),            Priority = 2;\r\nlet NodeIdentityAndProps = union kind=inner isfuzzy = true                                  EmptyNodeIdentityAndProps, OmsNodeIdentityAndProps, ServiceMapNodeIdentityAndProps                            \r\n    | summarize arg_max(Priority, *) by Computer; \r\nlet NodeIdentityAndPropsMin = NodeIdentityAndProps\r\n    | extend Kind = iff(NodeProps.type == \"StandAloneNode\", iff(NodeProps.azureResourceId == \"\", \"Non-Azure Virtual Machine\", \"Azure Virtual Machine\"), NodeProps.type), \r\n    ResourceId = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.vmScaleSetResourceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceDeploymentId, Computer)),\r\n    ResourceName = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.scaleSetInstanceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceInstanceId, Computer))\r\n    | project Computer, Kind, ResourceId, ResourceName;\r\nInsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | where Computer in (computerList)\r\n    | join kind=leftouter (NodeIdentityAndPropsMin) on Computer\r\n    | summarize {TrendAggregator11}{Unit11} by {Snippet11}",
                          "size": 0,
                          "aggregation": 3,
                          "showAnnotations": true,
                          "noDataMessage": "No computers are emitting data for this performance counter.",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/resourcegroups",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 36"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let metric = dynamic({Counter12});\r\nlet cpuSummary=totable(InsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where _ResourceId in~ ({Resources})\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | summarize hint.shufflekey=Computer {TrendAggregator12} by Computer, Name\r\n    | top {TopN} by {TrendAggregator12:label} {TrendAggregatorOrder12});\r\nlet computerList=(cpuSummary \r\n    | project Computer);\r\nlet EmptyNodeIdentityAndProps = datatable(Computer:string, NodeId:string, NodeProps:dynamic, Priority: long) [];\r\nlet OmsNodeIdentityAndProps = computerList\r\n    | extend NodeId = Computer\r\n    | extend Priority = 1\r\n    | extend NodeProps = pack('type', 'StandAloneNode', 'name', Computer);\r\nlet ServiceMapNodeIdentityAndProps = VMComputer | extend ResourceId=strcat('machines/', Machine) | extend Bitness=columnifexists('Bitness', '')\r\n    | where TimeGenerated {TimeRange}\r\n    | where Computer in (computerList)\r\n    | summarize arg_max(TimeGenerated, *) by Computer\r\n    | extend AzureCloudServiceNodeIdentity = iif(isnotempty(AzureCloudServiceName), strcat(AzureCloudServiceInstanceId, '|',                     AzureCloudServiceDeployment), ''),          AzureScaleSetNodeIdentity = iif(isnotempty(AzureVmScaleSetName),              strcat(AzureVmScaleSetInstanceId, '|',                     AzureVmScaleSetDeployment), ''),          ComputerProps =              pack('type', 'StandAloneNode',                   'name', Computer,                   'mappingResourceId', ResourceId,                   'subscriptionId', AzureSubscriptionId,                   'resourceGroup', AzureResourceGroup,                   'azureResourceId', columnifexists('_ResourceId', '')),          AzureCloudServiceNodeProps =              pack('type', 'AzureCloudServiceNode',                   'cloudServiceInstanceId', AzureCloudServiceInstanceId,                   'cloudServiceRoleName', columnifexists('AzureCloudServiceRoleName', ''),                   'cloudServiceDeploymentId', AzureCloudServiceDeployment,                   'cloudServiceName', AzureCloudServiceName,                   'mappingResourceId', ResourceId),          AzureScaleSetNodeProps =               pack('type', 'AzureScaleSetNode',                   'scaleSetInstanceId', columnifexists('Computer', ''),                   'vmScaleSetDeploymentId', AzureVmScaleSetDeployment,                   'vmScaleSetName', AzureVmScaleSetName,                   'serviceFabricClusterName', AzureServiceFabricClusterName,                   'vmScaleSetResourceId', AzureVmScaleSetResourceId,                   'resourceGroupName', columnifexists('AzureResourceGroup', ''),                   'subscriptionId', columnifexists('AzureSubscriptionId', ''),                   'mappingResourceId', ResourceId)| project   Computer,            NodeId = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeIdentity,                       isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeIdentity, Computer),            NodeProps = case(isnotempty(AzureCloudServiceNodeIdentity), AzureCloudServiceNodeProps,                          isnotempty(AzureScaleSetNodeIdentity), AzureScaleSetNodeProps, ComputerProps),            Priority = 2;\r\nlet NodeIdentityAndProps = union kind=inner isfuzzy = true                                  EmptyNodeIdentityAndProps, OmsNodeIdentityAndProps, ServiceMapNodeIdentityAndProps                            \r\n    | summarize arg_max(Priority, *) by Computer; \r\nlet NodeIdentityAndPropsMin = NodeIdentityAndProps\r\n    | extend Kind = iff(NodeProps.type == \"StandAloneNode\", iff(NodeProps.azureResourceId == \"\", \"Non-Azure Virtual Machine\", \"Azure Virtual Machine\"), NodeProps.type), \r\n    ResourceId = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.vmScaleSetResourceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceDeploymentId, Computer)),\r\n    ResourceName = iff(NodeProps.type == \"AzureScaleSetNode\", NodeProps.scaleSetInstanceId, \r\n        iff(NodeProps.type == \"AzureCloudServiceNode\", NodeProps.cloudServiceInstanceId, Computer))\r\n    | project Computer, Kind, ResourceId, ResourceName;\r\nInsightsMetrics\r\n    | where TimeGenerated {TimeRange}\r\n    | where Namespace == metric.object and Name == metric.counter\r\n    | where Computer in (computerList)\r\n    | join kind=leftouter (NodeIdentityAndPropsMin) on Computer\r\n    | summarize {TrendAggregator12}{Unit12} by {Snippet12}",
                          "size": 0,
                          "aggregation": 3,
                          "showAnnotations": true,
                          "noDataMessage": "No computers are emitting data for this performance counter.",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/resourcegroups",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 37"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "performancecounter"
                  },
                  "name": "Performance Counter"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "7595221a-ffa4-49b4-908a-5ca595c8eaa3",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "TIme Range",
                              "type": 4,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 172800000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "InsightsMetrics\r\n| where Name == \"FreeSpacePercentage\"\r\n| extend Drive = replace_string(Tags,'{\"vm.azm.ms/mountId\":\"','')\r\n| extend Drives = replace_string(Drive,'\"}','')\r\n| summarize Average=avg(Val), Maximum= max(Val), Minimum= min(Val), percentiles(Val, 5, 10, 50, 80, 90, 95)  by Computer, Tags,Drives\r\n| order by Average, Maximum\r\n| project Computer ,Drives, Average,Maximum,Minimum\r\n",
                          "size": 3,
                          "title": "Disk Space Utilziation",
                          "timeContextFromParameter": "TimeRange",
                          "showRefreshButton": true,
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Computer",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "50ch"
                                }
                              },
                              {
                                "columnMatch": "Drives",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Average",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 2
                                  }
                                }
                              },
                              {
                                "columnMatch": "Max",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 2
                                  }
                                }
                              },
                              {
                                "columnMatch": "Min",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 2
                                  }
                                }
                              },
                              {
                                "columnMatch": "Tags",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "percentile_Val_5",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "percentile_Val_10",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "percentile_Val_50",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "percentile_Val_80",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "percentile_Val_90",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "percentile_Val_95",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "TimeGenerated",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 10000
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "CounterValue",
                              "formatter": 12,
                              "formatOptions": {
                                "min": 1,
                                "max": 100,
                                "palette": "greenRed",
                                "linkColumn": "CounterName",
                                "linkTarget": "Resource",
                                "linkIsContextBlade": false
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true
                          },
                          "graphSettings": {
                            "type": 2,
                            "topContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "P90",
                              "formatter": 8,
                              "formatOptions": {
                                "min": 1,
                                "max": 100,
                                "palette": "hotCold",
                                "linkColumn": "P90",
                                "linkTarget": "Metrics",
                                "linkIsContextBlade": true
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal"
                                },
                                "emptyValCustomText": "0"
                              }
                            },
                            "nodeIdField": "P90",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "P90",
                            "sizeAggregation": "Sum",
                            "legendMetric": "P90",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "P90",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "name": "Disk Space Utilziation"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "volumeperformance"
                  },
                  "name": "Volume Performance"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "920babe0-e044-45a5-bbfe-cc6ddfb12679",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 604800000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Top 10 Virtual Machines by CPU utilization \r\n// Top 10 Virtual Machines by CPU utilization. \r\nInsightsMetrics\r\n\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"Processor\" and Name == \"UtilizationPercentage\"\r\n| summarize P90 = percentile(Val, 90) by Computer\r\n| top 5 by P90",
                          "size": 3,
                          "title": "Top 5 CPU Consumption",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "P90",
                              "formatter": 12,
                              "formatOptions": {
                                "min": 1,
                                "max": 100,
                                "palette": "greenRed"
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true
                          },
                          "graphSettings": {
                            "type": 2,
                            "topContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "P90",
                              "formatter": 8,
                              "formatOptions": {
                                "min": 1,
                                "max": 100,
                                "palette": "hotCold",
                                "linkColumn": "P90",
                                "linkTarget": "Metrics",
                                "linkIsContextBlade": true
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal"
                                },
                                "emptyValCustomText": "0"
                              }
                            },
                            "nodeIdField": "P90",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "P90",
                            "sizeAggregation": "Sum",
                            "legendMetric": "P90",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "P90",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "name": "Top 5 CPU Consumption"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Bottom 10 Free disk space % \r\n// Bottom 10 Free disk space % by computer, for the last 7 days. \r\nPerf\r\n\r\n| where (ObjectName == \"Logical Disk\" or ObjectName == \"LogicalDisk\") and CounterName contains \"%\" and InstanceName != \"_Total\" and InstanceName != \"HarddiskVolume1\"\r\n| project TimeGenerated, Computer, ObjectName, CounterName, InstanceName, CounterValue \r\n| summarize arg_max(TimeGenerated, *) by Computer\r\n| top 5 by CounterValue desc",
                          "size": 3,
                          "title": "Top 5 Disk Space Utilziation",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "CounterValue",
                              "formatter": 12,
                              "formatOptions": {
                                "min": 1,
                                "max": 100,
                                "palette": "greenRed",
                                "linkColumn": "CounterName",
                                "linkTarget": "Resource",
                                "linkIsContextBlade": false
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true
                          },
                          "graphSettings": {
                            "type": 2,
                            "topContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "P90",
                              "formatter": 8,
                              "formatOptions": {
                                "min": 1,
                                "max": 100,
                                "palette": "hotCold",
                                "linkColumn": "P90",
                                "linkTarget": "Metrics",
                                "linkIsContextBlade": true
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal"
                                },
                                "emptyValCustomText": "0"
                              }
                            },
                            "nodeIdField": "P90",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": null,
                            "hivesMargin": 5
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "P90",
                            "sizeAggregation": "Sum",
                            "legendMetric": "P90",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "P90",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "name": "Bottom 10 Free Disk Space"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Virtual Machine available memory \r\n// Virtual Machine available memory. \r\nInsightsMetrics\r\n\r\n| where Origin == \"vm.azm.ms\"\r\n| where Namespace == \"Memory\"\r\n| where Name == \"AvailableMB\"\r\n| summarize P90= avg(Val) by  Computer\r\n| top 5 by P90",
                          "size": 3,
                          "title": "Top 5 VM Available Memory",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "P90",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "name": "Top 5 VM Available Memory"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "top5"
                  },
                  "name": "Top10"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "b7ac2f26-2834-49d9-82e7-1f6c621905f1",
                              "version": "KqlParameterItem/1.0",
                              "name": "Criticality",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "resources\r\n| extend Criticality = case(tags.Criticality <> \"\", tags.Criticality,\r\n\t\t    \"Undefined\")\r\n| distinct Criticality",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": [
                                "value::all"
                              ]
                            },
                            {
                              "id": "d9f23711-7b51-41a9-842c-f938fce1a8cc",
                              "version": "KqlParameterItem/1.0",
                              "name": "Environment",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "resources\r\n| extend Environment = case(\r\ntags.Environment <> \"\", tags.Environment,\r\ntags.environment <> \"\", tags.environment,\r\ntags.Env <> \"\", tags.Env,\r\ntags.env <> \"\", tags.env,\r\ntolower(name) contains \"prod\", \"Production\",\r\ntolower(name) contains \"dev\", \"Development\",\r\ntolower(name) contains \"qa\", \"QA\",\r\ntolower(name) contains \"uat\", \"UAT\",\r\ntolower(name) contains \"sit\", \"SIT\",\r\ntolower(name) contains \"test\", \"Test\",\r\n\"Undefined\")\r\n| distinct Environment",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": [
                                "Dev"
                              ]
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\n| where resourceGroup in ({ResourceGroup})\n| extend criticality = case(tags.Criticality <> \"\", tags.Criticality,\n    \"Undefined\")\n| extend environment = case(\n    tags.Environment <> \"\", tags.Environment,\n    tags.environment <> \"\", tags.environment,\n    tags.Env <> \"\", tags.Env,\n    tags.env <> \"\", tags.env,\n    tolower(name) contains \"prod\", \"Production\",\n    tolower(name) contains \"dev\", \"Development\",\n    tolower(name) contains \"qa\", \"QA\",\n    tolower(name) contains \"uat\", \"UAT\",\n    tolower(name) contains \"sit\", \"SIT\",\n    tolower(name) contains \"test\", \"Test\",\n    \"Undefined\")\n| where criticality in ({Criticality})\n| where environment in ({Environment})\n| where \n    (type == 'microsoft.compute/virtualmachines') or \n    (type == \"microsoft.compute/virtualmachinescalesets\" and tags.aksEngineVersion !contains \"aks-gomod\") or\n    (type == 'microsoft.web/sites') or \n    (type == \"microsoft.containerservice/managedclusters\") or \n    (type == 'microsoft.sql/servers/databases') or \n    (type == 'microsoft.documentdb/databaseaccounts') or \n    (type == 'microsoft.dbformysql/servers') or \n    (type == 'microsoft.dbformysql/flexibleservers') or \n    (type == \"microsoft.apimanagement/service\") or \n    (type == \"microsoft.storage/storageaccounts\" or type == \"microsoft.classicstorage/storageaccounts\") or \n    (type == \"microsoft.network/azurefirewalls\") or \n    (type == \"microsoft.network/frontdoors\") or \n    (type == \"microsoft.network/applicationgateways\") or \n    (type == \"microsoft.network/loadbalancers\") or \n    (type == \"microsoft.recoveryservices/vaults\")\n| extend aksname = case(\n    type == \"microsoft.containerservice/managedclusters\", tolower(tostring(name)),\n    \"Undefined\"\n    )\n| join kind = leftouter (\n    resources \n    | where type == \"microsoft.compute/virtualmachinescalesets\"\n    | extend aksname = tolower(tostring(split(resourceGroup, \"_\")[2]))\n    | extend AvZones = coalesce(tostring(array_length(parse_json(zones))), 'Not Configured'), AvSets = \"Scale Sets\"\n    )\n    on aksname\n| extend state = case(\n    type == 'microsoft.compute/virtualmachines', tostring(properties.extended.instanceView.powerState.displayStatus),\n    type == 'microsoft.compute/virtualmachinescalesets', tostring(properties.provisioningState),\n    type == 'microsoft.web/sites', tostring(properties.state),\n    type == 'microsoft.containerservice/managedclusters', tostring(properties.provisioningState),\n    type == 'microsoft.sql/servers/databases', tostring(properties.status),\n    type == 'microsoft.documentdb/databaseaccounts', tostring(properties.provisioningState),\n    type == 'microsoft.dbformysql/servers', tostring(properties.userVisibleState),\n    type == 'microsoft.dbformysql/flexibleservers', tostring(properties.state),\n    type == \"microsoft.apimanagement/service\", tostring(properties.provisioningState),\n    type contains \"storageaccounts\", tostring(properties.provisioningState),\n    type == \"microsoft.network/azurefirewalls\", tostring(properties.provisioningState),\n    type == \"microsoft.network/frontdoors\", tostring(properties.resourceState),\n    type == \"microsoft.network/applicationgateways\", tostring(properties.operationalState),\n    type == \"microsoft.network/loadbalancers\", tostring(properties.provisioningState),\n    type == \"microsoft.recoveryservices/vaults\", tostring(properties.provisioningState),\n    \"Undefined\"\n    )\n| extend skuName = case(\n    type == 'microsoft.compute/virtualmachines', tostring(properties.hardwareProfile.vmSize),\n    type == 'microsoft.compute/virtualmachinescalesets', tostring(sku.name),\n    type == 'microsoft.web/sites', tostring(properties.sku),\n    type == 'microsoft.containerservice/managedclusters', tostring(properties.agentPoolProfiles[0].vmSize),\n    type == 'microsoft.sql/servers/databases', tostring(sku.tier),\n    type == 'microsoft.documentdb/databaseaccounts', tostring(properties.databaseAccountOfferType),\n    type == 'microsoft.dbformysql/servers', tostring(sku.tier),\n    type == 'microsoft.dbformysql/flexibleservers', tostring(sku.tier),\n    type == \"microsoft.apimanagement/service\", tostring(sku.name),\n    type contains 'storageaccounts', tostring(replace('-', '_', tostring(iff(type =~ \"microsoft.storage/storageaccounts\", sku.name, properties.accountType)))),\n    type == \"microsoft.network/azurefirewalls\", tostring(properties.sku.name),\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", tostring(properties.sku.name),\n    type == \"microsoft.network/loadbalancers\", tostring(sku.name),\n    type == \"microsoft.recoveryservices/vaults\", tostring(iif(isnotnull(sku.tier), sku.tier, sku.name)),\n    \"Undefined\"\n    )\n| extend avZones = case(\n    location !in~ ('brazilsouth', 'canadacentral', 'centralus', 'eastus', 'eastus2', 'southcentralus', 'usgovvirginia', 'westus2', 'westus3', 'francecentral', 'germanywestcentral', 'northeurope', 'norwayeast', 'uksouth', 'westeurope', 'swedencentral', 'southafricanorth', 'australiaeast', 'centralindia', 'japaneast', 'koreacentral', 'southeastasia', 'eastasia'), 'Not Applicable',\n    (type == 'microsoft.compute/virtualmachines'), coalesce(tostring(zones[0]), 'Not Configured'),\n    (type == 'microsoft.compute/virtualmachinescalesets'), coalesce(tostring(array_length(parse_json(zones))), 'Not Configured'),\n    (type == 'microsoft.containerservice/managedclusters' and AvZones <> \"\"), AvZones,\n    (type == 'microsoft.containerservice/managedclusters' and isempty(AvZones)), \"Not Configured\",\n    (type == 'microsoft.web/sites'), \"Not Applicable\",\n    (type == 'microsoft.sql/servers/databases' and sku.tier <> 'DataWarehouse'), iif(isempty(properties.zoneRedundant) or properties.zoneRedundant == \"false\", 'Not Configured', 'Configured'),\n    (type == 'microsoft.sql/servers/databases' and sku.tier == 'DataWarehouse'), \"Not Applicable\",\n    (type == 'microsoft.documentdb/databaseaccounts'), iif(properties.locations[0].isZoneRedundant == \"false\", 'Not Configured', 'Configured'), \n    (type == 'microsoft.dbformysql/servers'), \"Not Applicable\",\n    (type == 'microsoft.dbformysql/flexibleservers'), iif(properties.haEnabled == \"Enabled\", 'Configured', 'Not Configured'),\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains 'storageaccounts'), case(split(skuName, '_', 1)[0] =~ \"zrs\", \"Configured\", \"Not Configured\"),\n    (type == \"microsoft.network/azurefirewalls\"), iif(isnotnull(zones), \"Configured\", \"Not Configured\"),\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), iif(isnotnull(zones), \"Configured\", \"Not Configured\"),\n    (type == \"microsoft.network/loadbalancers\"), case( \n        skuName =~ \"Basic\", \"Not Applicable\",\n        skuName =~ \"Standard\" and isnotnull(zones), \"Configured\",\n        \"Not Configured\"\n    ),\n    (type == \"microsoft.recoveryservices/vaults\"), \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend avSets = case(\n    type == 'microsoft.compute/virtualmachines' and avZones in ('1', '2', '3'), \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachines', (coalesce(extract('/availabilitySets/(.*)', 1, tostring(properties.availabilitySet.id)), 'Not Configured')),\n    type == 'microsoft.compute/virtualmachinescalesets' and avZones in ('1', '2', '3'), \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachinescalesets', 'A regional (non-zonal) scale set uses placement groups, which act as an implicit availability set with five fault domains and five update domains.',\n    type == 'microsoft.web/sites', 'Not Applicable',\n    type == 'microsoft.containerservice/managedclusters', case(\n        AvSets == 'Scale Sets' and avZones in ('1', '2', '3'), \"Not Applicable\",\n        AvSets == 'Scale Sets', \"A regional (non-zonal) scale set uses placement groups, which act as an implicit availability set with five fault domains and five update domains.\",\n        \"Scale Sets Not Configured\"\n    ),\n    type == 'microsoft.sql/servers/databases', 'Not Applicable',\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', \"Not Applicable\",\n    type == 'microsoft.dbformysql/flexibleservers', \"Not Applicable\",\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", \"Not Applicable\",\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend Capacity = case(\n    type == 'microsoft.compute/virtualmachines', \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachinescalesets', tostring(sku.capacity),\n    type == 'microsoft.web/sites', \"Not Applicable\",\n    type == 'microsoft.containerservice/managedclusters', iif(isnotempty(sku1.capacity), tostring(sku1.capacity), \"0\"), // AKS with or without VMSS\n    type == 'microsoft.sql/servers/databases', tostring(sku.capacity),\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', tostring(sku.capacity),\n    type == 'microsoft.dbformysql/flexibleservers', tostring(sku.capacity),\n    type == \"microsoft.apimanagement/service\", tostring(sku.capacity),\n    type contains \"storageaccounts\", \"Not Applicable\", \n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", tostring(iif(isnotempty(properties.autoscaleConfiguration), properties.autoscaleConfiguration.minCapacity, properties.sku.capacity)),\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend FaultDomain = case(\n    type == 'microsoft.compute/virtualmachines', \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachinescalesets', iif(isnotempty(properties.platformFaultDomainCount), properties.platformFaultDomainCount, \"0\"),  // 1 - AZ, 5 - Regional VMSS\n    type == 'microsoft.web/sites', \"Not Applicable\",\n    type == 'microsoft.containerservice/managedclusters', iif(isnotempty(properties1.platformFaultDomainCount), properties1.platformFaultDomainCount, \"0\"),\n    type == 'microsoft.sql/servers/databases', \"Not Applicable\",\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', 'Not Applicable',\n    type == 'microsoft.dbformysql/flexibleservers', 'Not Applicable',\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", \"Not Applicable\",\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend osDisk = case(\n    type == 'microsoft.compute/virtualmachines', iif(properties.storageProfile.osDisk.diffDiskSettings.option == \"Local\", \"Ephemeral\",  properties.storageProfile.osDisk.managedDisk.storageAccountType),\n    type == 'microsoft.compute/virtualmachinescalesets', iif(properties.virtualMachineProfile.storageProfile.osDisk.diffDiskSettings.option == \"Local\", \"Ephemeral\",  properties.virtualMachineProfile.storageProfile.osDisk.managedDisk.storageAccountType),\n    type == 'microsoft.web/sites', 'Not Applicable',\n    type == 'microsoft.containerservice/managedclusters', iff(properties.agentPoolProfiles[0].osDiskType == 'Ephemeral', 'Ephemeral', properties1.virtualMachineProfile.storageProfile.osDisk.managedDisk.storageAccountType),\n    type == 'microsoft.sql/servers/databases', properties.storageAccountType,\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', 'Not Applicable',\n    type == 'microsoft.dbformysql/flexibleservers', 'Not Applicable',\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", tostring(split(skuName, '_', 0)[0]),\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    'Not Applicable'\n    )\n| extend OSDisk = case(\n    isnotempty(osDisk), osDisk,\n    isempty(osDisk) and (type == 'microsoft.compute/virtualmachines') and state <> 'VM running', 'Unknown, start VM to get disk information.',\n    isempty(osDisk) and (type == 'microsoft.compute/virtualmachines') and isnotempty(properties.storageProfile.osDisk.vhd.uri), 'Unmanaged',\n    \"Unknown\")\n| extend ReadReplica = case (\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters'), \"Not Applicable\",\n    (type == 'microsoft.sql/servers/databases' and sku.tier <> 'DataWarehouse'), tostring(properties.readReplicaCount), // SQL DB\n    (type == 'microsoft.sql/servers/databases' and sku.tier == 'DataWarehouse'), \"Not Applicable\", // Synapse\n    type == 'microsoft.documentdb/databaseaccounts', tostring(array_length(parse_json(properties.readLocations))),\n    type == 'microsoft.dbformysql/servers', \"Not Applicable\",\n    type == 'microsoft.dbformysql/flexibleservers', \"Not Applicable\",\n    type == \"microsoft.apimanagement/service\", tostring(properties.additionalLocations),\n    type contains \"storageaccounts\", case(split(skuName, '_', 1)[0] =~ \"ragrs\", \"Configured\", \"Not Configured\"),\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend AutomaticFailover = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.sql/servers/databases'), \"Not Applicable\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableAutomaticFailover == \"false\" and properties.enableMultipleWriteLocations == \"false\" and toint(ReadReplica) > 1), \"Not Configured\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableAutomaticFailover == \"true\"), \"Configured\",\n    (type == 'microsoft.documentdb/databaseaccounts'), \"Not Applicable\",\n    type == 'microsoft.dbformysql/servers', \"Not Applicable\",\n    type == 'microsoft.dbformysql/flexibleservers', case(properties.haEnabled == \"Enabled\", \"Configured\", \"Not Applicable\"),\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", \"Not Applicable\",\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", iif(isnotempty(properties.autoscaleConfiguration), \"Configured\", \"Not Configured\"),\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend MultipleWriteLocations = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.sql/servers/databases', 'microsoft.dbformysql/servers', 'microsoft.dbformysql/flexibleservers'), \"Not Applicable\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableMultipleWriteLocations == \"false\"), \"Not Enabled\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableMultipleWriteLocations == \"true\"), \"Enabled\",\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains \"storageaccounts\"), \"Not Applicable\",\n    (type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), \"Not Applicable\",\n    (type == \"microsoft.network/loadbalancers\"), \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend StorageAutogrow = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.sql/servers/databases', 'microsoft.documentdb/databaseaccounts'), \"Not Applicable\",\n    (type == 'microsoft.dbformysql/servers'), tostring(properties.storageProfile.storageAutogrow),\n    (type == 'microsoft.dbformysql/flexibleservers'), \"Not Applicable\",\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains \"storageaccounts\"), \"Not Applicable\",\n    (type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), \"Not Applicable\",\n    (type == \"microsoft.network/loadbalancers\"), \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend ReplicationRole = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.documentdb/databaseaccounts'), \"Not Applicable\",\n\t(type == 'microsoft.sql/servers/databases' and sku.tier <> 'DataWarehouse'), iif(isnotempty(properties.secondaryType), \"replica\", \"master\"),\n\t(type == 'microsoft.sql/servers/databases' and sku.tier == 'DataWarehouse'), \"Not Applicable\",\n    (type == 'microsoft.dbformysql/servers'), tostring(properties.replicationRole),\n    (type == 'microsoft.dbformysql/flexibleservers'), iif(properties.haEnabled == \"Enabled\", 'Not Applicable', tostring(properties.replicationRole)),\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains \"storageaccounts\"), tostring(split(skuName, '_', 1)[0]),\n    (type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), \"Not Applicable\",\n    (type == \"microsoft.network/loadbalancers\"), \"Not Applicable\",\n    (type == \"microsoft.recoveryservices/vaults\"), \"Not Applicable\",\n    \"Undefined\"\n    )\n| project \n    Type = tolower(type),\n    SkuName = tolower(skuName),\n    Kind = tolower(kind),\n    SubscriptionId = subscriptionId,\n    Name = tolower(name),\n    State = tolower(state),\n    Location = tolower(location),\n    ResourceGroup = resourceGroup,\n    Zones = tolower(tostring(zones)),\n    AvailabilityZone = tolower(avZones),\n    AvailabilitySet = tolower(avSets),\n    Capacity = tolower(Capacity),\n    FaultDomain = tolower(FaultDomain),\n    OSDisk = tolower(OSDisk),\n    ReadReplica = tolower(ReadReplica), \n    AutomaticFailover = tolower(AutomaticFailover),\n    MultipleWriteLocations = tolower(MultipleWriteLocations),\n    StorageAutogrow = tolower(StorageAutogrow),\n    ReplicationRole = tolower(ReplicationRole),\n    Criticality = criticality,\n    Environment = environment,\n    ResourceId = tolower(tostring(id)),\n    properties\n| join kind = leftouter (\n    securityresources\n    | where properties.displayName contains \"Azure Backup should\"\n    | extend Backup = tostring(properties.status.code)\n    | project ResourceId = tolower(tostring(properties.resourceDetails.Id)), Backup\n    )\n    on ResourceId\n| extend Backup = case(\n    Backup == \"Healthy\" or Backup == \"Unhealthy\", Backup,\n    \"Unknown\")\n| extend Backup = case(\n    (Type == 'microsoft.compute/virtualmachines') and (Backup == \"Healthy\" or Backup == \"Unhealthy\"), Backup, \n    (Type == \"microsoft.compute/virtualmachinescalesets\"), \"Not Applicable\", \n    (Type == \"microsoft.containerservice/managedclusters\"), \"Not Applicable\",\n    (Type == 'microsoft.sql/servers/databases'), \"Not Applicable\", \n    (Type == 'microsoft.documentdb/databaseaccounts'), iif(properties.backupPolicy.periodicModeProperties.backupStorageRedundancy == \"Geo\", \"Healthy\", \"Unhealthy\"),\n    (Type == 'microsoft.dbformysql/servers'), iif(properties.storageProfile.geoRedundantBackup == \"Enabled\", \"Healthy\", \"Unhealthy\"),\n    (Type contains \"storageaccounts\"), \"Not Applicable\",\n    (Type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (Type == \"microsoft.recoveryservices/vaults\"), \"Not Applicable\",\n    \"Unknown\"\n    )\n| extend AvailabilitySet = case(\n    AvailabilitySet == '-', 'None',\n    isnotempty(AvailabilitySet), AvailabilitySet,\n    \"Unknown\")\n| project ResourceId,Type, SkuName,  SubscriptionId, Name, State,publisher= tostring(properties.storageProfile.imageReference.publisher), version= tostring(properties.storageProfile.imageReference.version), imagesku= tostring(properties.storageProfile.imageReference.sku) ,offer= tostring(properties.storageProfile.imageReference.offer), Location, ResourceGroup, Zones, AvailabilityZone, AvailabilitySet, Capacity, FaultDomain, OSDisk, ReadReplica, AutomaticFailover, MultipleWriteLocations, StorageAutogrow, ReplicationRole, Backup = tolower(Backup), Criticality, Environment, bootDiagnostics =tostring(properties.diagnosticsProfile.bootDiagnostics.enabled),vmsize = tostring(properties.hardwareProfile.vmSize), \n os_type = tostring(properties.storageProfile.osDisk.osType)\n| where Type == 'microsoft.compute/virtualmachines'",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Name",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "SubscriptionId",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "vm running",
                                      "representation": "green",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "vm deallocated",
                                      "representation": "gray",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "publisher",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "1",
                                      "text": "{0}BYOL"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "imagesku",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "gen2",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "gensecond",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "is Empty",
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Zones",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "AvailabilityZone",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "not configured",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "1",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "2",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "3",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "not applicable",
                                      "representation": "more",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "configured",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "undefined",
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AvailabilitySet",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "undefined",
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "not applicable",
                                      "representation": "more",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "not configured",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Capacity",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "FaultDomain",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "OSDisk",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "premium",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "ultra",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "ephemeral",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "standard",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "unmanaged",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "ReadReplica",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "AutomaticFailover",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "MultipleWriteLocations",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "StorageAutogrow",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ReplicationRole",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Backup",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "healthy",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "unhealthy",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Criticality",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Mission Critical",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Environment",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "Prod",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "prod",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "bootDiagnostics",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "true",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "!=",
                                      "thresholdValue": "true",
                                      "representation": "info",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "-- Group By --",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "SubscriptionName",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "OSDisk_UltraorPremium",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "OSDisk_Type",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 10000,
                            "sortBy": [
                              {
                                "itemKey": "$gen_thresholds_publisher_6",
                                "sortOrder": 2
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "ResourceId",
                                "label": "VM Name"
                              },
                              {
                                "columnId": "publisher",
                                "label": "OS Image Publisher"
                              },
                              {
                                "columnId": "version",
                                "label": "Image version"
                              },
                              {
                                "columnId": "imagesku",
                                "label": "OS Image SKU"
                              },
                              {
                                "columnId": "bootDiagnostics",
                                "label": "Boot Diagnostic"
                              },
                              {
                                "columnId": "vmsize",
                                "label": "VM SKU"
                              },
                              {
                                "columnId": "os_type",
                                "label": "Operating System"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_publisher_6",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "name": "VM List"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "computeinventory"
                  },
                  "name": "Computeinventory"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "where type == \"microsoft.hybridcompute/machines\"\r\n| project MachineId=id, status = properties.status, \r\n\t\t\t  LastSeen = properties.lastStatusChange, \r\n\t\t\t  FQDN = properties.machineFqdn, \r\n\t\t\t  OS = properties.osName, \r\n\t\t\t  ServerVersion = properties.osVersion\r\n| extend ServerVersion = case(\r\n    ServerVersion has '10.0.20348', 'Server 2022',\r\n    ServerVersion has '10.0.17763', 'Server 2019',\r\n    ServerVersion has '10.0.16299', 'Server 2016',\r\n    ServerVersion has '10.0.14393', 'Server 2016',\r\n    ServerVersion has '6.3.9600', 'Server 2012 R2',\r\n\tServerVersion)\r\n |count",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "status",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "LastSeen",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "FQDN",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "OS",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "ServerVersion",
                                "formatter": 1
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "vmSize",
                              "formatter": 1,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto",
                                "showIcon": true
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "vmSize",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "Count",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "query - ARC Machines Inventory - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "where type == \"microsoft.hybridcompute/machines\"\r\n| project MachineId=id, status = properties.status, \r\n\t\t\t  LastSeen = properties.lastStatusChange, \r\n\t\t\t  FQDN = properties.machineFqdn, \r\n\t\t\t  OS = properties.osName, \r\n\t\t\t  ServerVersion = properties.osVersion\r\n| extend ServerVersion = case(\r\n    ServerVersion has '10.0.20348', 'Server 2022',\r\n    ServerVersion has '10.0.17763', 'Server 2019',\r\n    ServerVersion has '10.0.16299', 'Server 2016',\r\n    ServerVersion has '10.0.14393', 'Server 2016',\r\n    ServerVersion has '6.3.9600', 'Server 2012 R2',\r\n\tServerVersion)",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "status",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "LastSeen",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "FQDN",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "OS",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "ServerVersion",
                                "formatter": 1
                              }
                            ],
                            "filter": true
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "vmSize",
                              "formatter": 1,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto",
                                "showIcon": true
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "vmSize",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "Count",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "query - ARC Machines Inventory"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "azurearcvm"
                  },
                  "name": "Azure Arc VM"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type == 'microsoft.compute/disks'\r\n| summarize count() by type",
                                "size": 3,
                                "color": "green",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "type",
                                    "formatter": 16,
                                    "formatOptions": {
                                      "showIcon": true
                                    }
                                  },
                                  "leftContent": {
                                    "columnMatch": "count_",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": false
                                }
                              },
                              "name": "query - 4"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Resources\r\n| where type contains \"microsoft.compute/disks\"\r\n| summarize DiskSizeGB=sum(toint(properties.diskSizeGB))\r\n\r\n| extend Item = \"Total Storage Capacity (in GB)\",  Key = 1\r\n",
                                "size": 3,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Item",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "DiskSizeGB",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": false,
                                        "minimumIntegerDigits": 1,
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "showBorder": false,
                                  "size": "auto"
                                },
                                "graphSettings": {
                                  "type": 0
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "count_",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "count_",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "count_",
                                    "heatmapPalette": "greenRed"
                                  }
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "name": "Total Storage Capacitly"
                            }
                          ]
                        },
                        "customWidth": "25",
                        "name": "Overview"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "where type == \"microsoft.compute/disks\"\r\n| summarize DiskCount=count() by State=tostring(properties.diskState)\r\n| order by DiskCount desc\r\n| extend [\"Count (Disks)\"]=DiskCount\r\n| project State, [\"Count (Disks)\"]",
                          "size": 3,
                          "title": "Disk By State",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "PowerState",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "PowerState/running",
                                "color": "green"
                              },
                              {
                                "seriesName": "PowerState/deallocated",
                                "color": "redBright"
                              }
                            ]
                          },
                          "textSettings": {
                            "style": "bignumber"
                          }
                        },
                        "customWidth": "25",
                        "name": "VM Count - By State"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources\r\n| where type contains \"microsoft.compute/disks\"\r\n| summarize DiskSizeGB=sum(toint(properties.diskSizeGB)) by DiskSku=tostring(sku.name), location",
                          "size": 3,
                          "title": "Disk Size & SKU by Location",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "DiskSku",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "DiskSizeGB",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "secondaryContent": {
                              "columnMatch": "location"
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 4 - Copy",
                        "styleSettings": {
                          "margin": "2px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.compute/disks\"\r\n| project id, name = tostring(sku.name), tier = tostring(sku.tier)\r\n| summarize count() by name",
                          "size": 3,
                          "title": "Managed Disk overview",
                          "noDataMessage": "No Azure Managed Disk found in selected subscription.",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "DiskSku",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "DiskSizeGB",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "secondaryContent": {
                              "columnMatch": "location"
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "25",
                        "name": "Managed Disk Overview",
                        "styleSettings": {
                          "margin": "0",
                          "padding": "0",
                          "maxWidth": "33%"
                        }
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<hr>"
                        },
                        "name": "text - 4"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where type =~ 'microsoft.compute/virtualmachines'\r\n//| mv-expand datadisks = properties.storageProfile.dataDisks\r\n| project id, vmName = name, vmSize=tostring(properties.hardwareProfile.vmSize), osDisk = tostring(properties.storageProfile.osDisk.name), ppg = tostring(split(properties.proximityPlacementGroup.id,\"/\",8)[0]), caching= tostring(properties.storageProfile.osDisk.caching)\r\n, createOption=tostring(properties.storageProfile.osDisk.createOption), osType=tostring(properties.storageProfile.osDisk.osType), avSet= tostring(split(properties.availabilitySet.id,\"/\",8)[0])\r\n| join ( \r\nresources\r\n| where type == \"microsoft.compute/disks\"\r\n| project id1=id, diskname=name, osDisk=tostring(split(id,\"/\",8)[0]), vmName=tostring(split(managedBy,\"/\",8)[0]), sku.name, disk_tier = tostring(properties.tier), disk_size_GB = tostring(properties.diskSizeGB), \r\n diskbandwidthMBps = tostring(properties.diskMBpsReadWrite), disk_iops = tostring(properties.diskIOPSReadWrite),  managedBy, location, resourceGroup\r\n)\r\non vmName, osDisk\r\n| project id, vmName, vmSize, osType, id1, diskname, caching,disk_tier, disk_size_GB,diskbandwidthMBps, disk_iops, createOption, location, resourceGroup , ppg , avSet",
                          "size": 2,
                          "title": "Volume Inventory",
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "id",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": true,
                                  "showIcon": true,
                                  "customColumnWidthSetting": "18ch"
                                },
                                "tooltipFormat": {
                                  "tooltip": "Virtual Name must be =< 13 Characters"
                                }
                              },
                              {
                                "columnMatch": "vmName",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "vmSize",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "18ch"
                                }
                              },
                              {
                                "columnMatch": "id1",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Metrics",
                                  "linkIsContextBlade": true,
                                  "showIcon": true,
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "diskname",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "disk_tier",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "12ch"
                                }
                              },
                              {
                                "columnMatch": "disk_size_GB",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "diskbandwidthMBps",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "location",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "resourceGroup",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "25ch"
                                }
                              },
                              {
                                "columnMatch": "ppg",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "avSet",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "os_type",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "12ch"
                                }
                              },
                              {
                                "columnMatch": "datadisk_lun",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "14ch"
                                }
                              },
                              {
                                "columnMatch": "datadisk_wa",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "id2",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "sku_name",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10ch"
                                }
                              },
                              {
                                "columnMatch": "powerstate",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "vmsize",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "vmgen",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "V2",
                                      "representation": "success",
                                      "text": "V2"
                                    },
                                    {
                                      "operator": "!=",
                                      "thresholdValue": "V2",
                                      "representation": "1",
                                      "text": "Consider a review."
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "avZone",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "tags",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "id",
                                "label": "VM Name"
                              },
                              {
                                "columnId": "vmName",
                                "label": "VM Name"
                              },
                              {
                                "columnId": "vmSize",
                                "label": "Size"
                              },
                              {
                                "columnId": "osType",
                                "label": "OS Type"
                              },
                              {
                                "columnId": "id1",
                                "label": "Disk Name"
                              },
                              {
                                "columnId": "diskname",
                                "label": "Disk Name"
                              },
                              {
                                "columnId": "caching",
                                "label": "Caching"
                              },
                              {
                                "columnId": "disk_tier",
                                "label": "Tier"
                              },
                              {
                                "columnId": "disk_size_GB",
                                "label": "Disk Size"
                              },
                              {
                                "columnId": "diskbandwidthMBps",
                                "label": "Disk Bandwith (Mbps)"
                              },
                              {
                                "columnId": "disk_iops",
                                "label": "IOPS"
                              },
                              {
                                "columnId": "createOption",
                                "label": "Create Option"
                              },
                              {
                                "columnId": "location",
                                "label": "Azure Region"
                              },
                              {
                                "columnId": "resourceGroup",
                                "label": "Resource Group"
                              },
                              {
                                "columnId": "ppg",
                                "label": "PPG"
                              },
                              {
                                "columnId": "avSet",
                                "label": "Availability Set"
                              }
                            ]
                          }
                        },
                        "showPin": false,
                        "name": "query - Compute+OS Disk"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "volumes"
                  },
                  "name": "Volume"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tabname",
              "comparison": "isEqualTo",
              "value": "compute"
            },
            "name": "Compute"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "d5749b77-230f-45e3-89f5-be4c85ecfa36",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Overview",
                        "subTarget": "networkoverview",
                        "preText": "",
                        "style": "link"
                      },
                      {
                        "id": "d2568e3f-dddc-47d7-8bb1-afcbc94c0f97",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Express Route",
                        "subTarget": "expressroute",
                        "style": "link"
                      },
                      {
                        "id": "7ef3a846-67a4-4458-b430-b19d4d03e181",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Private DNS",
                        "subTarget": "privatedns",
                        "style": "link"
                      },
                      {
                        "id": "e12edfd2-6dd6-44f4-a631-2e4f9d20a0c6",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Private End Points",
                        "subTarget": "privateendpoint",
                        "style": "link"
                      },
                      {
                        "id": "a7661fff-0686-4a3b-872e-8b7f86e5664f",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Public IP",
                        "subTarget": "publicip",
                        "style": "link"
                      },
                      {
                        "id": "b0e4a24d-3f44-42c4-908a-486dd0bbafff",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "NSG",
                        "subTarget": "nsg",
                        "style": "link"
                      },
                      {
                        "id": "4c18ae23-f0a7-495a-a359-ff46cd12a13f",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Firewall",
                        "subTarget": "firewall",
                        "style": "link"
                      },
                      {
                        "id": "2b18c611-40c1-4056-b0c1-5a41e4588756",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Vnet Gateway",
                        "subTarget": "vnetgateway",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 0"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "adfb0a0a-b593-4dbd-8591-985d06b2c669",
                        "version": "KqlParameterItem/1.0",
                        "name": "StorageAccounts",
                        "type": 5,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "where type =~ 'microsoft.storage/storageaccounts'\r\n| order by name asc\r\n| extend Rank = row_number()\r\n| project value = id, label = id, selected = Rank <= 5",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "acfb0b0b-5af5-4c24-94a9-352aa1360151",
                        "version": "KqlParameterItem/1.0",
                        "name": "LogAnalyticsWorkspace",
                        "type": 5,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "resources\r\n| where type == \"microsoft.operationalinsights/workspaces\"\r\n| project id, name",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "value": null
                      },
                      {
                        "id": "e2cecc14-1c84-4871-8b40-0fe735a19175",
                        "version": "KqlParameterItem/1.0",
                        "name": "VPNGateways",
                        "type": 5,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "Resources \r\n| where type =~ \"microsoft.network/virtualnetworkgateways\" and properties.gatewayType == \"Vpn\"\r\n| project id",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "value": null
                      },
                      {
                        "id": "8284245f-5752-4258-ab07-aa48747a43da",
                        "version": "KqlParameterItem/1.0",
                        "name": "Firewalls",
                        "type": 5,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "resources\r\n| where type == \"microsoft.network/azurefirewalls\"\r\n| project id",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "conditionalVisibility": {
                    "parameterName": "SelectedTab",
                    "comparison": "isNotEqualTo",
                    "value": "CostInformation"
                  },
                  "name": "parameters - 0"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "where type has \"microsoft.network\"\r\n    or type has 'microsoft.cdn'\r\n| extend type = case(\r\n\ttype == 'microsoft.network/networkinterfaces', \"NICs\",\r\n\ttype == 'microsoft.network/networksecuritygroups', \"NSGs\", \r\n\ttype == \"microsoft.network/publicipaddresses\", \"Public IPs\", \r\n\ttype == 'microsoft.network/virtualnetworks', \"vNets\",\r\n\ttype == 'microsoft.network/networkwatchers/connectionmonitors', \"Connection Monitors\",\r\n\ttype == 'microsoft.network/privatednszones', \"Private DNS\",\r\n\ttype == 'microsoft.network/virtualnetworkgateways', @\"vNet Gateways\",\r\n\ttype == 'microsoft.network/connections', \"Connections\",\r\n\ttype == 'microsoft.network/networkwatchers', \"Network Watchers\",\r\n\ttype == 'microsoft.network/privateendpoints', \"Private Endpoints\",\r\n\ttype == 'microsoft.network/localnetworkgateways', \"Local Network Gateways\",\r\n\ttype == 'microsoft.network/privatednszones/virtualnetworklinks', \"vNet Links\",\r\n\ttype == 'microsoft.network/dnszones', 'DNS Zones',\r\n\ttype == 'microsoft.network/networkwatchers/flowlogs', 'Flow Logs',\r\n\ttype == 'microsoft.network/routetables', 'Route Tables',\r\n\ttype == 'microsoft.network/loadbalancers', 'Load Balancers',\r\n\ttype == 'microsoft.network/ddosprotectionplans', 'DDoS Protection Plans',\r\n\ttype == 'microsoft.network/applicationsecuritygroups', 'App Security Groups',\r\n\ttype == 'microsoft.network/azurefirewalls', 'Azure Firewalls',\r\n\ttype == 'microsoft.network/applicationgateways', 'App Gateways',\r\n\ttype == 'microsoft.network/frontdoors', 'Front Doors',\r\n\ttype == 'microsoft.network/applicationgatewaywebapplicationfirewallpolicies', 'AppGateway Policies',\r\n\ttype == 'microsoft.network/bastionhosts', 'Bastion Hosts',\r\n\ttype == 'microsoft.network/frontdoorwebapplicationfirewallpolicies', 'FrontDoor Policies',\r\n\ttype == 'microsoft.network/firewallpolicies', 'Firewall Policies',\r\n\ttype == 'microsoft.network/networkintentpolicies', 'Network Intent Policies',\r\n\ttype == 'microsoft.network/trafficmanagerprofiles', 'Traffic Manager Profiles',\r\n\ttype == 'microsoft.network/publicipprefixes', 'PublicIP Prefixes',\r\n\ttype == 'microsoft.network/privatelinkservices', 'Private Link',\r\n\ttype == 'microsoft.network/expressroutecircuits', 'Express Route Circuits',\r\n\ttype =~ 'microsoft.cdn/cdnwebapplicationfirewallpolicies', 'CDN Web App Firewall Policies',\r\n\ttype =~ 'microsoft.cdn/profiles', 'CDN Profiles',\r\n\ttype =~ 'microsoft.cdn/profiles/afdendpoints', 'CDN Front Door Endpoints',\r\n\ttype =~ 'microsoft.cdn/profiles/endpoints', 'CDN Endpoints',\r\n\tstrcat(\"Not Translated: \", type))\r\n| summarize count() by type",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "type",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "name": "query - 7"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "networkoverview"
                  },
                  "name": "Overview"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "c72755d6-9fac-458b-979a-f2ce197f6ddf",
                              "version": "KqlParameterItem/1.0",
                              "name": "Resources",
                              "label": "ExpressRoute Ckt",
                              "type": 5,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "resources\r\n| where type == \"microsoft.network/expressroutecircuits\"\r\n| order by name asc\r\n| extend Rank = row_number()\r\n| project value = id, label = id, selected = Rank <= 5",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1",
                                  "value::3",
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::3",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "a1f082dc-094f-48bb-8ae7-6467f2bfd916",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "type": 4,
                              "isRequired": true,
                              "value": {
                                "durationMs": 7776000000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ],
                                "allowCustom": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "id": "4798ec15-23a7-446e-ba82-fb56e49fd5ee",
                              "version": "KqlParameterItem/1.0",
                              "name": "Message",
                              "type": 1,
                              "query": "where type == \"microsoft.network/expressroutecircuits\"\r\n| summarize Selected = countif(id in ({Resources:value})), Total = count()\r\n| extend Selected = iff(Selected > 200, 200, Selected)\r\n| project Message = strcat('# ', Selected, ' / ', Total)",
                              "crossComponentResources": [
                                "{Subscriptions}"
                              ],
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "4e35d916-4d5a-4dbf-b7b2-39cd379fa727",
                              "version": "KqlParameterItem/1.0",
                              "name": "ResourceName",
                              "type": 1,
                              "isRequired": true,
                              "isHiddenWhenLocked": true,
                              "criteriaData": [
                                {
                                  "criteriaContext": {
                                    "operator": "Default",
                                    "resultValType": "static",
                                    "resultVal": "ExpressRoute Ckt"
                                  }
                                }
                              ],
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "Express Route"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// BGP route table \r\n// BPG route table learned over last 12 hours. \r\nAzureDiagnostics\r\n| where ResourceType == \"EXPRESSROUTECIRCUITS\"\r\n| project TimeGenerated , ResourceType , network_s , path_s , OperationName\r\n| summarize c = count()\r\n| extend Item = \"Route Learned\",  Key = 1",
                          "size": 3,
                          "queryType": 0,
                          "resourceType": "microsoft.network/expressroutecircuits",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item"
                            },
                            "leftContent": {
                              "columnMatch": "c",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "customWidth": "20",
                        "name": "query - 6"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"AzureHealthQuery/1.0\",\"queryType\":\"Detailed\"}",
                          "size": 3,
                          "title": "Express Route Circuits",
                          "showExportToExcel": true,
                          "queryType": 4,
                          "resourceType": "microsoft.network/expressroutecircuits",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Detailed status",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Reason chronicity",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Reason type",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Title",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Resource group",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              }
                            ],
                            "filter": true
                          }
                        },
                        "customWidth": "80",
                        "name": "ExpressRoute Circuit Status"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook491f1ae0-8005-4638-848a-dc181b2f797d",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.network/expressroutecircuits",
                          "metricScope": 0,
                          "resourceParameter": "Resources",
                          "resourceIds": [
                            "{Resources}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 7776000000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.network/expressroutecircuits",
                              "metric": "microsoft.network/expressroutecircuits-Circuit Availability-BgpAvailability",
                              "aggregation": 4,
                              "splitBy": null
                            },
                            {
                              "namespace": "microsoft.network/expressroutecircuits",
                              "metric": "microsoft.network/expressroutecircuits-Circuit Availability-ArpAvailability",
                              "aggregation": 4
                            }
                          ],
                          "title": "Availability ExpressRoute Ckt",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "50",
                        "name": "metric - 3"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook581d65e4-97e7-416b-824b-3a154d21a848",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.network/expressroutecircuits",
                          "metricScope": 0,
                          "resourceParameter": "Resources",
                          "resourceIds": [
                            "{Resources}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 7776000000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.network/expressroutecircuits",
                              "metric": "microsoft.network/expressroutecircuits-Circuit Traffic-BitsInPerSecond",
                              "aggregation": 4,
                              "splitBy": null
                            },
                            {
                              "namespace": "microsoft.network/expressroutecircuits",
                              "metric": "microsoft.network/expressroutecircuits-Circuit Traffic-BitsOutPerSecond",
                              "aggregation": 4
                            }
                          ],
                          "title": "Avg speed through ExpressRoute Ckt",
                          "resourceLimit": 10000,
                          "timeBrushParameterName": "Time",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "50",
                        "name": "metric - Speed"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookf18a2fba-74bf-435b-a99c-eba0722d7fc0",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.network/expressroutecircuits",
                          "metricScope": 0,
                          "resourceParameter": "Resources",
                          "resourceIds": [
                            "{Resources}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 7776000000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.network/expressroutecircuits",
                              "metric": "microsoft.network/expressroutecircuits-Circuit Traffic-BitsInPerSecond",
                              "aggregation": 4,
                              "splitBy": null
                            },
                            {
                              "namespace": "microsoft.network/expressroutecircuits",
                              "metric": "microsoft.network/expressroutecircuits-Circuit Qos-QosDropBitsOutPerSecond",
                              "aggregation": 4
                            }
                          ],
                          "title": "Avg Traffic dropped ",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "50",
                        "name": "metric - Avg Dropped Traffic"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook8800b475-0a9a-4985-8ce3-41a474abd690",
                          "version": "MetricsItem/2.0",
                          "size": 0,
                          "chartType": 2,
                          "resourceType": "microsoft.network/expressroutecircuits",
                          "metricScope": 0,
                          "resourceParameter": "Resources",
                          "resourceIds": [
                            "{Resources}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 7776000000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.network/expressroutecircuits",
                              "metric": "microsoft.network/expressroutecircuits-GlobalReach Traffic-GlobalReachBitsInPerSecond",
                              "aggregation": 4,
                              "splitBy": null
                            },
                            {
                              "namespace": "microsoft.network/expressroutecircuits",
                              "metric": "microsoft.network/expressroutecircuits-GlobalReach Traffic-GlobalReachBitsOutPerSecond",
                              "aggregation": 4
                            }
                          ],
                          "title": "Avg GlobalReach In/Out",
                          "resourceLimit": 10000,
                          "gridSettings": {
                            "rowLimit": 10000
                          },
                          "exportToExcelOptions": "all"
                        },
                        "customWidth": "50",
                        "name": "metric - GlobalReach In/Out"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "expressroute"
                  },
                  "name": "Express Route"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Run query to see results.\r\nresources\r\n| where type =~ \"microsoft.network/privateEndpoints\" and isnotnull(properties)\r\n| extend connection = iff(array_length(properties.manualPrivateLinkServiceConnections) > 0, properties.manualPrivateLinkServiceConnections[0], properties.privateLinkServiceConnections[0])\r\n| extend subnetId = properties.subnet.id\r\n| extend subnetIdSplit = split(subnetId, \"/\")\r\n| extend vnetId = strcat_array(array_slice(subnetIdSplit,0,8), \"/\")\r\n| extend vnetParameters = parse_json(strcat('{\"id\":\"',vnetId,'\",','\"menuid\":\"subnets\"','}'))\r\n| extend subnetName = strcat(subnetIdSplit[8], \"/\", subnetIdSplit[10])\r\n| extend serviceId = tostring(connection.properties.privateLinkServiceId)\r\n| extend serviceIdSplit = split(serviceId, \"/\")\r\n| extend serviceName = tostring(serviceIdSplit[8])\r\n| extend serviceTypeEnum = iff(isnotnull(serviceIdSplit[6]), tolower(strcat(serviceIdSplit[6], \"/\", serviceIdSplit[7])), \"microsoft.network/privatelinkservices\")\r\n| extend stateEnum = tostring(connection.properties.privateLinkServiceConnectionState.status)\r\n| extend statusIcon = case(\r\n    stateEnum == \"Approved\", 8,\r\n    stateEnum == \"Rejected\", 252,\r\n    stateEnum == \"Pending\", 88,\r\n    stateEnum == \"Disconnected\", 131,\r\n    7\r\n)\r\n| extend groupId = tostring(connection.properties.groupIds[0])\r\n| extend id = tolower(tostring(id))\r\n| join kind=leftouter hint.strategy=shuffle ( data\r\n        | where type =~ \"microsoft.network/networkInterfaces\" and isnotnull(properties) and isnotnull(properties.ipConfigurations) and isnotnull(properties.ipConfigurations[0].properties.privateLinkConnectionProperties)\r\n        | extend networkInterfaceId = id\r\n        | extend id = tolower(tostring(properties.privateEndpoint.id))\r\n        | extend ipAddress = properties.ipConfigurations[0].properties.privateIPAddress\r\n        | extend ipBladeParameters = parse_json(strcat('{\"id\":\"',networkInterfaceId,'\"}'))\r\n        | project id, ipBladeParameters, ipAddress)\r\n    on id\r\n| project id, name, type, location, subscriptionId, resourceGroup, kind, tags, serviceId, serviceName, serviceTypeEnum, groupId, subnetId, subnetName, stateEnum, privateIP = coalesce(ipAddress, \" \"), sortedIPs = parse_ipv6(tostring(ipAddress)), statusIcon, ipBladeParameters, vnetParameters\r\n| where (type !~ ('dynatrace.observability/monitors'))\r\n| where (type !~ ('nginx.nginxplus/nginxdeployments'))\r\n| where (type !~ ('microsoft.agfoodplatform/farmbeats'))\r\n| where (type !~ ('microsoft.cdn/profiles/afdendpoints'))\r\n| where (type !~ ('microsoft.cdn/profiles/customdomains'))\r\n| where (type !~ ('microsoft.cdn/profiles/origingroups'))\r\n| where (type !~ ('microsoft.cdn/profiles/rulesets'))\r\n| where (type !~ ('microsoft.cdn/profiles/secrets'))\r\n| where (type !~ ('microsoft.cdn/profiles/securitypolicies'))\r\n| where (type !~ ('microsoft.cdn/profiles/afdendpoints/routes'))\r\n| where (type !~ ('microsoft.cdn/profiles/origingroups/origins'))\r\n| where (type !~ ('microsoft.cdn/profiles/rulesets/rules'))\r\n| where (type !~ ('microsoft.kubernetes/connectedclusters/microsoft.kubernetesconfiguration/fluxconfigurations'))\r\n| where (type !~ ('microsoft.containerservice/managedclusters/microsoft.kubernetesconfiguration/fluxconfigurations'))\r\n| where (type !~ ('microsoft.portal/extensions/deployments'))\r\n| where (type !~ ('microsoft.portal/extensions'))\r\n| where (type !~ ('microsoft.portal/extensions/slots'))\r\n| where (type !~ ('microsoft.portal/extensions/versions'))\r\n| where (type !~ ('microsoft.datacollaboration/workspaces'))\r\n| where (type !~ ('microsoft.network/dnsforwardingrulesets'))\r\n| where (type !~ ('microsoft.network/dnsresolvers'))\r\n| where (type !~ ('microsoft.azurestack/registrations'))\r\n| where (type !~ ('microsoft.communication/emailservices/domains'))\r\n| where (type !~ ('microsoft.communication/emailservices'))\r\n| where (type !~ ('microsoft.hdinsight/clusterpools/clusters'))\r\n| where (type !~ ('microsoft.hdinsight/clusterpools/clusters/sessionclusters'))\r\n| where (type !~ ('microsoft.hdinsight/clusterpools'))\r\n| where (type !~ ('microsoft.hpcworkbench/instances'))\r\n| where (type !~ ('microsoft.scvmm/vmmservers'))\r\n| where (type !~ ('microsoft.connectedvmwarevsphere/vcenters'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins/assets'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins/tests'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins/executionplans'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins/testplans'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins'))\r\n| where not((type =~ ('microsoft.network/serviceendpointpolicies')) and ((kind =~ ('internal'))))\r\n| where (type !~ ('microsoft.openlogisticsplatform/workspaces'))\r\n| where (type !~ ('microsoft.scom/managedinstances'))\r\n| where (type !~ ('microsoft.orbital/spacecrafts/contacts'))\r\n| where (type !~ ('microsoft.orbital/contactprofiles'))\r\n| where (type !~ ('microsoft.orbital/edgesites'))\r\n| where (type !~ ('microsoft.orbital/groundstations'))\r\n| where (type !~ ('microsoft.orbital/l2connections'))\r\n| where (type !~ ('microsoft.orbital/spacecrafts'))\r\n| where (type !~ ('microsoft.azurepercept/accounts'))\r\n| where (type !~ ('microsoft.workloads/phpworkloads'))\r\n| where (type !~ ('microsoft.playfab/playeraccountpools'))\r\n| where (type !~ ('microsoft.playfab/playfabresources'))\r\n| where (type !~ ('microsoft.playfab/titles'))\r\n| where (type !~ ('microsoft.recommendationsservice/accounts/modeling'))\r\n| where (type !~ ('microsoft.recommendationsservice/accounts/serviceendpoints'))\r\n| where (type !~ ('microsoft.recoveryservicesbvtd2/vaults'))\r\n| where (type !~ ('microsoft.recoveryservicesbvtd/vaults'))\r\n| where (type !~ ('microsoft.recoveryservicesintd/vaults'))\r\n| where (type !~ ('microsoft.recoveryservicesintd2/vaults'))\r\n| where (type !~ ('microsoft.billingbenefits/savingsplanorders/savingsplans'))\r\n| where (type !~ ('microsoft.billingbenefits/savingsplanorders'))\r\n| where (type !~ ('microsoft.workloads/sapvirtualinstances/applicationinstances'))\r\n| where (type !~ ('microsoft.workloads/sapvirtualinstances/centralinstances'))\r\n| where (type !~ ('microsoft.workloads/sapvirtualinstances/databaseinstances'))\r\n| where (type !~ ('microsoft.workloads/sapvirtualinstances'))\r\n| where (type !~ ('microsoft.datareplication/replicationvaults'))\r\n| where (type !~ ('microsoft.storagecache/amlfilesystems'))\r\n| where not((type =~ ('microsoft.synapse/workspaces/sqlpools')) and ((kind =~ ('v3'))))\r\n| where (type !~ ('microsoft.testbase/testbaseaccounts/packages'))\r\n| where (type !~ ('microsoft.mobilenetwork/mobilenetworks/datanetworks'))\r\n| where (type !~ ('microsoft.mobilenetwork/mobilenetworks'))\r\n| where (type !~ ('microsoft.mobilenetwork/mobilenetworks/sites'))\r\n| where (type !~ ('microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes/attacheddatanetworks'))\r\n| where (type !~ ('microsoft.mobilenetwork/packetcorecontrolplanes'))\r\n| where (type !~ ('microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes'))\r\n| where (type !~ ('microsoft.mobilenetwork/mobilenetworks/services'))\r\n| where (type !~ ('microsoft.mobilenetwork/sims'))\r\n| where (type !~ ('microsoft.mobilenetwork/mobilenetworks/simpolicies'))\r\n| where (type !~ ('microsoft.mobilenetwork/mobilenetworks/slices'))\r\n| where (type !~ ('microsoft.workloads/monitors'))\r\n| where not((type =~ ('microsoft.sql/servers/databases')) and ((kind in~ ('system','v2.0,system','v12.0,system','v12.0,user,datawarehouse,gen2,analytics'))))\r\n| where not((type =~ ('microsoft.sql/servers')) and ((kind =~ ('v12.0,analytics'))))\r\n| project id, name,privateIP,serviceId,groupId,subnetName,statusIcon,location,subscriptionId,resourceGroup\r\n| sort by (tolower(tostring(name))) asc",
                          "size": 3,
                          "noDataMessage": "No Private Endpoints exist!",
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "id",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": true,
                                  "showIcon": true,
                                  "customColumnWidthSetting": "25ch"
                                }
                              },
                              {
                                "columnMatch": "name",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "privateIP",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "serviceId",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": true,
                                  "showIcon": true,
                                  "customColumnWidthSetting": "25ch"
                                }
                              },
                              {
                                "columnMatch": "statusIcon",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "8",
                                      "representation": "Available",
                                      "text": "Approved"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "252",
                                      "representation": "3",
                                      "text": "Rejected"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "88",
                                      "representation": "2",
                                      "text": "Pending"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "131",
                                      "representation": "disabled",
                                      "text": "Disconnected"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "1",
                                      "text": "Unknown"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 5
                              }
                            ],
                            "filter": true,
                            "sortBy": [
                              {
                                "itemKey": "$gen_thresholds_statusIcon_6",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "id",
                                "label": "Name"
                              },
                              {
                                "columnId": "privateIP",
                                "label": "IP address"
                              },
                              {
                                "columnId": "serviceId",
                                "label": "Resource"
                              },
                              {
                                "columnId": "groupId",
                                "label": "Sub-Resource"
                              },
                              {
                                "columnId": "subnetName",
                                "label": "Subnt"
                              },
                              {
                                "columnId": "statusIcon",
                                "label": "Connection State"
                              },
                              {
                                "columnId": "resourceGroup",
                                "label": "Resource Group"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_statusIcon_6",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "name": "query - PrivateEndpoint"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "privateendpoint"
                  },
                  "name": "Private Endpoint"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.network/privatednszones\"\r\n| project id, provisioningState=properties.provisioningState, maxNumberOfRecordSets=properties.maxNumberOfRecordSets, RecordSets=properties.numberOfRecordSets, MaxVNetLinksWithRegistration=properties.maxNumberOfVirtualNetworkLinksWithRegistration, VNetLinksWithRegistration=properties.numberOfVirtualNetworkLinksWithRegistration, MaxVNetLinks=properties.maxNumberOfVirtualNetworkLinks, VNetLinks=properties.numberOfVirtualNetworkLinks, location, resourceGroup",
                          "size": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "id",
                                "label": "Name"
                              },
                              {
                                "columnId": "provisioningState",
                                "label": "State"
                              },
                              {
                                "columnId": "maxNumberOfRecordSets",
                                "label": "Max Number of Record Sets"
                              },
                              {
                                "columnId": "RecordSets",
                                "label": "Record Set"
                              },
                              {
                                "columnId": "MaxVNetLinksWithRegistration",
                                "label": "Max Vnet Links With Registration"
                              },
                              {
                                "columnId": "VNetLinksWithRegistration",
                                "label": "Vnet Link With Registration"
                              },
                              {
                                "columnId": "MaxVNetLinks",
                                "label": "Max VNet Links"
                              },
                              {
                                "columnId": "VNetLinks",
                                "label": "VNet Links"
                              },
                              {
                                "columnId": "location",
                                "label": "Location"
                              },
                              {
                                "columnId": "resourceGroup",
                                "label": "Resource Group"
                              }
                            ]
                          }
                        },
                        "name": "query - 0"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "privatedns"
                  },
                  "name": "Private DNS"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "PUBLIC IP SUMMARY",
                          "style": "info"
                        },
                        "name": "text - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources\r\n| where type contains 'publicIPAddresses' and isnotempty(properties.ipAddress)\r\n| summarize count () by subscriptionId",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "subscriptionId",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "40",
                        "name": "query - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources\r\n| where type contains 'publicIPAddresses' and isnotempty(properties.ipAddress)\r\n| project name, properties.ipAddress \r\n| limit 100",
                          "size": 3,
                          "color": "green",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "name",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "properties_ipAddress",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  }
                                ],
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": []
                                }
                              }
                            },
                            "showBorder": true,
                            "sortCriteriaField": "name"
                          }
                        },
                        "customWidth": "60",
                        "name": "query - 2"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "publicip"
                  },
                  "name": "Public IP "
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "2a6c17b5-ef20-4ca7-a6f4-00901eb54ed1",
                              "version": "KqlParameterItem/1.0",
                              "name": "nsgWithTrafficAnalytics",
                              "label": "NSG With Flow Logs and Traffic Analytics",
                              "type": 1,
                              "query": "Resources\n| where type =~ 'Microsoft.Network/networkWatchers/flowlogs'\n| extend provisioningState = parse_json(properties).provisioningState \n| extend workspaceResourceId = tostring(parse_json(parse_json(parse_json(properties).flowAnalyticsConfiguration).networkWatcherFlowAnalyticsConfiguration).workspaceResourceId)\n| extend targetResourceId = iff(notempty(workspaceResourceId) and provisioningState == \"Succeeded\", tostring(parse_json(properties).targetResourceId), \"null\" ) \n| distinct targetResourceId\n",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "c8a786fc-40ff-4594-83b5-6952c6928523",
                              "version": "KqlParameterItem/1.0",
                              "name": "nsgWithFlowLogs",
                              "label": "NSG With Flow Logs",
                              "type": 1,
                              "query": "Resources\n| where type =~ 'Microsoft.Network/networkWatchers/flowlogs'\n| extend provisioningState = parse_json(properties).provisioningState \n| extend targetResourceId = iff(provisioningState == \"Succeeded\", tostring(parse_json(properties).targetResourceId), \"null\" ) \n| distinct targetResourceId\n",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            }
                          ],
                          "style": "above",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "query - Networking Details - NSG with Flow Logs and Traffic Analytics"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources\r\n| where type =~ 'microsoft.network/networksecuritygroups'\r\n| extend flowLogs = \"{nsgWithFlowLogs}\" has id\r\n| extend trafficAnalytics = \"{nsgWithTrafficAnalytics}\" has id\r\n| project subscriptionId, ['Resource group'] = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup), ['Network Security Group'] = id, [\"Location\"]=location, [\"Flow Logs\"]=flowLogs, [\"Traffic Analytics\"]=trafficAnalytics\r\n\r\n",
                          "size": 2,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 5,
                                "formatOptions": {
                                  "linkTarget": "Resource"
                                }
                              },
                              {
                                "columnMatch": "Resource group",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Network Security Group",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Flow Logs",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "1",
                                      "representation": "success",
                                      "text": "Enabled"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "0",
                                      "representation": "disabled",
                                      "text": "Disabled"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Traffic Analytics",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "1",
                                      "representation": "success",
                                      "text": "Enabled"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "0",
                                      "representation": "disabled",
                                      "text": "Disabled"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "unknown"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5,
                                "formatOptions": {
                                  "linkTarget": "Resource"
                                }
                              },
                              {
                                "columnMatch": "Flow logs",
                                "formatter": 11,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                  }
                                }
                              },
                              {
                                "columnMatch": "Resource",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                }
                              }
                            ],
                            "rowLimit": 1000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "subscriptionId"
                              ],
                              "expandTopLevel": true,
                              "finalBy": "Network Security Group"
                            },
                            "sortBy": [
                              {
                                "itemKey": "$gen_thresholds_Traffic Analytics_6",
                                "sortOrder": 1
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_Traffic Analytics_6",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "name": "NSG"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "nsg"
                  },
                  "name": "NSG"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "275e7403-ff7a-45cb-97c5-8d6ed2846758",
                              "version": "KqlParameterItem/1.0",
                              "name": "Workspace",
                              "label": "Choose a workspace",
                              "type": 5,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "Resources\r\n| where type =~ \"Microsoft.operationalinsights/workspaces\"\r\n| summarize by id",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": [
                                "value::all"
                              ]
                            },
                            {
                              "id": "495e8df7-5c59-4660-818b-f3d23209e3ac",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "isRequired": true,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "value": {
                                "durationMs": 172800000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "conditionalVisibilities": [
                          {
                            "parameterName": "submenu",
                            "comparison": "isNotEqualTo",
                            "value": "categoryview"
                          },
                          {
                            "parameterName": "submenu",
                            "comparison": "isNotEqualTo",
                            "value": "vmview"
                          }
                        ],
                        "name": "parameters - 1 - Copy - Copy"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookc9b8f2a1-5ab7-4815-8ea2-474bcfca994b",
                          "version": "MetricsItem/2.0",
                          "size": 1,
                          "chartType": 0,
                          "resourceType": "microsoft.network/azurefirewalls",
                          "metricScope": 0,
                          "resourceParameter": "Firewalls",
                          "resourceIds": [
                            "{Firewalls}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.network/azurefirewalls",
                              "metric": "microsoft.network/azurefirewalls--DataProcessed",
                              "aggregation": 1
                            },
                            {
                              "namespace": "microsoft.network/azurefirewalls",
                              "metric": "microsoft.network/azurefirewalls--Throughput",
                              "aggregation": 4
                            }
                          ],
                          "title": "Azure Firewalls",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/azurefirewalls--DataProcessed",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "more",
                                      "text": "Not In Use"
                                    },
                                    {
                                      "operator": "<",
                                      "thresholdValue": "5000000",
                                      "representation": "warning",
                                      "text": "Low"
                                    },
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "5000000",
                                      "representation": "success",
                                      "text": "Active"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": null,
                                      "text": ""
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  },
                                  "emptyValCustomText": "0"
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/azurefirewalls--DataProcessed Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.network/azurefirewalls--Throughput",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "more",
                                      "text": "Not In Use"
                                    },
                                    {
                                      "operator": "<",
                                      "thresholdValue": "5000000",
                                      "representation": "warning",
                                      "text": "Low"
                                    },
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "5000000",
                                      "representation": "success",
                                      "text": "Active"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": null,
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  },
                                  "emptyValCustomText": "0"
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/azurefirewalls--Throughput Timeline",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 10000,
                            "labelSettings": [
                              {
                                "columnId": "Subscription",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "Name",
                                "label": "Storage Name"
                              },
                              {
                                "columnId": "microsoft.network/azurefirewalls--DataProcessed",
                                "label": "Data processed (Sum)"
                              },
                              {
                                "columnId": "microsoft.network/azurefirewalls--DataProcessed Timeline",
                                "label": "Data processed Timeline"
                              },
                              {
                                "columnId": "microsoft.network/azurefirewalls--Throughput",
                                "label": "Throughput (Average)"
                              },
                              {
                                "columnId": "microsoft.network/azurefirewalls--Throughput Timeline",
                                "label": "Throughput Timeline"
                              }
                            ]
                          }
                        },
                        "customWidth": "80",
                        "name": "metric - 7"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics\r\n| where Category == \"AzureFirewallApplicationRule\"\r\n| summarize amount = count() by Resource, ResourceGroup",
                          "size": 3,
                          "title": "Firewall per resource group",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table"
                        },
                        "name": "Firewall per resource group"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics \r\n| where Category == \"AzureFirewallApplicationRule\" \r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePortInt:int \" \" TempDetails \r\n| parse TempDetails with \"was \" Action1 \". Reason: \" Rule1 \r\n| parse TempDetails with \"to \" FQDN \":\" TargetPortInt:int \". Action: \" Action2 \".\" * \r\n| parse TempDetails with * \". Rule Collection: \" RuleCollection2a \". Rule:\" Rule2a \r\n| parse TempDetails with * \"Deny.\" RuleCollection2b \". Proceeding with\" Rule2b \r\n| extend SourcePort = tostring(SourcePortInt) \r\n| extend TargetPort = tostring(TargetPortInt) \r\n| extend Action1 = case(Action1 == \"denied\",\"Deny\",\"Unknown Action\") \r\n| extend Action = case(Action2 == \"\",Action1,Action2),Rule = case(Rule2a == \"\", case(Rule1 == \"\",case(Rule2b == \"\",\"N/A\", Rule2b),Rule1),Rule2a),  RuleCollection = case(RuleCollection2b == \"\",case(RuleCollection2a == \"\",\"No rule matched\",RuleCollection2a), RuleCollection2b),FQDN = case(FQDN == \"\", \"N/A\", FQDN),TargetPort = case(TargetPort == \"\", \"N/A\", TargetPort)\r\n| where Action == \"Deny\" \r\n| summarize count() by URL=FQDN\r\n",
                          "size": 3,
                          "title": "Denied URL",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "piechart"
                        },
                        "customWidth": "50",
                        "name": "query - 7"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics | where Category == \"AzureFirewallApplicationRule\" | parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePortInt:int \" \" TempDetails | parse TempDetails with \"was \" Action1 \". Reason: \" Rule1 | parse TempDetails with \"to \" FQDN \":\" TargetPortInt:int \". Action: \" Action2 \".\" * | parse TempDetails with * \". Rule Collection: \" RuleCollection2a \". Rule:\" Rule2a | parse TempDetails with * \"Deny.\" RuleCollection2b \". Proceeding with\" Rule2b | extend SourcePort = tostring(SourcePortInt) | extend TargetPort = tostring(TargetPortInt) | extend Action1 = case(Action1 == \"denied\",\"Deny\",\"Unknown Action\") | extend Action = case(Action2 == \"\",Action1,Action2),Rule = case(Rule2a == \"\", case(Rule1 == \"\",case(Rule2b == \"\",\"N/A\", Rule2b),Rule1),Rule2a),  RuleCollection = case(RuleCollection2b == \"\",case(RuleCollection2a == \"\",\"No rule matched\",RuleCollection2a), RuleCollection2b),FQDN = case(FQDN == \"\", \"N/A\", FQDN),TargetPort = case(TargetPort == \"\", \"N/A\", TargetPort) | where Action == \"Allow\" \r\n| summarize count() by URL=FQDN",
                          "size": 3,
                          "title": "Allowed URL",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "piechart"
                        },
                        "customWidth": "50",
                        "name": "query - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics \r\n| where ResourceType == \"AZUREFIREWALLS\" \r\n| summarize Volume=count() by bin(TimeGenerated, {TimeRange:grain})",
                          "size": 0,
                          "title": "Events, by time",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "timechart"
                        },
                        "customWidth": "50",
                        "name": "query - 16"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics \r\n| where ResourceType == \"AZUREFIREWALLS\" \r\n| summarize Volume=count() by Category, bin(TimeGenerated, {TimeRange:grain})",
                          "size": 0,
                          "title": "Events categories, by time",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "timechart"
                        },
                        "customWidth": "50",
                        "name": "Events categories by time"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics \r\n| where ResourceType == \"AZUREFIREWALLS\" \r\n| summarize Volume=count() by Category",
                          "size": 4,
                          "title": "Events, by category",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "piechart"
                        },
                        "customWidth": "50",
                        "name": "Events by category"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics \r\n| where Category == \"AzureFirewallNetworkRule\" \r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePortInt:int \" to \" TargetIP \":\" TargetPortInt:int * \r\n| parse msg_s with * \". Action: \" Action1a \r\n| parse msg_s with * \"was \" Action1b \" to \" NatDestination\r\n| parse msg_s with Protocol2 \" request from \" SourceIP2 \" to \" TargetIP2 \". Action:\" Action2 \r\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt) \r\n| extend Action = case(Action1a == \"\", \r\ncase(Action1b == \"\",Action2,Action1b), Action1a),\r\nProtocol = case(Protocol == \"\", Protocol2, Protocol),\r\nSourceIP = case(SourceIP == \"\", SourceIP2, SourceIP),\r\nTargetIP = case(TargetIP == \"\", TargetIP2, TargetIP),\r\nSourcePort = case(SourcePort == \"\", \"N/A\", SourcePort),\r\nTargetPort = case(TargetPort == \"\", \"N/A\", TargetPort),\r\nNatDestination = case(NatDestination == \"\", \"N/A\", NatDestination)  \r\n| where Action == \"DNAT'ed\"\r\n| summarize Amount=count() by NatDestination, TimeGenerated\r\n",
                          "size": 4,
                          "title": "DNAT'ed over time",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "timechart"
                        },
                        "customWidth": "50",
                        "name": "query - 13"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics \r\n| where Category == \"AzureFirewallNetworkRule\" \r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePortInt:int \" to \" TargetIP \":\" TargetPortInt:int * \r\n| parse msg_s with * \". Action: \" Action1a \r\n| parse msg_s with * \"was \" Action1b \" to \" NatDestination \r\n| parse msg_s with Protocol2 \" request from \" SourceIP2 \" to \" TargetIP2 \". Action:\" Action2 \r\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt) \r\n| extend Action = case(Action1a == \"\", case(Action1b == \"\",Action2,Action1b), Action1a),Protocol = case(Protocol == \"\", Protocol2, Protocol),SourceIP = case(SourceIP == \"\", SourceIP2, SourceIP),TargetIP = case(TargetIP == \"\", TargetIP2, TargetIP),SourcePort = case(SourcePort == \"\", \"N/A\", SourcePort),TargetPort = case(TargetPort == \"\", \"N/A\", TargetPort),NatDestination = case(NatDestination == \"\", \"N/A\", NatDestination)  \r\n| summarize count() by Action",
                          "size": 4,
                          "title": "Rule actions",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "piechart"
                        },
                        "customWidth": "33",
                        "name": "query - 7"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics \r\n| where Category == \"AzureFirewallNetworkRule\" \r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePortInt:int \" to \" TargetIP \":\" TargetPortInt:int * \r\n| parse msg_s with * \". Action: \" Action1a \r\n| parse msg_s with * \"was \" Action1b \" to \" NatDestination \r\n| parse msg_s with Protocol2 \" request from \" SourceIP2 \" to \" TargetIP2 \". Action: \" Action2 \r\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt) \r\n| extend Action = case(Action1a == \"\", case(Action1b == \"\",Action2,Action1b), Action1a),Protocol = case(Protocol == \"\", Protocol2, Protocol),SourceIP = case(SourceIP == \"\", SourceIP2, SourceIP),TargetIP = case(TargetIP == \"\", TargetIP2, TargetIP),SourcePort = case(SourcePort == \"\", \"N/A\", SourcePort),TargetPort = case(TargetPort == \"\", \"N/A\", TargetPort), NatDestination = case(NatDestination == \"\", \"N/A\", NatDestination)  \r\n| summarize Count=count() by TargetPort",
                          "size": 4,
                          "title": "Target ports",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "piechart"
                        },
                        "customWidth": "33",
                        "name": "query - 10"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics \r\n| where Category == \"AzureFirewallNetworkRule\" \r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePortInt:int \" to \" TargetIP \":\" TargetPortInt:int * \r\n| parse msg_s with * \". Action: \" Action1a \r\n| parse msg_s with * \"was \" Action1b \" to \" NatDestination\r\n| parse msg_s with Protocol2 \" request from \" SourceIP2 \" to \" TargetIP2 \". Action:\" Action2 \r\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt) \r\n| extend Action = case(Action1a == \"\", \r\ncase(Action1b == \"\",Action2,Action1b), Action1a),\r\nProtocol = case(Protocol == \"\", Protocol2, Protocol),\r\nSourceIP = case(SourceIP == \"\", SourceIP2, SourceIP),\r\nTargetIP = case(TargetIP == \"\", TargetIP2, TargetIP),\r\nSourcePort = case(SourcePort == \"\", \"N/A\", SourcePort),\r\nTargetPort = case(TargetPort == \"\", \"N/A\", TargetPort),\r\nNatDestination = case(NatDestination == \"\", \"N/A\", NatDestination)  \r\n| where Action == \"DNAT'ed\"\r\n| summarize Amount=count() by NatDestination\r\n",
                          "size": 4,
                          "title": "DNAT actions",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "piechart"
                        },
                        "customWidth": "30",
                        "name": "query - 12"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics\r\n| where Category == \"AzureFirewallNetworkRule\"\r\n| parse msg_s with Protocol \" request from\" SourceIP \":\" SourcePortInt:int \" to\" TargetIP \":\" TargetPortInt:int *\r\n| parse msg_s with * \". Action: \" Action1a\r\n| parse msg_s with * \" was \" Action1b \" to \" NatDestination\r\n| parse msg_s with Protocol2 \" request from\" SourceIP2 \" to\" TargetIP2 \". Action:\" Action2\r\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt)\r\n| extend Action = case(Action1a == \"\", case(Action1b == \"\",Action2,Action1b), Action1a),Protocol = case(Protocol == \"\", Protocol2, Protocol),SourceIP = case(SourceIP == \"\", SourceIP2, SourceIP),TargetIP = case(TargetIP == \"\", TargetIP2, TargetIP),SourcePort = case(SourcePort == \"\", \"N/A\", SourcePort),TargetPort = case(TargetPort == \"\", \"N/A\", TargetPort),NatDestination = case(NatDestination == \"\", \"N/A\", NatDestination)\r\n| summarize count() by Action, bin(TimeGenerated, {TimeRange:grain})\r\n",
                          "size": 0,
                          "title": "Actions, by time",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "timechart"
                        },
                        "name": "query - 15"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics \r\n| where Category == \"AzureFirewallNetworkRule\" \r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePortInt:int \" to \" TargetIP \":\" TargetPortInt:int * \r\n| parse msg_s with * \". Action: \" Action1a \r\n| parse msg_s with * \"was \" Action1b \" to \" NatDestination\r\n| parse msg_s with Protocol2 \" request from \" SourceIP2 \" to \" TargetIP2 \". Action:\" Action2 \r\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt) \r\n| extend Action = case(Action1a == \"\", \r\ncase(Action1b == \"\",Action2,Action1b), Action1a),\r\nProtocol = case(Protocol == \"\", Protocol2, Protocol),\r\nSourceIP = case(SourceIP == \"\", SourceIP2, SourceIP),\r\nTargetIP = case(TargetIP == \"\", TargetIP2, TargetIP),\r\nSourcePort = case(SourcePort == \"\", \"N/A\", SourcePort),\r\nTargetPort = case(TargetPort == \"\", \"N/A\", TargetPort),\r\nNatDestination = case(NatDestination == \"\", \"N/A\", NatDestination)  \r\n| summarize amount = count() by Action , SourceIP",
                          "size": 0,
                          "title": "Rule actions, by IP addresses",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "eventCount",
                                "formatter": 3,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "showIcon": true
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 8"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let ActivityData = AzureDiagnostics\r\n| where Category == \"AzureFirewallApplicationRule\"\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePortInt:int \" \" TempDetails\r\n| parse TempDetails with \"was \" Action1 \". Reason: \" Rule1\r\n| parse TempDetails with \"to \" FQDN \":\" TargetPortInt:int \". Action: \" Action2 \".\" *\r\n| parse TempDetails with * \". Rule Collection: \" RuleCollection2a \". Rule:\" Rule2a\r\n| parse TempDetails with * \"Deny.\" RuleCollection2b \". Proceeding with\" Rule2b\r\n| extend SourcePort = tostring(SourcePortInt)\r\n| extend TargetPort = tostring(TargetPortInt)\r\n| extend Action1 = case(Action1 == \"denied\",\"Deny\",\"Unknown Action\")\r\n| extend Action = case(Action2 == \"\",Action1,Action2),Rule = case(Rule2a == \"\", case(Rule1 == \"\",case(Rule2b == \"\",\"N/A\", Rule2b),Rule1),Rule2a),  RuleCollection = case(RuleCollection2b == \"\",case(RuleCollection2a == \"\",\"No rule matched\",RuleCollection2a), RuleCollection2b),FQDN = case(FQDN == \"\", \"N/A\", FQDN),TargetPort = case(TargetPort == \"\", \"N/A\", TargetPort)\r\n| where Action == \"Deny\";\r\nActivityData\r\n| summarize Amount=count() by SourceIP\r\n| join kind = inner\r\n(\r\n    ActivityData\r\n    | make-series Trend = count() default = 0 on bin(TimeGenerated, 1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SourceIP) on SourceIP\r\n    | project-away SourceIP1, TimeGenerated\r\n    | top 10 by Amount\r\n    | sort by Amount",
                          "size": 0,
                          "title": "Unique Source IP addresses",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Amount",
                              "formatter": 12,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "subtitleContent": {
                              "columnMatch": "SourceIP",
                              "formatter": 1,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "secondaryContent": {
                              "columnMatch": "Trend",
                              "formatter": 9,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 4"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics \n| where Category == \"AzureFirewallApplicationRule\" \n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePortInt:int \" \" TempDetails \n| parse TempDetails with \"was \" Action1 \". Reason: \" Rule1 \n| parse TempDetails with \"to \" FQDN \":\" TargetPortInt:int \". Action: \" Action2 \".\" *\n| parse TempDetails with * \". Rule Collection: \" RuleCollection2a \". Rule:\" Rule2a \n| parse TempDetails with * \"Deny.\" RuleCollection2b \". Proceeding with\" Rule2b \n| extend SourcePort = tostring(SourcePortInt) \n| extend TargetPort = tostring(TargetPortInt) \n| extend Action1 = case(Action1 == \"denied\",\"Deny\",\"Unknown Action\") \n| extend Action = case(Action2 == \"\",Action1,Action2),Rule = case(Rule2a == \"\", case(Rule1 == \"\",case(Rule2b == \"\",\"N/A\", Rule2b),Rule1),Rule2a),  RuleCollection = case(RuleCollection2b == \"\",case(RuleCollection2a == \"\",\"No rule matched\",RuleCollection2a), RuleCollection2b),FQDN = case(FQDN == \"\", \"N/A\", FQDN),TargetPort = case(TargetPort == \"\", \"N/A\", TargetPort) \n| where Action == \"Deny\" \n|  summarize Amount=dcount(SourceIP) by SourceIP, Protocol, URL = FQDN, TargetPortInt, Action\n",
                          "size": 1,
                          "title": "Unique source IP addresses",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Count",
                                "formatter": 3,
                                "formatOptions": {
                                  "palette": "lightBlue",
                                  "showIcon": true,
                                  "aggregation": "Count"
                                },
                                "numberFormat": {
                                  "unit": 17,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics \r\n| where Category == \"AzureFirewallNetworkRule\" \r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePortInt:int \" to \" TargetIP \":\" TargetPortInt:int * \r\n| parse msg_s with * \". Action: \" Action1a \r\n| parse msg_s with * \"was \" Action1b \" to \" NatDestination \r\n| parse msg_s with Protocol2 \" request from \" SourceIP2 \" to \" TargetIP2 \". Action: \" Action2 \r\n| extend SourcePort = tostring(SourcePortInt),TargetPort = tostring(TargetPortInt) \r\n| extend Action = case(Action1a == \"\", \r\ncase(Action1b == \"\",Action2,Action1b), Action1a),Protocol = case(Protocol == \"\", \r\nProtocol2, Protocol),SourceIP = case(SourceIP == \"\", SourceIP2, SourceIP),\r\nTargetIP = case(TargetIP == \"\", TargetIP2, TargetIP),\r\nSourcePort = case(SourcePort == \"\", \"N/A\", SourcePort),\r\nTargetPort = case(TargetPort == \"\", \"N/A\", TargetPort), \r\nNatDestination = case(NatDestination == \"\", \r\n\"N/A\", NatDestination)  \r\n| summarize AMOUNT=count() by TargetPort, SourceIP",
                          "size": 1,
                          "title": "Target ports, by Source IP",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "filter": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 11"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureDiagnostics \r\n| where Category == \"AzureFirewallApplicationRule\" \r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePortInt:int \" \" TempDetails \r\n| parse TempDetails with \"was \" Action1 \". Reason: \" Rule1 \r\n| parse TempDetails with \"to \" FQDN \":\" TargetPortInt:int \". Action: \" Action2 \".\" * \r\n| parse TempDetails with * \". Rule Collection: \" RuleCollection2a \". Rule:\" Rule2a \r\n| parse TempDetails with * \"Deny.\" RuleCollection2b \". Proceeding with\" Rule2b \r\n| extend SourcePort = tostring(SourcePortInt) \r\n| extend TargetPort = tostring(TargetPortInt)\r\n| extend Action1 = case(Action1 == \"denied\",\"Deny\",\"Unknown Action\") \r\n| extend Action = case(Action2 == \"\",Action1,Action2),Rule = case(Rule2a == \"\", case(Rule1 == \"\",case(Rule2b == \"\",\"N/A\", Rule2b),Rule1),Rule2a),  RuleCollection = case(RuleCollection2b == \"\",case(RuleCollection2a == \"\",\"No rule matched\",RuleCollection2a), RuleCollection2b),FQDN = case(FQDN == \"\", \"N/A\", FQDN),TargetPort = case(TargetPort == \"\", \"N/A\", TargetPort) \r\n| summarize count() by URL=FQDN, bin(TimeGenerated,{TimeRange:grain}), Action, SourcePort, TargetPort\r\n",
                          "size": 0,
                          "title": "All IP addresses events",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "filter": true
                          }
                        },
                        "name": "query - 9"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "firewall"
                  },
                  "name": "Firewall"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "4651f813-292c-4932-95ae-ad439f6e8cd9",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "isRequired": true,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 43200000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbooka9ea46a6-d16a-43b9-a30d-81475a76a12a",
                          "version": "MetricsItem/2.0",
                          "size": 3,
                          "chartType": 0,
                          "resourceType": "microsoft.network/virtualnetworkgateways",
                          "metricScope": 0,
                          "resourceParameter": "VPNGateways",
                          "resourceIds": [
                            "{VPNGateways}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.network/virtualnetworkgateways",
                              "metric": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount",
                              "aggregation": 7
                            },
                            {
                              "namespace": "microsoft.network/virtualnetworkgateways",
                              "metric": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.network/virtualnetworkgateways",
                              "metric": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.network/virtualnetworkgateways",
                              "metric": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth",
                              "aggregation": 4
                            }
                          ],
                          "title": "Virtual network gateways",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Name",
                              "formatter": 13
                            },
                            "leftContent": {
                              "columnMatch": "Value",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource"
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 11,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-P2SConnectionCount Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-P2SConnectionCount",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 11,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 11,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "Metric",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Aggregation",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Value",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Timeline",
                                "formatter": 9
                              },
                              {
                                "columnMatch": "microsoft.network/virtualnetworkgateways-Performance-ExpressRouteGatewayPacketsPerSecond",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 31,
                                  "options": null
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "labelSettings": [
                              {
                                "columnId": "Subscription",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "Name",
                                "label": "Storage Name"
                              },
                              {
                                "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount",
                                "label": "Tunnel Total Flow Count (Count)"
                              },
                              {
                                "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount Timeline",
                                "label": "Tunnel Total Flow Count Timeline"
                              },
                              {
                                "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth",
                                "label": "Tunnel Bandwidth (Average)"
                              },
                              {
                                "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth Timeline",
                                "label": "Tunnel Bandwidth Timeline"
                              },
                              {
                                "columnId": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth",
                                "label": "Gateway P2S Bandwidth (Average)"
                              },
                              {
                                "columnId": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth Timeline",
                                "label": "Gateway P2S Bandwidth Timeline"
                              },
                              {
                                "columnId": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth",
                                "label": "Gateway S2S Bandwidth (Average)"
                              },
                              {
                                "columnId": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth Timeline",
                                "label": "Gateway S2S Bandwidth Timeline"
                              }
                            ]
                          }
                        },
                        "customWidth": "80",
                        "name": "metric - 11 - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "vnetgateway"
                  },
                  "name": "Vnet Gateway"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tabname",
              "comparison": "isEqualTo",
              "value": "network"
            },
            "name": "Network"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "7a677554-f941-4beb-9f1f-eee85ea44778",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Environment",
                        "subTarget": "environment",
                        "style": "link"
                      },
                      {
                        "id": "61f28781-e641-42de-821f-c94a6b4df7c5",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Inventory",
                        "subTarget": "inventory",
                        "style": "link"
                      },
                      {
                        "id": "14da6efa-57d9-4bc9-9dda-e165db7d94f7",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Performance",
                        "subTarget": "performance",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 5"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type =~ 'microsoft.documentdb/databaseaccounts'\r\n        or type =~ 'microsoft.sql/servers/databases'\r\n        or type =~ 'microsoft.dbformysql/servers'\r\n        or type =~ 'microsoft.sql/servers'\r\n        or type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines'\r\n        or type has 'microsoft.documentdb'\r\n\tor type has 'microsoft.sql'\r\n\tor type has 'microsoft.dbformysql'\r\n\tor type has 'microsoft.sql'\r\n    or type has 'microsoft.purview'\r\n    or type has 'microsoft.datafactory'\r\n\tor type has 'microsoft.analysisservices'\r\n\tor type has 'microsoft.datamigration'\r\n\tor type has 'microsoft.synapse'\r\n\tor type has 'microsoft.datafactory'\r\n\tor type has 'microsoft.kusto'\r\n    or type has 'microsoft.dbforpostgresql'\r\n    or type has 'microsoft.digitaltwins'\r\n| extend type = case(\r\n              type =~ 'microsoft.documentdb/databaseaccounts', 'CosmosDB',\r\n              type =~ 'microsoft.sql/servers/databases', 'SQL DBs',\r\n              type =~ 'microsoft.dbformysql/servers', 'MySQL',\r\n              type =~ 'microsoft.sql/servers', 'SQL Servers',\r\n              type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines', 'SQL Virtual Machines',\r\n              type =~ 'microsoft.documentdb/databaseaccounts', 'CosmosDB',\r\n\ttype =~ 'microsoft.sql/servers/databases', 'SQL DBs',\r\n\ttype =~ 'microsoft.dbformysql/servers', 'MySQL',\r\n\ttype =~ 'microsoft.sql/servers', 'SQL Servers',\r\n    type =~ 'microsoft.purview/accounts', 'Purview Accounts',\r\n\ttype =~ 'microsoft.synapse/workspaces/sqlpools', 'Synapse SQL Pools',\r\n\ttype =~ 'microsoft.kusto/clusters', 'ADX Clusters',\r\n\ttype =~ 'microsoft.datafactory/factories', 'Data Factories',\r\n\ttype =~ 'microsoft.synapse/workspaces', 'Synapse Workspaces',\r\n\ttype =~ 'microsoft.analysisservices/servers', 'Analysis Services Servers',\r\n\ttype =~ 'microsoft.datamigration/services', 'DB Migration Service',\r\n\ttype =~ 'microsoft.sql/managedinstances/databases', 'Managed Instance DBs',\r\n\ttype =~ 'microsoft.sql/managedinstances', 'Managed Instnace',\r\n\ttype =~ 'microsoft.datamigration/services/projects', 'Data Migration Projects',\r\n\ttype =~ 'microsoft.sql/virtualclusters', 'SQL Virtual Clusters',\r\n    type =~ 'microsoft.dbforpostgresql/servers', 'PostgreSQL DBs',\r\n    type =~ 'microsoft.digitaltwins/digitaltwinsinstances', 'Digital Twins',\r\n              \r\n              strcat(\"Not Translated: \", type))\r\n| where type !has \"Not Translated\"\r\n| summarize count() by type",
                          "size": 3,
                          "title": "Type Wise Database",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart"
                        },
                        "customWidth": "33",
                        "name": "query - 1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "where type == \"microsoft.sql/servers/databases\"\r\n| extend GB = todouble(properties.maxSizeBytes) / (1024 * 1024 * 1024)\r\n| summarize DBCount=count() by GB\r\n| order by GB desc\r\n|extend ['Count (SQL Databases)']=DBCount\r\n| project GB=strcat(tostring(GB), \" GB\"), ['Count (SQL Databases)']",
                          "size": 3,
                          "title": "SQL DB by Max Size",
                          "noDataMessage": "No SQL DB In Account",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "GB",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "Count (SQL Databases)",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "33",
                        "name": "query - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "where type == \"microsoft.sql/servers/databases\"\r\n| summarize DBCount=count() by Tier=tostring(properties.currentSku.tier)\r\n| order by DBCount desc\r\n|extend ['Count (SQL Databases)']=DBCount\r\n| project Tier, ['Count (SQL Databases)']",
                          "size": 3,
                          "title": "SQL DB By Tier",
                          "noDataMessage": "No SQL DB in Account",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart"
                        },
                        "customWidth": "33",
                        "name": "query - 3"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "environment"
                  },
                  "name": "environment"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type =~ \"microsoft.sql/servers/databases\"\r\n| where kind notcontains \"system\"\r\n| extend sku_name = sku.name\r\n| extend sql_server = split(id,\"/\")[8]\r\n| project name,  sku_name, sql_server, kind, location, resourceGroup, subscriptionId\r\n",
                          "size": 4,
                          "title": "SQL PaaS Database",
                          "noDataMessage": "No SQL PaaS Database exist In the Environment",
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "name": "SQL DB"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type =~ 'microsoft.documentdb/databaseaccounts'\r\n        or type =~ 'microsoft.sql/servers/databases'\r\n        or type =~ 'microsoft.dbformysql/servers'\r\n        or type =~ 'microsoft.sql/servers'\r\n        or type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines'\r\n        or type has 'microsoft.documentdb'\r\n        or type has 'microsoft.sql'\r\n\t    or type has 'microsoft.dbformysql'\r\n        or type has 'microsoft.purview'\r\n        or type has 'microsoft.datafactory'\r\n\t    or type has 'microsoft.analysisservices'\r\n\t    or type has 'microsoft.datamigration'\r\n\t    or type has 'microsoft.synapse'\r\n\t    or type has 'microsoft.datafactory'\r\n\t    or type has 'microsoft.kusto'\r\n        or type has 'microsoft.dbforpostgresql'\r\n        or type has 'microsoft.digitaltwins'\r\n\r\n| extend type = case(\r\n             type =~ 'microsoft.documentdb/databaseaccounts', 'CosmosDB',\r\n             type =~ 'microsoft.sql/servers/databases', 'SQL DBs',\r\n             type =~ 'microsoft.dbformysql/servers', 'MySQL',\r\n             type =~ 'microsoft.sql/servers', 'SQL Servers',\r\n            type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines', 'SQL Virtual Machines',\r\n            type =~ 'microsoft.purview/accounts', 'Purview Accounts',\r\n\ttype =~ 'microsoft.synapse/workspaces/sqlpools', 'Synapse SQL Pools',\r\n\ttype =~ 'microsoft.kusto/clusters', 'ADX Clusters',\r\n\ttype =~ 'microsoft.datafactory/factories', 'Data Factories',\r\n\ttype =~ 'microsoft.synapse/workspaces', 'Synapse Workspaces',\r\n\ttype =~ 'microsoft.analysisservices/servers', 'Analysis Services Servers',\r\n\ttype =~ 'microsoft.datamigration/services', 'DB Migration Service',\r\n\ttype =~ 'microsoft.sql/managedinstances/databases', 'Managed Instance DBs',\r\n\ttype =~ 'microsoft.sql/managedinstances', 'Managed Instnace',\r\n\ttype =~ 'microsoft.datamigration/services/projects', 'Data Migration Projects',\r\n\ttype =~ 'microsoft.sql/virtualclusters', 'SQL Virtual Clusters',\r\n    type =~ 'microsoft.dbforpostgresql/servers', 'PostgreSQL DBs',\r\n    type =~ 'microsoft.digitaltwins/digitaltwinsinstances', 'Digital Twins',\r\n             strcat(\"Not Translated: \", type))\r\n| extend Sku = case(\r\n             type =~ 'CosmosDB', properties.databaseAccountOfferType,\r\n             type =~ 'SQL DBs', sku.name,\r\n             type =~ 'MySQL', sku.name,\r\n           \r\n             ' ')\r\n| extend Status = case(\r\n             type =~ 'CosmosDB', properties.provisioningState,\r\n             type =~ 'SQL DBs', properties.status,\r\n             type =~ 'MySQL', properties.userVisibleState,\r\n             type =~ 'Managed Instance DBs', properties.status,\r\n             ' ')\r\n| extend Endpoint = case(\r\n             type =~ 'MySQL', properties.fullyQualifiedDomainName,\r\n             type =~ 'SQL Servers', properties.fullyQualifiedDomainName,\r\n             type =~ 'CosmosDB', properties.documentEndpoint,\r\n             type =~ 'ADX Clusters', properties.uri,\r\n\t        type =~ 'Purview Accounts', properties.endpoints,\r\n\t        type =~ 'Synapse Workspaces', properties.connectivityEndpoints,\r\n\t        type =~ 'Synapse SQL Pools', sku.name,\r\n             ' ')\r\n| extend maxSizeGB = todouble(case(\r\n             type =~ 'SQL DBs', properties.maxSizeBytes,\r\n             type =~ 'MySQL', properties.storageProfile.storageMB,\r\n             type =~ 'Synapse SQL Pools', properties.maxSizeBytes,\r\n             ' '))\r\n| extend maxSizeGB = case(\r\n\t\ttype has 'SQL DBs', maxSizeGB /1000 /1000 /1000,\r\n\t\ttype has 'Synapse SQL Pools', maxSizeGB /1000 /1000 /1000,\r\n\t\ttype has 'MySQL', maxSizeGB /1000,\r\n\t\tmaxSizeGB)\r\n| extend Tier = sku.tier\r\n| extend License = properties.licenseType\r\n| extend Details = pack_all()\r\n| project Resource=id, resourceGroup, subscriptionId, type, Sku,Tier,  Status, Endpoint, maxSizeGB ,location,apiVersion,Details",
                          "size": 3,
                          "title": "Database Inventory",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "filter": true,
                            "sortBy": [
                              {
                                "itemKey": "maxSizeGB",
                                "sortOrder": 2
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "resourceGroup",
                                "label": "Resorce Group"
                              },
                              {
                                "columnId": "subscriptionId",
                                "label": "Subscription ID"
                              },
                              {
                                "columnId": "type",
                                "label": "Type"
                              },
                              {
                                "columnId": "Status",
                                "label": "Status"
                              },
                              {
                                "columnId": "Endpoint",
                                "label": "End Point"
                              },
                              {
                                "columnId": "maxSizeGB",
                                "label": "Max Size GB"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "maxSizeGB",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "name": "query - 7"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "inventory"
                  },
                  "name": "inventory"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "5e8f8ef7-c57e-4c97-8356-67e34bdd1eb1",
                              "version": "KqlParameterItem/1.0",
                              "name": "Database",
                              "type": 5,
                              "isRequired": true,
                              "query": "Resources\r\n| where type =~ 'microsoft.sql/servers/databases'\r\n  or type =~ 'microsoft.sql/servers/databases'\r\n    | project databaseId = id, databaseName = name, elasticPoolId = tolower(tostring(properties.elasticPoolId))\r\n| join kind=leftouter (\r\n\tResources\r\n\t| where type =~ 'microsoft.sql/servers/elasticpools'\r\n\t| project elasticPoolId = tolower(id), elasticPoolName = name, elasticPoolState = properties.state)\r\n\ton elasticPoolId\r\n| project-away elasticPoolId1",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::1",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "dc5810c5-94fa-48b3-92ae-c550fcd6e5ec",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "isRequired": true,
                              "value": {
                                "durationMs": 7776000000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "parameters - 5"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook4cd53e9f-58a2-475b-9f3e-b33b9a57b6a3",
                          "version": "MetricsItem/2.0",
                          "size": 1,
                          "chartType": 2,
                          "resourceType": "microsoft.sql/servers/databases",
                          "metricScope": 0,
                          "resourceParameter": "Database",
                          "resourceIds": [
                            "{Database}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 7776000000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.sql/servers/databases",
                              "metric": "microsoft.sql/servers/databases-Basic-cpu_percent",
                              "aggregation": 4,
                              "splitBy": null
                            }
                          ],
                          "title": "CPU Utilization",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "25",
                        "name": "metric - 2"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook4cd53e9f-58a2-475b-9f3e-b33b9a57b6a3",
                          "version": "MetricsItem/2.0",
                          "size": 1,
                          "chartType": 2,
                          "resourceType": "microsoft.sql/servers/databases",
                          "metricScope": 0,
                          "resourceParameter": "Database",
                          "resourceIds": [
                            "{Database}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 7776000000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.sql/servers/databases",
                              "metric": "microsoft.sql/servers/databases-Basic-connection_failed",
                              "aggregation": 7,
                              "splitBy": null
                            }
                          ],
                          "title": "Failed Connection",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "25",
                        "name": "metric - 2 - Copy"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook0826ffa7-d944-466f-89bc-663f87ac227f",
                          "version": "MetricsItem/2.0",
                          "size": 1,
                          "chartType": 2,
                          "resourceType": "microsoft.sql/servers/databases",
                          "metricScope": 0,
                          "resourceParameter": "Database",
                          "resourceIds": [
                            "{Database}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 7776000000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.sql/servers/databases",
                              "metric": "microsoft.sql/servers/databases-Basic-physical_data_read_percent",
                              "aggregation": 4,
                              "splitBy": null
                            }
                          ],
                          "title": "Data I/O Percentage",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "25",
                        "name": "metric - 4"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook0826ffa7-d944-466f-89bc-663f87ac227f",
                          "version": "MetricsItem/2.0",
                          "size": 1,
                          "chartType": 2,
                          "resourceType": "microsoft.sql/servers/databases",
                          "metricScope": 0,
                          "resourceParameter": "Database",
                          "resourceIds": [
                            "{Database}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 7776000000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.sql/servers/databases",
                              "metric": "microsoft.sql/servers/databases-Basic-storage_percent",
                              "aggregation": 4,
                              "splitBy": null
                            }
                          ],
                          "title": "Data I/O Percentage",
                          "gridSettings": {
                            "rowLimit": 10000
                          }
                        },
                        "customWidth": "25",
                        "name": "metric - 4 - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "performance"
                  },
                  "name": "Performance"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tabname",
              "comparison": "isEqualTo",
              "value": "database"
            },
            "name": "Database"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "c4371616-48ba-48b4-aba8-e1b33ad7331d",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Storage Account",
                        "subTarget": "storageaccount",
                        "style": "link"
                      },
                      {
                        "id": "4886cc0b-6806-4c13-b83a-ad8a49b3088b",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Key Vault",
                        "subTarget": "keyvault",
                        "style": "link"
                      },
                      {
                        "id": "64415d15-5c5e-419b-b208-af3fc74fee35",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "App Services",
                        "subTarget": "appservices",
                        "style": "link"
                      },
                      {
                        "id": "99b75f53-824d-4213-a61a-c226deb6ebeb",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "App Gateway",
                        "subTarget": "appgateway",
                        "style": "link"
                      },
                      {
                        "id": "dbd91c54-d259-42a5-9561-bd7ac0aa343d",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Load Balancers",
                        "subTarget": "loadbalancer",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 0"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "parameters": [
                            {
                              "id": "827a53dc-62fe-49ee-88a6-f9f751ed5ab3",
                              "version": "KqlParameterItem/1.0",
                              "name": "Resources",
                              "label": "Key vaults",
                              "type": 5,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "\"",
                              "delimiter": ",",
                              "query": "Resources\r\n| where type =~ 'microsoft.keyvault/vaults' and resourceGroup in~({ResourceGroup}) \r\n| project name, id\r\n| union (Resources\r\n| where type =~ 'microsoft.keyvault/vaults' and resourceGroup in~({ResourceGroup}) \r\n| order by name asc\r\n| take 5\r\n| project id, name)\r\n| summarize Count = count() by id, name\r\n| order by name asc\r\n| project value = id, label = id, selected = Count > 1",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1",
                                  "value::5",
                                  "value::all"
                                ],
                                "selectAllValue": "",
                                "showDefault": false
                              },
                              "defaultValue": "value::5",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "65f81355-b707-45be-b7e1-f8450b537da4",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "isRequired": true,
                              "value": {
                                "durationMs": 2592000000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  }
                                ],
                                "allowCustom": true
                              }
                            },
                            {
                              "id": "ed145907-5677-426b-8737-66ac01714250",
                              "version": "KqlParameterItem/1.0",
                              "name": "Message",
                              "type": 1,
                              "query": "where type =~ 'microsoft.keyvault/vaults' and resourceGroup in~({ResourceGroup}) \r\n| summarize Selected = countif(id in ({Resources:value})), Total = count()\r\n| extend Selected = iff(Selected > 200, 200, Selected)\r\n| project Message = strcat('# ', Selected, ' / ', Total)",
                              "crossComponentResources": [
                                "{Resources}"
                              ],
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "148a4084-ce64-44cc-9fdc-6b3ab6c00830",
                              "version": "KqlParameterItem/1.0",
                              "name": "ResourceName",
                              "type": 1,
                              "description": "Used in 'No Subscription' workbook template",
                              "isHiddenWhenLocked": true,
                              "criteriaData": [
                                {
                                  "condition": "else result = 'Key vault'",
                                  "criteriaContext": {
                                    "operator": "Default",
                                    "rightValType": "param",
                                    "resultValType": "static",
                                    "resultVal": "Key vault"
                                  }
                                }
                              ]
                            },
                            {
                              "id": "d8328492-f765-4a9e-b3cb-3d0d653f403c",
                              "version": "KqlParameterItem/1.0",
                              "name": "ResourceImageUrl",
                              "type": 1,
                              "description": "Used in 'No Subscription' workbook template",
                              "isHiddenWhenLocked": true
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "KeyVault-Parameters",
                        "styleSettings": {
                          "margin": "15px 0 0 0"
                        }
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "{Message}\r\n_Key vaults_"
                        },
                        "customWidth": "25",
                        "name": "text - 1"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook6f5ece70-86e7-4a7e-9a20-72fe3c12eeb4",
                          "version": "MetricsItem/2.0",
                          "size": 3,
                          "chartType": 0,
                          "resourceType": "microsoft.keyvault/vaults",
                          "metricScope": 0,
                          "resourceParameter": "Resources",
                          "resourceIds": [
                            "{Resources}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 2592000000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.keyvault/vaults",
                              "metric": "microsoft.keyvault/vaults--ServiceApiResult",
                              "aggregation": 1,
                              "splitBy": "ActivityName",
                              "splitBySortOrder": -1,
                              "splitByLimit": 10,
                              "columnName": "Api hits"
                            },
                            {
                              "namespace": "microsoft.keyvault/vaults",
                              "metric": "microsoft.keyvault/vaults--ServiceApiResult",
                              "aggregation": 1,
                              "splitBy": "ActivityName",
                              "splitBySortOrder": -1,
                              "splitByLimit": 5,
                              "columnName": "Api hit failures",
                              "filters": [
                                {
                                  "key": "StatusCode",
                                  "operator": 1,
                                  "values": [
                                    "200",
                                    "201",
                                    "202",
                                    "206"
                                  ]
                                }
                              ]
                            },
                            {
                              "namespace": "microsoft.keyvault/vaults",
                              "metric": "microsoft.keyvault/vaults--ServiceApiLatency",
                              "aggregation": 4,
                              "splitBy": "ActivityName",
                              "splitBySortOrder": -1,
                              "splitByLimit": 5
                            },
                            {
                              "namespace": "microsoft.keyvault/vaults",
                              "metric": "microsoft.keyvault/vaults--SaturationShoebox",
                              "aggregation": 4,
                              "splitBy": "ActivityName",
                              "splitBySortOrder": 2,
                              "splitByLimit": 5,
                              "columnName": "Saturation"
                            }
                          ],
                          "gridFormatType": 2,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "subTarget": "insights",
                                  "showIcon": true,
                                  "workbookContext": {
                                    "componentIdSource": "cell",
                                    "resourceIdsSource": "workbook",
                                    "templateIdSource": "static",
                                    "templateId": "Community-Workbooks/KeyVault/Overview",
                                    "typeSource": "workbook",
                                    "gallerySource": "workbook",
                                    "locationSource": "default"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 5,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": "Segment",
                                "formatter": 5,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": "Api hits",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "aggregation": "Sum"
                                },
                                "numberFormat": {
                                  "unit": 17,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "maximumFractionDigits": 1
                                  },
                                  "emptyValCustomText": "-"
                                }
                              },
                              {
                                "columnMatch": "Api hits Timeline",
                                "formatter": 21,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "aggregation": "Sum"
                                }
                              },
                              {
                                "columnMatch": "Api hit failures",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "red",
                                  "aggregation": "Sum"
                                },
                                "numberFormat": {
                                  "unit": 17,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  },
                                  "emptyValCustomText": "-"
                                }
                              },
                              {
                                "columnMatch": "Api hit failures Timeline",
                                "formatter": 5,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": "microsoft.keyvault/vaults--ServiceApiLatency",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "gray",
                                  "aggregation": "Max"
                                },
                                "numberFormat": {
                                  "unit": 23,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 2
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.keyvault/vaults--ServiceApiLatency Timeline",
                                "formatter": 5,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": "Saturation",
                                "formatter": 18,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed",
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">",
                                      "thresholdValue": "75",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "is Empty",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "aggregation": "Average"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "maximumFractionDigits": 1
                                  },
                                  "emptyValCustomText": "0%"
                                }
                              },
                              {
                                "columnMatch": "Saturation Timeline",
                                "formatter": 5,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": ".*\\/Total Service Api Hits$",
                                "formatter": 1,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": "microsoft.keyvault/vaults--ServiceApiResult Timeline",
                                "formatter": 5,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": "microsoft.keyvault/vaults--ServiceApiResult",
                                "formatter": 1,
                                "formatOptions": {},
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                  }
                                }
                              },
                              {
                                "columnMatch": "More Details",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "WorkbookTemplate",
                                  "workbookContext": null
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Subscription",
                                "Name"
                              ],
                              "expandTopLevel": true,
                              "finalBy": "Segment"
                            },
                            "sortBy": [
                              {
                                "itemKey": "$gen_heatmap_Api hit failures_6",
                                "sortOrder": 2
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Subscription",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "Name",
                                "label": "Storage Name"
                              },
                              {
                                "columnId": "Api hits",
                                "label": "Requests"
                              },
                              {
                                "columnId": "Api hits Timeline",
                                "label": "Requests timeline"
                              },
                              {
                                "columnId": "Api hit failures",
                                "label": "Request failures"
                              },
                              {
                                "columnId": "Api hit failures Timeline",
                                "label": "Api hit failures Timeline"
                              },
                              {
                                "columnId": "microsoft.keyvault/vaults--ServiceApiLatency",
                                "label": "Average latency (worst rolled up)"
                              },
                              {
                                "columnId": "microsoft.keyvault/vaults--ServiceApiLatency Timeline",
                                "label": "Overall Service Api Latency (Average) Timeline"
                              },
                              {
                                "columnId": "Saturation",
                                "label": "Saturation"
                              },
                              {
                                "columnId": "Saturation Timeline",
                                "label": "Saturation Timeline"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_heatmap_Api hit failures_6",
                              "sortOrder": 2
                            }
                          ],
                          "exportedParameters": [
                            {
                              "fieldName": "Name",
                              "parameterName": "Vault",
                              "parameterType": 5,
                              "defaultValue": ""
                            }
                          ],
                          "showExportToExcel": true
                        },
                        "customWidth": "100",
                        "name": "Key vault overview metrics"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.keyvault/vaults\"\r\n| extend Retention=\"Retention\"\r\n| project id,  enableSoftDelete = tostring(properties.enableSoftDelete), softDeleteRetentionInDays=tostring(properties.softDeleteRetentionInDays) ",
                          "size": 3,
                          "title": "Soft Delete & Retention",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "enableSoftDelete",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "true",
                                      "representation": "Resolved",
                                      "text": "Enabled"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "failed",
                                      "text": "Not Enabled"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "softDeleteRetentionInDays",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">=",
                                      "thresholdValue": "7",
                                      "representation": "more",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "is Empty",
                                      "representation": "Sev2",
                                      "text": "{0}Not Applicable"
                                    },
                                    {
                                      "operator": "<",
                                      "thresholdValue": "7",
                                      "representation": "more",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "1",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ],
                            "filter": true,
                            "sortBy": [
                              {
                                "itemKey": "$gen_link_id_0",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "id",
                                "label": "Storage Account"
                              },
                              {
                                "columnId": "enableSoftDelete",
                                "label": "Soft Delete"
                              },
                              {
                                "columnId": "softDeleteRetentionInDays",
                                "label": "Soft Delete Retention Days"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_link_id_0",
                              "sortOrder": 1
                            }
                          ],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "id",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            "subtitleContent": {
                              "columnMatch": "enableSoftDelete",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "true",
                                    "representation": "Available",
                                    "text": "Enabled"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "4",
                                    "text": "Not Enabled"
                                  }
                                ]
                              }
                            },
                            "leftContent": {
                              "columnMatch": "Retention"
                            },
                            "rightContent": {
                              "columnMatch": "softDeleteRetentionInDays"
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "customWidth": "40",
                        "name": "query - 0"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Who is calling this KeyVault? \r\n// List of callers identified by their IP address with their request count.  \r\n// KeyVault diagnostic currently stores logs in AzureDiagnostics table which stores logs for multiple services. \r\n// Filter on ResourceProvider for logs specific to a service.\r\nAzureDiagnostics\r\n| where ResourceProvider ==\"MICROSOFT.KEYVAULT\"\r\n| summarize  count() by CallerIPAddress\r\n",
                          "size": 3,
                          "title": "Top 10 Caller IP Address",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "rowLimit": 10,
                            "filter": true,
                            "sortBy": [
                              {
                                "itemKey": "count_",
                                "sortOrder": 2
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "count_",
                              "sortOrder": 2
                            }
                          ],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "CallerIPAddress",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "customWidth": "30",
                        "name": "Who is acccessing Your Keyvault"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// How active has this KeyVault been? \r\n// Line chart showing trend of KeyVault requests volume, per operation over time. \r\n// KeyVault diagnostic currently stores logs in AzureDiagnostics table which stores logs for multiple services. \r\n// Filter on ResourceProvider for logs specific to a service.\r\nAzureDiagnostics\r\n| where ResourceProvider ==\"MICROSOFT.KEYVAULT\" \r\n| summarize count() by  OperationName // Aggregate by hour\r\n| render timechart",
                          "size": 3,
                          "title": "Top 10 Vault Operations",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "rowLimit": 10,
                            "filter": true
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "OperationName",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "customWidth": "30",
                        "name": "Key Vault Operations"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// How fast is this KeyVault serving requests? \r\n// Line chart showing trend of request duration over time using different aggregations.  \r\nAzureDiagnostics\r\n| where ResourceProvider ==\"MICROSOFT.KEYVAULT\" \r\n| summarize avg(DurationMs) by requestUri_s // requestUri_s contains the URI of the request\r\n",
                          "size": 3,
                          "title": "URI Latency",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Resources}"
                          ],
                          "visualization": "tiles",
                          "gridSettings": {
                            "labelSettings": [
                              {
                                "columnId": "requestUri_s",
                                "label": "Key Vault URI"
                              },
                              {
                                "columnId": "avg_DurationMs",
                                "label": "Response in Mili Second"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "requestUri_s",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "avg_DurationMs",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "full"
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "requestUri_s",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "avg_DurationMs",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "Key Vault URI Performance (ms)"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "keyvault"
                  },
                  "name": "Key Vault"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == 'microsoft.storage/storageaccounts'\r\n| summarize count() by type\r\n",
                          "size": 3,
                          "color": "green",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "type",
                              "formatter": 16,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "15",
                        "name": "query - 4"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "where type =~ \"microsoft.storage/storageaccounts\"\r\n| summarize count() by location\r\n|project Location=['location'], Total=count_",
                          "size": 4,
                          "title": "Storage Account - By  Location",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "PowerState",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "textSettings": {
                            "style": "bignumber"
                          }
                        },
                        "customWidth": "20",
                        "name": "Storage Account - By  Location",
                        "styleSettings": {
                          "margin": "10px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.storage/storageaccounts\"\r\n| project id, name = tostring(sku.name), tier = tostring(sku.tier)\r\n| summarize count() by name",
                          "size": 4,
                          "title": "Azure Storage Accounts - By SKU",
                          "noDataMessage": "No Storage Account found in selected subscription.",
                          "exportToExcelOptions": "all",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "PowerState",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "25",
                        "name": "query - Storage Account Overview"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": " where type == \"microsoft.storage/storageaccounts\"\r\n\r\n | summarize StorageCount=count() by PrimaryStatus=tostring(properties.statusOfPrimary), SecondaryStatus=tostring(properties.statusOfSecondary)\r\n  |extend ['Count (Storage accounts)']=StorageCount\r\n | extend SecondaryStatus= iff(strlen(SecondaryStatus) == 0, \"No secondary\", SecondaryStatus)\r\n | project-away StorageCount",
                          "size": 4,
                          "title": "Storage Account  by State",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "PrimaryStatus",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "available",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "No Secondary",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "more",
                                      "text": ""
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "SecondaryStatus",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "available",
                                      "representation": "Available",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "No secondary",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "more",
                                      "text": ""
                                    }
                                  ]
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "PrimaryStatus",
                                "label": "Primary Status"
                              },
                              {
                                "columnId": "SecondaryStatus",
                                "label": "Secondary Status"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Count (Storage accounts)",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "PrimaryStatus",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": false
                          },
                          "textSettings": {
                            "style": "bignumber"
                          }
                        },
                        "customWidth": "40",
                        "name": "Storage Account  by State",
                        "styleSettings": {
                          "margin": "10px"
                        }
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<hr>"
                        },
                        "name": "text - 7"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "a0373635-ad8d-4770-82bf-a6b6acc47a88",
                              "version": "KqlParameterItem/1.0",
                              "name": "Resources",
                              "label": "Storage accounts",
                              "type": 5,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "where type =~ 'microsoft.storage/storageaccounts'\r\n| order by name asc\r\n| extend Rank = row_number()\r\n| project value = id, label = id, selected = Rank <= 5",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "resourceTypeFilter": {
                                  "microsoft.storage/storageaccounts": true
                                },
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": null
                            },
                            {
                              "id": "34ecbb4e-158f-409d-8074-1c408be01c42",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "type": 4,
                              "isRequired": true,
                              "value": {
                                "durationMs": 604800000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "id": "bcd653bc-bc9d-49d2-b70d-9d4ed5174f8f",
                              "version": "KqlParameterItem/1.0",
                              "name": "Message",
                              "type": 1,
                              "query": "where type == 'microsoft.storage/storageaccounts' \r\n| summarize Selected = countif(id in ({Resources:value})), Total = count()\r\n| extend Selected = iff(Selected > 200, 200, Selected)\r\n| project Message = strcat('# ', Selected, ' / ', Total)",
                              "crossComponentResources": [
                                "{Subscriptions}"
                              ],
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "16a97aee-d216-46c6-8ebd-5d14acb1fcff",
                              "version": "KqlParameterItem/1.0",
                              "name": "ResourceName",
                              "type": 1,
                              "isRequired": true,
                              "isHiddenWhenLocked": true,
                              "criteriaData": [
                                {
                                  "criteriaContext": {
                                    "operator": "Default",
                                    "resultValType": "static",
                                    "resultVal": "Storage account"
                                  }
                                }
                              ],
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "parameters - Blob Overview"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbookccea5694-99c5-4e38-8b61-011c07d379f3",
                          "version": "MetricsItem/2.0",
                          "size": 3,
                          "chartType": 0,
                          "resourceType": "microsoft.storage/storageaccounts",
                          "metricScope": 0,
                          "resourceParameter": "Resources",
                          "resourceIds": [
                            "{Resources}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 604800000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.storage/storageaccounts",
                              "metric": "microsoft.storage/storageaccounts-Capacity-UsedCapacity",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.storage/storageaccounts/blobservices",
                              "metric": "microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.storage/storageaccounts/fileservices",
                              "metric": "microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.storage/storageaccounts/queueservices",
                              "metric": "microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.storage/storageaccounts/tableservices",
                              "metric": "microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity",
                              "aggregation": 4
                            }
                          ],
                          "title": "Storage Capacity Overview",
                          "resourceLimit": 10000,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "subTarget": "insights",
                                  "linkIsContextBlade": true,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": true,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts-Capacity-UsedCapacity$|microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity$|microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity$|microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity$|microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity$",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "linkColumn": "Name",
                                  "linkTarget": "WorkbookTemplate",
                                  "workbookContext": {
                                    "componentIdSource": "column",
                                    "componentId": "Name",
                                    "resourceIdsSource": "column",
                                    "resourceIds": "Name",
                                    "templateIdSource": "static",
                                    "templateId": "Community-Workbooks/Individual Storage/Capacity",
                                    "typeSource": "static",
                                    "type": "workbook",
                                    "gallerySource": "static",
                                    "gallery": "microsoft.storage/storageaccounts",
                                    "locationSource": "default"
                                  }
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts-Capacity-UsedCapacity Timeline",
                                "formatter": 21,
                                "formatOptions": {
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "blue",
                                  "workbookContext": {
                                    "componentIdSource": "column",
                                    "componentId": "Name",
                                    "resourceIdsSource": "column",
                                    "resourceIds": "Name",
                                    "templateIdSource": "static",
                                    "templateId": "Community-Workbooks/Individual Storage/Capacity",
                                    "typeSource": "static",
                                    "type": "workbook",
                                    "gallerySource": "static",
                                    "gallery": "microsoft.storage/storageaccounts",
                                    "locationSource": "default"
                                  }
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity Timeline",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Subscription"
                              ],
                              "expandTopLevel": true
                            },
                            "labelSettings": [
                              {
                                "columnId": "Subscription",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "Name",
                                "label": "Storage Name"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts-Capacity-UsedCapacity",
                                "label": "Used capacity (Average)"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts-Capacity-UsedCapacity Timeline",
                                "label": "Used capacity Timeline"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity",
                                "label": "Blob Capacity (Average)"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity Timeline",
                                "label": "Blob Capacity Timeline"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity",
                                "label": "File Capacity (Average)"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity Timeline",
                                "label": "File Capacity Timeline"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity",
                                "label": "Queue Capacity (Average)"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity Timeline",
                                "label": "Queue Capacity Timeline"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity",
                                "label": "Table Capacity (Average)"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity Timeline",
                                "label": "Table Capacity Timeline"
                              }
                            ]
                          },
                          "sortBy": [],
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all"
                        },
                        "name": "metric - Storage Capacity Overview"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook14690fcf-55b7-484e-8efd-8df92c6a6446",
                          "version": "MetricsItem/2.0",
                          "size": 3,
                          "chartType": 0,
                          "resourceType": "microsoft.storage/storageaccounts",
                          "metricScope": 0,
                          "resourceParameter": "Resources",
                          "resourceIds": [
                            "{Resources}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 604800000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.storage/storageaccounts",
                              "metric": "microsoft.storage/storageaccounts-Transaction-Transactions",
                              "aggregation": 1
                            },
                            {
                              "namespace": "microsoft.storage/storageaccounts",
                              "metric": "microsoft.storage/storageaccounts-Transaction-SuccessE2ELatency",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.storage/storageaccounts",
                              "metric": "microsoft.storage/storageaccounts-Transaction-Ingress",
                              "aggregation": 1
                            },
                            {
                              "namespace": "microsoft.storage/storageaccounts",
                              "metric": "microsoft.storage/storageaccounts-Transaction-Egress",
                              "aggregation": 1
                            }
                          ],
                          "title": "Blob Perfomance Metrics",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": true,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts-Transaction-Transactions",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 17,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts-Transaction-Transactions Timeline",
                                "formatter": 21,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue"
                                }
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts-Transaction-SuccessE2ELatency",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 23,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts-Transaction-SuccessE2ELatency Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts-Transaction-Ingress",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts-Transaction-Ingress Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts-Transaction-Egress",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.storage/storageaccounts-Transaction-Egress Timeline",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Subscription"
                              ],
                              "expandTopLevel": true
                            },
                            "sortBy": [
                              {
                                "itemKey": "$gen_heatmap_microsoft.storage/storageaccounts-Transaction-Transactions_3",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Subscription",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "Name",
                                "label": "Storage Name"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts-Transaction-Transactions",
                                "label": "Transactions (Sum)"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts-Transaction-Transactions Timeline",
                                "label": "Transactions Timeline"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts-Transaction-SuccessE2ELatency",
                                "label": "Success E2E Latency (Average)"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts-Transaction-SuccessE2ELatency Timeline",
                                "label": "Success E2E Latency Timeline"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts-Transaction-Ingress",
                                "label": "Ingress (Sum)"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts-Transaction-Ingress Timeline",
                                "label": "Ingress Timeline"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts-Transaction-Egress",
                                "label": "Egress (Sum)"
                              },
                              {
                                "columnId": "microsoft.storage/storageaccounts-Transaction-Egress Timeline",
                                "label": "Egress Timeline"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_heatmap_microsoft.storage/storageaccounts-Transaction-Transactions_3",
                              "sortOrder": 1
                            }
                          ],
                          "showExportToExcel": true
                        },
                        "name": "metric - Overview"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.storage/storageaccounts\"\r\n\r\n| project id,  sku=sku.name, Tier=sku.tier, status= tostring(properties.provisioningState), Create_Time=tostring(properties.creationTime), supportsHttpsTrafficOnly=tostring(properties.supportsHttpsTrafficOnly), allowBlobPublicAccess=tostring(properties.allowBlobPublicAccess),minimumTlsVersion=tostring(properties.minimumTlsVersion), Primary_Region=tostring(properties.primaryLocation), statusOfPrimary=tostring(properties.statusOfPrimary), accessTier=tostring(properties.accessTier) ,Secondary_Available=tostring(properties.secondaryLocation), Secondary_Status=tostring(properties.statusOfSecondary), PrivateEndPoint=tostring(properties.privateEndpointConnections)",
                          "size": 3,
                          "title": "Storage Account List",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "supportsHttpsTrafficOnly",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "true",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "false",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "allowBlobPublicAccess",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "true",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "false",
                                      "representation": "Resolved",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "minimumTlsVersion",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "TLS1_2",
                                      "representation": "Resolved",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "TLS1_0",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "TLS1_1",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "accessTier",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Hot",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Cold",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Secondary_Available",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "thresholdValue": "\"\"",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Secondary_Status",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "available",
                                      "representation": "Available",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "PrivateEndPoint",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "[]",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": ""
                                    }
                                  ]
                                }
                              }
                            ],
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "id",
                                "label": "Name"
                              },
                              {
                                "columnId": "sku",
                                "label": "SKU"
                              },
                              {
                                "columnId": "Create_Time",
                                "label": "Creation TIme"
                              },
                              {
                                "columnId": "supportsHttpsTrafficOnly",
                                "label": "Support HTTPS Traffuc Only"
                              },
                              {
                                "columnId": "allowBlobPublicAccess",
                                "label": "Allow Blob Public Access"
                              },
                              {
                                "columnId": "minimumTlsVersion",
                                "label": "Minimum TLS Version"
                              },
                              {
                                "columnId": "Primary_Region",
                                "label": "Perimary Region"
                              },
                              {
                                "columnId": "statusOfPrimary",
                                "label": "Status of Primary"
                              },
                              {
                                "columnId": "accessTier",
                                "label": "Access Tier"
                              },
                              {
                                "columnId": "Secondary_Available",
                                "label": "Secondary Available"
                              },
                              {
                                "columnId": "Secondary_Status",
                                "label": "Seconday Status"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "name": "Storage Account List"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.storage/storageaccounts\"\r\n| mv-expand privatepoint=properties.privateEndpointConnections\r\n| project id,   PrivateEndPoint=privatepoint.name",
                          "size": 3,
                          "title": "Storage Account  Private Endpoint",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "supportsHttpsTrafficOnly",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "true",
                                      "representation": "1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "false",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "allowBlobPublicAccess",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "true",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "false",
                                      "representation": "Resolved",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "minimumTlsVersion",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "TLS1_2",
                                      "representation": "Resolved",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "!=",
                                      "thresholdValue": "TLS1_2",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "15ch"
                                }
                              }
                            ],
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "id",
                                "label": "Name"
                              },
                              {
                                "columnId": "PrivateEndPoint",
                                "label": "Private End Point"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "name": "Storage Account with Private Endpoint"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "storageaccount"
                  },
                  "name": "Storage Account"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type has 'microsoft.web' or type has 'microsoft.automation' or  type has 'microsoft.logic' or type has 'microsoft.web/customapis'\r\n           or type =~ 'microsoft.apimanagement/service'\r\n           or type =~ 'microsoft.network/frontdoors'\r\n           or type =~ 'microsoft.network/applicationgateways'\r\n           or type =~ 'microsoft.appconfiguration/configurationstores'\r\n| extend type = case(\r\n           type == 'microsoft.web/serverfarms', \"App Service Plans\",\r\n           kind == 'functionapp', \"Azure Functions\",\r\n           kind == \"api\", \"API Apps\",\r\n           type =~ 'microsoft.automation/automationaccounts', 'Automation Accounts',\r\n           type == 'microsoft.web/sites', \"App Services\",\r\n           type =~ 'microsoft.network/applicationgateways', 'App Gateways',\r\ntype =~ 'microsoft.network/frontdoors', 'Front Door',\r\n           type =~ 'microsoft.apimanagement/service', 'API Management',\r\n           type =~ 'microsoft.web/certificates', 'App Certificates',\r\n           type =~ 'microsoft.appconfiguration/configurationstores', 'App Config Stores',\r\n           type =~ 'microsoft.web/connections', 'LogicApp Connectors',\r\n\ttype =~ 'microsoft.web/customapis','LogicApp API Connectors',\r\n\ttype =~ 'microsoft.logic/workflows','LogicApps',\r\n    type =~ 'microsoft.logic/integrationaccounts', 'Integration Accounts',\r\n\ttype =~ 'microsoft.automation/automationaccounts/runbooks', 'Automation Runbooks',\r\n    type =~ 'microsoft.automation/automationaccounts/configurations', 'Automation Configurations',\r\n           strcat(\"Not Translated: \", type))\r\n           \r\n\r\n\r\n\r\n\r\n| where type !has \"Not Translated\"\r\n| summarize count() by type",
                                "size": 3,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "showBorder": false,
                                  "titleContent": {
                                    "columnMatch": "type",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "count_",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "customWidth": "70",
                              "name": "query - 0",
                              "styleSettings": {
                                "padding": "3px"
                              }
                            }
                          ]
                        },
                        "customWidth": "70",
                        "name": "App Service Overview -1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "where type == \"microsoft.web/sites\"\r\n| summarize SiteCount=count() by Status=tostring(properties.state) \r\n| order by SiteCount desc\r\n|extend ['Count (AppService Apps)']=SiteCount\r\n| project Status, ['Count (AppService Apps)']",
                          "size": 4,
                          "title": "AppService Apps",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "Status",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "Count (AppService Apps)",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "30",
                        "name": "query - 13"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.web/serverfarms\"\r\n| extend  planId=tolower(tostring(id)),skuname = tostring(sku.name) , skutier = tostring(sku.tier), workers=tostring(properties.numberOfWorkers),webRG=resourceGroup,maxworkers=tostring(properties.maximumNumberOfWorkers), SubscriptionName=subscriptionId\r\n\r\n| where skutier !in('Basic','Free','Shared')\r\n| project planId, name, skuname, skutier, workers, maxworkers, webRG, SubscriptionName\r\n| join kind=leftouter (resources | where type ==\"microsoft.insights/autoscalesettings\" | project planId=tolower(tostring(properties.targetResourceUri)), PredictiveAutoscale=properties.predictiveAutoscalePolicy.scaleMode, AutoScaleProfiles=properties.profiles,resourceGroup) on planId\r\n| summarize ['Disabled'] = countif(isempty(AutoScaleProfiles))",
                          "size": 4,
                          "title": "Apps Without Autoscaling",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "Disabled",
                              "formatter": 12,
                              "formatOptions": {
                                "max": 0,
                                "palette": "red"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "30",
                        "name": "query - AppServiceplandetails - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.web/serverfarms\"\r\n| extend  planId=tolower(tostring(id)),skuname = tostring(sku.name) , skutier = tostring(sku.tier), workers=tostring(properties.numberOfWorkers),webRG=resourceGroup,maxworkers=tostring(properties.maximumNumberOfWorkers), SubscriptionName=subscriptionId\r\n| project planId, name, skuname, skutier, workers, maxworkers, webRG, SubscriptionName\r\n| where skutier startswith \"Premium\" and toint(workers) <= 1\r\n| where skutier in ('Premium', 'PremiumV2', 'ElasticPremium', 'PremiumV3') and toint(workers) <= 1\r\n| summarize count()\r\n",
                          "size": 4,
                          "title": "Premium App Service Plans with 1 app",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              }
                            },
                            "rightContent": {
                              "columnMatch": "Enabled",
                              "formatter": 12,
                              "formatOptions": {
                                "max": 1,
                                "palette": "green"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "30",
                        "name": "query - AppServiceplandetails - Copy - Copy"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<hr>"
                        },
                        "name": "text - 6"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ 'microsoft.insights/components'\r\n| extend RetentionInDays = properties.RetentionInDays\r\n| extend IngestionMode = properties.IngestionMode\r\n| extend Details = pack_all()\r\n| project Resource=id, location, resourceGroup, subscriptionId, IngestionMode, RetentionInDays, Details\r\n| summarize c = count()\r\n| extend Item = \"Application Insights\",  Key = 1",
                                "size": 3,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Item"
                                  },
                                  "leftContent": {
                                    "columnMatch": "c",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    }
                                  },
                                  "showBorder": false,
                                  "size": "auto"
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "customWidth": "25",
                              "name": "query - 3"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ 'microsoft.insights/components'\r\n| extend RetentionInDays = properties.RetentionInDays\r\n| extend IngestionMode = properties.IngestionMode\r\n| extend Details = pack_all()\r\n| project Resource=id, location, resourceGroup, IngestionMode, RetentionInDays",
                                "size": 3,
                                "title": "Applicaiton Insights",
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "gridSettings": {
                                  "filter": true,
                                  "labelSettings": [
                                    {
                                      "columnId": "resourceGroup",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "IngestionMode",
                                      "label": "Ingestion Mode"
                                    },
                                    {
                                      "columnId": "RetentionInDays",
                                      "label": "Retention(Days)"
                                    }
                                  ]
                                }
                              },
                              "customWidth": "75",
                              "name": "query - 4"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "Detailed View",
                                "style": "info"
                              },
                              "name": "text - 5"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type has 'microsoft.web'\r\n           or type =~ 'microsoft.apimanagement/service'\r\n           or type =~ 'microsoft.network/frontdoors'\r\n           or type =~ 'microsoft.network/applicationgateways'\r\n           or type =~ 'microsoft.appconfiguration/configurationstores'\r\n| extend type = case(\r\n           type == 'microsoft.web/serverfarms', \"App Service Plans\",\r\n           kind == 'functionapp', \"Azure Functions\",\r\n           kind == \"api\", \"API Apps\",\r\n           type == 'microsoft.web/sites', \"App Services\",\r\n           type =~ 'microsoft.network/applicationgateways', 'App Gateways',\r\n           type =~ 'microsoft.network/frontdoors', 'Front Door',\r\n           type =~ 'microsoft.apimanagement/service', 'API Management',\r\n           type =~ 'microsoft.web/certificates', 'App Certificates',\r\n           type =~ 'microsoft.appconfiguration/configurationstores', 'App Config Stores',\r\n           strcat(\"Not Translated: \", type))\r\n| where type !has \"Not Translated\"\r\n| extend Sku = case(\r\n           type =~ 'App Gateways', properties.sku.name,\r\n           type =~ 'Azure Functions', properties.sku,\r\n           type =~ 'API Management', sku.name,\r\n           type =~ 'App Service Plans', sku.name,\r\n           type =~ 'App Services', properties.sku,\r\n           type =~ 'App Config Stores', sku.name,\r\n           ' ')\r\n| extend State = case(\r\n           type =~ 'App Config Stores', properties.provisioningState,\r\n           type =~ 'App Service Plans', properties.status,\r\n           type =~ 'Azure Functions', properties.enabled,\r\n           type =~ 'App Services', properties.state,\r\n           type =~ 'API Management', properties.provisioningState,\r\n           type =~ 'App Gateways', properties.provisioningState,\r\n           type =~ 'Front Door', properties.provisioningState,\r\n           ' ')\r\n| mv-expand publicIpId=properties.frontendIPConfigurations\r\n| mv-expand publicIpId = publicIpId.properties.publicIPAddress.id\r\n| extend publicIpId = tostring(publicIpId)\r\n           | join kind=leftouter(\r\n               Resources\r\n               | where type =~ 'microsoft.network/publicipaddresses'\r\n               | project publicIpId = id, publicIpAddress = tostring(properties.ipAddress))\r\n               on publicIpId\r\n| extend PublicIP = case(\r\n           type =~ 'API Management', properties.publicIPAddresses,\r\n           type =~ 'App Gateways', publicIpAddress,\r\n           ' ')\r\n| extend Details = pack_all()\r\n| project Resource=id, type, subscriptionId, Sku, State, PublicIP",
                                "size": 3,
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "gridSettings": {
                                  "filter": true,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "type"
                                    ]
                                  },
                                  "sortBy": [
                                    {
                                      "itemKey": "$gen_link_Resource_1",
                                      "sortOrder": 1
                                    }
                                  ],
                                  "labelSettings": [
                                    {
                                      "columnId": "type",
                                      "label": "Type"
                                    },
                                    {
                                      "columnId": "subscriptionId",
                                      "label": "Subscription ID"
                                    },
                                    {
                                      "columnId": "Sku",
                                      "label": "SKU"
                                    },
                                    {
                                      "columnId": "PublicIP",
                                      "label": "Public IP"
                                    }
                                  ]
                                },
                                "sortBy": [
                                  {
                                    "itemKey": "$gen_link_Resource_1",
                                    "sortOrder": 1
                                  }
                                ]
                              },
                              "name": "query - 4"
                            }
                          ]
                        },
                        "name": "Appication Insights Summary"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Web Apps",
                          "style": "info"
                        },
                        "name": "text - 5"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' \r\n    | extend SubscriptionName=name \r\n    | join \t( resources | where type =~ 'Microsoft.Web/sites' \r\n    | extend WebAppId=id, WebAppRG=resourceGroup, WebAppName=name, AppServicePlan=tostring(properties.serverFarmId), SKU=tostring(properties.sku), Type=kind, Status=tostring(properties.state), WebAppLocation=location) on subscriptionId\r\n    | order by WebAppId asc \r\n    | project WebAppId,WebAppName, Type, Status, WebAppLocation, AppServicePlan, WebAppRG,SubscriptionName",
                                "size": 3,
                                "title": "WebApps Status",
                                "noDataMessage": "Sucess",
                                "showExportToExcel": true,
                                "exportToExcelOptions": "all",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "SelectedTab",
                                "comparison": "isEqualTo",
                                "value": "Never"
                              },
                              "name": "query - WebFunctionStatus"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type == \"microsoft.web/serverfarms\"\r\n| extend  skuname = tostring(sku.name) , skutier = tostring(sku.tier), workers=tostring(properties.numberOfWorkers), \r\nmaxworkers=tostring(properties.maximumNumberOfWorkers)\r\n| project id,name,skuname,skutier,workers, maxworkers",
                                "size": 3,
                                "noDataMessageStyle": 3,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "SelectedTab",
                                "comparison": "isEqualTo",
                                "value": "Never"
                              },
                              "name": "query - AppServiceplandetails"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources \r\n| where type ==\"microsoft.insights/autoscalesettings\" \r\n| project id=properties.targetResourceUri, PredictiveAutoscale=properties.predictiveAutoscalePolicy.scaleMode, AutoScaleProfiles=properties.profiles",
                                "size": 3,
                                "title": "query - AutoScaleDetails",
                                "noDataMessageStyle": 3,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "SelectedTab",
                                "comparison": "isEqualTo",
                                "value": "Never"
                              },
                              "name": "query - AutoScaleDetails"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"e65e5991-8cf6-4d4d-b0b7-75b1ce30803e\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - WebFunctionStatus\",\"rightTable\":\"query - AppServiceplandetails\",\"leftColumn\":\"AppServicePlan\",\"rightColumn\":\"id\"},{\"id\":\"71f6b336-0f07-4a5b-a795-ffdb0f1cb08a\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - AppServiceplandetails\",\"rightTable\":\"query - AutoScaleDetails\",\"leftColumn\":\"id\",\"rightColumn\":\"id\"}],\"projectRename\":[{\"originalName\":\"[query - WebFunctionStatus].WebAppId\",\"mergedName\":\"WebAppId\",\"fromId\":\"e65e5991-8cf6-4d4d-b0b7-75b1ce30803e\"},{\"originalName\":\"[query - WebFunctionStatus].WebAppRG\",\"mergedName\":\"WebAppRG\",\"fromId\":\"e65e5991-8cf6-4d4d-b0b7-75b1ce30803e\"},{\"originalName\":\"[query - WebFunctionStatus].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"e65e5991-8cf6-4d4d-b0b7-75b1ce30803e\"},{\"originalName\":\"[query - WebFunctionStatus].Status\",\"mergedName\":\"Status\",\"fromId\":\"e65e5991-8cf6-4d4d-b0b7-75b1ce30803e\"},{\"originalName\":\"[query - WebFunctionStatus].WebAppLocation\",\"mergedName\":\"WebAppLocation\",\"fromId\":\"e65e5991-8cf6-4d4d-b0b7-75b1ce30803e\"},{\"originalName\":\"[query - WebFunctionStatus].Type\",\"mergedName\":\"Type\",\"fromId\":\"e65e5991-8cf6-4d4d-b0b7-75b1ce30803e\"},{\"originalName\":\"[query - WebFunctionStatus].AppServicePlan\",\"mergedName\":\"AppServicePlan\",\"fromId\":\"e65e5991-8cf6-4d4d-b0b7-75b1ce30803e\"},{\"originalName\":\"[query - AppServiceplandetails].skuname\",\"mergedName\":\"skuname\",\"fromId\":\"e65e5991-8cf6-4d4d-b0b7-75b1ce30803e\"},{\"originalName\":\"[query - AppServiceplandetails].workers\",\"mergedName\":\"workers\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].maxworkers\",\"mergedName\":\"maxworkers\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].skutier\",\"mergedName\":\"skutier\",\"fromId\":\"e65e5991-8cf6-4d4d-b0b7-75b1ce30803e\"},{\"originalName\":\"[query - WebFunctionStatus].WebAppName\",\"mergedName\":\"WebAppName\",\"fromId\":\"e65e5991-8cf6-4d4d-b0b7-75b1ce30803e\"},{\"originalName\":\"[query - AppServiceplandetails].name\",\"mergedName\":\"name\",\"fromId\":\"e65e5991-8cf6-4d4d-b0b7-75b1ce30803e\"},{\"originalName\":\"[query - AppServiceplandetails].id\"},{\"originalName\":\"[query - AutoScaleDetails].id\"},{\"originalName\":\"[query - AutoScaleDetails].PredictiveAutoscale\"},{\"originalName\":\"[query - AutoScaleDetails].AutoScaleProfiles\"}]}",
                                "size": 3,
                                "noDataMessage": "No Web apps found",
                                "showExportToExcel": true,
                                "exportToExcelOptions": "all",
                                "queryType": 7,
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "Status",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Running",
                                            "representation": "Available",
                                            "text": ""
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Stopped",
                                            "representation": "disabled",
                                            "text": "Stopped"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "success",
                                            "text": "Running"
                                          }
                                        ]
                                      }
                                    }
                                  ],
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "name"
                                    ],
                                    "expandTopLevel": true
                                  },
                                  "labelSettings": [
                                    {
                                      "columnId": "WebAppId",
                                      "label": "WebApp ID"
                                    },
                                    {
                                      "columnId": "WebAppRG",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "SubscriptionName",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "WebAppLocation",
                                      "label": "Location"
                                    },
                                    {
                                      "columnId": "AppServicePlan",
                                      "label": "App Service Plan"
                                    },
                                    {
                                      "columnId": "skuname",
                                      "label": "SKU"
                                    },
                                    {
                                      "columnId": "workers",
                                      "label": "Workers"
                                    },
                                    {
                                      "columnId": "maxworkers",
                                      "label": "Max Workers"
                                    },
                                    {
                                      "columnId": "skutier",
                                      "label": "SKU Tier"
                                    },
                                    {
                                      "columnId": "WebAppName",
                                      "label": "WebApp Name"
                                    },
                                    {
                                      "columnId": "name",
                                      "label": "Name"
                                    }
                                  ]
                                }
                              },
                              "showPin": false,
                              "name": "query - 3"
                            }
                          ]
                        },
                        "name": "Group WebApps"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type has 'microsoft.automation'\r\n\t or type has 'microsoft.logic'\r\n\t or type has 'microsoft.web/customapis'\r\n| extend type = case(\r\n\ttype =~ 'microsoft.automation/automationaccounts', 'Automation Accounts',\r\n\ttype =~ 'microsoft.web/connections', 'LogicApp Connectors',\r\n\ttype =~ 'microsoft.web/customapis','LogicApp API Connectors',\r\n\ttype =~ 'microsoft.logic/workflows','LogicApps',\r\n    type =~ 'microsoft.logic/integrationaccounts', 'Integration Accounts',\r\n\ttype =~ 'microsoft.automation/automationaccounts/runbooks', 'Automation Runbooks',\r\n\ttype =~ 'microsoft.automation/automationaccounts/configurations', 'Automation Configurations',\r\n\tstrcat(\"Not Translated: \", type))\r\n| extend RunbookType = tostring(properties.runbookType)\r\n| extend LogicAppTrigger = properties.definition.triggers\r\n| extend LogicAppTrigger = iif(type =~ 'LogicApps', case(\r\n\tLogicAppTrigger has 'manual', tostring(LogicAppTrigger.manual.type),\r\n\tLogicAppTrigger has 'Recurrence', tostring(LogicAppTrigger.Recurrence.type),\r\n    LogicAppTrigger has 'When_an_Azure_Security_Center_Alert', 'Azure Security Center Alert',\r\n    LogicAppTrigger has 'When_an_Azure_Security_Center_Recommendation', 'Azure Security Center Recommendation',\r\n    LogicAppTrigger has 'When_a_response_to_an_Azure_Sentinel_alert', 'Azure Sentinel Alert',\r\n    LogicAppTrigger has 'When_Azure_Sentinel_incident_creation', 'Azure Sentinel Incident',\r\n\tstrcat(\"Unknown Trigger type\", LogicAppTrigger)), LogicAppTrigger)\r\n| extend State = case(\r\n\ttype =~ 'Automation Runbooks', properties.state, \r\n\ttype =~ 'LogicApps', properties.state,\r\n\ttype =~ 'Automation Accounts', properties.state,\r\n\ttype =~ 'Automation Configurations', properties.state,\r\n\t' ')\r\n| extend CreatedDate = case(\r\n\ttype =~ 'Automation Runbooks', properties.creationTime, \r\n\ttype =~ 'LogicApps', properties.createdTime,\r\n\ttype =~ 'Automation Accounts', properties.creationTime,\r\n\ttype =~ 'Automation Configurations', properties.creationTime,\r\n\t' ')\r\n| extend LastModified = case(\r\n\ttype =~ 'Automation Runbooks', properties.lastModifiedTime, \r\n\ttype =~ 'LogicApps', properties.changedTime,\r\n\ttype =~ 'Automation Accounts', properties.lastModifiedTime,\r\n\ttype =~ 'Automation Configurations', properties.lastModifiedTime,\r\n\t' ')\r\n| extend Details = pack_all()\r\n| project Resource=id, subscriptionId, type, resourceGroup, RunbookType, LogicAppTrigger, State, Details",
                          "size": 2,
                          "noDataMessage": "No resources found",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Resource",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Details",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "CellDetails",
                                  "linkLabel": "🔍 View Details",
                                  "linkIsContextBlade": true
                                }
                              }
                            ],
                            "rowLimit": 1000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "subscriptionId"
                              ],
                              "expandTopLevel": true,
                              "finalBy": "Resource"
                            }
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "type",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true,
                            "sortCriteriaField": "type",
                            "sortOrderField": 1
                          }
                        },
                        "name": "query - PaaS - Automation Detailed",
                        "styleSettings": {
                          "padding": "0 0 200px 0"
                        }
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "appservices"
                  },
                  "name": "App Services"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "template",
                    "loadFromTemplateId": "",
                    "items": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "appgateway"
                  },
                  "name": "Application Gateway"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.network/loadbalancers\"\r\n| project id, name = tostring(sku.name), tier = tostring(sku.tier)\r\n| summarize count() by name",
                          "size": 1,
                          "title": "Azure Load Balancer Overview",
                          "noDataMessage": "No Azure Load Balancer found in selected subscription.",
                          "exportToExcelOptions": "all",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "vmsize",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "vmsize",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "count_",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "v2",
                                "label": "Application GW V2"
                              },
                              {
                                "seriesName": "v1",
                                "label": "Application GW V1"
                              }
                            ]
                          }
                        },
                        "customWidth": "25",
                        "name": " Azure Load Balancer Overview"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.network/loadbalancers\"\r\n| extend sku = tostring(sku.name)\r\n| mv-expand lbrules = properties.loadBalancingRules\r\n| mv-expand feip = properties.frontendIPConfigurations\r\n| mv-expand probes = properties.probes\r\n| project subscriptionId\r\n, id\r\n, resourceGroup\r\n, lbName=name\r\n, sku\r\n, location\r\n, rulename=tostring(lbrules.name)\r\n, frontendIP=tostring(feip.properties.privateIPAddress)\r\n, probeport=tostring(probes.properties.port)\r\n, HA_Ports= tostring(lbrules.properties.protocol)\r\n, rule_idleTimeoutMinutes=tostring(lbrules.properties.idleTimeoutInMinutes)\r\n, rule_isFloatingIPEnabled = tostring(lbrules.properties.enableFloatingIP)\r\n, rule_isTCP_ResetEnabled = tostring(lbrules.properties.enableTcpReset)\r\n, rule_loadDistribution = tostring(lbrules.properties.loadDistribution)\r\n| summarize by subscriptionId\r\n, id\r\n, lbName\r\n, resourceGroup\r\n, location\r\n, sku\r\n, rulename\r\n, frontendIP\r\n, probeport\r\n, HA_Ports\r\n, rule_idleTimeoutMinutes\r\n, rule_isFloatingIPEnabled\r\n, rule_isTCP_ResetEnabled\r\n, rule_loadDistribution",
                          "size": 1,
                          "title": "Standard Load Balancer Overview",
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "id",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": true,
                                  "showIcon": true,
                                  "customColumnWidthSetting": "25ch"
                                }
                              },
                              {
                                "columnMatch": "lbName",
                                "formatter": 5,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": true
                                }
                              },
                              {
                                "columnMatch": "resourceGroup",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "rulename",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "frontendIP",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10ch"
                                }
                              },
                              {
                                "columnMatch": "probeport",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10ch"
                                }
                              },
                              {
                                "columnMatch": "HA_Ports",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "All",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "!=",
                                      "thresholdValue": "All",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "rule_idleTimeoutMinutes",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10ch"
                                }
                              },
                              {
                                "columnMatch": "rule_isFloatingIPEnabled",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "true",
                                      "representation": "Available",
                                      "text": "Enabled"
                                    },
                                    {
                                      "operator": "!=",
                                      "thresholdValue": "true",
                                      "representation": "2",
                                      "text": "Review SAP Note 2743751"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "10ch"
                                }
                              },
                              {
                                "columnMatch": "rule_isTCP_ResetEnabled",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10ch"
                                }
                              },
                              {
                                "columnMatch": "rule_loadDistribution",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10ch"
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "subscriptionId",
                                "label": "Subscription Name"
                              },
                              {
                                "columnId": "id",
                                "label": "LB Name"
                              },
                              {
                                "columnId": "resourceGroup",
                                "label": "Resource Group"
                              },
                              {
                                "columnId": "location",
                                "label": "Azure Region"
                              },
                              {
                                "columnId": "sku",
                                "label": "LB SKU"
                              },
                              {
                                "columnId": "rulename",
                                "label": "LB Rule name"
                              },
                              {
                                "columnId": "frontendIP",
                                "label": "LB FrontEnd IP"
                              },
                              {
                                "columnId": "probeport",
                                "label": "LB Probe Port"
                              },
                              {
                                "columnId": "HA_Ports",
                                "label": "HA Ports"
                              },
                              {
                                "columnId": "rule_idleTimeoutMinutes",
                                "label": "LB Idle Timeout"
                              },
                              {
                                "columnId": "rule_isFloatingIPEnabled",
                                "label": "LB Floating IP"
                              },
                              {
                                "columnId": "rule_isTCP_ResetEnabled",
                                "label": "LB TCP Reset"
                              },
                              {
                                "columnId": "rule_loadDistribution",
                                "label": "LB Load Distribution"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "customWidth": "75",
                        "showPin": false,
                        "name": "Load Balancer Overview"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "173cfcd1-93dd-4eb1-9d1d-c8f10bc9973c",
                              "version": "KqlParameterItem/1.0",
                              "name": "Resources",
                              "label": "Load Balancer",
                              "type": 5,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "resources\r\n| where type == \"microsoft.network/loadbalancers\"\r\n| order by name asc\r\n| extend Rank = row_number()\r\n| project value = id, label = id, selected = Rank <= 5",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1",
                                  "value::3",
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::3",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": null
                            },
                            {
                              "id": "ee1d322c-ed49-4840-94eb-a4f32d098f71",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "type": 4,
                              "isRequired": true,
                              "value": {
                                "durationMs": 1800000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "Load Balancer"
                      },
                      {
                        "type": 10,
                        "content": {
                          "chartId": "workbook8642f436-3fbb-4a96-ba03-5c5d4b0edbad",
                          "version": "MetricsItem/2.0",
                          "size": 3,
                          "chartType": 0,
                          "resourceType": "microsoft.network/loadbalancers",
                          "metricScope": 0,
                          "resourceParameter": "Resources",
                          "resourceIds": [
                            "{Resources}"
                          ],
                          "timeContextFromParameter": "TimeRange",
                          "timeContext": {
                            "durationMs": 1800000
                          },
                          "metrics": [
                            {
                              "namespace": "microsoft.network/loadbalancers",
                              "metric": "microsoft.network/loadbalancers--VipAvailability",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.network/loadbalancers",
                              "metric": "microsoft.network/loadbalancers--DipAvailability",
                              "aggregation": 4
                            },
                            {
                              "namespace": "microsoft.network/loadbalancers",
                              "metric": "microsoft.network/loadbalancers--SnatConnectionCount",
                              "aggregation": 1
                            },
                            {
                              "namespace": "microsoft.network/loadbalancers",
                              "metric": "microsoft.network/loadbalancers--SYNCount",
                              "aggregation": 1
                            },
                            {
                              "namespace": "microsoft.network/loadbalancers",
                              "metric": "microsoft.network/loadbalancers--ByteCount",
                              "aggregation": 1
                            }
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Subscription",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": true,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/loadbalancers--VipAvailability",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/loadbalancers--VipAvailability Timeline",
                                "formatter": 10,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/loadbalancers--DipAvailability",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/loadbalancers--DipAvailability Timeline",
                                "formatter": 10,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/loadbalancers--SnatConnectionCount",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/loadbalancers--SnatConnectionCount Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.network/loadbalancers--SYNCount",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/loadbalancers--SYNCount Timeline",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "microsoft.network/loadbalancers--ByteCount",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": null
                                }
                              },
                              {
                                "columnMatch": "microsoft.network/loadbalancers--ByteCount Timeline",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Subscription"
                              ],
                              "expandTopLevel": true
                            },
                            "sortBy": [
                              {
                                "itemKey": "$gen_heatmap_microsoft.network/loadbalancers--VipAvailability_3",
                                "sortOrder": 2
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Subscription",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "Name",
                                "label": "Load Balancer Name"
                              },
                              {
                                "columnId": "microsoft.network/loadbalancers--VipAvailability",
                                "label": "Data Path Availability (Average)"
                              },
                              {
                                "columnId": "microsoft.network/loadbalancers--VipAvailability Timeline",
                                "label": "Data Path Availability (Average) Timeline"
                              },
                              {
                                "columnId": "microsoft.network/loadbalancers--DipAvailability",
                                "label": "Health Probe Status (Average)"
                              },
                              {
                                "columnId": "microsoft.network/loadbalancers--DipAvailability Timeline",
                                "label": "Health Probe Status (Average) Timeline"
                              },
                              {
                                "columnId": "microsoft.network/loadbalancers--SnatConnectionCount",
                                "label": "SNAT Connection Count (Sum)"
                              },
                              {
                                "columnId": "microsoft.network/loadbalancers--SnatConnectionCount Timeline",
                                "label": "SNAT Connection Count (Sum) Timeline"
                              },
                              {
                                "columnId": "microsoft.network/loadbalancers--SYNCount",
                                "label": "SYN Count (Sum)"
                              },
                              {
                                "columnId": "microsoft.network/loadbalancers--SYNCount Timeline",
                                "label": "SYN Count (Sum) Timeline"
                              },
                              {
                                "columnId": "microsoft.network/loadbalancers--ByteCount",
                                "label": "Byte Count (Sum)"
                              },
                              {
                                "columnId": "microsoft.network/loadbalancers--ByteCount Timeline",
                                "label": "Byte Count (Sum) Timeline"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_heatmap_microsoft.network/loadbalancers--VipAvailability_3",
                              "sortOrder": 2
                            }
                          ],
                          "showExportToExcel": true
                        },
                        "showPin": false,
                        "name": "Load Balancer Metrics"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "loadbalancer"
                  },
                  "name": "Load Balancer"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tabname",
              "comparison": "isEqualTo",
              "value": "PaaS"
            },
            "name": "PaaS"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "4fbb9e4e-972b-421e-bab1-330999ff1d16",
                        "cellValue": "backuptab",
                        "linkTarget": "parameter",
                        "linkLabel": "Overview",
                        "subTarget": "overview",
                        "style": "link"
                      },
                      {
                        "id": "bd1774ef-e6c9-477a-a8e1-81b3adaa527b",
                        "cellValue": "backuptab",
                        "linkTarget": "parameter",
                        "linkLabel": "VM Without Backup",
                        "subTarget": "compliance",
                        "style": "link"
                      },
                      {
                        "id": "68293d35-d2c4-4f77-90b7-8b7a4807a2f0",
                        "cellValue": "backuptab",
                        "linkTarget": "parameter",
                        "linkLabel": "Status",
                        "subTarget": "status",
                        "style": "link"
                      },
                      {
                        "id": "25429552-0a51-4d10-afe9-9609b583cf30",
                        "cellValue": "backuptab",
                        "linkTarget": "parameter",
                        "linkLabel": "Items",
                        "subTarget": "items",
                        "style": "link"
                      },
                      {
                        "id": "ec00dc7e-1a89-4dc3-a8a0-368a67dc4156",
                        "cellValue": "backuptab",
                        "linkTarget": "parameter",
                        "linkLabel": "Policies",
                        "subTarget": "policies",
                        "style": "link"
                      },
                      {
                        "id": "83afb441-60d9-47ea-9f8e-7bca3884b1a9",
                        "cellValue": "backuptab",
                        "linkTarget": "parameter",
                        "linkLabel": "Snapshot",
                        "subTarget": "snapshot",
                        "style": "link"
                      },
                      {
                        "id": "5a41bd94-f073-4ba3-82be-652b7c741e93",
                        "cellValue": "backuptab",
                        "linkTarget": "parameter",
                        "linkLabel": "Vaults",
                        "subTarget": "vault",
                        "style": "link"
                      },
                      {
                        "id": "ab06c206-ec09-463f-8b1b-ae08459d9424",
                        "cellValue": "backuptab",
                        "linkTarget": "parameter",
                        "linkLabel": "Alerts",
                        "subTarget": "alerts",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 8"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "2373a24f-ad32-4909-a7f6-59b373dcde6c",
                        "version": "KqlParameterItem/1.0",
                        "name": "Workspaces",
                        "type": 5,
                        "description": "LA Workspaces configured in vault diagnostic settings",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "where type =~ 'microsoft.operationalinsights/workspaces' | project id",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "defaultValue": "value::all",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "value": [
                          "value::all"
                        ]
                      },
                      {
                        "id": "64dd748f-d528-4912-a3bf-4a503e0b17f6",
                        "version": "KqlParameterItem/1.0",
                        "name": "VaultsUsingAzureDiagnostics",
                        "type": 1,
                        "query": "// function Params - Report Filters\r\nlet RangeStart = startofday(ago(3d));\r\nlet RangeEnd = startofday(now());\r\nlet VaultSubscriptionList = \"*\";\r\nlet VaultLocationList = \"*\"; \r\nlet VaultList = \"*\";\r\nlet VaultTypeList = \"*\";\r\nlet ExcludeLegacyEvent_1 = false;\r\nlet ExcludeLegacyEvent_2 = true;\r\n// calling LA System Function\r\n_AzureBackup_GetVaults(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent_1) | distinct Id\r\n| join kind = leftanti ( \r\n// calling LA System Function\r\n_AzureBackup_GetVaults(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent_2) | distinct Id) on Id\r\n| count ",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "d894d309-7e5f-488e-afde-73796c84b711",
                        "version": "KqlParameterItem/1.0",
                        "name": "AzureStorageCutOffDate",
                        "type": 1,
                        "description": "Cut-off Date To Enable AzureStorage",
                        "isRequired": true,
                        "query": "{\"version\":\"1.0.0\",\"content\":\"\\\"5/14/2020, 12:00:00.000 AM\\\"\",\"transformers\":null}",
                        "isHiddenWhenLocked": true,
                        "queryType": 8
                      },
                      {
                        "id": "4c2d9ddd-b67f-4903-893a-d71dfd39debc",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRange",
                        "label": "Time Range",
                        "type": 4,
                        "isRequired": true,
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 300000
                            },
                            {
                              "durationMs": 900000
                            },
                            {
                              "durationMs": 1800000
                            },
                            {
                              "durationMs": 3600000
                            },
                            {
                              "durationMs": 14400000
                            },
                            {
                              "durationMs": 43200000
                            },
                            {
                              "durationMs": 86400000
                            },
                            {
                              "durationMs": 172800000
                            },
                            {
                              "durationMs": 259200000
                            },
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ]
                        },
                        "value": {
                          "durationMs": 604800000
                        }
                      },
                      {
                        "id": "34106ae0-12e2-4a1d-a935-8cdf079fb70e",
                        "version": "KqlParameterItem/1.0",
                        "name": "ExcludeLegacyEvent",
                        "label": "Exclude Legacy Table",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                          "additionalResourceOptions": []
                        },
                        "jsonData": "[\r\n    { \"value\":\"True\",  \"selected\":true},\r\n    { \"value\":\"False\"}\r\n]"
                      }
                    ],
                    "style": "pills",
                    "doNotRunWhenHidden": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "backuptab",
                      "comparison": "isNotEqualTo",
                      "value": "vault"
                    },
                    {
                      "parameterName": "backuptab",
                      "comparison": "isNotEqualTo",
                      "value": "snapshot"
                    },
                    {
                      "parameterName": "backuptab",
                      "comparison": "isNotEqualTo",
                      "value": "alerts"
                    },
                    {
                      "parameterName": "backuptab",
                      "comparison": "isEqualTo",
                      "value": "policies"
                    },
                    {
                      "parameterName": "backuptab",
                      "comparison": "isNotEqualTo",
                      "value": "compliance"
                    },
                    {
                      "parameterName": "backuptab",
                      "comparison": "isNotEqualTo",
                      "value": "status"
                    }
                  ],
                  "name": "Overview-WorkspaceParameterBlock"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "parameters": [
                      {
                        "id": "8ce61d1d-e371-40bf-ad53-7ba78afb976f",
                        "version": "KqlParameterItem/1.0",
                        "name": "DatasourceType",
                        "label": "Backup Solution",
                        "type": 2,
                        "description": "Use to filter reports by backup solution",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "",
                        "delimiter": ",",
                        "value": [
                          "value::all"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "selectAllValue": "*",
                          "showDefault": false
                        },
                        "jsonData": "\r\n[    \r\n{ \"value\": \"Azure Backup Agent\", \t\t\t\t\t\t\"label\": \"Azure Backup Agent\" },\r\n{ \"value\": \"Azure Backup Server\", \t\t\t\"label\": \"Azure Backup Server\" },\r\n{ \"value\": \"Azure Storage (Azure Files) Backup\", \t\t\t\t\"label\": \"Azure Storage (Azure Files) Backup\" },\r\n{ \"value\": \"Azure Virtual Machine Backup\", \t\t\t\t\t\t\"label\": \"Azure Virtual Machine Backup\" },\r\n{ \"value\": \"DPM\", \t\t\t\t\t\t\"label\": \"DPM\" },\r\n{ \"value\": \"SAP HANA in Azure VM Backup\", \"label\": \"SAP HANA in Azure VM Backup\" },\r\n{ \"value\": \"SQL in Azure VM Backup\",     \"label\": \"SQL in Azure VM Backup\" }\r\n]"
                      },
                      {
                        "id": "678680e5-76b5-4db8-bbef-5f73942caf2e",
                        "version": "KqlParameterItem/1.0",
                        "name": "VaultSubscription",
                        "label": "Vault Subscription",
                        "type": 6,
                        "description": "Subscription(s) under which the vault(s) exist",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "",
                        "delimiter": ",",
                        "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = \"*\";\r\nlet VaultLocationList = \"*\";\r\nlet VaultList = \"*\";\r\nlet VaultTypeList = \"*\";\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = false;\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n// query to transform function output\r\n| distinct VaultSubscriptionId",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "selectAllValue": "*",
                          "showDefault": false
                        },
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "value": [
                          "value::all"
                        ]
                      },
                      {
                        "id": "2a83acc5-2123-476f-8a4c-da2fddf231a1",
                        "version": "KqlParameterItem/1.0",
                        "name": "VaultLocation",
                        "label": "Vault Location",
                        "type": 2,
                        "description": "Location(s) in which the vault(s) were created",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "",
                        "delimiter": ",",
                        "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = \"*\";\r\nlet VaultList = \"*\";\r\nlet VaultTypeList = \"*\";\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = false;\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n// query to transform function output\r\n| distinct VaultLocation",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "value": [
                          "value::all"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "selectAllValue": "*",
                          "showDefault": false
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "fefd31fa-2774-43ca-8cc3-44d477c969f0",
                        "version": "KqlParameterItem/1.0",
                        "name": "VaultName",
                        "label": "Vault Name",
                        "type": 2,
                        "description": "Name(s) of the vault(s)",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "",
                        "delimiter": ",",
                        "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultList = \"*\";\r\nlet VaultTypeList = \"*\";\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\n// calling LA System Function\r\n_AzureBackup_GetVaults(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent)\r\n// query to transform function output\r\n| distinct Name ",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "value": [
                          "value::all"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "selectAllValue": "*",
                          "showDefault": false
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "doNotRunWhenHidden": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "backuptab",
                      "comparison": "isNotEqualTo",
                      "value": "snapshot"
                    },
                    {
                      "parameterName": "backuptab",
                      "comparison": "isNotEqualTo",
                      "value": "vault"
                    },
                    {
                      "parameterName": "backuptab",
                      "comparison": "isNotEqualTo",
                      "value": "alerts"
                    },
                    {
                      "parameterName": "backuptab",
                      "comparison": "isNotEqualTo",
                      "value": "policies"
                    },
                    {
                      "parameterName": "backuptab",
                      "comparison": "isNotEqualTo",
                      "value": "compliance"
                    },
                    {
                      "parameterName": "backuptab",
                      "comparison": "isNotEqualTo",
                      "value": "status"
                    }
                  ],
                  "name": "Overview-ReportParameterBlock"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "parameters": [
                      {
                        "id": "3c5a3e26-bce4-43d9-a22d-e963a0d734af",
                        "version": "KqlParameterItem/1.0",
                        "name": "ResourceGroupId",
                        "type": 1,
                        "query": "resources | where type==\"microsoft.operationalinsights/workspaces\" | project name, resourceGroupId=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",resourceGroup) | where \"{Workspaces}\" contains name | project resourceGroupId | take 1",
                        "crossComponentResources": [
                          "{Subscriptions}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "897957ad-a946-4b3b-98f0-02008d30ff0f",
                        "version": "KqlParameterItem/1.0",
                        "name": "WorkspaceName",
                        "type": 1,
                        "query": "resources | where type==\"microsoft.operationalinsights/workspaces\" \r\n| project name, resourceGroupId=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",resourceGroup) \r\n| where \"{Workspaces}\" contains name \r\n| where \"{ResourceGroupId}\" has resourceGroupId\r\n| take 1\r\n",
                        "crossComponentResources": [
                          "{Subscriptions}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "version": "KqlParameterItem/1.0",
                        "name": "WorkspaceResourceGroup",
                        "type": 1,
                        "query": "resources | where type==\"microsoft.operationalinsights/workspaces\" \r\n| project name, resourceGroupId=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",resourceGroup), resourceGroup, subscriptionId \r\n| where \"{WorkspaceName}\" has name \r\n| where \"{ResourceGroupId}\" has resourceGroupId\r\n| take 1\r\n| project resourceGroup\r\n",
                        "crossComponentResources": [
                          "{Subscriptions}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "id": "75065a95-e81f-470f-805e-427558ee0ea3"
                      },
                      {
                        "version": "KqlParameterItem/1.0",
                        "name": "WorkspaceSubscriptionId",
                        "type": 1,
                        "query": "resources | where type==\"microsoft.operationalinsights/workspaces\" \r\n| project name, resourceGroupId=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",resourceGroup), resourceGroup, subscriptionId \r\n| where \"{WorkspaceName}\" has name \r\n| where \"{ResourceGroupId}\" has resourceGroupId\r\n| take 1\r\n| project subscriptionId\r\n",
                        "crossComponentResources": [
                          "{Subscriptions}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "id": "2581aa73-ab5f-4f2c-82f1-1b4d0f9708ad"
                      },
                      {
                        "id": "5327529a-bd07-4305-bf65-4b36a3c787b9",
                        "version": "KqlParameterItem/1.0",
                        "name": "LogicApp_VaultSubscriptionList",
                        "type": 1,
                        "query": "let VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nprint VaultSubscriptionList",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "e404488a-5db7-42ba-9b44-996f1d8cd7b2",
                        "version": "KqlParameterItem/1.0",
                        "name": "LogicApp_VaultLocationList",
                        "type": 1,
                        "query": "let VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nprint VaultLocationList",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "8005c310-7839-42ff-a3a4-01e5a6c45223",
                        "version": "KqlParameterItem/1.0",
                        "name": "LogicApp_VaultList",
                        "type": 1,
                        "query": "let VaultList = todynamic( @\"{VaultName}\"); \r\nprint VaultList",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "2e3d4cd7-7393-4cc4-ab9e-793311eb291c",
                        "version": "KqlParameterItem/1.0",
                        "name": "LogicApp_DatasourceTypeList",
                        "type": 1,
                        "query": "let DatasourceTypeList = @\"{DatasourceType}\";\r\nprint DatasourceTypeList",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "376631ff-44ae-4824-b470-ac32d82cd4f2",
                        "version": "KqlParameterItem/1.0",
                        "name": "LogicApp_ExcludeLegacyEvent",
                        "type": 1,
                        "query": "let ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nprint ExcludeLegacyEvent",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "5d1a9bc1-34ab-491d-bfa6-f7fc8402f3dc",
                        "version": "KqlParameterItem/1.0",
                        "name": "LogicApp_AggregationType",
                        "type": 1,
                        "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nprint AggregationType=iff(datetime_diff('day',RangeEnd,RangeStart)<=30,\"Daily\",iff(datetime_diff('day',RangeEnd,RangeStart)<=90,\"Weekly\",\"Monthly\"))\r\n\r\n\r\n\r\n\r\n\r\n",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "892dcb11-ee52-478b-aac2-10892fb837ae",
                        "version": "KqlParameterItem/1.0",
                        "name": "LogicApp_TimeRangeInDays",
                        "type": 1,
                        "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = startofday({TimeRange:end});\r\nprint TimeRangeInDays = datetime_diff('day',RangeEnd,RangeStart)\r\n\r\n",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "60",
                  "conditionalVisibility": {
                    "parameterName": "Workspaces",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Overview-ReportParameterBlock - Copy",
                  "styleSettings": {
                    "maxWidth": "100%"
                  }
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "parameters": [
                      {
                        "id": "a29464c3-34f0-4d60-82bb-614b8128b7f9",
                        "version": "KqlParameterItem/1.0",
                        "name": "UsageTab_BillingGroupName",
                        "label": "Search Billed Entity",
                        "type": 1,
                        "description": "Search by Billed Entity Name",
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "value": ""
                      }
                    ],
                    "style": "above",
                    "doNotRunWhenHidden": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "90",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "TabName",
                      "comparison": "isEqualTo",
                      "value": "Usage"
                    },
                    {
                      "parameterName": "Workspaces",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "DatasourceType",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "Usage-SearchParameterBlock",
                  "styleSettings": {
                    "margin": "0% 0% 0% 0%",
                    "padding": "0% 0% 0% 0%"
                  }
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "parameters": [
                      {
                        "id": "396c89aa-fd11-4736-8eb9-40c10a04be21",
                        "version": "KqlParameterItem/1.0",
                        "name": "AggregationType",
                        "type": 1,
                        "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nprint AggregationType=iff(datetime_diff('day',RangeEnd,RangeStart)<=30,\"Daily\",iff(datetime_diff('day',RangeEnd,RangeStart)<=90,\"Weekly\",\"Monthly\"))\r\n\r\n",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "AggregationTypeParam"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupjobs\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| where todatetime(properties.startTime) {TimeRange}\r\n| where properties.status != \"InProgress\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupJobs.*\",\"\",id))\r\n| extend SubText = \"Jobs\"\r\n| summarize c=count() by operation = tostring(properties.operation)\r\n| sort by operation asc",
                                "size": 4,
                                "title": "By Operation",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Workspaces}"
                                ],
                                "visualization": "piechart",
                                "chartSettings": {
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "Backup",
                                      "color": "green"
                                    },
                                    {
                                      "seriesName": "DeleteBackupData",
                                      "color": "red"
                                    },
                                    {
                                      "seriesName": "ConfigureBackup",
                                      "color": "blue"
                                    },
                                    {
                                      "seriesName": "Restore",
                                      "color": "greenDark"
                                    },
                                    {
                                      "seriesName": "DisableBackup",
                                      "color": "gray"
                                    }
                                  ]
                                }
                              },
                              "customWidth": "50",
                              "name": "By Operation"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupjobs\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| where todatetime(properties.startTime) {TimeRange}\r\n| where properties.status != \"InProgress\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupJobs.*\",\"\",id))\r\n| extend SubText = \"Jobs\"\r\n| summarize c=count() by status = tostring(properties.status)\r\n| sort by status asc\r\n",
                                "size": 4,
                                "title": "By Status",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Workspaces}"
                                ],
                                "visualization": "piechart",
                                "chartSettings": {
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "Completed",
                                      "color": "green"
                                    },
                                    {
                                      "seriesName": "Failed",
                                      "color": "redBright"
                                    },
                                    {
                                      "seriesName": "CompletedWithWarnings",
                                      "label": "Completed With Warnings",
                                      "color": "yellow"
                                    }
                                  ]
                                }
                              },
                              "customWidth": "33",
                              "name": "By Status"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList =  \"*\";\r\nlet Item_search =   \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = false;\r\nlet JobOperationList = \"*\";\r\nlet JobStatusList =  \"*\";\r\nlet JobFailureCodeList =  \"*\";\r\nlet ExcludeLog = True;\r\nlet BillingGroupName = \"*\";\r\n(\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| count | extend Dummy = 1\r\n) \r\n| join (\r\n// calling LA System Function\r\n_AzureBackup_GetBillingGroups(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, BillingGroupName) \r\n| summarize Sum_VaultStore_StorageConsumption_InGBs = sum(VaultStore_StorageConsumptionInMBs)/1024, sum_ProtectedInstanceCount = sum(todouble(parse_json(ExtendedProperties).ProtectedInstanceCount)) | extend Dummy = 1\r\n) on Dummy \r\n| join (\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog) \r\n| summarize dcount(UniqueId,4) | extend Dummy = 1\r\n) on Dummy \r\n| extend  Key = pack_array( \"Backup Instances\", \"Protected Instances\",  \"Cloud Storage (GB)\", \"Jobs Created\"), Value = pack_array( Count, sum_ProtectedInstanceCount, Sum_VaultStore_StorageConsumption_InGBs, dcount_UniqueId), \r\nSubTitle = pack_array( \"\", \"\", \"\", \"\")\r\n| project Key, Value, SubTitle \r\n| mvexpand Key, Value, SubTitle",
                                "size": 3,
                                "noDataMessage": "No records found for the selected time range and scope",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{Workspaces}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Key",
                                    "formatter": 1
                                  },
                                  "subtitleContent": {
                                    "columnMatch": "SubTitle",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "Value",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 0,
                                      "options": {
                                        "style": "decimal",
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                }
                              },
                              "name": "Summary-Tiles",
                              "styleSettings": {
                                "margin": "0% 0% 0% -15px"
                              }
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet BillingGroupName = @\"{UsageTab_BillingGroupName}\";\r\nlet AggregationType = @\"{AggregationType}\";\r\n// calling LA System Function\r\n_AzureBackup_GetBillingGroupsTrends(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, BillingGroupName, AggregationType)\r\n// query to transform function output\r\n| summarize StorageConsumedInGBs = sum(VaultStore_StorageConsumptionInMBs)/1024 by  startofday(TimeGenerated)",
                                "size": 0,
                                "aggregation": 5,
                                "title": "Cloud Storage Trend",
                                "noDataMessage": "No records found for the selected time range and scope",
                                "timeContextFromParameter": "TimeRange",
                                "showExportToExcel": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{Workspaces}"
                                ],
                                "visualization": "linechart",
                                "gridSettings": {
                                  "sortBy": [
                                    {
                                      "itemKey": "TimeGenerated",
                                      "sortOrder": 1
                                    }
                                  ]
                                },
                                "sortBy": [
                                  {
                                    "itemKey": "TimeGenerated",
                                    "sortOrder": 1
                                  }
                                ],
                                "chartSettings": {
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "StorageConsumedInMBs",
                                      "label": "Cloud Storage (MB)"
                                    },
                                    {
                                      "seriesName": "StorageConsumedInGBs",
                                      "label": "Cloud Storage (GB)"
                                    }
                                  ],
                                  "xSettings": {
                                    "unit": 17,
                                    "min": null,
                                    "max": null
                                  }
                                }
                              },
                              "showPin": true,
                              "name": "Usage-CloudStorageTrendGraph"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "<div style=\"text-align:left\"><span style=\"font-size:14px;font-weight:600;\">Key Parameters by Backup Solution </span> </div>"
                              },
                              "customWidth": "100",
                              "conditionalVisibilities": [
                                {
                                  "parameterName": "TabName",
                                  "comparison": "isEqualTo",
                                  "value": "Summary"
                                },
                                {
                                  "parameterName": "Workspaces",
                                  "comparison": "isNotEqualTo"
                                },
                                {
                                  "parameterName": "DatasourceType",
                                  "comparison": "isNotEqualTo"
                                }
                              ],
                              "name": "Summary-GridTitle1",
                              "styleSettings": {
                                "margin": "0% 0% 0% 0%"
                              }
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "<hr>"
                              },
                              "name": "text - 5"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList =  \"*\";\r\nlet Item_search =   \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = true;\r\nlet JobOperationList = \"*\";\r\nlet JobStatusList =  \"*\";\r\nlet JobFailureCodeList =  \"*\";\r\nlet ExcludeLog = True;\r\nlet BackupInstanceDetails = (){\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n// query to transform function output\r\n| summarize BackupInstances=count(UniqueId), CloudStorage=sum(VaultStore_StorageConsumptionInMBs)/(1024) by BackupSolution\r\n};\r\nlet JobSuccessPercentageTable = (){\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n// query to transform function output\r\n| extend success=iff((Status == \"Completed\" or Status == \"CompletedWithWarnings\") , 1 , 0)\r\n| extend record = iff(UniqueId != \"\", 1, 0)  // to be used for total row count\r\n| summarize SuccessfulCount =sum(success), TotalCount=sum(record) by BackupSolution\r\n| extend JobSuccessPercentage = (SuccessfulCount*100)/todouble(TotalCount)\r\n| project-away SuccessfulCount, TotalCount\r\n};\r\nBackupInstanceDetails | join kind = leftouter (JobSuccessPercentageTable) on BackupSolution  | project-away BackupSolution1 | project BackupSolution, BackupInstances, JobSuccessPercentage=iff( (isnan( JobSuccessPercentage) or isinf( JobSuccessPercentage) or isempty( JobSuccessPercentage)), \"-\", strcat(tostring(round( JobSuccessPercentage,2)), \" %\")), CloudStorage",
                                "size": 3,
                                "noDataMessage": "No records found for the selected time range and scope",
                                "timeContextFromParameter": "TimeRange",
                                "showExportToExcel": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{Workspaces}"
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "BackupSolution",
                                      "formatter": 0,
                                      "tooltipFormat": {
                                        "tooltip": "Backup Solution"
                                      }
                                    },
                                    {
                                      "columnMatch": "BackupInstances",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "blue",
                                        "customColumnWidthSetting": "25%"
                                      },
                                      "tooltipFormat": {
                                        "tooltip": "Number of backup instances backed up using the given backup solution, as of the end of the selected time range"
                                      }
                                    },
                                    {
                                      "columnMatch": "JobSuccessPercentage",
                                      "formatter": 1,
                                      "formatOptions": {
                                        "customColumnWidthSetting": "25%"
                                      },
                                      "numberFormat": {
                                        "unit": 1,
                                        "options": {
                                          "style": "decimal",
                                          "useGrouping": false,
                                          "maximumFractionDigits": 2
                                        }
                                      },
                                      "tooltipFormat": {
                                        "tooltip": "% of Jobs (that were triggered in the selected time range) that were successful for backup instances backed up using the given backup solution"
                                      }
                                    },
                                    {
                                      "columnMatch": "CloudStorage",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "blue",
                                        "customColumnWidthSetting": "25%"
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal",
                                          "minimumFractionDigits": 2,
                                          "maximumFractionDigits": 2
                                        }
                                      },
                                      "tooltipFormat": {
                                        "tooltip": "Total cloud storage consumed by backup instances backed up by the given backup solution, as of the end of the selected time range"
                                      }
                                    }
                                  ],
                                  "labelSettings": [
                                    {
                                      "columnId": "BackupSolution",
                                      "label": "Backup Solution"
                                    },
                                    {
                                      "columnId": "BackupInstances",
                                      "label": "Backup Instances"
                                    },
                                    {
                                      "columnId": "JobSuccessPercentage",
                                      "label": "Job Success %"
                                    },
                                    {
                                      "columnId": "CloudStorage",
                                      "label": "Cloud Storage (GB)"
                                    }
                                  ]
                                },
                                "sortBy": []
                              },
                              "showPin": true,
                              "name": "Summary-Grid",
                              "styleSettings": {
                                "margin": "-23px 0% 0% 0%"
                              }
                            }
                          ]
                        },
                        "conditionalVisibilities": [
                          {
                            "parameterName": "Workspaces",
                            "comparison": "isNotEqualTo"
                          },
                          {
                            "parameterName": "DatasourceType",
                            "comparison": "isNotEqualTo"
                          }
                        ],
                        "name": "summary-group"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<hr>"
                        },
                        "name": "text - 5"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "items": [
                                  {
                                    "type": 9,
                                    "content": {
                                      "version": "KqlParameterItem/1.0",
                                      "crossComponentResources": [
                                        "{Workspaces}"
                                      ],
                                      "parameters": [
                                        {
                                          "id": "24608a3f-634b-4f4f-87cc-998a00636eeb",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "JobTab_SearchBackupInstanceOrDatasourceSet",
                                          "label": "Search Instance or Container",
                                          "type": 1,
                                          "description": "Use to search for a backup instance by name. <br/> To search for a specific instance in a container, use the syntax [container name];[instance name] <br/> To search for all instances in a container, use the syntax [container name];",
                                          "timeContext": {
                                            "durationMs": 604800000
                                          },
                                          "timeContextFromParameter": "TimeRange",
                                          "value": ""
                                        },
                                        {
                                          "id": "71c5a2f9-67e4-48d4-aec3-4c4116f04acd",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "JobTab_JobOperation",
                                          "label": "Job Operation",
                                          "type": 2,
                                          "description": "Use to filter by Job Operation",
                                          "isRequired": true,
                                          "multiSelect": true,
                                          "quote": "",
                                          "delimiter": ",",
                                          "query": "// Function Params\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  @\"{JobTab_SearchBackupInstanceOrDatasourceSet}\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = \"*\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| distinct OperationCategory",
                                          "crossComponentResources": [
                                            "{Workspaces}"
                                          ],
                                          "value": [
                                            "Backup"
                                          ],
                                          "typeSettings": {
                                            "additionalResourceOptions": [
                                              "value::all"
                                            ],
                                            "selectAllValue": "*",
                                            "showDefault": false
                                          },
                                          "timeContext": {
                                            "durationMs": 0
                                          },
                                          "timeContextFromParameter": "TimeRange",
                                          "queryType": 0,
                                          "resourceType": "microsoft.operationalinsights/workspaces"
                                        },
                                        {
                                          "id": "49be13b9-6869-4cb2-94e0-b122508d1efb",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "JobTab_JobStatus",
                                          "label": "Job Status",
                                          "type": 2,
                                          "description": "Use to filter by Job Status",
                                          "isRequired": true,
                                          "multiSelect": true,
                                          "quote": "",
                                          "delimiter": ",",
                                          "value": [
                                            "value::all"
                                          ],
                                          "typeSettings": {
                                            "additionalResourceOptions": [
                                              "value::all"
                                            ],
                                            "selectAllValue": "*",
                                            "showDefault": false
                                          },
                                          "jsonData": "[\r\n    { \"value\":\"Completed\", \"label\":\"Succeeded\" },\r\n    { \"value\":\"Failed\", \"label\":\"Failed\"  },\r\n    { \"value\":\"CompletedWithWarnings\",   \"label\":\"SucceededWithWarnings\"  },\r\n    { \"value\":\"Cancelled\", \"label\":\"Cancelled\" }\r\n]",
                                          "timeContext": {
                                            "durationMs": 604800000
                                          },
                                          "timeContextFromParameter": "TimeRange"
                                        },
                                        {
                                          "id": "84fef06a-bc14-40e3-a6c5-68647b3f5474",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "JobTab_JobFailureCode",
                                          "label": "Job Failure Code",
                                          "type": 2,
                                          "description": "Use to filter by Job Failure Code",
                                          "isRequired": true,
                                          "multiSelect": true,
                                          "quote": "",
                                          "delimiter": ",",
                                          "query": "// Function Params\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  @\"{JobTab_SearchBackupInstanceOrDatasourceSet}\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = todynamic( @\"{JobTab_JobOperation}\"); \r\nlet JobStatusList = todynamic( @\"{JobTab_JobStatus}\");\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| distinct ErrorTitle\r\n| where not (ErrorTitle == \"Success\" or ErrorTitle == \"\")",
                                          "crossComponentResources": [
                                            "{Workspaces}"
                                          ],
                                          "value": [
                                            "value::all"
                                          ],
                                          "typeSettings": {
                                            "additionalResourceOptions": [
                                              "value::all"
                                            ],
                                            "selectAllValue": "*",
                                            "showDefault": false
                                          },
                                          "timeContext": {
                                            "durationMs": 0
                                          },
                                          "timeContextFromParameter": "TimeRange",
                                          "queryType": 0,
                                          "resourceType": "microsoft.operationalinsights/workspaces"
                                        }
                                      ],
                                      "style": "pills",
                                      "doNotRunWhenHidden": true,
                                      "queryType": 0,
                                      "resourceType": "microsoft.operationalinsights/workspaces"
                                    },
                                    "conditionalVisibilities": [
                                      {
                                        "parameterName": "Workspaces",
                                        "comparison": "isNotEqualTo"
                                      },
                                      {
                                        "parameterName": "DatasourceType",
                                        "comparison": "isNotEqualTo"
                                      }
                                    ],
                                    "name": "JobDistribution-TopParameterBlock"
                                  },
                                  {
                                    "type": 1,
                                    "content": {
                                      "json": "________________________"
                                    },
                                    "conditionalVisibilities": [
                                      {
                                        "parameterName": "Workspaces",
                                        "comparison": "isNotEqualTo"
                                      },
                                      {
                                        "parameterName": "DatasourceType",
                                        "comparison": "isNotEqualTo"
                                      }
                                    ],
                                    "name": "JobDistribution-DividingLine1"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end})); \r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  @\"{JobTab_SearchBackupInstanceOrDatasourceSet}\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = todynamic( @\"{JobTab_JobOperation}\"); \r\nlet JobStatusList = todynamic( @\"{JobTab_JobStatus}\");\r\nlet JobFailureCodeList = todynamic( @\"{JobTab_JobFailureCode}\");\r\nlet ExcludeLog = true; \r\n// query to transform function output\r\nlet LatestJobTable =  materialize(\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| summarize by JobStatus = Status, JobUniqueId = UniqueId); \r\nlet JobSuccessPercent = LatestJobTable\r\n| extend success=iff((JobStatus == \"Completed\" or JobStatus == \"CompletedWithWarnings\") , 1 , 0)\r\n| extend record = 1 // to be used for total row count\r\n| summarize SuccessfulCount =sum(success), TotalCount=sum(record)\r\n| extend JobSuccessPercentage = (SuccessfulCount*100)/todouble(TotalCount)\r\n| project JobSuccessPercentage = iff( (isnan(JobSuccessPercentage) or isinf(JobSuccessPercentage) or isempty(JobSuccessPercentage)), \"-\", tostring(JobSuccessPercentage)) \r\n| extend  Key = pack_array(\"Success %\"), Value = pack_array(JobSuccessPercentage), Row = pack_array(0)\r\n| project Key, Value, Row\r\n| mvexpand  Key, Value, Row; \r\nlet JobStatusEnum = datatable (JobStatus:string, statusOrder:int, CustomJobStatus:string)\r\n    [ \"Completed\", 1, \"Succeeded\",\r\n      \"CompletedWithWarnings\", 2, \"SucceededWithWarnings\",\r\n      \"Failed\", 3, \"Failed\",\r\n      \"Cancelled\", 4, \"Cancelled\"];\r\nlet JobStatusTable = JobStatusEnum\r\n| join kind= leftouter (LatestJobTable | summarize dcount(JobUniqueId, 4) by JobStatus) \r\non JobStatus\r\n| project  JobStatus = CustomJobStatus, JobCount = (iff(isempty(dcount_JobUniqueId), 0, dcount_JobUniqueId)), statusOrder\r\n| order by statusOrder asc\r\n| extend  Key = pack_array(JobStatus), Value = pack_array( JobCount), Row = pack_array(statusOrder)\r\n| project Key, Value, Row\r\n| mvexpand  Key, Value, Row;\r\nunion  JobStatusTable, JobSuccessPercent \r\n| order by toint(Row) asc",
                                      "size": 3,
                                      "noDataMessage": "No records found for the selected time range and scope",
                                      "timeContextFromParameter": "TimeRange",
                                      "queryType": 0,
                                      "resourceType": "microsoft.operationalinsights/workspaces",
                                      "crossComponentResources": [
                                        "{Workspaces}"
                                      ],
                                      "visualization": "tiles",
                                      "tileSettings": {
                                        "titleContent": {
                                          "columnMatch": "Key",
                                          "formatter": 1,
                                          "formatOptions": {
                                            "showIcon": true
                                          }
                                        },
                                        "subtitleContent": {
                                          "columnMatch": "SubTitle",
                                          "formatter": 1,
                                          "formatOptions": {
                                            "showIcon": true
                                          }
                                        },
                                        "leftContent": {
                                          "columnMatch": "Value",
                                          "formatter": 1,
                                          "formatOptions": {
                                            "showIcon": true
                                          },
                                          "numberFormat": {
                                            "unit": 0,
                                            "options": {
                                              "style": "decimal",
                                              "maximumFractionDigits": 2
                                            }
                                          }
                                        },
                                        "showBorder": true,
                                        "sortCriteriaField": "Key",
                                        "sortOrderField": 2
                                      }
                                    },
                                    "conditionalVisibilities": [
                                      {
                                        "parameterName": "Workspaces",
                                        "comparison": "isNotEqualTo"
                                      },
                                      {
                                        "parameterName": "DatasourceType",
                                        "comparison": "isNotEqualTo"
                                      }
                                    ],
                                    "name": "JobDistribution-Tiles",
                                    "styleSettings": {
                                      "margin": "-10px 0% 0% -15px"
                                    }
                                  },
                                  {
                                    "type": 1,
                                    "content": {
                                      "json": "_____________________________"
                                    },
                                    "conditionalVisibilities": [
                                      {
                                        "parameterName": "TabName",
                                        "comparison": "isEqualTo",
                                        "value": "JobDistribution"
                                      },
                                      {
                                        "parameterName": "Workspaces",
                                        "comparison": "isNotEqualTo"
                                      },
                                      {
                                        "parameterName": "DatasourceType",
                                        "comparison": "isNotEqualTo"
                                      }
                                    ],
                                    "name": "JobDistribution-DividingLine2"
                                  },
                                  {
                                    "type": 1,
                                    "content": {
                                      "json": "____________________________"
                                    },
                                    "conditionalVisibilities": [
                                      {
                                        "parameterName": "Workspaces",
                                        "comparison": "isNotEqualTo"
                                      },
                                      {
                                        "parameterName": "DatasourceType",
                                        "comparison": "isNotEqualTo"
                                      }
                                    ],
                                    "name": "JobDistribution-DividingLine3"
                                  },
                                  {
                                    "type": 1,
                                    "content": {
                                      "json": "<div style=\"text-align:left\"><span style=\"font-size:14px;font-weight:600;\">Distribution of Jobs in Period by Backup Item </span> </div>"
                                    },
                                    "conditionalVisibilities": [
                                      {
                                        "parameterName": "Workspaces",
                                        "comparison": "isNotEqualTo",
                                        "value": ""
                                      },
                                      {
                                        "parameterName": "DatasourceType",
                                        "comparison": "isNotEqualTo"
                                      }
                                    ],
                                    "name": "JobDistribution-Grid2Title",
                                    "styleSettings": {
                                      "margin": "0% 0% 10px 0%"
                                    }
                                  },
                                  {
                                    "type": 9,
                                    "content": {
                                      "version": "KqlParameterItem/1.0",
                                      "parameters": [
                                        {
                                          "id": "5dc2a074-b510-44f2-9530-cfcbd159b59c",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "JobTab_SortBy",
                                          "label": "Sort By",
                                          "type": 2,
                                          "description": "Use to sort by a certain column",
                                          "isRequired": true,
                                          "typeSettings": {
                                            "additionalResourceOptions": [],
                                            "showDefault": false
                                          },
                                          "jsonData": "[{ \"value\": \"FailureCount\", \"label\": \"# Jobs Failed\" },\r\n{ \"value\": \"AvgDataTransferred\", \"label\": \"Avg data transferred (MB)\" }, \r\n{ \"value\": \"AvgJobDuration\", \"label\": \"Avg Job Duration (hrs)\" },\r\n{ \"value\": \"SuccessPercent\", \"label\": \"Job Success %\", \"selected\": \"true\" }]",
                                          "timeContext": {
                                            "durationMs": 0
                                          },
                                          "timeContextFromParameter": "TimeRange",
                                          "value": "AvgDataTransferred"
                                        },
                                        {
                                          "id": "df3cc03c-53f7-4523-a29b-e50bf1b6d922",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "JobTab_Order",
                                          "label": "Order",
                                          "type": 2,
                                          "description": "Use to specify the sort order: Ascending/Descending",
                                          "isRequired": true,
                                          "typeSettings": {
                                            "additionalResourceOptions": [],
                                            "showDefault": false
                                          },
                                          "jsonData": "[\r\n    { \"value\":\"Ascending\", \"selected\":true},\r\n    { \"value\":\"Descending\"}\r\n]",
                                          "timeContext": {
                                            "durationMs": 0
                                          },
                                          "timeContextFromParameter": "TimeRange",
                                          "value": "Descending"
                                        },
                                        {
                                          "id": "2033073e-5e18-4e0f-a543-a03b98874d8d",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "JobTab_RowsPerPage",
                                          "label": "Rows per Page",
                                          "type": 2,
                                          "description": "Number of rows to display in grid view",
                                          "isRequired": true,
                                          "typeSettings": {
                                            "additionalResourceOptions": [],
                                            "showDefault": false
                                          },
                                          "jsonData": "[\r\n    { \"value\":10, \"label\":\"10\", \"selected\":true  },\r\n    { \"value\":25, \"label\":\"25\" },\r\n    { \"value\":50, \"label\":\"50\" },\r\n    { \"value\":100, \"label\":\"100\" },\r\n    { \"value\":250, \"label\":\"250\" },\r\n    { \"value\":500, \"label\":\"500\" },\r\n    { \"value\":1000, \"label\":\"1000\" }\r\n]",
                                          "timeContext": {
                                            "durationMs": 0
                                          },
                                          "timeContextFromParameter": "TimeRange"
                                        },
                                        {
                                          "id": "356e4bfd-7e3d-4e48-89c0-b03efb72b9dc",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "JobTab_Page",
                                          "label": "Page",
                                          "type": 2,
                                          "description": "Select Page Number",
                                          "isRequired": true,
                                          "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  @\"{JobTab_SearchBackupInstanceOrDatasourceSet}\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = todynamic( @\"{JobTab_JobOperation}\"); \r\nlet JobStatusList = todynamic( @\"{JobTab_JobStatus}\");\r\nlet JobFailureCodeList = todynamic( @\"{JobTab_JobFailureCode}\");\r\nlet ExcludeLog = true; \r\nlet DisplayAllFields = false;\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| summarize \r\nBackupInstanceFriendlyName = any(FriendlyName),  DatasourceSetFriendlyName = any(DatasourceSetFriendlyName),  DatasourceType = any(DatasourceType),  VaultResourceId = any(VaultResourceId), BackupInstanceId=any(Id), DatasourceResourceId=any(DatasourceResourceId) , DatasourceSetResourceId=any(DatasourceSetResourceId) by BackupInstanceUniqueId = UniqueId\r\n| join kind = leftouter(\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n) on BackupInstanceUniqueId\r\n// query to transform function output\r\n| extend failed=iff(Status == \"Failed\" , 1 , 0)\r\n| extend record = iff(UniqueId != \"\", 1, 0)  // to be used for total row count\r\n| summarize FailureCount =sum(failed), TotalCount=sum(record), AvgDataTransferred =avg(DataTransferredInMBs), AvgJobDuration = avg(DurationInSecs)/3600, \r\nBackupItemFriendlyName = any(BackupInstanceFriendlyName), BackupInstance = any(BackupInstanceFriendlyName), Container = any(DatasourceSetFriendlyName),  DatasourceType = any(DatasourceType),  ResourceId = any(VaultResourceId), BackupInstanceId=any(BackupInstanceId), ResourceGroup=any(DatasourceResourceId) , AzureResource=any(DatasourceSetResourceId) by BackupInstanceUniqueId\r\n| summarize c=count()\r\n| project num = (c-1)/{JobTab_RowsPerPage} + 1\r\n| project nums = range(1,num,1), num\r\n| mvexpand nums\r\n| project nums = tostring(nums), num = strcat(tostring(nums),\" of \",tostring(num))",
                                          "crossComponentResources": [
                                            "{Workspaces}"
                                          ],
                                          "value": "2",
                                          "typeSettings": {
                                            "additionalResourceOptions": [],
                                            "showDefault": false
                                          },
                                          "queryType": 0,
                                          "resourceType": "microsoft.operationalinsights/workspaces"
                                        }
                                      ],
                                      "style": "pills",
                                      "doNotRunWhenHidden": true,
                                      "queryType": 0,
                                      "resourceType": "microsoft.operationalinsights/workspaces"
                                    },
                                    "customWidth": "90",
                                    "conditionalVisibilities": [
                                      {
                                        "parameterName": "Workspaces",
                                        "comparison": "isNotEqualTo"
                                      },
                                      {
                                        "parameterName": "DatasourceType",
                                        "comparison": "isNotEqualTo"
                                      }
                                    ],
                                    "name": "parameters - 7",
                                    "styleSettings": {
                                      "margin": "-23px 0% 0% 0%",
                                      "padding": "0% 0% 0% 0%"
                                    }
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  @\"{JobTab_SearchBackupInstanceOrDatasourceSet}\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = todynamic( @\"{JobTab_JobOperation}\"); \r\nlet JobStatusList = todynamic( @\"{JobTab_JobStatus}\");\r\nlet JobFailureCodeList = todynamic( @\"{JobTab_JobFailureCode}\");\r\nlet ExcludeLog = true; \r\nlet DisplayAllFields = false;\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| summarize \r\nBackupInstanceFriendlyName = any(FriendlyName),  DatasourceSetFriendlyName = any(DatasourceSetFriendlyName),  DatasourceType = any(DatasourceType),  VaultResourceId = any(VaultResourceId), BackupInstanceId=any(Id), DatasourceResourceId=any(DatasourceResourceId) , DatasourceSetResourceId=any(DatasourceSetResourceId) by BackupInstanceUniqueId = UniqueId\r\n| join kind = leftouter(\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n) on BackupInstanceUniqueId\r\n// query to transform function output\r\n| extend failed=iff(Status == \"Failed\" , 1 , 0)\r\n| extend record = iff(UniqueId != \"\", 1, 0)  // to be used for total row count\r\n| summarize FailureCount =sum(failed), TotalCount=sum(record), AvgDataTransferred =avg(DataTransferredInMBs), AvgJobDuration = avg(DurationInSecs)/3600, \r\nBackupItemFriendlyName = any(BackupInstanceFriendlyName), BackupInstance = any(BackupInstanceFriendlyName), Container = any(DatasourceSetFriendlyName),  DatasourceType = any(DatasourceType),  ResourceId = any(VaultResourceId), BackupInstanceId=any(BackupInstanceId), ResourceGroup=any(DatasourceResourceId) , AzureResource=any(DatasourceSetResourceId) by BackupInstanceUniqueId\r\n| extend SuccessPercent = ((TotalCount - FailureCount) *100)/todouble(TotalCount)\r\n| extend TempColumn = column_ifexists(tostring('{JobTab_SortBy}'), \"SuccessPercent\")\r\n| extend ColumnToBeSorted = iff(tostring('{JobTab_Order}') == \"Ascending\", todouble(TempColumn) - 90000000, 90000000 - todouble(TempColumn))\r\n| sort by ColumnToBeSorted asc nulls last, BackupInstanceUniqueId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{JobTab_RowsPerPage} + 1))\r\n| where page_num has ('{JobTab_Page}') or '*' in ('{JobTab_Page}')\r\n| project BackupInstanceUniqueId, BackupInstance, BackupInstanceId, Container, ResourceGroup=iff(DatasourceType==\"Azure Backup Agent\" or DatasourceType==\"Azure Backup Server\" or DatasourceType==\"DPM\",\"(none)\",split(split(tostring(tolower(AzureResource)), '/resourcegroups/')[1],'/')[0]\r\n), JobsFailed=FailureCount, JobSuccessPercent=iff( (isnan(SuccessPercent) or isinf(SuccessPercent) or isempty(SuccessPercent)), \"-\", strcat(tostring(round(SuccessPercent,2)), \" %\")), AvgDataTransferred, AvgJobDuration, AzureResource ",
                                      "size": 3,
                                      "noDataMessage": "No records found for the selected time range and scope",
                                      "exportFieldName": "BackupInstanceUniqueId",
                                      "exportParameterName": "JobTab_SearchBackupInstanceUniqueId",
                                      "exportDefaultValue": "*",
                                      "showExportToExcel": true,
                                      "queryType": 0,
                                      "resourceType": "microsoft.operationalinsights/workspaces",
                                      "crossComponentResources": [
                                        "{Workspaces}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "BackupInstanceUniqueId",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "BackupInstance",
                                            "formatter": 16,
                                            "formatOptions": {
                                              "linkColumn": "BackupInstanceId",
                                              "linkTarget": "Resource",
                                              "showIcon": true,
                                              "customColumnWidthSetting": "15%"
                                            },
                                            "tooltipFormat": {
                                              "tooltip": "Name of the backup instance"
                                            }
                                          },
                                          {
                                            "columnMatch": "BackupInstanceId",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Container",
                                            "formatter": 0,
                                            "formatOptions": {
                                              "customColumnWidthSetting": "15%"
                                            },
                                            "tooltipFormat": {
                                              "tooltip": "Protected container associated with the backup instance"
                                            }
                                          },
                                          {
                                            "columnMatch": "ResourceGroup",
                                            "formatter": 0,
                                            "formatOptions": {
                                              "customColumnWidthSetting": "15%"
                                            },
                                            "tooltipFormat": {
                                              "tooltip": "Resource group associated with the backup instance"
                                            }
                                          },
                                          {
                                            "columnMatch": "JobsFailed",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "blue",
                                              "customColumnWidthSetting": "15%"
                                            },
                                            "tooltipFormat": {
                                              "tooltip": "Number of jobs (that were triggered in the selected time range) that failed for the given backup instance"
                                            }
                                          },
                                          {
                                            "columnMatch": "JobSuccessPercent",
                                            "formatter": 1,
                                            "formatOptions": {
                                              "customColumnWidthSetting": "15%"
                                            },
                                            "tooltipFormat": {
                                              "tooltip": "% of jobs (that were triggered in the selected time range) on the backup instance that were successful"
                                            }
                                          },
                                          {
                                            "columnMatch": "AvgDataTransferred",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "blue",
                                              "customColumnWidthSetting": "15%"
                                            },
                                            "numberFormat": {
                                              "unit": 0,
                                              "options": {
                                                "style": "decimal",
                                                "minimumFractionDigits": 2,
                                                "maximumFractionDigits": 2
                                              }
                                            },
                                            "tooltipFormat": {
                                              "tooltip": "Avg data transferred by jobs (that were triggered in the selected time range) on the given backup instance"
                                            }
                                          },
                                          {
                                            "columnMatch": "AvgJobDuration",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "blue",
                                              "customColumnWidthSetting": "15%"
                                            },
                                            "numberFormat": {
                                              "unit": 0,
                                              "options": {
                                                "style": "decimal",
                                                "useGrouping": false,
                                                "minimumFractionDigits": 2,
                                                "maximumFractionDigits": 2
                                              }
                                            },
                                            "tooltipFormat": {
                                              "tooltip": "Avg duration of jobs (that were triggered in the selected time range) on the backup instance"
                                            }
                                          },
                                          {
                                            "columnMatch": "AzureResource",
                                            "formatter": 0,
                                            "formatOptions": {
                                              "customColumnWidthSetting": "15%"
                                            },
                                            "tooltipFormat": {
                                              "tooltip": "Azure Resource associated with the backup instance. For Azure VM Backup, SQL in Azure VM backup and SAP database in Azure VM backup, the Azure Resource is the Azure VM. For Azure Files Share backup, the Azure Resource is the Azure Storage account. For on-premises backup instances, this field is blank."
                                            }
                                          }
                                        ],
                                        "filter": true,
                                        "labelSettings": [
                                          {
                                            "columnId": "BackupInstance",
                                            "label": "Backup Instance"
                                          },
                                          {
                                            "columnId": "ResourceGroup",
                                            "label": "Resource Group"
                                          },
                                          {
                                            "columnId": "JobsFailed",
                                            "label": "# Jobs Failed"
                                          },
                                          {
                                            "columnId": "JobSuccessPercent",
                                            "label": "Job Success %"
                                          },
                                          {
                                            "columnId": "AvgDataTransferred",
                                            "label": "Avg Data Transferred (MB)"
                                          },
                                          {
                                            "columnId": "AvgJobDuration",
                                            "label": "Avg Job Duration (hrs)"
                                          },
                                          {
                                            "columnId": "AzureResource",
                                            "label": "Azure Resource"
                                          }
                                        ]
                                      },
                                      "sortBy": []
                                    },
                                    "conditionalVisibilities": [
                                      {
                                        "parameterName": "DatasourceType",
                                        "comparison": "isNotEqualTo"
                                      },
                                      {
                                        "parameterName": "Workspaces",
                                        "comparison": "isNotEqualTo"
                                      }
                                    ],
                                    "showPin": false,
                                    "name": "JobDistribution-Grid1",
                                    "styleSettings": {
                                      "padding": "0% 0% 0% 0%"
                                    }
                                  },
                                  {
                                    "type": 1,
                                    "content": {
                                      "json": "<span style=\"font-size:12px;font-style:italic\"> Click on any row above to see details of all jobs for that backup item in the selected time range. </span>"
                                    },
                                    "conditionalVisibilities": [
                                      {
                                        "parameterName": "Workspaces",
                                        "comparison": "isNotEqualTo"
                                      },
                                      {
                                        "parameterName": "DatasourceType",
                                        "comparison": "isNotEqualTo"
                                      }
                                    ],
                                    "name": "JobDetailsPromptText"
                                  },
                                  {
                                    "type": 1,
                                    "content": {
                                      "json": "<div style=\"text-align:left\"><span style=\"font-size:14px;font-weight:600;\">List of Jobs in Period</span> </div>"
                                    },
                                    "conditionalVisibilities": [
                                      {
                                        "parameterName": "Workspaces",
                                        "comparison": "isNotEqualTo"
                                      },
                                      {
                                        "parameterName": "JobTab_SearchBackupInstanceUniqueId",
                                        "comparison": "isNotEqualTo",
                                        "value": "*"
                                      },
                                      {
                                        "parameterName": "DatasourceType",
                                        "comparison": "isNotEqualTo"
                                      }
                                    ],
                                    "name": "JobDetails-GridTitle",
                                    "styleSettings": {
                                      "margin": "0% 0% 10px 0%"
                                    }
                                  },
                                  {
                                    "type": 9,
                                    "content": {
                                      "version": "KqlParameterItem/1.0",
                                      "parameters": [
                                        {
                                          "id": "5dc2a074-b510-44f2-9530-cfcbd159b59c",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "JobTab_SortBy_2",
                                          "label": "Sort By",
                                          "type": 2,
                                          "description": "Use to sort by a certain column",
                                          "isRequired": true,
                                          "value": "DurationInSecs",
                                          "typeSettings": {
                                            "additionalResourceOptions": [],
                                            "showDefault": false
                                          },
                                          "jsonData": "[{ \"value\": \"DurationInSecs\", \"label\": \"Job Duration (sec)\" },\r\n{ \"value\": \"DataTransferredInMBs\", \"label\": \"Data Transferred (MB)\", \"selected\": \"true\" }]",
                                          "timeContext": {
                                            "durationMs": 604800000
                                          },
                                          "timeContextFromParameter": "TimeRange"
                                        },
                                        {
                                          "id": "df3cc03c-53f7-4523-a29b-e50bf1b6d922",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "JobTab_Order_2",
                                          "label": "Order",
                                          "type": 2,
                                          "description": "Use to specify the sort order: Ascending/Descending",
                                          "isRequired": true,
                                          "typeSettings": {
                                            "additionalResourceOptions": [],
                                            "showDefault": false
                                          },
                                          "jsonData": "[\r\n    { \"value\":\"Ascending\"},\r\n    { \"value\":\"Descending\", \"selected\":true}\r\n]",
                                          "timeContext": {
                                            "durationMs": 0
                                          },
                                          "timeContextFromParameter": "TimeRange"
                                        },
                                        {
                                          "id": "90453a1f-7fd0-45d4-a2ef-cd36b4a834e0",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "JobTab_RowsPerPage_2",
                                          "label": "Rows per Page",
                                          "type": 2,
                                          "description": "Number of rows to display in grid view",
                                          "isRequired": true,
                                          "typeSettings": {
                                            "additionalResourceOptions": [],
                                            "showDefault": false
                                          },
                                          "jsonData": "[\r\n    { \"value\":10, \"label\":\"10\", \"selected\":true  },\r\n    { \"value\":25, \"label\":\"25\" },\r\n    { \"value\":50, \"label\":\"50\" },\r\n    { \"value\":100, \"label\":\"100\" },\r\n    { \"value\":250, \"label\":\"250\" },\r\n    { \"value\":500, \"label\":\"500\" },\r\n    { \"value\":1000, \"label\":\"1000\" }\r\n]",
                                          "timeContext": {
                                            "durationMs": 0
                                          },
                                          "timeContextFromParameter": "TimeRange"
                                        },
                                        {
                                          "id": "356e4bfd-7e3d-4e48-89c0-b03efb72b9dc",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "JobTab_Page_2",
                                          "label": "Page",
                                          "type": 2,
                                          "description": "Select Page Number",
                                          "isRequired": true,
                                          "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  @\"{JobTab_SearchBackupInstanceOrDatasourceSet}\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = todynamic( @\"{JobTab_JobOperation}\"); \r\nlet JobStatusList = todynamic( @\"{JobTab_JobStatus}\");\r\nlet JobFailureCodeList = todynamic( @\"{JobTab_JobFailureCode}\");\r\nlet ExcludeLog = true; \r\n// local Params\r\nlet BackupInstanceUniqueIdParam =  @\"{JobTab_SearchBackupInstanceUniqueId}\";\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n// query to transform function output\r\n| where BackupInstanceUniqueId == (BackupInstanceUniqueIdParam) or '*' in (BackupInstanceUniqueIdParam)\r\n| summarize c=count()\r\n| project num = (c-1)/{JobTab_RowsPerPage_2} + 1\r\n| project nums = range(1,num,1), num\r\n| mvexpand nums\r\n| project nums = tostring(nums), num = strcat(tostring(nums),\" of \",tostring(num))",
                                          "crossComponentResources": [
                                            "{Workspaces}"
                                          ],
                                          "value": "1",
                                          "typeSettings": {
                                            "additionalResourceOptions": [],
                                            "showDefault": false
                                          },
                                          "queryType": 0,
                                          "resourceType": "microsoft.operationalinsights/workspaces"
                                        }
                                      ],
                                      "style": "pills",
                                      "doNotRunWhenHidden": true,
                                      "queryType": 0,
                                      "resourceType": "microsoft.operationalinsights/workspaces"
                                    },
                                    "customWidth": "90",
                                    "conditionalVisibilities": [
                                      {
                                        "parameterName": "Workspaces",
                                        "comparison": "isNotEqualTo"
                                      },
                                      {
                                        "parameterName": "JobTab_SearchBackupInstanceUniqueId",
                                        "comparison": "isNotEqualTo",
                                        "value": "*"
                                      },
                                      {
                                        "parameterName": "DatasourceType",
                                        "comparison": "isNotEqualTo"
                                      }
                                    ],
                                    "name": "JobDistribution-Grid2ParameterBlock",
                                    "styleSettings": {
                                      "margin": "-23px 0% 0% 0%",
                                      "padding": "0% 0% 0% 0%"
                                    }
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  @\"{JobTab_SearchBackupInstanceOrDatasourceSet}\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = todynamic( @\"{JobTab_JobOperation}\"); \r\nlet JobStatusList = todynamic( @\"{JobTab_JobStatus}\");\r\nlet JobFailureCodeList = todynamic( @\"{JobTab_JobFailureCode}\");\r\nlet ExcludeLog = true; \r\n// local Params\r\nlet BackupInstanceUniqueIdParam =  @\"{JobTab_SearchBackupInstanceUniqueId}\";\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n// query to transform function output\r\n| where BackupInstanceUniqueId == (BackupInstanceUniqueIdParam) or '*' in (BackupInstanceUniqueIdParam)\r\n| extend TempColumn = column_ifexists(tostring('{JobTab_SortBy_2}'), \"DataTransferredInMBs\")\r\n| extend ColumnToBeSorted = iff(tostring('{JobTab_Order_2}') == \"Ascending\", todouble(TempColumn) - 90000000, 90000000 - todouble(TempColumn))\r\n| sort by ColumnToBeSorted asc nulls last, UniqueId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{JobTab_RowsPerPage_2} + 1))\r\n| where page_num has ('{JobTab_Page_2}') or '*' in ('{JobTab_Page_2}')\r\n| project BackupInstance=BackupInstanceFriendlyName, BackupInstanceId, Container=DatasourceSetFriendlyName, ResourceGroup=iff(DatasourceType==\"Azure Backup Agent\" or DatasourceType==\"Azure Backup Server\" or DatasourceType==\"DPM\",\"(none)\",split(split(tostring(tolower(DatasourceSetResourceId)), '/resourcegroups/')[1],'/')[0]\r\n), OperationCategory, JobStatus=Status,  JobStartDateTime=StartTime, JobDuration=DurationInSecs/3600, ErrorTitle, DataTransferred=DataTransferredInMBs, AzureResource=DatasourceSetResourceId, DatasourceType ",
                                      "size": 3,
                                      "noDataMessage": "No records found for the selected time range and scope",
                                      "showExportToExcel": true,
                                      "queryType": 0,
                                      "resourceType": "microsoft.operationalinsights/workspaces",
                                      "crossComponentResources": [
                                        "{Workspaces}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "BackupInstance",
                                            "formatter": 16,
                                            "formatOptions": {
                                              "linkColumn": "BackupInstanceId",
                                              "linkTarget": "Resource",
                                              "showIcon": true
                                            },
                                            "tooltipFormat": {
                                              "tooltip": "Name of the backup instance"
                                            }
                                          },
                                          {
                                            "columnMatch": "BackupInstanceId",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Container",
                                            "formatter": 0,
                                            "tooltipFormat": {
                                              "tooltip": "Protected Container associated with the backup instance"
                                            }
                                          },
                                          {
                                            "columnMatch": "ResourceGroup",
                                            "formatter": 0,
                                            "tooltipFormat": {
                                              "tooltip": "Resource group associated with the backup instance"
                                            }
                                          },
                                          {
                                            "columnMatch": "OperationCategory",
                                            "formatter": 0,
                                            "tooltipFormat": {
                                              "tooltip": "Operation Category"
                                            }
                                          },
                                          {
                                            "columnMatch": "JobStatus",
                                            "formatter": 0,
                                            "tooltipFormat": {
                                              "tooltip": "Job Status"
                                            }
                                          },
                                          {
                                            "columnMatch": "JobStartDateTime",
                                            "formatter": 6,
                                            "numberFormat": {
                                              "unit": 0,
                                              "options": {
                                                "style": "decimal",
                                                "useGrouping": false
                                              }
                                            },
                                            "dateFormat": {
                                              "showUtcTime": true,
                                              "formatName": "shortDateTimePattern"
                                            },
                                            "tooltipFormat": {
                                              "tooltip": "Start date and time of the Job"
                                            }
                                          },
                                          {
                                            "columnMatch": "JobDuration",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "blue"
                                            },
                                            "numberFormat": {
                                              "unit": 0,
                                              "options": {
                                                "style": "decimal",
                                                "useGrouping": false,
                                                "minimumFractionDigits": 2,
                                                "maximumFractionDigits": 2
                                              }
                                            },
                                            "tooltipFormat": {
                                              "tooltip": "Job Duration"
                                            }
                                          },
                                          {
                                            "columnMatch": "ErrorTitle",
                                            "formatter": 0,
                                            "tooltipFormat": {
                                              "tooltip": "Job Failure Code"
                                            }
                                          },
                                          {
                                            "columnMatch": "DataTransferred",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "blue"
                                            },
                                            "tooltipFormat": {
                                              "tooltip": "Amount of data transferred by the job"
                                            }
                                          },
                                          {
                                            "columnMatch": "AzureResource",
                                            "formatter": 0,
                                            "tooltipFormat": {
                                              "tooltip": "Azure Resource associated with the backup instance. For Azure VM Backup, SQL in Azure VM backup and SAP database in Azure VM backup, the Azure Resource is the Azure VM. For Azure Files Share backup, the Azure Resource is the Azure Storage account. For on-premises backup instances, this field is blank."
                                            }
                                          },
                                          {
                                            "columnMatch": "DatasourceType",
                                            "formatter": 0,
                                            "tooltipFormat": {
                                              "tooltip": "Datasource Type"
                                            }
                                          }
                                        ],
                                        "filter": true,
                                        "labelSettings": [
                                          {
                                            "columnId": "BackupInstance",
                                            "label": "Backup Instance"
                                          },
                                          {
                                            "columnId": "ResourceGroup",
                                            "label": "Resource Group"
                                          },
                                          {
                                            "columnId": "OperationCategory",
                                            "label": "Operation Category"
                                          },
                                          {
                                            "columnId": "JobStatus",
                                            "label": "Job Status"
                                          },
                                          {
                                            "columnId": "JobStartDateTime",
                                            "label": "Job Start Date Time"
                                          },
                                          {
                                            "columnId": "JobDuration",
                                            "label": "Job Duration (hrs)"
                                          },
                                          {
                                            "columnId": "ErrorTitle",
                                            "label": "Job Failure Code"
                                          },
                                          {
                                            "columnId": "DataTransferred",
                                            "label": "Data Transferred (MB)"
                                          },
                                          {
                                            "columnId": "AzureResource",
                                            "label": "Azure Resource"
                                          },
                                          {
                                            "columnId": "DatasourceType",
                                            "label": "Datasource Type"
                                          }
                                        ]
                                      }
                                    },
                                    "conditionalVisibilities": [
                                      {
                                        "parameterName": "Workspaces",
                                        "comparison": "isNotEqualTo"
                                      },
                                      {
                                        "parameterName": "JobTab_SearchBackupInstanceUniqueId",
                                        "comparison": "isNotEqualTo",
                                        "value": "*"
                                      },
                                      {
                                        "parameterName": "DatasourceType",
                                        "comparison": "isNotEqualTo"
                                      }
                                    ],
                                    "showPin": false,
                                    "name": "JobDistribution-Grid2"
                                  }
                                ]
                              },
                              "name": "group - 0"
                            }
                          ]
                        },
                        "conditionalVisibilities": [
                          {
                            "parameterName": "Workspaces",
                            "comparison": "isNotEqualTo"
                          },
                          {
                            "parameterName": "DatasourceType",
                            "comparison": "isNotEqualTo"
                          }
                        ],
                        "name": "jobs-group"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "backuptab",
                    "comparison": "isEqualTo",
                    "value": "overview"
                  },
                  "name": "Overview"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "RecoveryServicesResources \r\n| where type in~ ('Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems')\r\n| extend vaultName = case(type =~ 'microsoft.dataprotection/backupVaults/backupInstances',split(split(id, '/Microsoft.DataProtection/backupVaults/')[1],'/')[0],type =~ 'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems',split(split(id, '/Microsoft.RecoveryServices/vaults/')[1],'/')[0],'--')\r\n| extend dataSourceType = case(type=~'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems',properties.backupManagementType,type =~ 'microsoft.dataprotection/backupVaults/backupInstances',properties.dataSourceSetInfo.datasourceType,'--')\r\n| extend friendlyName = properties.friendlyName\r\n| extend dsResourceGroup = split(split(properties.dataSourceInfo.resourceID, '/resourceGroups/')[1],'/')[0]\r\n| extend dsSubscription = split(split(properties.dataSourceInfo.resourceID, '/subscriptions/')[1],'/')[0]\r\n| extend lastRestorePoint = properties.lastRecoveryPoint\r\n| extend primaryLocation = properties.dataSourceInfo.resourceLocation\r\n| extend policyName = case(type =~ 'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems',properties.policyName, type =~ 'microsoft.dataprotection/backupVaults/backupInstances', properties.policyInfo.name, '--')\r\n| extend protectionState = properties.currentProtectionState\r\n| summarize c = count() \r\n| extend Item = \"VM Configured with Backup\",  Key = 1\r\n\r\n| union\r\n(\r\nResources\r\n| where type in~ ('microsoft.compute/virtualmachines','microsoft.classiccompute/virtualmachines') \r\n| extend resourceId=tolower(id) \r\n| join kind = leftouter ( RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| project resourceId = tolower(tostring(properties.sourceResourceId)), backupItemid = id, isBackedUp = isnotempty(id) ) on resourceId \r\n| extend isProtected = isnotempty(backupItemid)\r\n| where (isProtected == (0))\r\n| project id,name,resourceGroup,location,tags\r\n| summarize c = count() \r\n| extend Item = \"VM Not Configured with Backup\",  Key = 1\r\n)\r\n",
                          "size": 4,
                          "title": "VM Configred with Backup",
                          "noDataMessageStyle": 5,
                          "exportFieldName": "item",
                          "exportParameterName": "SelectedItem",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "c",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          },
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "VM Configured with Backup",
                                "color": "green"
                              },
                              {
                                "seriesName": "VM Not Configured with Backup",
                                "color": "redBright"
                              }
                            ]
                          },
                          "textSettings": {
                            "style": "bignumber"
                          }
                        },
                        "customWidth": "100",
                        "name": "query - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources\r\n| where type in~ ('microsoft.compute/virtualmachines','microsoft.classiccompute/virtualmachines') \r\n| extend resourceId=tolower(id) \r\n| join kind = leftouter ( RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| project resourceId = tolower(tostring(properties.sourceResourceId)), backupItemid = id, isBackedUp = isnotempty(id) ) on resourceId \r\n| extend isProtected = isnotempty(backupItemid)\r\n| where (isProtected == (0))\r\n| project id,resourceGroup,location",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "id",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            "leftContent": {
                              "columnMatch": "location",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "4",
                                    "text": "Not Enabled"
                                  }
                                ]
                              }
                            },
                            "showBorder": true
                          },
                          "graphSettings": {
                            "type": 2,
                            "topContent": {
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": false
                              }
                            },
                            "centerContent": {
                              "columnMatch": "id",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": true
                              }
                            },
                            "nodeIdField": "location",
                            "sourceIdField": "id",
                            "targetIdField": "id",
                            "graphOrientation": 3,
                            "showOrientationToggles": false,
                            "nodeSize": null,
                            "staticNodeSize": 100,
                            "colorSettings": {
                              "nodeColorField": "id",
                              "type": 3,
                              "thresholdsGrid": [
                                {
                                  "operator": "Default",
                                  "thresholdValue": null,
                                  "representation": "orange"
                                }
                              ]
                            },
                            "hivesMargin": 5
                          },
                          "mapSettings": {
                            "locInfo": "AzureLoc",
                            "labelSettings": "location",
                            "locInfoColumn": "location"
                          }
                        },
                        "customWidth": "100",
                        "name": "query - 4"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "backuptab",
                    "comparison": "isEqualTo",
                    "value": "compliance"
                  },
                  "name": "Compliance"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "4d7d150c-138f-4c2f-9d50-c66c95882c07",
                              "version": "KqlParameterItem/1.0",
                              "name": "Subscription",
                              "label": "Choose Subscription",
                              "type": 6,
                              "description": "Choose a subscription",
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1",
                                  "value::3",
                                  "value::all"
                                ],
                                "includeAll": true,
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::3",
                              "value": [
                                "value::all"
                              ]
                            },
                            {
                              "id": "a634aa80-e05b-458a-a4a8-8d86ccd0a6c4",
                              "version": "KqlParameterItem/1.0",
                              "name": "Workspace",
                              "label": "Choose Workspace",
                              "type": 5,
                              "description": "Choose a LA Workspace",
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "Resources\r\n| where type =~ \"Microsoft.operationalinsights/workspaces\"\r\n| summarize by id",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "value": [
                                "value::all"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "12ba2ca7-c49d-4394-ba62-251b69f05cc7",
                              "version": "KqlParameterItem/1.0",
                              "name": "VaultLocation",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "Resources\r\n| where type == \"microsoft.recoveryservices/vaults\"\r\n| summarize by location",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ]
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "label": "Choose Vault Locaiton",
                              "value": [
                                "value::all"
                              ]
                            },
                            {
                              "id": "edfa92f5-78b2-4084-abec-40ac7e6b8504",
                              "version": "KqlParameterItem/1.0",
                              "name": "Vault",
                              "label": "Choose Vault",
                              "type": 5,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "Resources\r\n| where type == \"microsoft.recoveryservices/vaults\"\r\n| where location in ({VaultLocation}) or '*' in ({VaultLocation})\r\n| summarize by id = tolower(id)",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ]
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": [
                                "value::all"
                              ]
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "conditionalVisibility": {
                          "parameterName": "Tabname",
                          "comparison": "isNotEqualTo",
                          "value": "summary"
                        },
                        "name": "parameters - 1 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "recoveryservicesresources\r\n| where type == \"microsoft.recoveryservices/vaults/backupjobs\"\r\n| summarize count() by BackupState = tostring(properties.status)",
                          "size": 4,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Vault}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "subscriptionId",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "Completed",
                                "color": "green"
                              },
                              {
                                "seriesName": "InProgress",
                                "color": "yellow"
                              },
                              {
                                "seriesName": "Failed",
                                "color": "redBright"
                              }
                            ],
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 0,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "name": "query - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "recoveryservicesresources \r\n| where type == \"microsoft.recoveryservices/vaults/backupjobs\" \r\n| where properties.status=='Failed'\r\n| project name = tostring(properties.entityFriendlyName),properties.status, startTime1 = properties.startTime ,properties.endTime, properties.duration, properties.dataSourceLocation,properties.dataSourceType, tostring(properties.errorDetails.recommendations), resourceGroup\r\n| sort by name ,resourceGroup, todatetime(startTime1) asc",
                          "size": 3,
                          "title": "VM Last Backup Status",
                          "noDataMessage": "No Failed Backup",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Vault}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "properties_status",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Failed",
                                      "representation": "3",
                                      "text": "Backup Failed"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "backupMgmtType",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true
                          }
                        },
                        "customWidth": "100",
                        "name": "VM Last Backup Status"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "backuptab",
                    "comparison": "isEqualTo",
                    "value": "status"
                  },
                  "name": "Backup Status Summary",
                  "styleSettings": {
                    "margin": "2px"
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "e5ec7b7e-171d-4d90-bc68-fb53f3444837",
                              "version": "KqlParameterItem/1.0",
                              "name": "Workspace",
                              "label": "Choose Workspace",
                              "type": 5,
                              "description": "Choose a LA Workspace",
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "Resources\r\n| where type =~ \"Microsoft.operationalinsights/workspaces\"\r\n| summarize by id",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": [
                                "value::all"
                              ]
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "conditionalVisibility": {
                          "parameterName": "Tabname",
                          "comparison": "isNotEqualTo",
                          "value": "summary"
                        },
                        "name": "parameters - 1 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupFabrics.*\",\"\",id))\r\n| extend ProtectionState = iff(tostring(properties.protectionState) == \"IRPending\", \"Initial Backup Pending\", iff(tostring(properties.protectionState) == \"Protected\", \"Actively Protected\", iff(tostring(properties.protectionState) == \"ProtectionStopped\", \"Protection Stopped\", \"Actively Protected\")))\r\n| summarize BackupItems = count() by ProtectionState\r\n| sort by ProtectionState asc",
                          "size": 4,
                          "title": "Protection State",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "piechart",
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "Actively Protected",
                                "color": "green"
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "Protection State"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet BillingGroupName = @\"{UsageTab_BillingGroupName}\";\r\nlet AggregationType = @\"{AggregationType}\";\r\n// calling LA System Function\r\n_AzureBackup_GetBillingGroupsTrends(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, BillingGroupName, AggregationType)\r\n// query to transform function output\r\n| summarize ProtectedInstanceCount = sum(todouble(parse_json(ExtendedProperties).ProtectedInstanceCount)) by  startofday(TimeGenerated)",
                          "size": 4,
                          "aggregation": 5,
                          "title": "Protected Instances Trend",
                          "noDataMessage": "No records found for the selected time range and scope",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "linechart",
                          "gridSettings": {
                            "sortBy": [
                              {
                                "itemKey": "TimeRangeEndDay",
                                "sortOrder": 2
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "TimeRangeEndDay",
                              "sortOrder": 2
                            }
                          ],
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "ProtectedInstanceCount",
                                "label": "# Protected Instances"
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "showPin": true,
                        "name": "Usage-ProtectedInstancesTrendGraph"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Workspaces}"
                          ],
                          "parameters": [
                            {
                              "id": "5dc2a074-b510-44f2-9530-cfcbd159b59c",
                              "version": "KqlParameterItem/1.0",
                              "name": "UsageTab_SortBy",
                              "label": "Sort By",
                              "type": 2,
                              "description": "Use to sort by a certain column",
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[{ \"value\": \"ProtectedInstanceCount\", \"label\": \"# Protected Instances\" },\r\n{ \"value\": \"VaultStore_StorageConsumptionInMBs\", \"label\": \"Cloud Storage (MB)\", \"selected\": \"true\" }]",
                              "timeContext": {
                                "durationMs": 604800000
                              },
                              "timeContextFromParameter": "TimeRange"
                            },
                            {
                              "id": "df3cc03c-53f7-4523-a29b-e50bf1b6d922",
                              "version": "KqlParameterItem/1.0",
                              "name": "UsageTab_Order",
                              "label": "Order",
                              "type": 2,
                              "description": "Use to specify the sort order: Ascending/Descending",
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    { \"value\":\"Ascending\"},\r\n    { \"value\":\"Descending\", \"selected\":true}\r\n]",
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange"
                            },
                            {
                              "id": "102bf69d-4952-4a1f-827d-fd726a82d666",
                              "version": "KqlParameterItem/1.0",
                              "name": "UsageTab_RowsPerPage",
                              "label": "Rows per page",
                              "type": 2,
                              "description": "Number of rows to display in grid view",
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    { \"value\":10, \"label\":\"10\", \"selected\":true  },\r\n    { \"value\":25, \"label\":\"25\" },\r\n    { \"value\":50, \"label\":\"50\" },\r\n    { \"value\":100, \"label\":\"100\" },\r\n    { \"value\":250, \"label\":\"250\" },\r\n    { \"value\":500, \"label\":\"500\" },\r\n    { \"value\":1000, \"label\":\"1000\" }\r\n]",
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange"
                            },
                            {
                              "id": "f4433681-963d-4204-867c-c54c6c89d3f8",
                              "version": "KqlParameterItem/1.0",
                              "name": "UsageTab_Page",
                              "label": "Page",
                              "type": 2,
                              "description": "Select Page Number",
                              "isRequired": true,
                              "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet BillingGroupName = @\"{UsageTab_BillingGroupName}\";\r\n// calling LA System Function\r\n_AzureBackup_GetBillingGroups(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, BillingGroupName)\r\n// query to transform function output\r\n| summarize c=count()\r\n| project num = (c-1)/{UsageTab_RowsPerPage} + 1\r\n| project nums = range(1,num,1), num\r\n| mvexpand nums\r\n| project nums = tostring(nums), num = strcat(tostring(nums),\" of \",tostring(num))",
                              "crossComponentResources": [
                                "{Workspaces}"
                              ],
                              "value": "1",
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "above",
                          "doNotRunWhenHidden": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "customWidth": "90",
                        "name": "Usage-Grid1ParameterBlock",
                        "styleSettings": {
                          "margin": "-23px 0% 0% 0%",
                          "padding": "0% 0% 0% 0%"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet BillingGroupName = @\"{UsageTab_BillingGroupName}\";\r\n// calling LA System Function\r\n_AzureBackup_GetBillingGroups(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, BillingGroupName)\r\n// query to transform function output\r\n| extend TempColumn = column_ifexists(tostring('{UsageTab_SortBy}'), \"VaultStore_StorageConsumptionInMBs\")\r\n| extend ColumnToBeSorted = iff(tostring('{UsageTab_Order}') == \"Ascending\", todouble(TempColumn) - 90000000, 90000000 - todouble(TempColumn))\r\n| sort by ColumnToBeSorted asc nulls last, UniqueId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{UsageTab_RowsPerPage} + 1))\r\n| where page_num has ('{UsageTab_Page}') or '*' in ('{UsageTab_Page}')\r\n|  extend name_array = split(Name,\";\")\r\n|  extend name_arraylen = array_length(name_array)\r\n| project BilledEntity=FriendlyName, BilledEntityResourceGroup=iff(name_arraylen == 3, name_array[(name_arraylen-2)], \"(none)\"), BilledEntityType=Type, BackupSolution, ProtectedInstances=todouble(parse_json(ExtendedProperties).ProtectedInstanceCount), CloudStorage=VaultStore_StorageConsumptionInMBs/1024, StorageReplicationType=VaultStore_StorageReplicationType, Vault=VaultResourceId, VaultResourceGroup=split(split(tolower(VaultResourceId), '/resourcegroups/')[1],'/')[0], Subscription=VaultSubscriptionId",
                          "size": 3,
                          "noDataMessage": "No records found for the selected time range and scope",
                          "timeContextFromParameter": "TimeRange",
                          "exportFieldName": "BillingEntityUniqueId",
                          "exportParameterName": "SelectedBillingEntityUniqueId",
                          "exportDefaultValue": "*",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspaces}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "BilledEntity",
                                "formatter": 0,
                                "tooltipFormat": {
                                  "tooltip": "Name of the billed entity"
                                }
                              },
                              {
                                "columnMatch": "BilledEntityResourceGroup",
                                "formatter": 0,
                                "tooltipFormat": {
                                  "tooltip": "Resource group of the billed entity"
                                }
                              },
                              {
                                "columnMatch": "BilledEntityType",
                                "formatter": 0,
                                "tooltipFormat": {
                                  "tooltip": "Type of the billed entity"
                                }
                              },
                              {
                                "columnMatch": "DatasourceType",
                                "formatter": 0,
                                "tooltipFormat": {
                                  "tooltip": "Datasource Type"
                                }
                              },
                              {
                                "columnMatch": "ProtectedInstances",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue"
                                },
                                "tooltipFormat": {
                                  "tooltip": "Number of protected instances associated with the billed entity, as of the end of the selected time range. A billed entity with a frontend size under 50 GB is said to have 0.5 instances"
                                }
                              },
                              {
                                "columnMatch": "CloudStorage",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 2,
                                    "maximumFractionDigits": 2
                                  }
                                },
                                "tooltipFormat": {
                                  "tooltip": "Total cloud storage consumed by the billed entity, as of the end of the selected time range"
                                }
                              },
                              {
                                "columnMatch": "StorageReplicationType",
                                "formatter": 0,
                                "tooltipFormat": {
                                  "tooltip": "Storage replication type associated with the billed entity"
                                }
                              },
                              {
                                "columnMatch": "Vault",
                                "formatter": 0,
                                "tooltipFormat": {
                                  "tooltip": "Vault associated with the billed entity"
                                }
                              },
                              {
                                "columnMatch": "VaultResourceGroup",
                                "formatter": 0,
                                "tooltipFormat": {
                                  "tooltip": "Resource group of the vault"
                                }
                              },
                              {
                                "columnMatch": "Subscription",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true
                                },
                                "tooltipFormat": {
                                  "tooltip": "Subscription associated with the billed entity"
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "$gen_number_BilledEntity_0",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "BilledEntity",
                                "label": "Billed Entity"
                              },
                              {
                                "columnId": "BilledEntityResourceGroup",
                                "label": "Billed Entity Resource Group"
                              },
                              {
                                "columnId": "BilledEntityType",
                                "label": "Billed Entity Type"
                              },
                              {
                                "columnId": "ProtectedInstances",
                                "label": "# Protected Instances"
                              },
                              {
                                "columnId": "CloudStorage",
                                "label": "Cloud Storage (GB)"
                              },
                              {
                                "columnId": "StorageReplicationType",
                                "label": "Storage Replication Type"
                              },
                              {
                                "columnId": "VaultResourceGroup",
                                "label": "Vault Resource Group"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_number_BilledEntity_0",
                              "sortOrder": 1
                            }
                          ],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Key",
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "leftContent": {
                              "columnMatch": "Value",
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "showPin": true,
                        "name": "Usage-Grid1",
                        "styleSettings": {
                          "margin": "-30px 0% 0% 0%",
                          "padding": "0% 0% 0% 0%",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupFabrics.*\",\"\",id))\r\n| extend a = split(tolower(tostring(properties.containerName)),\";\")\r\n| extend a = iff(array_length(a) == 4, tostring(hash(strcat(tolower(subscriptionId), tostring(a[2]), tostring(a[3])))), tostring(hash(strcat(tolower(subscriptionId), tostring(a[1]), tostring(a[2])))))\r\n| project backupItemId = id,\r\n\t\t  Name = replace(\"iaasvmcontainer;\",\"\",replace(\"iaasvmcontainerv2;\",\"\",tolower(tostring(properties.containerName)))),\r\n          ProtectionState = iff(tostring(properties.protectionState) == \"IRPending\", \"Initial Backup Pending\", iff(tostring(properties.protectionState) == \"Protected\", \"Actively Protected\", iff(tostring(properties.protectionState) == \"ProtectionStopped\", \"Protection Stopped\", \"Actively Protected\"))),\r\n          \r\n\t\t  HealthCheck = tostring(properties.healthStatus),\r\n\t\t  LastBackup = iff(isempty(tostring(properties.lastBackupStatus)),\"Unknown\",tostring(properties.lastBackupStatus)), \r\n\t\t  LastBackupTime = properties.lastBackupTime,\r\n          LastRecoveryPoint = properties.lastRecoveryPoint,\r\n\t\t  backupItemHostId = properties.sourceResourceId,\r\n\t\t  Host = iff(tostring(properties.protectedItemType) contains \"classic\", \"Classic VM\", \"VM\"),\r\n\t\t  policyId = tolower(tostring(properties.policyId)),\r\n\t\t  VaultName = replace(\".*\\\\/vaults\\\\/\",\"\",replace(\"\\\\/backupFabrics.*\",\"\",id)),\r\n\t\t  vaultId = replace(\"\\\\/backupFabrics.*\",\"\",id)\r\n\r\n\r\n| project backupItemId,\r\n\t\t  Name,\r\n          Item = tostring(split(Name,\";\")[1]),\r\n          ResourceGroup = tostring(split(Name,\";\")[0]),\r\n       \t\t  HealthCheck,\r\n\t\t  LastBackup, \r\n\t\t  LastBackupTime = todatetime(LastBackupTime),\r\n          LastRecoveryPoint = todatetime(LastRecoveryPoint),\r\n    \r\n\t\t  \t\t  vaultId\r\n| sort by tolower(Item) asc, backupItemId asc\r\n",
                          "size": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "HealthCheck",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Passed",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Fired",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "LastBackup",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Completed",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Failed",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "warning",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ],
                            "filter": true,
                            "sortBy": [
                              {
                                "itemKey": "Item",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "backupItemId",
                                "label": "Backup Item"
                              },
                              {
                                "columnId": "Name",
                                "label": "Name"
                              },
                              {
                                "columnId": "Item",
                                "label": "Item"
                              },
                              {
                                "columnId": "ResourceGroup",
                                "label": "Resource Group"
                              },
                              {
                                "columnId": "HealthCheck",
                                "label": "Health Check"
                              },
                              {
                                "columnId": "LastBackup",
                                "label": "Last Backup"
                              },
                              {
                                "columnId": "LastBackupTime",
                                "label": "Last Backup Time"
                              },
                              {
                                "columnId": "LastRecoveryPoint",
                                "label": "Last Recovery Point"
                              },
                              {
                                "columnId": "vaultId",
                                "label": "Vault ID"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "Item",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "name": "query - 3"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "backuptab",
                    "comparison": "isEqualTo",
                    "value": "items"
                  },
                  "name": "items"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.compute/snapshots\"\r\n| summarize c = count()\r\n| extend Item = \"Snapshot\",  Key = 2",
                          "size": 3,
                          "color": "green",
                          "noDataMessage": "vaultlist",
                          "exportParameterName": "displayeditems",
                          "exportDefaultValue": "vaultlist",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "c",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "15",
                        "name": "snapshot"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.compute/snapshots\"\r\n| project id  , location ,resourceGroup ,tostring(sku)\r\n",
                          "size": 3,
                          "color": "green",
                          "noDataMessage": "vaultlist",
                          "exportParameterName": "displayeditems",
                          "exportDefaultValue": "vaultlist",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "id",
                                "label": "Snapshot Name"
                              },
                              {
                                "columnId": "location",
                                "label": "Location"
                              },
                              {
                                "columnId": "resourceGroup",
                                "label": "Resource Group"
                              },
                              {
                                "columnId": "sku",
                                "label": "SKU"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "c",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "name": "snapshot - List"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "backuptab",
                    "comparison": "isEqualTo",
                    "value": "snapshot"
                  },
                  "name": "Snapshot"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "972eba34-11d9-42e3-8005-b0334b3a301b",
                              "version": "KqlParameterItem/1.0",
                              "name": "Criticality",
                              "type": 2,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "resources\r\n| extend Criticality = case(tags.Criticality <> \"\", tags.Criticality,\r\n\t\t    \"Undefined\")\r\n| distinct Criticality",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": [
                                "value::all"
                              ]
                            },
                            {
                              "id": "5c4674db-3151-4a5f-bb5a-e5e886cc2c17",
                              "version": "KqlParameterItem/1.0",
                              "name": "Environment",
                              "type": 2,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "resources\r\n| extend Environment = case(\r\ntags.Environment <> \"\", tags.Environment,\r\ntags.environment <> \"\", tags.environment,\r\ntags.Env <> \"\", tags.Env,\r\ntags.env <> \"\", tags.env,\r\ntolower(name) contains \"prod\", \"Production\",\r\ntolower(name) contains \"dev\", \"Development\",\r\ntolower(name) contains \"qa\", \"QA\",\r\ntolower(name) contains \"uat\", \"UAT\",\r\ntolower(name) contains \"sit\", \"SIT\",\r\ntolower(name) contains \"test\", \"Test\",\r\n\"Undefined\")\r\n| distinct Environment",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": [
                                "value::all"
                              ]
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "parameters - 0 - Copy - Copy - Copy - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.recoveryservices/vaults\"\r\n| summarize c = count()\r\n| extend Item = \"Recovery Vault\",  Key = 2",
                          "size": 3,
                          "color": "green",
                          "noDataMessage": "vaultlist",
                          "exportParameterName": "displayeditem",
                          "exportDefaultValue": "vaultlist",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "c",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "name": "query - 4 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\n| where resourceGroup in ({ResourceGroup})\n| extend criticality = case(tags.Criticality <> \"\", tags.Criticality,\n    \"Undefined\")\n| extend environment = case(\n    tags.Environment <> \"\", tags.Environment,\n    tags.environment <> \"\", tags.environment,\n    tags.Env <> \"\", tags.Env,\n    tags.env <> \"\", tags.env,\n    tolower(name) contains \"prod\", \"Production\",\n    tolower(name) contains \"dev\", \"Development\",\n    tolower(name) contains \"qa\", \"QA\",\n    tolower(name) contains \"uat\", \"UAT\",\n    tolower(name) contains \"sit\", \"SIT\",\n    tolower(name) contains \"test\", \"Test\",\n    \"Undefined\")\n| where criticality in ({Criticality})\n| where environment in ({Environment})\n| where \n    (type == 'microsoft.compute/virtualmachines') or \n    (type == \"microsoft.compute/virtualmachinescalesets\" and tags.aksEngineVersion !contains \"aks-gomod\") or\n    (type == 'microsoft.web/sites') or \n    (type == \"microsoft.containerservice/managedclusters\") or \n    (type == 'microsoft.sql/servers/databases') or \n    (type == 'microsoft.documentdb/databaseaccounts') or \n    (type == 'microsoft.dbformysql/servers') or \n    (type == 'microsoft.dbformysql/flexibleservers') or \n    (type == \"microsoft.apimanagement/service\") or \n    (type == \"microsoft.storage/storageaccounts\" or type == \"microsoft.classicstorage/storageaccounts\") or \n    (type == \"microsoft.network/azurefirewalls\") or \n    (type == \"microsoft.network/frontdoors\") or \n    (type == \"microsoft.network/applicationgateways\") or \n    (type == \"microsoft.network/loadbalancers\") or \n    (type == \"microsoft.recoveryservices/vaults\")\n| extend aksname = case(\n    type == \"microsoft.containerservice/managedclusters\", tolower(tostring(name)),\n    \"Undefined\"\n    )\n| join kind = leftouter (\n    resources \n    | where type == \"microsoft.compute/virtualmachinescalesets\"\n    | extend aksname = tolower(tostring(split(resourceGroup, \"_\")[2]))\n    | extend AvZones = coalesce(tostring(array_length(parse_json(zones))), 'Not Configured'), AvSets = \"Scale Sets\"\n    )\n    on aksname\n| extend state = case(\n    type == 'microsoft.compute/virtualmachines', tostring(properties.extended.instanceView.powerState.displayStatus),\n    type == 'microsoft.compute/virtualmachinescalesets', tostring(properties.provisioningState),\n    type == 'microsoft.web/sites', tostring(properties.state),\n    type == 'microsoft.containerservice/managedclusters', tostring(properties.provisioningState),\n    type == 'microsoft.sql/servers/databases', tostring(properties.status),\n    type == 'microsoft.documentdb/databaseaccounts', tostring(properties.provisioningState),\n    type == 'microsoft.dbformysql/servers', tostring(properties.userVisibleState),\n    type == 'microsoft.dbformysql/flexibleservers', tostring(properties.state),\n    type == \"microsoft.apimanagement/service\", tostring(properties.provisioningState),\n    type contains \"storageaccounts\", tostring(properties.provisioningState),\n    type == \"microsoft.network/azurefirewalls\", tostring(properties.provisioningState),\n    type == \"microsoft.network/frontdoors\", tostring(properties.resourceState),\n    type == \"microsoft.network/applicationgateways\", tostring(properties.operationalState),\n    type == \"microsoft.network/loadbalancers\", tostring(properties.provisioningState),\n    type == \"microsoft.recoveryservices/vaults\", tostring(properties.provisioningState),\n    \"Undefined\"\n    )\n| extend skuName = case(\n    type == 'microsoft.compute/virtualmachines', tostring(properties.hardwareProfile.vmSize),\n    type == 'microsoft.compute/virtualmachinescalesets', tostring(sku.name),\n    type == 'microsoft.web/sites', tostring(properties.sku),\n    type == 'microsoft.containerservice/managedclusters', tostring(properties.agentPoolProfiles[0].vmSize),\n    type == 'microsoft.sql/servers/databases', tostring(sku.tier),\n    type == 'microsoft.documentdb/databaseaccounts', tostring(properties.databaseAccountOfferType),\n    type == 'microsoft.dbformysql/servers', tostring(sku.tier),\n    type == 'microsoft.dbformysql/flexibleservers', tostring(sku.tier),\n    type == \"microsoft.apimanagement/service\", tostring(sku.name),\n    type contains 'storageaccounts', tostring(replace('-', '_', tostring(iff(type =~ \"microsoft.storage/storageaccounts\", sku.name, properties.accountType)))),\n    type == \"microsoft.network/azurefirewalls\", tostring(properties.sku.name),\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", tostring(properties.sku.name),\n    type == \"microsoft.network/loadbalancers\", tostring(sku.name),\n    type == \"microsoft.recoveryservices/vaults\", tostring(iif(isnotnull(sku.tier), sku.tier, sku.name)),\n    \"Undefined\"\n    )\n| extend avZones = case(\n    location !in~ ('brazilsouth', 'canadacentral', 'centralus', 'eastus', 'eastus2', 'southcentralus', 'usgovvirginia', 'westus2', 'westus3', 'francecentral', 'germanywestcentral', 'northeurope', 'norwayeast', 'uksouth', 'westeurope', 'swedencentral', 'southafricanorth', 'australiaeast', 'centralindia', 'japaneast', 'koreacentral', 'southeastasia', 'eastasia'), 'Not Applicable',\n    (type == 'microsoft.compute/virtualmachines'), coalesce(tostring(zones[0]), 'Not Configured'),\n    (type == 'microsoft.compute/virtualmachinescalesets'), coalesce(tostring(array_length(parse_json(zones))), 'Not Configured'),\n    (type == 'microsoft.containerservice/managedclusters' and AvZones <> \"\"), AvZones,\n    (type == 'microsoft.containerservice/managedclusters' and isempty(AvZones)), \"Not Configured\",\n    (type == 'microsoft.web/sites'), \"Not Applicable\",\n    (type == 'microsoft.sql/servers/databases' and sku.tier <> 'DataWarehouse'), iif(isempty(properties.zoneRedundant) or properties.zoneRedundant == \"false\", 'Not Configured', 'Configured'),\n    (type == 'microsoft.sql/servers/databases' and sku.tier == 'DataWarehouse'), \"Not Applicable\",\n    (type == 'microsoft.documentdb/databaseaccounts'), iif(properties.locations[0].isZoneRedundant == \"false\", 'Not Configured', 'Configured'), \n    (type == 'microsoft.dbformysql/servers'), \"Not Applicable\",\n    (type == 'microsoft.dbformysql/flexibleservers'), iif(properties.haEnabled == \"Enabled\", 'Configured', 'Not Configured'),\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains 'storageaccounts'), case(split(skuName, '_', 1)[0] =~ \"zrs\", \"Configured\", \"Not Configured\"),\n    (type == \"microsoft.network/azurefirewalls\"), iif(isnotnull(zones), \"Configured\", \"Not Configured\"),\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), iif(isnotnull(zones), \"Configured\", \"Not Configured\"),\n    (type == \"microsoft.network/loadbalancers\"), case( \n        skuName =~ \"Basic\", \"Not Applicable\",\n        skuName =~ \"Standard\" and isnotnull(zones), \"Configured\",\n        \"Not Configured\"\n    ),\n    (type == \"microsoft.recoveryservices/vaults\"), \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend avSets = case(\n    type == 'microsoft.compute/virtualmachines' and avZones in ('1', '2', '3'), \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachines', (coalesce(extract('/availabilitySets/(.*)', 1, tostring(properties.availabilitySet.id)), 'Not Configured')),\n    type == 'microsoft.compute/virtualmachinescalesets' and avZones in ('1', '2', '3'), \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachinescalesets', 'A regional (non-zonal) scale set uses placement groups, which act as an implicit availability set with five fault domains and five update domains.',\n    type == 'microsoft.web/sites', 'Not Applicable',\n    type == 'microsoft.containerservice/managedclusters', case(\n        AvSets == 'Scale Sets' and avZones in ('1', '2', '3'), \"Not Applicable\",\n        AvSets == 'Scale Sets', \"A regional (non-zonal) scale set uses placement groups, which act as an implicit availability set with five fault domains and five update domains.\",\n        \"Scale Sets Not Configured\"\n    ),\n    type == 'microsoft.sql/servers/databases', 'Not Applicable',\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', \"Not Applicable\",\n    type == 'microsoft.dbformysql/flexibleservers', \"Not Applicable\",\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", \"Not Applicable\",\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend Capacity = case(\n    type == 'microsoft.compute/virtualmachines', \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachinescalesets', tostring(sku.capacity),\n    type == 'microsoft.web/sites', \"Not Applicable\",\n    type == 'microsoft.containerservice/managedclusters', iif(isnotempty(sku1.capacity), tostring(sku1.capacity), \"0\"), // AKS with or without VMSS\n    type == 'microsoft.sql/servers/databases', tostring(sku.capacity),\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', tostring(sku.capacity),\n    type == 'microsoft.dbformysql/flexibleservers', tostring(sku.capacity),\n    type == \"microsoft.apimanagement/service\", tostring(sku.capacity),\n    type contains \"storageaccounts\", \"Not Applicable\", \n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", tostring(iif(isnotempty(properties.autoscaleConfiguration), properties.autoscaleConfiguration.minCapacity, properties.sku.capacity)),\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend FaultDomain = case(\n    type == 'microsoft.compute/virtualmachines', \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachinescalesets', iif(isnotempty(properties.platformFaultDomainCount), properties.platformFaultDomainCount, \"0\"),  // 1 - AZ, 5 - Regional VMSS\n    type == 'microsoft.web/sites', \"Not Applicable\",\n    type == 'microsoft.containerservice/managedclusters', iif(isnotempty(properties1.platformFaultDomainCount), properties1.platformFaultDomainCount, \"0\"),\n    type == 'microsoft.sql/servers/databases', \"Not Applicable\",\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', 'Not Applicable',\n    type == 'microsoft.dbformysql/flexibleservers', 'Not Applicable',\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", \"Not Applicable\",\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend osDisk = case(\n    type == 'microsoft.compute/virtualmachines', iif(properties.storageProfile.osDisk.diffDiskSettings.option == \"Local\", \"Ephemeral\",  properties.storageProfile.osDisk.managedDisk.storageAccountType),\n    type == 'microsoft.compute/virtualmachinescalesets', iif(properties.virtualMachineProfile.storageProfile.osDisk.diffDiskSettings.option == \"Local\", \"Ephemeral\",  properties.virtualMachineProfile.storageProfile.osDisk.managedDisk.storageAccountType),\n    type == 'microsoft.web/sites', 'Not Applicable',\n    type == 'microsoft.containerservice/managedclusters', iff(properties.agentPoolProfiles[0].osDiskType == 'Ephemeral', 'Ephemeral', properties1.virtualMachineProfile.storageProfile.osDisk.managedDisk.storageAccountType),\n    type == 'microsoft.sql/servers/databases', properties.storageAccountType,\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', 'Not Applicable',\n    type == 'microsoft.dbformysql/flexibleservers', 'Not Applicable',\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", tostring(split(skuName, '_', 0)[0]),\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    'Not Applicable'\n    )\n| extend OSDisk = case(\n    isnotempty(osDisk), osDisk,\n    isempty(osDisk) and (type == 'microsoft.compute/virtualmachines') and state <> 'VM running', 'Unknown, start VM to get disk information.',\n    isempty(osDisk) and (type == 'microsoft.compute/virtualmachines') and isnotempty(properties.storageProfile.osDisk.vhd.uri), 'Unmanaged',\n    \"Unknown\")\n| extend ReadReplica = case (\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters'), \"Not Applicable\",\n    (type == 'microsoft.sql/servers/databases' and sku.tier <> 'DataWarehouse'), tostring(properties.readReplicaCount), // SQL DB\n    (type == 'microsoft.sql/servers/databases' and sku.tier == 'DataWarehouse'), \"Not Applicable\", // Synapse\n    type == 'microsoft.documentdb/databaseaccounts', tostring(array_length(parse_json(properties.readLocations))),\n    type == 'microsoft.dbformysql/servers', \"Not Applicable\",\n    type == 'microsoft.dbformysql/flexibleservers', \"Not Applicable\",\n    type == \"microsoft.apimanagement/service\", tostring(properties.additionalLocations),\n    type contains \"storageaccounts\", case(split(skuName, '_', 1)[0] =~ \"ragrs\", \"Configured\", \"Not Configured\"),\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend AutomaticFailover = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.sql/servers/databases'), \"Not Applicable\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableAutomaticFailover == \"false\" and properties.enableMultipleWriteLocations == \"false\" and toint(ReadReplica) > 1), \"Not Configured\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableAutomaticFailover == \"true\"), \"Configured\",\n    (type == 'microsoft.documentdb/databaseaccounts'), \"Not Applicable\",\n    type == 'microsoft.dbformysql/servers', \"Not Applicable\",\n    type == 'microsoft.dbformysql/flexibleservers', case(properties.haEnabled == \"Enabled\", \"Configured\", \"Not Applicable\"),\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", \"Not Applicable\",\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", iif(isnotempty(properties.autoscaleConfiguration), \"Configured\", \"Not Configured\"),\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend MultipleWriteLocations = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.sql/servers/databases', 'microsoft.dbformysql/servers', 'microsoft.dbformysql/flexibleservers'), \"Not Applicable\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableMultipleWriteLocations == \"false\"), \"Not Enabled\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableMultipleWriteLocations == \"true\"), \"Enabled\",\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains \"storageaccounts\"), \"Not Applicable\",\n    (type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), \"Not Applicable\",\n    (type == \"microsoft.network/loadbalancers\"), \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend StorageAutogrow = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.sql/servers/databases', 'microsoft.documentdb/databaseaccounts'), \"Not Applicable\",\n    (type == 'microsoft.dbformysql/servers'), tostring(properties.storageProfile.storageAutogrow),\n    (type == 'microsoft.dbformysql/flexibleservers'), \"Not Applicable\",\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains \"storageaccounts\"), \"Not Applicable\",\n    (type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), \"Not Applicable\",\n    (type == \"microsoft.network/loadbalancers\"), \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend ReplicationRole = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.documentdb/databaseaccounts'), \"Not Applicable\",\n\t(type == 'microsoft.sql/servers/databases' and sku.tier <> 'DataWarehouse'), iif(isnotempty(properties.secondaryType), \"replica\", \"master\"),\n\t(type == 'microsoft.sql/servers/databases' and sku.tier == 'DataWarehouse'), \"Not Applicable\",\n    (type == 'microsoft.dbformysql/servers'), tostring(properties.replicationRole),\n    (type == 'microsoft.dbformysql/flexibleservers'), iif(properties.haEnabled == \"Enabled\", 'Not Applicable', tostring(properties.replicationRole)),\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains \"storageaccounts\"), tostring(split(skuName, '_', 1)[0]),\n    (type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), \"Not Applicable\",\n    (type == \"microsoft.network/loadbalancers\"), \"Not Applicable\",\n    (type == \"microsoft.recoveryservices/vaults\"), \"Not Applicable\",\n    \"Undefined\"\n    )\n| project \n    Type = tolower(type),\n    SkuName = tolower(skuName),\n    Kind = tolower(kind),\n    SubscriptionId = subscriptionId,\n    Name = tolower(name),\n    State = tolower(state),\n    Location = tolower(location),\n    ResourceGroup = resourceGroup,\n    Zones = tolower(tostring(zones)),\n    AvailabilityZone = tolower(avZones),\n    AvailabilitySet = tolower(avSets),\n    Capacity = tolower(Capacity),\n    FaultDomain = tolower(FaultDomain),\n    OSDisk = tolower(OSDisk),\n    ReadReplica = tolower(ReadReplica), \n    AutomaticFailover = tolower(AutomaticFailover),\n    MultipleWriteLocations = tolower(MultipleWriteLocations),\n    StorageAutogrow = tolower(StorageAutogrow),\n    ReplicationRole = tolower(ReplicationRole),\n    Criticality = criticality,\n    Environment = environment,\n    ResourceId = tolower(tostring(id)),\n    properties\n| join kind = leftouter (\n    securityresources\n    | where properties.displayName contains \"Azure Backup should\"\n    | extend Backup = tostring(properties.status.code)\n    | project ResourceId = tolower(tostring(properties.resourceDetails.Id)), Backup\n    )\n    on ResourceId\n| extend Backup = case(\n    Backup == \"Healthy\" or Backup == \"Unhealthy\", Backup,\n    \"Unknown\")\n| extend Backup = case(\n    (Type == 'microsoft.compute/virtualmachines') and (Backup == \"Healthy\" or Backup == \"Unhealthy\"), Backup, \n    (Type == \"microsoft.compute/virtualmachinescalesets\"), \"Not Applicable\", \n    (Type == \"microsoft.containerservice/managedclusters\"), \"Not Applicable\",\n    (Type == 'microsoft.sql/servers/databases'), \"Not Applicable\", \n    (Type == 'microsoft.documentdb/databaseaccounts'), iif(properties.backupPolicy.periodicModeProperties.backupStorageRedundancy == \"Geo\", \"Healthy\", \"Unhealthy\"),\n    (Type == 'microsoft.dbformysql/servers'), iif(properties.storageProfile.geoRedundantBackup == \"Enabled\", \"Healthy\", \"Unhealthy\"),\n    (Type contains \"storageaccounts\"), \"Not Applicable\",\n    (Type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (Type == \"microsoft.recoveryservices/vaults\"), \"Not Applicable\",\n    \"Unknown\"\n    )\n| extend AvailabilitySet = case(\n    AvailabilitySet == '-', 'None',\n    isnotempty(AvailabilitySet), AvailabilitySet,\n    \"Unknown\")\n| project Type, SkuName, Kind, SubscriptionId, Name, State, Location, ResourceGroup, Zones, AvailabilityZone, AvailabilitySet, Capacity, FaultDomain, OSDisk, ReadReplica, AutomaticFailover, MultipleWriteLocations, StorageAutogrow, ReplicationRole, Backup = tolower(Backup), Criticality, Environment, ResourceId\n| where Type == 'microsoft.recoveryservices/vaults'",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Type",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Kind",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "SubscriptionId",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "succeeded",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "!=",
                                      "thresholdValue": "succeeded",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Zones",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "AvailabilityZone",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "AvailabilitySet",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Capacity",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "FaultDomain",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "OSDisk",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ReadReplica",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "AutomaticFailover",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "MultipleWriteLocations",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "StorageAutogrow",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ReplicationRole",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Backup",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "-- Group By --",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "SubscriptionName",
                                "formatter": 5
                              }
                            ],
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "SubscriptionId",
                                "label": "Subscription"
                              }
                            ]
                          }
                        },
                        "name": "kql_azuresiterecovery_resources_details"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "backuptab",
                    "comparison": "isEqualTo",
                    "value": "vault"
                  },
                  "name": "Vault"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 11,
                        "content": {
                          "version": "LinkItem/1.0",
                          "style": "tabs",
                          "links": [
                            {
                              "id": "c510dd50-fbe9-439a-b092-6b6a1e60bc4d",
                              "cellValue": "submenu",
                              "linkTarget": "parameter",
                              "linkLabel": "Policies",
                              "subTarget": "policylist",
                              "style": "link"
                            },
                            {
                              "id": "c6bfae33-09e2-4b5d-8808-e45a5a369b69",
                              "cellValue": "submenu",
                              "linkTarget": "parameter",
                              "linkLabel": "Adhearance",
                              "subTarget": "adhearance",
                              "style": "link"
                            }
                          ]
                        },
                        "name": "links - 1"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Workspaces}"
                          ],
                          "parameters": [
                            {
                              "id": "396c89aa-fd11-4736-8eb9-40c10a04be21",
                              "version": "KqlParameterItem/1.0",
                              "name": "AggregationType",
                              "type": 1,
                              "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nprint AggregationType=iff(datetime_diff('day',RangeEnd,RangeStart)<=30,\"Daily\",iff(datetime_diff('day',RangeEnd,RangeStart)<=90,\"Weekly\",\"Monthly\"))\r\n\r\n",
                              "crossComponentResources": [
                                "{Workspaces}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "AggregationTypeParam"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "4e6c0062-8388-48ed-9d51-87dce6012e0d",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Subscription",
                                    "label": "Choose Subscription",
                                    "type": 6,
                                    "description": "Choose a subscription",
                                    "isRequired": true,
                                    "multiSelect": true,
                                    "quote": "'",
                                    "delimiter": ",",
                                    "typeSettings": {
                                      "additionalResourceOptions": [
                                        "value::1",
                                        "value::3",
                                        "value::all"
                                      ],
                                      "includeAll": true,
                                      "showDefault": false
                                    },
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "defaultValue": "value::3",
                                    "value": [
                                      "value::all"
                                    ]
                                  },
                                  {
                                    "id": "d32f4df4-51d9-4816-b3d2-a23e18ab65db",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Workspace",
                                    "label": "Choose Workspace",
                                    "type": 5,
                                    "description": "Choose a LA Workspace",
                                    "isRequired": true,
                                    "multiSelect": true,
                                    "quote": "'",
                                    "delimiter": ",",
                                    "query": "Resources\r\n| where type =~ \"Microsoft.operationalinsights/workspaces\"\r\n| summarize by id",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "value": [
                                      "value::all"
                                    ],
                                    "typeSettings": {
                                      "additionalResourceOptions": [
                                        "value::all"
                                      ],
                                      "showDefault": false
                                    },
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources"
                                  }
                                ],
                                "style": "pills",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isNotEqualTo",
                                "value": "summary"
                              },
                              "name": "parameters - 1 - Copy"
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "crossComponentResources": [
                                  "{Subscriptions}"
                                ],
                                "parameters": [
                                  {
                                    "id": "db5ab575-14f6-44d0-bbb9-71c59d0d86b2",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "PolicyName",
                                    "label": "Search Vault or Policy",
                                    "type": 1,
                                    "description": "Use to filter by Vault or Policy name. <br/> To filter for a specific policy in a specific vault use &lt;vault&gt;;&lt;policy&gt;",
                                    "timeContext": {
                                      "durationMs": 0
                                    },
                                    "timeContextFromParameter": "TimeRange"
                                  },
                                  {
                                    "id": "0588c964-1b62-424b-aef3-34f05435548a",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "HasProtectedItems",
                                    "label": "Has Protected Items?",
                                    "type": 2,
                                    "description": "Use to filter the results only for policies associated with one or more protected items",
                                    "isRequired": true,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Yes\", \"label\":\"Yes\" },\r\n    { \"value\":\"No\", \"label\":\"No\" }\r\n]",
                                    "timeContext": {
                                      "durationMs": 0
                                    },
                                    "timeContextFromParameter": "TimeRange"
                                  },
                                  {
                                    "id": "2fd2f893-b2e3-44d8-9326-5f6b9564b3c4",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ScheduleFrequency",
                                    "label": "Schedule Frequency",
                                    "type": 2,
                                    "description": "Use to filter by Backup Frequency of the policy",
                                    "isRequired": true,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"Daily\", \"label\":\"Daily\" },\r\n    { \"value\":\"Weekly\", \"label\":\"Weekly\" }\r\n]",
                                    "timeContext": {
                                      "durationMs": 0
                                    },
                                    "timeContextFromParameter": "TimeRange"
                                  },
                                  {
                                    "id": "0b064ac9-d8fa-4985-83e7-8f41dca55f02",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "RetentionSchedule",
                                    "label": "Retention Type",
                                    "type": 2,
                                    "description": "Use to filter policies where selected Retention Type has been defined",
                                    "isRequired": true,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    { \"value\":\"1 == 1\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"isnotempty(DailyRetention)\", \"label\":\"Daily\" },\r\n    { \"value\":\"isnotempty(WeeklyRetention)\", \"label\":\"Weekly\" },\r\n    { \"value\":\"isnotempty(MonthlyRetention)\", \"label\":\"Monthly\" },\r\n    { \"value\":\"isnotempty(YearlyRetention)\", \"label\":\"Yearly\" }\r\n]",
                                    "timeContext": {
                                      "durationMs": 0
                                    },
                                    "timeContextFromParameter": "TimeRange"
                                  },
                                  {
                                    "id": "1d767e68-5daf-4741-afa5-1dd017d68ba2",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "SnapshotRetention",
                                    "type": 2,
                                    "description": "To filter by number of days the backup snapshot is retained for fast restores. Use zero to view rows with no snapshot retention.",
                                    "isRequired": true,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\": true },\r\n    { \"value\":\"0\", \"label\":\"0\" },\r\n    { \"value\":\"1\", \"label\":\"1\" },\r\n    { \"value\":\"2\", \"label\":\"2\" },\r\n    { \"value\":\"3\", \"label\":\"3\" },\r\n    { \"value\":\"4\", \"label\":\"4\" },\r\n    { \"value\":\"5\", \"label\":\"5\" }\r\n]",
                                    "timeContext": {
                                      "durationMs": 0
                                    },
                                    "timeContextFromParameter": "TimeRange",
                                    "label": "Snapshot Retention"
                                  }
                                ],
                                "style": "pills",
                                "doNotRunWhenHidden": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources"
                              },
                              "customWidth": "100",
                              "name": "PoliciesStandardParameterBlock",
                              "styleSettings": {
                                "margin": "-10px 0% 0% 0%"
                              }
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "crossComponentResources": [
                                  "{Workspaces}"
                                ],
                                "parameters": [
                                  {
                                    "id": "a29464c3-34f0-4d60-82bb-614b8128b7f9",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "PolicyTab_SearchPolicyName",
                                    "label": "Search Policy Name",
                                    "type": 1,
                                    "description": "Use to search by Policy Name",
                                    "timeContext": {
                                      "durationMs": 0
                                    },
                                    "timeContextFromParameter": "TimeRange",
                                    "value": ""
                                  }
                                ],
                                "style": "above",
                                "doNotRunWhenHidden": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "customWidth": "90",
                              "conditionalVisibilities": [
                                {
                                  "parameterName": "TabName",
                                  "comparison": "isEqualTo",
                                  "value": "PolicyDetails"
                                },
                                {
                                  "parameterName": "Workspaces",
                                  "comparison": "isNotEqualTo"
                                },
                                {
                                  "parameterName": "DatasourceType",
                                  "comparison": "isNotEqualTo"
                                }
                              ],
                              "name": "PolicyDetails-SearchParameterBlock",
                              "styleSettings": {
                                "margin": "0% 0% 0% 0%"
                              }
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "RecoveryServicesResources\r\n| where type == 'microsoft.recoveryservices/vaults/backuppolicies'\r\n| extend vaultName = case(type == 'microsoft.recoveryservices/vaults/backuppolicies', split(split(id, 'microsoft.recoveryservices/vaults/')[1],'/')[0],type == 'microsoft.recoveryservices/vaults/backuppolicies', split(split(id, 'microsoft.recoveryservices/vaults/')[1],'/')[0],'--')\r\n| extend datasourceType = case(type == 'microsoft.recoveryservices/vaults/backuppolicies', properties.backupManagementType,type == 'microsoft.dataprotection/backupVaults/backupPolicies',properties.datasourceTypes[0],'--')\r\n| project id,name,vaultName,resourceGroup,properties,datasourceType\r\n| where datasourceType == 'AzureIaasVM'\r\n| summarize c = count() \r\n| extend Item = \"Backup Policies\",  Key = 1 , tit=\"Count\"",
                                "size": 3,
                                "noDataMessageStyle": 5,
                                "exportParameterName": "displayeditem",
                                "exportDefaultValue": "policylist",
                                "queryType": 1,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{Workspace}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Item",
                                    "formatter": 1
                                  },
                                  "subtitleContent": {
                                    "columnMatch": "tit"
                                  },
                                  "leftContent": {
                                    "columnMatch": "c",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    }
                                  },
                                  "showBorder": false,
                                  "size": "auto"
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "customWidth": "15",
                              "name": "Backup Policies"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = true;\r\n// local Params\r\nlet PolicyNameParam =  @\"{PolicyTab_SearchPolicyName}\";\r\nlet ActivePolicyCount = () \r\n{\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n// query to transform function output\r\n| summarize count(UniqueId) by PolicyUniqueId, VaultResourceId\r\n| extend active = iff(PolicyUniqueId != \"\", 1, 0)\r\n| summarize ActivePolicy = sum(active)\r\n| extend  Key = pack_array(\"Active Policies\"), Value = pack_array( ActivePolicy), SubText = pack_array(\"Count\"), Row = pack_array(-2)\r\n| project Key, Value, SubText, Row\r\n| mvexpand  Key, Value, SubText, Row};\r\nlet StorageByStorageReplication = ()\r\n{\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n// query to transform function output\r\n| summarize sum_VaultStore_StorageConsumption_InGBs = sum(VaultStore_StorageConsumptionInMBs)/1024 by VaultStore_StorageReplicationType\r\n| order by VaultStore_StorageReplicationType \r\n// The below two values are temporary VaultStore_StorageReplicationType during vault creation\r\n| where VaultStore_StorageReplicationType !in (\"Invalid\", \"\")\r\n| extend rn = row_number()\r\n| extend  Key = pack_array(VaultStore_StorageReplicationType), Value = pack_array(sum_VaultStore_StorageConsumption_InGBs), SubText = pack_array(\"Cloud Storage (GB)\"), Row = pack_array(rn)\r\n| project Key, Value, SubText, Row\r\n| mvexpand  Key, Value, SubText, Row\r\n};\r\nunion  ActivePolicyCount, StorageByStorageReplication \r\n| order by toint(Row) asc\r\n| order by toint(Row) asc",
                                "size": 3,
                                "noDataMessage": "No records found for the selected time range and scope",
                                "timeContextFromParameter": "TimeRange",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{Workspaces}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Key"
                                  },
                                  "subtitleContent": {
                                    "columnMatch": "SubText"
                                  },
                                  "leftContent": {
                                    "columnMatch": "Value",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 0,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": false,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": false,
                                  "size": "auto"
                                }
                              },
                              "customWidth": "50",
                              "name": "PolicyDetails-Tiles"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = true;\r\nlet AggregationType = @\"{AggregationType}\";\r\n// local Params\r\nlet PolicyNameParam =  @\"{PolicyTab_SearchPolicyName}\";\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstancesTrends(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields, AggregationType)\r\n// query to transform function output\r\n| where PolicyUniqueId != \"\"\r\n| summarize ActivePolicyCount = dcount(strcat(VaultResourceId, PolicyUniqueId), 4) by TimeRangeEndDay =  startofday(TimeGenerated)",
                                "size": 0,
                                "aggregation": 5,
                                "title": "Active Policy Trend",
                                "noDataMessage": "No records found for the selected time range and scope",
                                "timeContextFromParameter": "TimeRange",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{Workspaces}"
                                ],
                                "visualization": "linechart",
                                "gridSettings": {
                                  "sortBy": [
                                    {
                                      "itemKey": "TimeRangeEndDay",
                                      "sortOrder": 2
                                    }
                                  ]
                                },
                                "sortBy": [
                                  {
                                    "itemKey": "TimeRangeEndDay",
                                    "sortOrder": 2
                                  }
                                ],
                                "chartSettings": {
                                  "xAxis": "TimeRangeEndDay",
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "ActivePolicyCount",
                                      "label": "# Active Policies"
                                    }
                                  ]
                                }
                              },
                              "customWidth": "50",
                              "showPin": false,
                              "name": "PolicyDetails-ActivePoliciesTrendGraph"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = true;\r\nlet AggregationType = @\"{AggregationType}\";\r\n// local Params\r\nlet PolicyNameParam =  @\"{PolicyTab_SearchPolicyName}\";\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstancesTrends(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields, AggregationType)\r\n// query to transform function output\r\n| summarize StorageConsumedInGBs = sum(VaultStore_StorageConsumptionInMBs)/(1024) by  TimeRangeEndDay = startofday(TimeGenerated)",
                                "size": 0,
                                "aggregation": 5,
                                "title": "Cloud Storage Trend",
                                "noDataMessage": "No records found for the selected time range and scope",
                                "timeContextFromParameter": "TimeRange",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{Workspaces}"
                                ],
                                "visualization": "linechart",
                                "gridSettings": {
                                  "sortBy": [
                                    {
                                      "itemKey": "TimeRangeEndDay",
                                      "sortOrder": 2
                                    }
                                  ]
                                },
                                "sortBy": [
                                  {
                                    "itemKey": "TimeRangeEndDay",
                                    "sortOrder": 2
                                  }
                                ],
                                "chartSettings": {
                                  "xAxis": "TimeRangeEndDay",
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "StorageConsumedInMBs",
                                      "label": "Cloud Storage (MB)"
                                    },
                                    {
                                      "seriesName": "StorageConsumedInGBs",
                                      "label": "Cloud Storage (GB)"
                                    }
                                  ]
                                }
                              },
                              "customWidth": "50",
                              "showPin": false,
                              "name": "PolicyDetails-CloudStorageTrendGraph"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "<div style=\"text-align:left\"><span style=\"font-size:14px;font-weight:600;\">Backup Instances and Storage by Policy</span> </div>"
                              },
                              "name": "PolicyDetails-GridTitle1",
                              "styleSettings": {
                                "margin": "0% 0% 10px 0%"
                              }
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "5dc2a074-b510-44f2-9530-cfcbd159b59c",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "PolicyTab_SortBy",
                                    "label": "Sort By",
                                    "type": 2,
                                    "description": "Use to sort by a certain column",
                                    "isRequired": true,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[{ \"value\": \"count_UniqueId\", \"label\": \"# BackupItems\" },\r\n{ \"value\": \"sum_VaultStore_StorageConsumptionInMBs\", \"label\": \"Cloud Storage (MB)\", \"selected\": \"true\" }]",
                                    "timeContext": {
                                      "durationMs": 604800000
                                    },
                                    "timeContextFromParameter": "TimeRange"
                                  },
                                  {
                                    "id": "df3cc03c-53f7-4523-a29b-e50bf1b6d922",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "PolicyTab_Order",
                                    "label": "Order",
                                    "type": 2,
                                    "description": "Use to specify the sort order: Ascending/Descending",
                                    "isRequired": true,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    { \"value\":\"Ascending\"},\r\n    { \"value\":\"Descending\", \"selected\":true}\r\n]",
                                    "timeContext": {
                                      "durationMs": 0
                                    },
                                    "timeContextFromParameter": "TimeRange"
                                  },
                                  {
                                    "id": "44b4c590-ecc4-4d3d-840e-16c4638000d4",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "PolicyTab_RowsPerPage",
                                    "label": "Rows Per Page",
                                    "type": 2,
                                    "description": "Number of rows to display in grid view",
                                    "isRequired": true,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    { \"value\":10, \"label\":\"10\", \"selected\":true  },\r\n    { \"value\":25, \"label\":\"25\" },\r\n    { \"value\":50, \"label\":\"50\" },\r\n    { \"value\":100, \"label\":\"100\" },\r\n    { \"value\":250, \"label\":\"250\" },\r\n    { \"value\":500, \"label\":\"500\" },\r\n    { \"value\":1000, \"label\":\"1000\" }\r\n]",
                                    "timeContext": {
                                      "durationMs": 0
                                    },
                                    "timeContextFromParameter": "TimeRange"
                                  },
                                  {
                                    "id": "90478836-8cb6-4235-98a0-7724ac01d29a",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "PolicyTab_Page",
                                    "label": "Page",
                                    "type": 2,
                                    "description": "Select Page Number",
                                    "isRequired": true,
                                    "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = true;\r\n// local Params\r\nlet PolicyNameParam =  @\"{PolicyTab_SearchPolicyName}\";\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n// query to transform function output\r\n| where PolicyUniqueId != \"\"\r\n| where PolicyName contains (PolicyNameParam) or '*' in (PolicyNameParam)\r\n| summarize sum(SourceSizeInMBs), sum(VaultStore_StorageConsumptionInMBs), count(UniqueId), StorageReplicationType = any(VaultStore_StorageReplicationType), PolicyName = any(PolicyName), ResourceId = any(VaultResourceId), PolicyId = any(PolicyId) by PolicyUniqueId, VaultResourceId\r\n| summarize c=count()\r\n| project num = (c-1)/{PolicyTab_RowsPerPage} + 1\r\n| project nums = range(1,num,1), num\r\n| mvexpand nums\r\n| project nums = tostring(nums), num = strcat(tostring(nums),\" of \",tostring(num))",
                                    "crossComponentResources": [
                                      "{Workspaces}"
                                    ],
                                    "value": "1",
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  }
                                ],
                                "style": "above",
                                "doNotRunWhenHidden": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "customWidth": "90",
                              "name": "PolicyDetails-Grid1ParameterBlock",
                              "styleSettings": {
                                "margin": "-23px 0% 0% 0%"
                              }
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "<span style=\"font-size:12px;font-style:italic\"> Click on any row above to see all backup items associated with that policy.</span>"
                              },
                              "name": "text - 65"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = true;\r\n// local Params\r\nlet PolicyNameParam =  @\"{PolicyTab_SearchPolicyName}\";\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n// query to transform function output\r\n| where PolicyUniqueId != \"\"\r\n| where PolicyName contains (PolicyNameParam) or '*' in (PolicyNameParam)\r\n| summarize sum(SourceSizeInMBs), sum(VaultStore_StorageConsumptionInMBs), count(UniqueId), StorageReplicationType = any(VaultStore_StorageReplicationType), PolicyName = any(PolicyName), Vault = any(VaultResourceId), PolicyId = any(PolicyId) by PolicyUniqueId, VaultResourceId\r\n| extend TempColumn = column_ifexists(tostring('{PolicyTab_SortBy}'), \"sum_VaultStore_StorageConsumptionInMBs\")\r\n| extend ColumnToBeSorted = iff(tostring('{PolicyTab_Order}') == \"Ascending\", todouble(TempColumn) - 90000000, 90000000 - todouble(TempColumn))\r\n| sort by ColumnToBeSorted asc nulls last, PolicyId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{PolicyTab_RowsPerPage} + 1))\r\n| where page_num has ('{PolicyTab_Page}') or '*' in ('{PolicyTab_Page}') \r\n| project PolicyId, PolicyName, BackupInstances=count_UniqueId, CloudStorage = sum_VaultStore_StorageConsumptionInMBs/1024, Vault, StorageReplicationType, VaultAndPolicyUniqueId = strcat(Vault,PolicyUniqueId)",
                                "size": 3,
                                "noDataMessage": "No records found for the selected time range and scope",
                                "timeContextFromParameter": "TimeRange",
                                "exportFieldName": "VaultAndPolicyUniqueId",
                                "exportParameterName": "PolicyTab_VaultAndPolicyUniqueId",
                                "exportDefaultValue": "*",
                                "showExportToExcel": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{Workspaces}"
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "PolicyId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "PolicyName",
                                      "formatter": 0,
                                      "formatOptions": {
                                        "customColumnWidthSetting": "20%"
                                      },
                                      "tooltipFormat": {
                                        "tooltip": "Name of the policy"
                                      }
                                    },
                                    {
                                      "columnMatch": "BackupInstances",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "blue",
                                        "customColumnWidthSetting": "20%"
                                      },
                                      "tooltipFormat": {
                                        "tooltip": "Number of backup instances associated with the given policy"
                                      }
                                    },
                                    {
                                      "columnMatch": "CloudStorage",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "blue",
                                        "customColumnWidthSetting": "20%"
                                      },
                                      "tooltipFormat": {
                                        "tooltip": "Total cloud storage consumed by backup instances associated with the given policy, as of the end of the selected time range"
                                      }
                                    },
                                    {
                                      "columnMatch": "Vault",
                                      "formatter": 0,
                                      "formatOptions": {
                                        "customColumnWidthSetting": "20%"
                                      },
                                      "tooltipFormat": {
                                        "tooltip": "Vault associated with the policy"
                                      }
                                    },
                                    {
                                      "columnMatch": "StorageReplicationType",
                                      "formatter": 0,
                                      "formatOptions": {
                                        "customColumnWidthSetting": "20%"
                                      },
                                      "tooltipFormat": {
                                        "tooltip": "Storage replication type associated with the policy"
                                      }
                                    },
                                    {
                                      "columnMatch": "VaultAndPolicyUniqueId",
                                      "formatter": 5
                                    }
                                  ],
                                  "labelSettings": [
                                    {
                                      "columnId": "PolicyName",
                                      "label": "Policy Name"
                                    },
                                    {
                                      "columnId": "BackupInstances",
                                      "label": "# Backup Instances"
                                    },
                                    {
                                      "columnId": "CloudStorage",
                                      "label": "Cloud Storage (GB)"
                                    },
                                    {
                                      "columnId": "StorageReplicationType",
                                      "label": "Storage Replication Type"
                                    }
                                  ]
                                },
                                "sortBy": []
                              },
                              "name": "PolicyDetails-Grid1",
                              "styleSettings": {
                                "margin": "-30px 0% 0% 0%",
                                "showBorder": true
                              }
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "<div style=\"text-align:left\"><span style=\"font-size:14px;font-weight:600;\">List of Backup Items associated with the selected Policy</span> </div>"
                              },
                              "name": "PolicyDetails-Grid2Title",
                              "styleSettings": {
                                "margin": "0% 0% 10px 0%"
                              }
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "7bb4a71d-d932-4737-8715-d378be7ffba5",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "PolicyTab_SortBy_2",
                                    "label": "Sort By",
                                    "type": 2,
                                    "description": "Use to sort by a certain column",
                                    "isRequired": true,
                                    "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n{ \\\"value\\\": \\\"VaultStore_StorageConsumptionInMBs\\\", \\\"label\\\": \\\"Cloud Storage (MB)\\\", \\\"selected\\\": \\\"true\\\" }]\",\"transformers\":null}",
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "timeContext": {
                                      "durationMs": 604800000
                                    },
                                    "timeContextFromParameter": "TimeRange",
                                    "queryType": 8
                                  },
                                  {
                                    "id": "595e5629-4f64-4038-bff5-5f3371259caa",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "PolicyTab_Order_2",
                                    "label": "Order",
                                    "type": 2,
                                    "description": "Use to specify the sort order: Ascending/Descending",
                                    "isRequired": true,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    { \"value\":\"Ascending\"},\r\n    { \"value\":\"Descending\", \"selected\":true}\r\n]",
                                    "timeContext": {
                                      "durationMs": 0
                                    },
                                    "timeContextFromParameter": "TimeRange"
                                  },
                                  {
                                    "id": "0e4b3406-91aa-452e-90b2-6b22e71f0b82",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "PolicyTab_RowsPerPage_2",
                                    "label": "Rows Per Page",
                                    "type": 2,
                                    "description": "Number of rows to display in grid view",
                                    "isRequired": true,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    { \"value\":10, \"label\":\"10\", \"selected\":true  },\r\n    { \"value\":25, \"label\":\"25\" },\r\n    { \"value\":50, \"label\":\"50\" },\r\n    { \"value\":100, \"label\":\"100\" },\r\n    { \"value\":250, \"label\":\"250\" },\r\n    { \"value\":500, \"label\":\"500\" },\r\n    { \"value\":1000, \"label\":\"1000\" }\r\n]",
                                    "timeContext": {
                                      "durationMs": 0
                                    },
                                    "timeContextFromParameter": "TimeRange"
                                  },
                                  {
                                    "id": "d1b7fe67-8c02-431c-904c-f82238dd112e",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "PolicyTab_Page_2",
                                    "label": "Page",
                                    "type": 2,
                                    "description": "Select Page Number",
                                    "isRequired": true,
                                    "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = true;\r\n// local Params\r\nlet VaultAndPolicyUniqueIdParam =  @\"{PolicyTab_VaultAndPolicyUniqueId}\";\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n// query to transform function output\r\n| where strcat(VaultResourceId, PolicyUniqueId) == (VaultAndPolicyUniqueIdParam) or '*' in (VaultAndPolicyUniqueIdParam)\r\n| summarize c=count()\r\n| project num = (c-1)/{PolicyTab_RowsPerPage_2} + 1\r\n| project nums = range(1,num,1), num\r\n| mvexpand nums\r\n| project nums = tostring(nums), num = strcat(tostring(nums),\" of \",tostring(num))",
                                    "crossComponentResources": [
                                      "{Workspaces}"
                                    ],
                                    "value": "1",
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  }
                                ],
                                "style": "above",
                                "doNotRunWhenHidden": true,
                                "queryType": 8
                              },
                              "customWidth": "90",
                              "name": "PolicyDetails-Grid2ParameterBlock",
                              "styleSettings": {
                                "margin": "-23px 0% 0% 0%"
                              }
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = true;\r\n// local Params\r\nlet VaultAndPolicyUniqueIdParam =  @\"{PolicyTab_VaultAndPolicyUniqueId}\";\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n// query to transform function output\r\n| where strcat(VaultResourceId, PolicyUniqueId) == (VaultAndPolicyUniqueIdParam) or '*' in (VaultAndPolicyUniqueIdParam)\r\n| extend TempColumn = column_ifexists(tostring('{PolicyTab_SortBy_2}'), \"VaultStore_StorageConsumptionInMBs\")\r\n| extend ColumnToBeSorted = iff(tostring('{PolicyTab_Order_2}') == \"Ascending\", todouble(TempColumn) - 90000000, 90000000 - todouble(TempColumn))\r\n| sort by ColumnToBeSorted asc nulls last, UniqueId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{PolicyTab_RowsPerPage_2} + 1))\r\n| where page_num has ('{PolicyTab_Page_2}') or '*' in ('{PolicyTab_Page_2}')\r\n| project BackupInstance=FriendlyName, Id, Container=DatasourceSetFriendlyName, ResourceGroup=iff(DatasourceType==\"Azure Backup Agent\" or DatasourceType==\"Azure Backup Server\" or DatasourceType==\"DPM\",\"(none)\",split(split(tostring(tolower(DatasourceSetResourceId)), '/resourcegroups/')[1],'/')[0]\r\n), Policy=PolicyName, CloudStorage=VaultStore_StorageConsumptionInMBs/1024, Vault=VaultResourceId, StorageReplicationType=VaultStore_StorageReplicationType, AzureResource=DatasourceSetResourceId, DatasourceType",
                                "size": 3,
                                "noDataMessage": "No records found for the selected time range and scope",
                                "timeContextFromParameter": "TimeRange",
                                "exportFieldName": "BackupItemUniqueId",
                                "exportParameterName": "SelectedBackupItemUniqueId",
                                "exportDefaultValue": "*",
                                "showExportToExcel": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{Workspaces}"
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "BackupInstance",
                                      "formatter": 16,
                                      "formatOptions": {
                                        "showIcon": true
                                      },
                                      "tooltipFormat": {
                                        "tooltip": "Name of the backup instance"
                                      }
                                    },
                                    {
                                      "columnMatch": "Id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Container",
                                      "formatter": 0,
                                      "tooltipFormat": {
                                        "tooltip": "Protected container associated with the backup instance"
                                      }
                                    },
                                    {
                                      "columnMatch": "Policy",
                                      "formatter": 0,
                                      "tooltipFormat": {
                                        "tooltip": "Policy associated with the backup instance"
                                      }
                                    },
                                    {
                                      "columnMatch": "CloudStorage",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "blue"
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal",
                                          "minimumFractionDigits": 2,
                                          "maximumFractionDigits": 2
                                        }
                                      },
                                      "tooltipFormat": {
                                        "tooltip": "Total cloud storage consumed by the backup instance, as of the end of the selected time range"
                                      }
                                    },
                                    {
                                      "columnMatch": "Vault",
                                      "formatter": 0,
                                      "tooltipFormat": {
                                        "tooltip": "Vault associated with the backup instance"
                                      }
                                    },
                                    {
                                      "columnMatch": "StorageReplicationType",
                                      "formatter": 0,
                                      "tooltipFormat": {
                                        "tooltip": "Storage replication type associated with the backup instance"
                                      }
                                    },
                                    {
                                      "columnMatch": "AzureResource",
                                      "formatter": 0,
                                      "tooltipFormat": {
                                        "tooltip": "Azure Resource associated with the backup instance. For Azure VM Backup, SQL in Azure VM backup and SAP database in Azure VM backup, the Azure Resource is the Azure VM. For Azure Files Share backup, the Azure Resource is the Azure Storage account. For on-premises backup instances, this field is blank."
                                      }
                                    },
                                    {
                                      "columnMatch": "DatasourceType",
                                      "formatter": 0,
                                      "tooltipFormat": {
                                        "tooltip": "DatasourceType"
                                      }
                                    },
                                    {
                                      "columnMatch": "UniqueId",
                                      "formatter": 5
                                    }
                                  ],
                                  "labelSettings": [
                                    {
                                      "columnId": "BackupInstance",
                                      "label": "Backup Instance"
                                    },
                                    {
                                      "columnId": "ResourceGroup",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "CloudStorage",
                                      "label": "Cloud Storage (GB)"
                                    },
                                    {
                                      "columnId": "StorageReplicationType",
                                      "label": "Storage Replication Type"
                                    },
                                    {
                                      "columnId": "AzureResource",
                                      "label": "Azure Resource"
                                    },
                                    {
                                      "columnId": "DatasourceType",
                                      "label": "Datasource Type"
                                    }
                                  ]
                                },
                                "sortBy": []
                              },
                              "showPin": true,
                              "name": "PolicyDetails-Grid2",
                              "styleSettings": {
                                "margin": "-30px 0% 0% 0%",
                                "showBorder": true
                              }
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "recoveryservicesresources\r\n| where type == \"microsoft.recoveryservices/vaults/backuppolicies\"\r\n| where properties.backupManagementType == \"AzureIaasVM\"\r\n| extend vaultId = tolower(replace(\"\\\\/backupPolicies.*\",\"\",id))\r\n| extend PolicyId = tolower(id)\r\n| join kind = leftouter\r\n(\r\n    recoveryservicesresources\r\n    | where type == \"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems\"\r\n\t| where properties.backupManagementType == \"AzureIaasVM\"\r\n    | summarize ProtectedItems = count() by PolicyId = tolower(tostring(properties.policyId))\r\n) on PolicyId\r\n| project id,\r\n          PolicyName = replace(\".*\\\\/backupPolicies\\\\/\",\"\",id),\r\n\t\t  vaultId,\r\n\t\t  VaultName = replace(\".*\\\\/vaults\\\\/\",\"\",vaultId),\r\n\t\t  ProtectedItems,\r\n          RunTime = strcat(tostring(properties.schedulePolicy.scheduleRunTimes[0]),\" \",iff(isempty(tostring(properties.timeZone)),\"UTC\",tostring(properties.timeZone))),\r\n          Frequency = tostring(properties.schedulePolicy.scheduleRunFrequency),\r\n          RunDays = tostring(properties.schedulePolicy.scheduleRunDays),\r\n \t      SnapshotRetention = iff(isempty(tostring(properties.instantRpRetentionRangeInDays)),\"2\",tostring(properties.instantRpRetentionRangeInDays)),\r\n          DailyRetention = tostring(properties.retentionPolicy.dailySchedule.retentionDuration.['count']),\r\n          WeeklyRetention = tostring(properties.retentionPolicy.weeklySchedule.retentionDuration.['count']),\r\n          MonthlyRetention = tostring(properties.retentionPolicy.monthlySchedule.retentionDuration.['count']),\r\n          YearlyRetention = tostring(properties.retentionPolicy.yearlySchedule.retentionDuration.['count']),\r\n\t\t  Daily = \"Daily\", Weekly = \"Weekly\", Monthly = \"Monthly\", Yearly = \"Yearly\"\r\n| where strcat(VaultName,\";\",PolicyName) contains (@\"{PolicyName}\")\r\n| where (isnull(ProtectedItems) and \"{HasProtectedItems}\" == \"No\") or (isnotnull(ProtectedItems) and \"{HasProtectedItems}\" == \"Yes\") or (strcat(tostring(ProtectedItems),\"{HasProtectedItems}\") contains \"All\") \r\n| where Frequency == \"{ScheduleFrequency}\" or strcat(Frequency,\"{ScheduleFrequency}\") contains \"All\"\r\n| where {RetentionSchedule}\r\n| where SnapshotRetention == \"{SnapshotRetention}\" or strcat(SnapshotRetention,\"{SnapshotRetention}\") contains \"All\" or (isempty(SnapshotRetention) and strcat(SnapshotRetention,\"{SnapshotRetention}\") contains \"0\")\r\n| project id, PolicyName, vaultId, ProtectedItems, RunTime, BackupFrequency = Frequency, RunDays, SnapshotRetention,\r\n          DailyRetention = iff(isnotempty(DailyRetention),strcat(DailyRetention,\" days \"),DailyRetention),\r\n\t\t  WeeklyRetention = iff(isnotempty(WeeklyRetention),strcat(WeeklyRetention,\" weeks \"),WeeklyRetention),\r\n\t\t  MonthlyRetention = iff(isnotempty(MonthlyRetention),strcat(MonthlyRetention,\" months \"),MonthlyRetention),\r\n\t\t  YearlyRetention = iff(isnotempty(YearlyRetention),strcat(YearlyRetention,\" years \"),YearlyRetention)\r\n| project id, PolicyName, vaultId, ProtectedItems, SnapshotRetention,\r\n          MaxRetention = iff(isempty(YearlyRetention),iff(isempty(MonthlyRetention),iff(isempty(WeeklyRetention),DailyRetention,WeeklyRetention),MonthlyRetention),YearlyRetention), DailyRetention=DailyRetention,WeeklyRetention = WeeklyRetention,MonthlyRetention=MonthlyRetention,YearlyRetention=YearlyRetention, BackupFrequency\r\n          \r\n| sort by ProtectedItems desc, tolower(PolicyName) asc, id asc\r\n\r\n",
                                "size": 3,
                                "title": "List of Active + Non Active Policy",
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Workspace}"
                                ],
                                "gridSettings": {
                                  "filter": true,
                                  "labelSettings": [
                                    {
                                      "columnId": "id",
                                      "label": "Policy"
                                    },
                                    {
                                      "columnId": "PolicyName",
                                      "label": "Name"
                                    },
                                    {
                                      "columnId": "vaultId",
                                      "label": "Vault ID"
                                    },
                                    {
                                      "columnId": "ProtectedItems",
                                      "label": "Protection Status"
                                    },
                                    {
                                      "columnId": "SnapshotRetention",
                                      "label": "Snapshot Retention"
                                    },
                                    {
                                      "columnId": "MaxRetention",
                                      "label": "Max Retention"
                                    },
                                    {
                                      "columnId": "DailyRetention",
                                      "label": "Daily Retention"
                                    },
                                    {
                                      "columnId": "WeeklyRetention",
                                      "label": "Weekly Retention"
                                    },
                                    {
                                      "columnId": "MonthlyRetention",
                                      "label": "Monthly Retention"
                                    },
                                    {
                                      "columnId": "YearlyRetention",
                                      "label": "Yearly Retention"
                                    },
                                    {
                                      "columnId": "BackupFrequency",
                                      "label": "Backup Frequency"
                                    }
                                  ]
                                }
                              },
                              "customWidth": "100",
                              "name": "query - 5"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "submenu",
                          "comparison": "isEqualTo",
                          "value": "policylist"
                        },
                        "name": "Policy List"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "2373a24f-ad32-4909-a7f6-59b373dcde6c",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Workspaces",
                                    "type": 5,
                                    "description": "LA Workspaces configured in vault diagnostic settings",
                                    "isRequired": true,
                                    "multiSelect": true,
                                    "quote": "'",
                                    "delimiter": ",",
                                    "query": "where type =~ 'microsoft.operationalinsights/workspaces' | project id",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "typeSettings": {
                                      "additionalResourceOptions": [
                                        "value::all"
                                      ],
                                      "showDefault": false
                                    },
                                    "defaultValue": "value::all",
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources"
                                  },
                                  {
                                    "id": "64dd748f-d528-4912-a3bf-4a503e0b17f6",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "VaultsUsingAzureDiagnostics",
                                    "type": 1,
                                    "query": "// function Params - Report Filters\r\nlet RangeStart = startofday(ago(3d));\r\nlet RangeEnd = startofday(now());\r\nlet VaultSubscriptionList = \"*\";\r\nlet VaultLocationList = \"*\"; \r\nlet VaultList = \"*\";\r\nlet VaultTypeList = \"*\";\r\nlet ExcludeLegacyEvent_1 = false;\r\nlet ExcludeLegacyEvent_2 = true;\r\n// calling LA System Function\r\n_AzureBackup_GetVaults(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent_1) | distinct Id\r\n| join kind = leftanti ( \r\n// calling LA System Function\r\n_AzureBackup_GetVaults(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent_2) | distinct Id) on Id\r\n| count ",
                                    "crossComponentResources": [
                                      "{Workspaces}"
                                    ],
                                    "isHiddenWhenLocked": true,
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  {
                                    "id": "d894d309-7e5f-488e-afde-73796c84b711",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "AzureStorageCutOffDate",
                                    "type": 1,
                                    "description": "Cut-off Date To Enable AzureStorage",
                                    "isRequired": true,
                                    "query": "{\"version\":\"1.0.0\",\"content\":\"\\\"5/14/2020, 12:00:00.000 AM\\\"\",\"transformers\":null}",
                                    "isHiddenWhenLocked": true,
                                    "queryType": 8
                                  },
                                  {
                                    "id": "aabf4e52-2fb9-4fe0-96db-c6dd8f1995ce",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "TimeRange",
                                    "label": "Time Range",
                                    "type": 4,
                                    "typeSettings": {
                                      "selectableValues": [
                                        {
                                          "durationMs": 300000
                                        },
                                        {
                                          "durationMs": 900000
                                        },
                                        {
                                          "durationMs": 1800000
                                        },
                                        {
                                          "durationMs": 3600000
                                        },
                                        {
                                          "durationMs": 14400000
                                        },
                                        {
                                          "durationMs": 43200000
                                        },
                                        {
                                          "durationMs": 86400000
                                        },
                                        {
                                          "durationMs": 172800000
                                        },
                                        {
                                          "durationMs": 259200000
                                        },
                                        {
                                          "durationMs": 604800000
                                        },
                                        {
                                          "durationMs": 1209600000
                                        },
                                        {
                                          "durationMs": 2419200000
                                        },
                                        {
                                          "durationMs": 2592000000
                                        },
                                        {
                                          "durationMs": 5184000000
                                        },
                                        {
                                          "durationMs": 7776000000
                                        }
                                      ]
                                    },
                                    "value": {
                                      "durationMs": 259200000
                                    }
                                  },
                                  {
                                    "id": "0b719877-b54c-4ffa-8639-93b43e62488c",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ExcludeLegacyEvent",
                                    "label": "Exclude Legacy Table",
                                    "type": 2,
                                    "isRequired": true,
                                    "typeSettings": {
                                      "additionalResourceOptions": []
                                    },
                                    "jsonData": "[\r\n    { \"value\":\"True\",  \"selected\":true},\r\n    { \"value\":\"False\"}\r\n]"
                                  }
                                ],
                                "style": "pills",
                                "doNotRunWhenHidden": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "customWidth": "50",
                              "name": "Overview-WorkspaceParameterBlock"
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "8ce61d1d-e371-40bf-ad53-7ba78afb976f",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "DatasourceType",
                                    "label": "Backup Solution",
                                    "type": 2,
                                    "description": "Use to filter reports by backup solution",
                                    "isRequired": true,
                                    "multiSelect": true,
                                    "quote": "",
                                    "delimiter": ",",
                                    "value": [
                                      "value::all"
                                    ],
                                    "typeSettings": {
                                      "additionalResourceOptions": [
                                        "value::all"
                                      ],
                                      "selectAllValue": "*",
                                      "showDefault": false
                                    },
                                    "jsonData": "\r\n[    \r\n{ \"value\": \"Azure Backup Agent\", \t\t\t\t\t\t\"label\": \"Azure Backup Agent\" },\r\n{ \"value\": \"Azure Backup Server\", \t\t\t\"label\": \"Azure Backup Server\" },\r\n{ \"value\": \"Azure Storage (Azure Files) Backup\", \t\t\t\t\"label\": \"Azure Storage (Azure Files) Backup\" },\r\n{ \"value\": \"Azure Virtual Machine Backup\", \t\t\t\t\t\t\"label\": \"Azure Virtual Machine Backup\" },\r\n{ \"value\": \"DPM\", \t\t\t\t\t\t\"label\": \"DPM\" },\r\n{ \"value\": \"SAP HANA in Azure VM Backup\", \"label\": \"SAP HANA in Azure VM Backup\" },\r\n{ \"value\": \"SQL in Azure VM Backup\",     \"label\": \"SQL in Azure VM Backup\" }\r\n]"
                                  },
                                  {
                                    "id": "678680e5-76b5-4db8-bbef-5f73942caf2e",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "VaultSubscription",
                                    "label": "Vault Subscription",
                                    "type": 6,
                                    "description": "Subscription(s) under which the vault(s) exist",
                                    "isRequired": true,
                                    "multiSelect": true,
                                    "quote": "",
                                    "delimiter": ",",
                                    "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = \"*\";\r\nlet VaultLocationList = \"*\";\r\nlet VaultList = \"*\";\r\nlet VaultTypeList = \"*\";\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = false;\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n// query to transform function output\r\n| distinct VaultSubscriptionId",
                                    "crossComponentResources": [
                                      "{Workspaces}"
                                    ],
                                    "typeSettings": {
                                      "additionalResourceOptions": [
                                        "value::all"
                                      ],
                                      "selectAllValue": "*",
                                      "showDefault": false
                                    },
                                    "timeContext": {
                                      "durationMs": 0
                                    },
                                    "timeContextFromParameter": "TimeRange",
                                    "defaultValue": "value::all",
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  {
                                    "id": "2a83acc5-2123-476f-8a4c-da2fddf231a1",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "VaultLocation",
                                    "label": "Vault Location",
                                    "type": 2,
                                    "description": "Location(s) in which the vault(s) were created",
                                    "isRequired": true,
                                    "multiSelect": true,
                                    "quote": "",
                                    "delimiter": ",",
                                    "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = \"*\";\r\nlet VaultList = \"*\";\r\nlet VaultTypeList = \"*\";\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet DisplayAllFields = false;\r\n// calling LA System Function\r\n_AzureBackup_GetBackupInstances(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n// query to transform function output\r\n| distinct VaultLocation",
                                    "crossComponentResources": [
                                      "{Workspaces}"
                                    ],
                                    "value": [
                                      "value::all"
                                    ],
                                    "typeSettings": {
                                      "additionalResourceOptions": [
                                        "value::all"
                                      ],
                                      "selectAllValue": "*",
                                      "showDefault": false
                                    },
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  {
                                    "id": "fefd31fa-2774-43ca-8cc3-44d477c969f0",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "VaultName",
                                    "label": "Vault Name",
                                    "type": 2,
                                    "description": "Name(s) of the vault(s)",
                                    "isRequired": true,
                                    "multiSelect": true,
                                    "quote": "",
                                    "delimiter": ",",
                                    "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultList = \"*\";\r\nlet VaultTypeList = \"*\";\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\n// calling LA System Function\r\n_AzureBackup_GetVaults(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent)\r\n// query to transform function output\r\n| distinct Name ",
                                    "crossComponentResources": [
                                      "{Workspaces}"
                                    ],
                                    "typeSettings": {
                                      "additionalResourceOptions": [
                                        "value::all"
                                      ],
                                      "selectAllValue": "*",
                                      "showDefault": false
                                    },
                                    "timeContext": {
                                      "durationMs": 0
                                    },
                                    "timeContextFromParameter": "TimeRange",
                                    "defaultValue": "value::all",
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  }
                                ],
                                "style": "pills",
                                "doNotRunWhenHidden": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "conditionalVisibility": {
                                "parameterName": "Workspaces",
                                "comparison": "isNotEqualTo"
                              },
                              "name": "Overview-ReportParameterBlock"
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "crossComponentResources": [
                                  "{Workspaces}"
                                ],
                                "parameters": [
                                  {
                                    "id": "3c5a3e26-bce4-43d9-a22d-e963a0d734af",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "ResourceGroupId",
                                    "type": 1,
                                    "query": "resources | where type==\"microsoft.operationalinsights/workspaces\" | project name, resourceGroupId=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",resourceGroup) | where \"{Workspaces}\" contains name | project resourceGroupId | take 1",
                                    "crossComponentResources": [
                                      "{Subscriptions}"
                                    ],
                                    "isHiddenWhenLocked": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources"
                                  },
                                  {
                                    "id": "897957ad-a946-4b3b-98f0-02008d30ff0f",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "WorkspaceName",
                                    "type": 1,
                                    "query": "resources | where type==\"microsoft.operationalinsights/workspaces\" \r\n| project name, resourceGroupId=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",resourceGroup) \r\n| where \"{Workspaces}\" contains name \r\n| where \"{ResourceGroupId}\" has resourceGroupId\r\n| take 1\r\n",
                                    "crossComponentResources": [
                                      "{Subscriptions}"
                                    ],
                                    "isHiddenWhenLocked": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources"
                                  },
                                  {
                                    "version": "KqlParameterItem/1.0",
                                    "name": "WorkspaceResourceGroup",
                                    "type": 1,
                                    "query": "resources | where type==\"microsoft.operationalinsights/workspaces\" \r\n| project name, resourceGroupId=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",resourceGroup), resourceGroup, subscriptionId \r\n| where \"{WorkspaceName}\" has name \r\n| where \"{ResourceGroupId}\" has resourceGroupId\r\n| take 1\r\n| project resourceGroup\r\n",
                                    "crossComponentResources": [
                                      "{Subscriptions}"
                                    ],
                                    "isHiddenWhenLocked": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "id": "75065a95-e81f-470f-805e-427558ee0ea3"
                                  },
                                  {
                                    "version": "KqlParameterItem/1.0",
                                    "name": "WorkspaceSubscriptionId",
                                    "type": 1,
                                    "query": "resources | where type==\"microsoft.operationalinsights/workspaces\" \r\n| project name, resourceGroupId=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",resourceGroup), resourceGroup, subscriptionId \r\n| where \"{WorkspaceName}\" has name \r\n| where \"{ResourceGroupId}\" has resourceGroupId\r\n| take 1\r\n| project subscriptionId\r\n",
                                    "crossComponentResources": [
                                      "{Subscriptions}"
                                    ],
                                    "isHiddenWhenLocked": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "id": "2581aa73-ab5f-4f2c-82f1-1b4d0f9708ad"
                                  },
                                  {
                                    "id": "5327529a-bd07-4305-bf65-4b36a3c787b9",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "LogicApp_VaultSubscriptionList",
                                    "type": 1,
                                    "query": "let VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nprint VaultSubscriptionList",
                                    "crossComponentResources": [
                                      "{Workspaces}"
                                    ],
                                    "isHiddenWhenLocked": true,
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  {
                                    "id": "e404488a-5db7-42ba-9b44-996f1d8cd7b2",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "LogicApp_VaultLocationList",
                                    "type": 1,
                                    "query": "let VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nprint VaultLocationList",
                                    "crossComponentResources": [
                                      "{Workspaces}"
                                    ],
                                    "isHiddenWhenLocked": true,
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  {
                                    "id": "8005c310-7839-42ff-a3a4-01e5a6c45223",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "LogicApp_VaultList",
                                    "type": 1,
                                    "query": "let VaultList = todynamic( @\"{VaultName}\"); \r\nprint VaultList",
                                    "crossComponentResources": [
                                      "{Workspaces}"
                                    ],
                                    "isHiddenWhenLocked": true,
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  {
                                    "id": "2e3d4cd7-7393-4cc4-ab9e-793311eb291c",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "LogicApp_DatasourceTypeList",
                                    "type": 1,
                                    "query": "let DatasourceTypeList = @\"{DatasourceType}\";\r\nprint DatasourceTypeList",
                                    "crossComponentResources": [
                                      "{Workspaces}"
                                    ],
                                    "isHiddenWhenLocked": true,
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  {
                                    "id": "376631ff-44ae-4824-b470-ac32d82cd4f2",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "LogicApp_ExcludeLegacyEvent",
                                    "type": 1,
                                    "query": "let ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nprint ExcludeLegacyEvent",
                                    "crossComponentResources": [
                                      "{Workspaces}"
                                    ],
                                    "isHiddenWhenLocked": true,
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  {
                                    "id": "5d1a9bc1-34ab-491d-bfa6-f7fc8402f3dc",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "LogicApp_AggregationType",
                                    "type": 1,
                                    "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nprint AggregationType=iff(datetime_diff('day',RangeEnd,RangeStart)<=30,\"Daily\",iff(datetime_diff('day',RangeEnd,RangeStart)<=90,\"Weekly\",\"Monthly\"))\r\n\r\n\r\n\r\n\r\n\r\n",
                                    "crossComponentResources": [
                                      "{Workspaces}"
                                    ],
                                    "isHiddenWhenLocked": true,
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  {
                                    "id": "892dcb11-ee52-478b-aac2-10892fb837ae",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "LogicApp_TimeRangeInDays",
                                    "type": 1,
                                    "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = startofday({TimeRange:end});\r\nprint TimeRangeInDays = datetime_diff('day',RangeEnd,RangeStart)\r\n\r\n",
                                    "crossComponentResources": [
                                      "{Workspaces}"
                                    ],
                                    "isHiddenWhenLocked": true,
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  }
                                ],
                                "style": "above",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "customWidth": "60",
                              "conditionalVisibility": {
                                "parameterName": "Workspaces",
                                "comparison": "isNotEqualTo"
                              },
                              "name": "Overview-ReportParameterBlock - Copy",
                              "styleSettings": {
                                "maxWidth": "100%"
                              }
                            },
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "items": [
                                  {
                                    "type": 12,
                                    "content": {
                                      "version": "NotebookGroup/1.0",
                                      "groupType": "editable",
                                      "items": [
                                        {
                                          "type": 11,
                                          "content": {
                                            "version": "LinkItem/1.0",
                                            "style": "tabs",
                                            "links": [
                                              {
                                                "id": "eb1c9bce-f681-4fd9-939c-9515f911494a",
                                                "cellValue": "PolicyAdherence_SubTab",
                                                "linkTarget": "parameter",
                                                "linkLabel": "Policy Adherence by Time Period",
                                                "subTarget": "Policy Adherence by Time Period",
                                                "preText": "Policy Adherence by Time Period",
                                                "style": "link"
                                              },
                                              {
                                                "id": "d641ca7e-8ca3-4ff9-a536-129243f877b6",
                                                "cellValue": "PolicyAdherence_SubTab",
                                                "linkTarget": "parameter",
                                                "linkLabel": "Policy Adherence by Backup Instance",
                                                "subTarget": "Policy Adherence by Backup Instance",
                                                "style": "link"
                                              }
                                            ]
                                          },
                                          "name": "PolicyAdherenceSubTabs"
                                        },
                                        {
                                          "type": 9,
                                          "content": {
                                            "version": "KqlParameterItem/1.0",
                                            "parameters": [
                                              {
                                                "id": "65975bbd-0ea1-4c4d-ae29-2adb4467ad3f",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherence_DailyOrWeeklyBackup",
                                                "label": "Display Data for",
                                                "type": 2,
                                                "description": "Use to filter for items with daily backup policy or weekly backup policy",
                                                "isRequired": true,
                                                "value": "Daily",
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[{ \"value\": \"Daily\", \"label\": \"Items backed up daily\" },\r\n{ \"value\": \"Weekly\", \"label\": \"Items backed up weekly\" }]",
                                                "timeContext": {
                                                  "durationMs": 86400000
                                                }
                                              }
                                            ],
                                            "style": "pills",
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces"
                                          },
                                          "name": "PolicyAdherence-PolicyTypeParameter"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "<div style=\"text-align:left\"><span style=\"font-size:14px;font-weight:600;\">Count of Backup Instances with atleast one successful backup every day </span> </div>"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Daily"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByTimePeriod-DailyBackup-Grid1Title"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "The below grid is displayed in **Daily view** due to your time range selection. Backup Instances which have had **atleast one successful backup** on a given day fall under the second column in the below table. [Learn more](https://aka.ms/AzureBackupReportDailyBackupDailyView1)",
                                            "style": "info"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Daily"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            },
                                            {
                                              "parameterName": "AggregationType",
                                              "comparison": "isEqualTo",
                                              "value": "Daily"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByTimePeriod-DailyBackup-AggregationType-Daily-Text"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "The below grid is displayed in **Weekly view** due to your time range selection. Backup Instances which have had **atleast one successful backup** on every day in the given week fall under the second column in the below table. [Learn more](https://aka.ms/AzureBackupReportDailyBackupWeeklyView1)",
                                            "style": "info"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Daily"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            },
                                            {
                                              "parameterName": "AggregationType",
                                              "comparison": "isEqualTo",
                                              "value": "Weekly"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByTimePeriod-DailyBackup-AggregationType-Daily-Text - Copy"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "The below grid is displayed in **Monthly view** due to your time range selection. Backup Instances which have had **atleast one successful backup** on every day in the given month (28 days) fall under the second column in the below table. [Learn more](https://aka.ms/AzureBackupReportDailyBackupMonthlyView1)",
                                            "style": "info"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Daily"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            },
                                            {
                                              "parameterName": "AggregationType",
                                              "comparison": "isEqualTo",
                                              "value": "Monthly"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByTimePeriod-DailyBackup-AggregationType-Daily-Text - Copy - Copy"
                                        },
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\n// Grid specific params\r\nlet bin_Value = iff(@\"{AggregationType}\" == \"Weekly\", 7d, iff(@\"{AggregationType}\" == \"Monthly\", 28d, 1d));\r\nlet sum_isJobSuccessInTheTimePeriod_Value = iff(@\"{AggregationType}\" == \"Weekly\", \"7\", iff(@\"{AggregationType}\" == \"Monthly\", \"28\", \"1\")); \r\nlet duration_Value = iff(@\"{AggregationType}\" == \"Weekly\", \"6.00:00:00\", iff(@\"{AggregationType}\" == \"Monthly\", \"27.00:00:00\", \"00.00:00:00\")); \r\nlet BackupInstanceWithDailyBackup = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == \"Daily\"\r\n};\r\n// Grid Logic\r\nlet JobInfo = ()\r\n{\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithDailyBackup) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| summarize jobCount =count(), jobSuccessCount = countif(Status == \"Completed\" or Status == \"CompletedWithWarnings\"), jobFailureCount = countif(Status == \"Failed\" or Status == \"Cancelled\") by BackupInstanceUniqueId, JobCreationDate = startofday(StartTime)\r\n};\r\nJobInfo\r\n| summarize by BackupInstanceUniqueId\r\n| extend Day = range(RangeEnd, RangeStart, -1d)\r\n| mv-expand Day\r\n| project BackupInstanceUniqueId, todatetime(Day)\r\n| join kind = leftouter \r\n( JobInfo\r\n) on BackupInstanceUniqueId, $left.Day == $right.JobCreationDate\r\n// calculating isJobSuccess in the timeperiod to determine if it is successfull throughout the timeperiod\r\n| project BackupInstanceUniqueId, Day, isJobSuccessInTheTimePeriod =iff(isnull(jobCount), 0, iff((jobSuccessCount > 1), 1, jobSuccessCount)), jobFailureCount\r\n| summarize max(Day), min(Day), sum(isJobSuccessInTheTimePeriod), sum(jobFailureCount) by BackupInstanceUniqueId, bin_at(Day, bin_Value, RangeEnd + 1d)\r\n//| where BackupInstanceUniqueId in (\"westus;1541146419693764636;iaasvmcontainerv2;arult-test;cvarshrbac\",\"southeastasia;7777938885731870052;iaasvmcontainerv2;trinadhkselfhostrg;databasevm8\")\r\n| project BackupInstanceUniqueId, Period = iff(@\"{AggregationType}\" == \"Weekly\" or @\"{AggregationType}\" == \"Monthly\", strcat(format_datetime(todatetime(min_Day),\"yyyy/MM/dd\"), \" - \", format_datetime(todatetime(max_Day),\"yyyy/MM/dd\")), format_datetime(todatetime(min_Day),\"yyyy/MM/dd\")), sum_isJobSuccessInTheTimePeriod, sum_jobFailureCount, duration = max_Day - min_Day, Day\r\n// Exclude partial week/month\r\n| where duration == duration_Value\r\n| summarize ItemsWithSuccessfulDailyBackup = countif(sum_isJobSuccessInTheTimePeriod == sum_isJobSuccessInTheTimePeriod_Value), ItemsWithoutSuccessfulDailyBackup = countif(sum_isJobSuccessInTheTimePeriod != sum_isJobSuccessInTheTimePeriod_Value), Day= (any(Day)), sum_jobFailureCount = any(sum_jobFailureCount) by BackupInstanceUniqueId, Period\r\n| summarize ItemsWithSuccessfulDailyBackup = sum(ItemsWithSuccessfulDailyBackup), ItemsWithoutSuccessfulDailyBackup = sum(ItemsWithoutSuccessfulDailyBackup), FailedBackupJobs = sum(sum_jobFailureCount), RangeStartValue = (any(Day)) by Period\r\n| sort by RangeStartValue desc | extend RangeEndValue = RangeStartValue + bin_Value - 1d | extend BackupJobsInPeriod=\"Click to view\"\r\n\r\n\r\n\r\n\r\n",
                                            "size": 3,
                                            "noDataMessage": "No records found for the selected scope and time range",
                                            "exportedParameters": [
                                              {
                                                "fieldName": "RangeEndValue",
                                                "parameterName": "RangeEndValue_PolicyAdherenceTimePeriod_DailyBackup",
                                                "parameterType": 1,
                                                "defaultValue": ""
                                              },
                                              {
                                                "fieldName": "RangeStartValue",
                                                "parameterName": "RangeStartValue_PolicyAdherenceTimePeriod_DailyBackup",
                                                "parameterType": 1,
                                                "defaultValue": "2000-01-01T00:00:00Z"
                                              }
                                            ],
                                            "showExportToExcel": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces",
                                            "crossComponentResources": [
                                              "{Workspaces}"
                                            ],
                                            "gridSettings": {
                                              "formatters": [
                                                {
                                                  "columnMatch": "Period",
                                                  "formatter": 0,
                                                  "formatOptions": {
                                                    "customColumnWidthSetting": "20%"
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Time Period in UTC"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "ItemsWithSuccessfulDailyBackup",
                                                  "formatter": 0,
                                                  "formatOptions": {
                                                    "customColumnWidthSetting": "20%"
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Number of backup instances which had atleast one successful backup on all days in the selected time period"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "ItemsWithoutSuccessfulDailyBackup",
                                                  "formatter": 0,
                                                  "formatOptions": {
                                                    "customColumnWidthSetting": "20%"
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Number of backup instances which did not have atleast one successful backup on all days in the selected time period"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "FailedBackupJobs",
                                                  "formatter": 0,
                                                  "formatOptions": {
                                                    "customColumnWidthSetting": "20%"
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Number of failed backup jobs in the selected time period"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "RangeStartValue",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "RangeEndValue",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "BackupJobsInPeriod",
                                                  "formatter": 7,
                                                  "formatOptions": {
                                                    "linkTarget": "Url"
                                                  }
                                                }
                                              ],
                                              "filter": true,
                                              "labelSettings": [
                                                {
                                                  "columnId": "Period",
                                                  "label": "Period (UTC)"
                                                },
                                                {
                                                  "columnId": "ItemsWithSuccessfulDailyBackup",
                                                  "label": "# Items with successful daily backup"
                                                },
                                                {
                                                  "columnId": "ItemsWithoutSuccessfulDailyBackup",
                                                  "label": "# Items without successful daily backup"
                                                },
                                                {
                                                  "columnId": "FailedBackupJobs",
                                                  "label": "# Failed backup jobs"
                                                },
                                                {
                                                  "columnId": "BackupJobsInPeriod",
                                                  "label": "Backup Jobs In Period"
                                                }
                                              ]
                                            },
                                            "sortBy": []
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Daily"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "showPin": false,
                                          "name": "PolicyAdherenceByTimePeriod-DailyBackup-Grid1"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "<div style=\"text-align:left\"><span style=\"font-size:14px;font-weight:600;\">Count of Backup Instances with atleast one successful backup every week </span> </div>"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Weekly"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByTimePeriod-WeeklyBackup-Grid1Title"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "The below grid is displayed in **Weekly view** due to your time range selection. Backup Instances which have had **atleast one** successful backup in a given week fall under the second column in the below table. [Learn more](https://aka.ms/AzureBackupReportWeeklyBackupWeeklyView1)",
                                            "style": "info"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Weekly"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            },
                                            {
                                              "parameterName": "AggregationType",
                                              "comparison": "isNotEqualTo",
                                              "value": "Monthly"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByTimePeriod-WeeklyBackup-AggregationType-Weekly-Text"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "The below grid is displayed in **Monthly view** due to your time range selection. Backup Instances which have had **atleast one** successful backup in every week in a given month (28 days) fall under the second column in the below table. [Learn more](https://aka.ms/AzureBackupReportWeeklyBackupMonthlyView1)",
                                            "style": "info"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Weekly"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            },
                                            {
                                              "parameterName": "AggregationType",
                                              "comparison": "isEqualTo",
                                              "value": "Monthly"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByTimePeriod-WeeklyBackup-AggregationType-Weekly-Text - Copy"
                                        },
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\n// BackupJob\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\n// Grid specific params\r\nlet bin_Value =  iff(@\"{AggregationType}\" == \"Monthly\", 28d, 7d);\r\nlet sum_isJobSuccessInTheTimePeriod_Value = iff(@\"{AggregationType}\" == \"Monthly\", \"4\", \"1\"); \r\nlet duration_Value = iff(@\"{AggregationType}\" == \"Monthly\", \"27.00:00:00\", \"6.00:00:00\"); \r\nlet BackupInstanceWithWeeklyBackup = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == \"Weekly\"\r\n};\r\n// Grid Logic\r\nlet JobInfo = ()\r\n{\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithWeeklyBackup) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| summarize jobCount =count(), jobSuccessCount = countif(Status == \"Completed\" or Status == \"CompletedWithWarnings\"), jobFailureCount = countif(Status == \"Failed\" or Status == \"Cancelled\") by BackupInstanceUniqueId, JobCreationDate = startofday(StartTime)\r\n};\r\nJobInfo\r\n| summarize by BackupInstanceUniqueId\r\n| extend Day = range(RangeEnd, RangeStart, -1d)\r\n| mv-expand Day\r\n| project BackupInstanceUniqueId, todatetime(Day)\r\n| join kind = leftouter \r\n( JobInfo\r\n) on BackupInstanceUniqueId, $left.Day == $right.JobCreationDate\r\n// Create weekly buckets to check if SLA met\r\n| summarize max(Day), min(Day), sum(jobSuccessCount), sum(jobFailureCount) by BackupInstanceUniqueId, bin_at(Day, 7d, RangeEnd + 1d)\r\n| project BackupInstanceUniqueId, Day, sum_isJobSuccessInTheTimePeriod = iff(sum_jobSuccessCount > 1, 1, sum_jobSuccessCount), sum_jobFailureCount, max_Day, min_Day\r\n| summarize max_Day = max(max_Day), min_Day = min(min_Day), sum_isJobSuccessInTheTimePeriod = sum(sum_isJobSuccessInTheTimePeriod), sum_jobFailureCount = sum(sum_jobFailureCount) by BackupInstanceUniqueId, Day = bin_at(Day, bin_Value, RangeEnd + 1d)\r\n| project BackupInstanceUniqueId, Period = strcat(format_datetime(todatetime(min_Day),\"yyyy/MM/dd\"), \" - \", format_datetime(todatetime(max_Day),\"yyyy/MM/dd\")),  sum_isJobSuccessInTheTimePeriod, sum_jobFailureCount, duration = max_Day - min_Day, Day\r\n// Exclude partial week/month\r\n| where duration == duration_Value\r\n| summarize ItemsWithSuccessfulWeeklyBackup = countif(sum_isJobSuccessInTheTimePeriod == sum_isJobSuccessInTheTimePeriod_Value), ItemsWithoutSuccessfulWeeklyBackup = countif(sum_isJobSuccessInTheTimePeriod != sum_isJobSuccessInTheTimePeriod_Value), Day= (any(Day)), sum_jobFailureCount = any(sum_jobFailureCount) by BackupInstanceUniqueId, Period\r\n| summarize ItemsWithSuccessfulWeeklyBackup = sum(ItemsWithSuccessfulWeeklyBackup), ItemsWithoutSuccessfulWeeklyBackup = sum(ItemsWithoutSuccessfulWeeklyBackup), FailedBackupJobs = sum(sum_jobFailureCount), RangeStartValue = (any(Day)) by Period\r\n| sort by RangeStartValue desc | extend RangeEndValue = RangeStartValue + bin_Value - 1d | extend BackupJobsInPeriod=\"Click to view\"",
                                            "size": 3,
                                            "noDataMessage": "No records found for the selected scope and time range. Note that data for partial weeks is not displayed.",
                                            "exportedParameters": [
                                              {
                                                "fieldName": "RangeEndValue",
                                                "parameterName": "RangeEndValue_PolicyAdherenceTimePeriod_WeeklyBackup",
                                                "parameterType": 1,
                                                "defaultValue": ""
                                              },
                                              {
                                                "fieldName": "RangeStartValue",
                                                "parameterName": "RangeStartValue_PolicyAdherenceTimePeriod_WeeklyBackup",
                                                "parameterType": 1,
                                                "defaultValue": ""
                                              }
                                            ],
                                            "showExportToExcel": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces",
                                            "crossComponentResources": [
                                              "{Workspaces}"
                                            ],
                                            "gridSettings": {
                                              "formatters": [
                                                {
                                                  "columnMatch": "Period",
                                                  "formatter": 0,
                                                  "formatOptions": {
                                                    "customColumnWidthSetting": "20%"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "FailedBackupJobs",
                                                  "formatter": 0,
                                                  "formatOptions": {
                                                    "customColumnWidthSetting": "20%"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "RangeStartValue",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "RangeEndValue",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "BackupJobsInPeriod",
                                                  "formatter": 7,
                                                  "formatOptions": {
                                                    "linkTarget": "Url"
                                                  }
                                                }
                                              ],
                                              "sortBy": [
                                                {
                                                  "itemKey": "Period",
                                                  "sortOrder": 2
                                                }
                                              ],
                                              "labelSettings": [
                                                {
                                                  "columnId": "Period",
                                                  "label": "Period (UTC)"
                                                },
                                                {
                                                  "columnId": "ItemsWithSuccessfulWeeklyBackup",
                                                  "label": "# Items with successful weekly backup"
                                                },
                                                {
                                                  "columnId": "ItemsWithoutSuccessfulWeeklyBackup",
                                                  "label": "# Items without successful weekly backup"
                                                },
                                                {
                                                  "columnId": "FailedBackupJobs",
                                                  "label": "# Failed backup jobs"
                                                },
                                                {
                                                  "columnId": "BackupJobsInPeriod",
                                                  "label": "Backup Jobs In Period"
                                                }
                                              ]
                                            },
                                            "sortBy": [
                                              {
                                                "itemKey": "Period",
                                                "sortOrder": 2
                                              }
                                            ]
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Weekly"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "showPin": true,
                                          "name": "PolicyAdherenceByTimePeriod-WeeklyBackup-Grid1",
                                          "styleSettings": {
                                            "showBorder": true
                                          }
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "<span style=\"font-size:12px;font-style:italic\"> Click on any row above to see details of all backup jobs that were triggered in the selected period. </span>"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByTimePeriod-PromptText"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "<div style=\"text-align:left\"><span style=\"font-size:14px;font-weight:600;\">List of Backup Jobs in Period</span> </div>"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "RangeEndValue_PolicyAdherenceTimePeriod_DailyBackup",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByTimePeriod-DailyBackup-Grid2Title"
                                        },
                                        {
                                          "type": 9,
                                          "content": {
                                            "version": "KqlParameterItem/1.0",
                                            "parameters": [
                                              {
                                                "id": "8db8c419-3938-44fb-98c1-38fec5488fbf",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_SortBy_1a",
                                                "label": "Sort By",
                                                "type": 2,
                                                "description": "Use to sort by a certain column",
                                                "isRequired": true,
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[{ \"value\": \"DurationInSecs\", \"label\": \"Job Duration (hrs)\" },\r\n{ \"value\": \"DataTransferredInMBs\", \"label\": \"Data Transferred (MB)\", \"selected\": \"true\" }]",
                                                "timeContext": {
                                                  "durationMs": 604800000
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "bbe6281f-5a52-4c0e-8f6e-c2bef22742f4",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_Order_1a",
                                                "label": "Order",
                                                "type": 2,
                                                "description": "Use to specify the sort order: Ascending/Descending",
                                                "isRequired": true,
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[\r\n    { \"value\":\"Ascending\"},\r\n    { \"value\":\"Descending\", \"selected\":true}\r\n]",
                                                "timeContext": {
                                                  "durationMs": 0
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "f95c204a-4472-489b-b92e-f0fd393cc236",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_RowsPerPage_1a",
                                                "label": "Rows per Page",
                                                "type": 2,
                                                "description": "Number of rows to display in grid view",
                                                "isRequired": true,
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[\r\n    { \"value\":10, \"label\":\"10\", \"selected\":true  },\r\n    { \"value\":25, \"label\":\"25\" },\r\n    { \"value\":50, \"label\":\"50\" },\r\n    { \"value\":100, \"label\":\"100\" },\r\n    { \"value\":250, \"label\":\"250\" },\r\n    { \"value\":500, \"label\":\"500\" },\r\n    { \"value\":1000, \"label\":\"1000\" }\r\n]",
                                                "timeContext": {
                                                  "durationMs": 0
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "e9debeb6-ff52-4136-9fd8-ac9798b45bfe",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_Page_1a",
                                                "label": "Page",
                                                "type": 2,
                                                "description": "Select Page Number",
                                                "isRequired": true,
                                                "query": "// function Params - Report Filters\r\nlet RangeStartValue_PolicyAdherenceTimePeriod_DailyBackup = @\"{RangeStartValue_PolicyAdherenceTimePeriod_DailyBackup}\";\r\nlet RangeEndValue_PolicyAdherenceTimePeriod_DailyBackup = @\"{RangeEndValue_PolicyAdherenceTimePeriod_DailyBackup}\";\r\n// function Params - Report Filters\r\nlet RangeStart = RangeStartValue_PolicyAdherenceTimePeriod_DailyBackup;\r\nlet RangeEnd = RangeEndValue_PolicyAdherenceTimePeriod_DailyBackup; \r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\nlet PolicyAdherence_DailyOrWeeklyBackup_Value = @\"{PolicyAdherence_DailyOrWeeklyBackup}\";\r\nlet BackupInstanceWithSelectedBackupFrequency = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == PolicyAdherence_DailyOrWeeklyBackup_Value\r\n};\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithSelectedBackupFrequency) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| summarize c=count()\r\n| project num = (c-1)/{PolicyAdherenceTab_RowsPerPage_1a} + 1\r\n| project nums = range(1,num,1), num\r\n| mvexpand nums\r\n| project nums = tostring(nums), num = strcat(tostring(nums),\" of \",tostring(num)) ",
                                                "crossComponentResources": [
                                                  "{Workspaces}"
                                                ],
                                                "value": "1",
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "queryType": 0,
                                                "resourceType": "microsoft.operationalinsights/workspaces"
                                              }
                                            ],
                                            "style": "pills",
                                            "doNotRunWhenHidden": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces"
                                          },
                                          "customWidth": "90",
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "RangeEndValue_PolicyAdherenceTimePeriod_DailyBackup",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByTimePeriod-DailyBackup-Grid2ParameterBlock",
                                          "styleSettings": {
                                            "padding": "0% 0% 0% 0%"
                                          }
                                        },
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "// function Params - Report Filters\r\nlet RangeStartValue_PolicyAdherenceTimePeriod_DailyBackup = @\"{RangeStartValue_PolicyAdherenceTimePeriod_DailyBackup}\";\r\nlet RangeEndValue_PolicyAdherenceTimePeriod_DailyBackup = @\"{RangeEndValue_PolicyAdherenceTimePeriod_DailyBackup}\";\r\n// function Params - Report Filters\r\nlet RangeStart = RangeStartValue_PolicyAdherenceTimePeriod_DailyBackup;\r\nlet RangeEnd = RangeEndValue_PolicyAdherenceTimePeriod_DailyBackup; \r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\nlet PolicyAdherence_DailyOrWeeklyBackup_Value = @\"{PolicyAdherence_DailyOrWeeklyBackup}\";\r\nlet BackupInstanceWithSelectedBackupFrequency = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == PolicyAdherence_DailyOrWeeklyBackup_Value\r\n};\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithSelectedBackupFrequency) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| extend TempColumn = column_ifexists(tostring('{PolicyAdherenceTab_SortBy_1a}'), \"DataTransferredInMBs\")\r\n| extend ColumnToBeSorted = iff(tostring('{PolicyAdherenceTab_Order_1a}') == \"Ascending\", todouble(TempColumn) - 90000000, 90000000 - todouble(TempColumn))\r\n| sort by ColumnToBeSorted asc nulls last, UniqueId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{PolicyAdherenceTab_RowsPerPage_1a} + 1))\r\n| where page_num has ('{PolicyAdherenceTab_Page_1a}') or '*' in ('{PolicyAdherenceTab_Page_1a}')\r\n| project BackupInstance=BackupInstanceFriendlyName, BackupInstanceId, Container=DatasourceSetFriendlyName, ResourceGroup=iff(DatasourceType==\"Azure Backup Agent\" or DatasourceType==\"Azure Backup Server\" or DatasourceType==\"DPM\",\"(none)\",split(split(tostring(tolower(DatasourceSetResourceId)), '/resourcegroups/')[1],'/')[0]\r\n), OperationCategory, JobStatus=Status,  JobStartDateTime=StartTime, JobDuration=DurationInSecs/3600, ErrorTitle, DataTransferred=DataTransferredInMBs, AzureResource=DatasourceSetResourceId, DatasourceType \r\n\r\n\r\n",
                                            "size": 3,
                                            "showExportToExcel": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces",
                                            "crossComponentResources": [
                                              "{Workspaces}"
                                            ],
                                            "gridSettings": {
                                              "formatters": [
                                                {
                                                  "columnMatch": "BackupInstance",
                                                  "formatter": 16,
                                                  "formatOptions": {
                                                    "linkColumn": "BackupInstanceId",
                                                    "linkTarget": "Resource",
                                                    "showIcon": true
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Name of the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "BackupInstanceId",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "Container",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Protected Container associated with the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "ResourceGroup",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Resource group associated with the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "OperationCategory",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Operation Category"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "JobStatus",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Job Status"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "JobStartDateTime",
                                                  "formatter": 6,
                                                  "dateFormat": {
                                                    "showUtcTime": true,
                                                    "formatName": "shortDateTimePattern"
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Start date and time of the Job"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "JobDuration",
                                                  "formatter": 4,
                                                  "formatOptions": {
                                                    "min": 0,
                                                    "palette": "blue"
                                                  },
                                                  "numberFormat": {
                                                    "unit": 0,
                                                    "options": {
                                                      "style": "decimal",
                                                      "useGrouping": false,
                                                      "maximumFractionDigits": 2
                                                    }
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Job Duration"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "ErrorTitle",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Job Failure Code"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "DataTransferred",
                                                  "formatter": 4,
                                                  "formatOptions": {
                                                    "min": 0,
                                                    "palette": "blue"
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Amount of data transferred by the job"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "AzureResource",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Azure Resource associated with the backup instance. For Azure VM Backup, SQL in Azure VM backup and SAP database in Azure VM backup, the Azure Resource is the Azure VM. For Azure Files Share backup, the Azure Resource is the Azure Storage account. For on-premises backup instances, this field is blank."
                                                  }
                                                },
                                                {
                                                  "columnMatch": "DatasourceType",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Datasource Type"
                                                  }
                                                }
                                              ],
                                              "filter": true,
                                              "labelSettings": [
                                                {
                                                  "columnId": "BackupInstance",
                                                  "label": "Backup Instance"
                                                },
                                                {
                                                  "columnId": "ResourceGroup",
                                                  "label": "Resource Group"
                                                },
                                                {
                                                  "columnId": "OperationCategory",
                                                  "label": "Operation Category"
                                                },
                                                {
                                                  "columnId": "JobStatus",
                                                  "label": "Job Status"
                                                },
                                                {
                                                  "columnId": "JobStartDateTime",
                                                  "label": "Job Start Date Time"
                                                },
                                                {
                                                  "columnId": "JobDuration",
                                                  "label": "Job Duration (hrs)"
                                                },
                                                {
                                                  "columnId": "ErrorTitle",
                                                  "label": "Job Failure Code"
                                                },
                                                {
                                                  "columnId": "DataTransferred",
                                                  "label": "Data Transferred (MB)"
                                                },
                                                {
                                                  "columnId": "AzureResource",
                                                  "label": "Azure Resource"
                                                },
                                                {
                                                  "columnId": "DatasourceType",
                                                  "label": "Datasource Type"
                                                }
                                              ]
                                            },
                                            "sortBy": []
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "RangeEndValue_PolicyAdherenceTimePeriod_DailyBackup",
                                              "comparison": "isNotEqualTo",
                                              "value": ""
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            }
                                          ],
                                          "showPin": false,
                                          "name": "PolicyAdherenceByTimePeriod-DailyBackup-Grid2"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "<div style=\"text-align:left\"><span style=\"font-size:14px;font-weight:600;\">List of Backup Jobs in Period </span> </div>"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "RangeEndValue_PolicyAdherenceTimePeriod_WeeklyBackup",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByTimePeriod-WeeklyBackup-Grid2Title"
                                        },
                                        {
                                          "type": 9,
                                          "content": {
                                            "version": "KqlParameterItem/1.0",
                                            "parameters": [
                                              {
                                                "id": "4010e835-5e14-40f1-8232-885b3d81392a",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_SortBy_1b",
                                                "label": "Sort By",
                                                "type": 2,
                                                "description": "Use to sort by a certain column",
                                                "isRequired": true,
                                                "value": "DurationInSecs",
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[{ \"value\": \"DurationInSecs\", \"label\": \"Job Duration (hrs)\" },\r\n{ \"value\": \"DataTransferredInMBs\", \"label\": \"Data Transferred (MB)\", \"selected\": \"true\" }]",
                                                "timeContext": {
                                                  "durationMs": 604800000
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "715e7892-2a1a-4579-806b-459c49e8abd5",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_Order_1b",
                                                "label": "Order",
                                                "type": 2,
                                                "description": "Use to specify the sort order: Ascending/Descending",
                                                "isRequired": true,
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[\r\n    { \"value\":\"Ascending\"},\r\n    { \"value\":\"Descending\", \"selected\":true}\r\n]",
                                                "timeContext": {
                                                  "durationMs": 0
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "4ec2f27f-c475-4472-93d1-e2a4c12768db",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_RowsPerPage_1b",
                                                "label": "Rows per Page",
                                                "type": 2,
                                                "description": "Number of rows to display in grid view",
                                                "isRequired": true,
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[\r\n    { \"value\":10, \"label\":\"10\", \"selected\":true  },\r\n    { \"value\":25, \"label\":\"25\" },\r\n    { \"value\":50, \"label\":\"50\" },\r\n    { \"value\":100, \"label\":\"100\" },\r\n    { \"value\":250, \"label\":\"250\" },\r\n    { \"value\":500, \"label\":\"500\" },\r\n    { \"value\":1000, \"label\":\"1000\" }\r\n]",
                                                "timeContext": {
                                                  "durationMs": 0
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "dfa947c5-2084-41c2-856b-44a485e40314",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_Page_1b",
                                                "label": "Page",
                                                "type": 2,
                                                "description": "Select Page Number",
                                                "isRequired": true,
                                                "query": "// function Params - Report Filters\r\nlet RangeStartValue_PolicyAdherenceTimePeriod_WeeklyBackup = @\"{RangeStartValue_PolicyAdherenceTimePeriod_WeeklyBackup}\";\r\nlet RangeEndValue_PolicyAdherenceTimePeriod_WeeklyBackup = @\"{RangeEndValue_PolicyAdherenceTimePeriod_WeeklyBackup}\";\r\n// function Params - Report Filters\r\nlet RangeStart = RangeStartValue_PolicyAdherenceTimePeriod_WeeklyBackup;\r\nlet RangeEnd = RangeEndValue_PolicyAdherenceTimePeriod_WeeklyBackup;\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\nlet PolicyAdherence_DailyOrWeeklyBackup_Value = @\"{PolicyAdherence_DailyOrWeeklyBackup}\";\r\nlet BackupInstanceWithSelectedBackupFrequency = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == PolicyAdherence_DailyOrWeeklyBackup_Value\r\n};\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithSelectedBackupFrequency) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| summarize c=count()\r\n| project num = (c-1)/{PolicyAdherenceTab_RowsPerPage_1b} + 1\r\n| project nums = range(1,num,1), num\r\n| mvexpand nums\r\n| project nums = tostring(nums), num = strcat(tostring(nums),\" of \",tostring(num)) ",
                                                "crossComponentResources": [
                                                  "{Workspaces}"
                                                ],
                                                "value": "1",
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "queryType": 0,
                                                "resourceType": "microsoft.operationalinsights/workspaces"
                                              }
                                            ],
                                            "style": "pills",
                                            "doNotRunWhenHidden": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces"
                                          },
                                          "customWidth": "90",
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "RangeEndValue_PolicyAdherenceTimePeriod_WeeklyBackup",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByTimePeriod-WeeklyBackup-Grid2ParameterBlock",
                                          "styleSettings": {
                                            "padding": "0% 0% 0% 0%"
                                          }
                                        },
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "// function Params - Report Filters\r\nlet RangeStartValue_PolicyAdherenceTimePeriod_WeeklyBackup = @\"{RangeStartValue_PolicyAdherenceTimePeriod_WeeklyBackup}\";\r\nlet RangeEndValue_PolicyAdherenceTimePeriod_WeeklyBackup = @\"{RangeEndValue_PolicyAdherenceTimePeriod_WeeklyBackup}\";\r\n// function Params - Report Filters\r\nlet RangeStart = RangeStartValue_PolicyAdherenceTimePeriod_WeeklyBackup;\r\nlet RangeEnd = RangeEndValue_PolicyAdherenceTimePeriod_WeeklyBackup;\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet Item_search =  \"*;*\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\nlet PolicyAdherence_DailyOrWeeklyBackup_Value = @\"{PolicyAdherence_DailyOrWeeklyBackup}\";\r\nlet BackupInstanceWithSelectedBackupFrequency = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == PolicyAdherence_DailyOrWeeklyBackup_Value\r\n};\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithSelectedBackupFrequency) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| extend TempColumn = column_ifexists(tostring('{PolicyAdherenceTab_SortBy_1b}'), \"DataTransferredInMBs\")\r\n| extend ColumnToBeSorted = iff(tostring('{PolicyAdherenceTab_Order_1b}') == \"Ascending\", todouble(TempColumn) - 90000000, 90000000 - todouble(TempColumn))\r\n| sort by ColumnToBeSorted asc nulls last, UniqueId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{PolicyAdherenceTab_RowsPerPage_1b} + 1))\r\n| where page_num has ('{PolicyAdherenceTab_Page_1b}') or '*' in ('{PolicyAdherenceTab_Page_1b}')\r\n| project BackupInstance=BackupInstanceFriendlyName, BackupInstanceId, Container=DatasourceSetFriendlyName, ResourceGroup=iff(DatasourceType==\"Azure Backup Agent\" or DatasourceType==\"Azure Backup Server\" or DatasourceType==\"DPM\",\"(none)\",split(split(tostring(tolower(DatasourceSetResourceId)), '/resourcegroups/')[1],'/')[0]\r\n), OperationCategory, JobStatus=Status,  JobStartDateTime=StartTime, JobDuration=DurationInSecs/3600, ErrorTitle, DataTransferred=DataTransferredInMBs, AzureResource=DatasourceSetResourceId, DatasourceType \r\n\r\n\r\n",
                                            "size": 3,
                                            "showExportToExcel": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces",
                                            "crossComponentResources": [
                                              "{Workspaces}"
                                            ],
                                            "gridSettings": {
                                              "formatters": [
                                                {
                                                  "columnMatch": "BackupInstance",
                                                  "formatter": 16,
                                                  "formatOptions": {
                                                    "linkColumn": "BackupInstanceId",
                                                    "linkTarget": "Resource",
                                                    "showIcon": true
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Name of the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "BackupInstanceId",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "Container",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Protected Container associated with the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "ResourceGroup",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Resource group associated with the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "OperationCategory",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Operation Category"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "JobStatus",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Job Status"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "JobStartDateTime",
                                                  "formatter": 6,
                                                  "numberFormat": {
                                                    "unit": 0,
                                                    "options": {
                                                      "style": "decimal"
                                                    }
                                                  },
                                                  "dateFormat": {
                                                    "showUtcTime": true,
                                                    "formatName": "shortDateTimePattern"
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Start date and time of the Job"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "JobDuration",
                                                  "formatter": 4,
                                                  "formatOptions": {
                                                    "min": 0,
                                                    "palette": "blue"
                                                  },
                                                  "numberFormat": {
                                                    "unit": 0,
                                                    "options": {
                                                      "style": "decimal",
                                                      "maximumFractionDigits": 2
                                                    }
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Job Duration"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "ErrorTitle",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Job Failure Code"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "DataTransferred",
                                                  "formatter": 4,
                                                  "formatOptions": {
                                                    "min": 0,
                                                    "palette": "blue"
                                                  },
                                                  "numberFormat": {
                                                    "unit": 0,
                                                    "options": {
                                                      "style": "decimal",
                                                      "maximumFractionDigits": 2
                                                    }
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Amount of data transferred by the job"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "AzureResource",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Azure Resource associated with the backup instance. For Azure VM Backup, SQL in Azure VM backup and SAP database in Azure VM backup, the Azure Resource is the Azure VM. For Azure Files Share backup, the Azure Resource is the Azure Storage account. For on-premises backup instances, this field is blank."
                                                  }
                                                },
                                                {
                                                  "columnMatch": "DatasourceType",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Datasource Type"
                                                  }
                                                }
                                              ],
                                              "labelSettings": [
                                                {
                                                  "columnId": "BackupInstance",
                                                  "label": "Backup Instance"
                                                },
                                                {
                                                  "columnId": "ResourceGroup",
                                                  "label": "Resource Group"
                                                },
                                                {
                                                  "columnId": "OperationCategory",
                                                  "label": "Operation Category"
                                                },
                                                {
                                                  "columnId": "JobStatus",
                                                  "label": "Job Status"
                                                },
                                                {
                                                  "columnId": "JobStartDateTime",
                                                  "label": "Job Start Date Time"
                                                },
                                                {
                                                  "columnId": "JobDuration",
                                                  "label": "Job Duration (hrs)"
                                                },
                                                {
                                                  "columnId": "ErrorTitle",
                                                  "label": "Job Failure Code"
                                                },
                                                {
                                                  "columnId": "DataTransferred",
                                                  "label": "Data Transferred (MB)"
                                                },
                                                {
                                                  "columnId": "AzureResource",
                                                  "label": "Azure Resource"
                                                },
                                                {
                                                  "columnId": "DatasourceType",
                                                  "label": "Datasource Type"
                                                }
                                              ]
                                            },
                                            "sortBy": []
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "RangeEndValue_PolicyAdherenceTimePeriod_WeeklyBackup",
                                              "comparison": "isNotEqualTo",
                                              "value": ""
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Time Period"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "showPin": true,
                                          "name": "PolicyAdherenceByTimePeriod-WeeklyBackup-Grid2",
                                          "styleSettings": {
                                            "showBorder": true
                                          }
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "<div style=\"text-align:left\"><span style=\"font-size:14px;font-weight:600;\">Policy Adherence details at Backup Instance level</span> </div>"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Backup Instance"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByBackupInstance-Grid1Title"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "The below grid is displayed in **Daily view** due to your time range selection. Backup Instances which have had **atleast one successful backup** on a given day are marked green (compliant) for that day. [Learn more](https://aka.ms/AzureBackupReportDailyBackupDailyView2)",
                                            "style": "info"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Daily"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Backup Instance"
                                            },
                                            {
                                              "parameterName": "AggregationType",
                                              "comparison": "isEqualTo",
                                              "value": "Daily"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByBackupInstance-DailyBackup-AggregationType-Daily-Text"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "The below grid is displayed in **Weekly view** due to your time range selection. Backup Instances which have had **atleast one successful backup** on every day in a given week are marked green (compliant) for that day. [Learn more](https://aka.ms/AzureBackupReportDailyBackupWeeklyView2)",
                                            "style": "info"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Daily"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Backup Instance"
                                            },
                                            {
                                              "parameterName": "AggregationType",
                                              "comparison": "isEqualTo",
                                              "value": "Weekly"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByBackupInstance-DailyBackup-AggregationType-Daily-Text - Copy"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "The below grid is displayed in **Monthly view** due to your time range selection. Backup Instances which have had **atleast one successful backup** on every day in a given month (28 days) are marked green (compliant) for that day. [Learn more](https://aka.ms/AzureBackupReportDailyBackupMonthlyView2)",
                                            "style": "info"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Daily"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Backup Instance"
                                            },
                                            {
                                              "parameterName": "AggregationType",
                                              "comparison": "isEqualTo",
                                              "value": "Monthly"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByBackupInstance-DailyBackup-AggregationType-Daily-Text - Copy - Copy"
                                        },
                                        {
                                          "type": 9,
                                          "content": {
                                            "version": "KqlParameterItem/1.0",
                                            "crossComponentResources": [
                                              "{Workspaces}"
                                            ],
                                            "parameters": [
                                              {
                                                "id": "f25f4728-0548-4872-995b-009e36fae10e",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_SearchBackupInstanceOrDatasourceSet_2b",
                                                "label": "Search Instance or Container",
                                                "type": 1,
                                                "description": "Use to search for a backup instance by name. <br/> To search for a specific instance in a container, use the syntax [container name];[instance name] <br/> To search for all instances in a container, use the syntax [container name];",
                                                "timeContext": {
                                                  "durationMs": 604800000
                                                },
                                                "timeContextFromParameter": "TimeRange",
                                                "value": ""
                                              },
                                              {
                                                "id": "8fcd9638-ffa1-4ab4-a10a-6ec84675e7d5",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_RowsPerPage_2b",
                                                "label": "Rows per Page",
                                                "type": 2,
                                                "description": "Number of rows to display in grid view",
                                                "isRequired": true,
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[\r\n    { \"value\":10, \"label\":\"10\", \"selected\":true  },\r\n    { \"value\":25, \"label\":\"25\" },\r\n    { \"value\":50, \"label\":\"50\" },\r\n    { \"value\":100, \"label\":\"100\" },\r\n    { \"value\":250, \"label\":\"250\" },\r\n    { \"value\":500, \"label\":\"500\" },\r\n    { \"value\":1000, \"label\":\"1000\" }\r\n]",
                                                "timeContext": {
                                                  "durationMs": 0
                                                },
                                                "timeContextFromParameter": "TimeRange",
                                                "value": "25"
                                              },
                                              {
                                                "id": "8c69b14b-b995-44ea-baa8-3e812d381c96",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_Page_2b",
                                                "label": "Page",
                                                "type": 2,
                                                "description": "Select Page Number",
                                                "isRequired": true,
                                                "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet Item_search =  @\"{PolicyAdherenceTab_SearchBackupInstanceOrDatasourceSet_2b}\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\n// Grid specific params\r\nlet bin_Value = iff(@\"{AggregationType}\" == \"Weekly\", 7d, iff(@\"{AggregationType}\" == \"Monthly\", 28d, 1d));\r\nlet sum_isJobSuccessInTheTimePeriod_Value = iff(@\"{AggregationType}\" == \"Weekly\", \"7\", iff(@\"{AggregationType}\" == \"Monthly\", \"28\", \"1\")); \r\nlet duration_Value = iff(@\"{AggregationType}\" == \"Weekly\", \"6.00:00:00\", iff(@\"{AggregationType}\" == \"Monthly\", \"27.00:00:00\", \"00.00:00:00\")); \r\nlet BackupInstanceWithDailyBackup = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == \"Daily\"\r\n};\r\n// Grid Logic\r\nlet JobInfo = ()\r\n{\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithDailyBackup) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| summarize jobCount = count(), jobSuccessCount = countif(Status == \"Completed\" or Status == \"CompletedWithWarnings\"), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName), BackupSolution =  any(BackupSolution), DatasourceSetResourceId = any(DatasourceSetResourceId), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName) by BackupInstanceUniqueId, JobCreationDate = startofday(StartTime)\r\n| project ResourceGroup=iff(BackupSolution ==\"Azure Backup Agent\" or BackupSolution ==\"Azure Backup Server\" or BackupSolution ==\"DPM\",\"(none)\",split(split(tostring(tolower(DatasourceSetResourceId)), '/resourcegroups/')[1],'/')[0]), jobCount, jobSuccessCount, BackupInstanceFriendlyName, BackupInstanceUniqueId, DatasourceSetFriendlyName, JobCreationDate\r\n};\r\nJobInfo\r\n| summarize by BackupInstanceUniqueId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup\r\n| extend Day = range(RangeEnd, RangeStart, -1d)\r\n| mv-expand Day\r\n| project BackupInstanceUniqueId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup, todatetime(Day)\r\n| join kind = leftouter \r\n( JobInfo\r\n) on BackupInstanceUniqueId, $left.Day == $right.JobCreationDate\r\n//| where BackupInstanceUniqueId == \"eastus;944400882857245004;iaasvmcontainerv2;azurefiles;afsaccount\"\r\n| sort by BackupInstanceUniqueId, Day desc\r\n| project BackupInstanceUniqueId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup, Day, jobTotalCountInTheTimePeriod = iff(isnull(jobCount), 0, jobCount), isJobSuccessInTheTimePeriod =iff(isnull(jobCount), 0, iff((jobSuccessCount > 1), 1, jobSuccessCount))\r\n| summarize max(Day), min(Day), sum(isJobSuccessInTheTimePeriod), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName), ResourceGroup = any(ResourceGroup) by BackupInstanceUniqueId, bin_at(Day, bin_Value, RangeEnd + 1d)\r\n| project BackupInstanceUniqueId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup, Period = iff(@\"{AggregationType}\" == \"Weekly\" or @\"{AggregationType}\" == \"Monthly\", strcat(format_datetime(todatetime(min_Day),\"yyyy/MM/dd\"), \" - \", format_datetime(todatetime(max_Day),\"yyyy/MM/dd\")), format_datetime(todatetime(min_Day),\"yyyy/MM/dd\")), sum_isJobSuccessInTheTimePeriod, duration = max_Day - min_Day, Day\r\n// Exclude partial week/month\r\n| where duration == duration_Value\r\n| summarize sum_isJobSuccessInTheTimePeriod = countif(sum_isJobSuccessInTheTimePeriod == sum_isJobSuccessInTheTimePeriod_Value), Day= (any(Day)), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName), ResourceGroup = any(ResourceGroup) by BackupInstanceUniqueId, Period\r\n| evaluate pivot(Period, any(sum_isJobSuccessInTheTimePeriod), BackupInstanceFriendlyName, BackupInstanceUniqueId, DatasourceSetFriendlyName, ResourceGroup)\r\n| summarize c=count()\r\n| project num = (c-1)/{PolicyAdherenceTab_RowsPerPage_2b} + 1\r\n| project nums = range(1,num,1), num\r\n| mvexpand nums\r\n| project nums = tostring(nums), num = strcat(tostring(nums),\" of \",tostring(num))",
                                                "crossComponentResources": [
                                                  "{Workspaces}"
                                                ],
                                                "value": "1",
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "timeContext": {
                                                  "durationMs": 0
                                                },
                                                "timeContextFromParameter": "TimeRange",
                                                "queryType": 0,
                                                "resourceType": "microsoft.operationalinsights/workspaces"
                                              }
                                            ],
                                            "style": "pills",
                                            "doNotRunWhenHidden": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces"
                                          },
                                          "customWidth": "90",
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Backup Instance"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Daily"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByBackupInstance-DailyBackup-Grid1ParameterBlock",
                                          "styleSettings": {
                                            "padding": "0% 0% 0% 0%"
                                          }
                                        },
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet Item_search =  @\"{PolicyAdherenceTab_SearchBackupInstanceOrDatasourceSet_2b}\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\n// Grid specific params\r\nlet bin_Value = iff(@\"{AggregationType}\" == \"Weekly\", 7d, iff(@\"{AggregationType}\" == \"Monthly\", 28d, 1d));\r\nlet sum_isJobSuccessInTheTimePeriod_Value = iff(@\"{AggregationType}\" == \"Weekly\", \"7\", iff(@\"{AggregationType}\" == \"Monthly\", \"28\", \"1\")); \r\nlet duration_Value = iff(@\"{AggregationType}\" == \"Weekly\", \"6.00:00:00\", iff(@\"{AggregationType}\" == \"Monthly\", \"27.00:00:00\", \"00.00:00:00\")); \r\nlet BackupInstanceWithDailyBackup = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == \"Daily\"\r\n};\r\n// Grid Logic\r\nlet JobInfo = ()\r\n{\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithDailyBackup) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| summarize jobCount = count(), jobSuccessCount = countif(Status == \"Completed\" or Status == \"CompletedWithWarnings\"), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName), BackupInstanceId=any(BackupInstanceId), BackupSolution =  any(BackupSolution), DatasourceSetResourceId = any(DatasourceSetResourceId), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName) by BackupInstanceUniqueId, JobCreationDate = startofday(StartTime)\r\n| project ResourceGroup=iff(BackupSolution ==\"Azure Backup Agent\" or BackupSolution ==\"Azure Backup Server\" or BackupSolution ==\"DPM\",\"(none)\",split(split(tostring(tolower(DatasourceSetResourceId)), '/resourcegroups/')[1],'/')[0]), jobCount, jobSuccessCount, BackupInstanceFriendlyName, BackupInstanceUniqueId, DatasourceSetFriendlyName, JobCreationDate, BackupInstanceId\r\n};\r\nJobInfo\r\n| summarize by BackupInstanceUniqueId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup, BackupInstanceId\r\n| extend Day = range(RangeEnd, RangeStart, -1d)\r\n| mv-expand Day\r\n| project BackupInstanceUniqueId, BackupInstanceFriendlyName, BackupInstanceId, DatasourceSetFriendlyName, ResourceGroup, todatetime(Day)\r\n| join kind = leftouter \r\n( JobInfo\r\n) on BackupInstanceUniqueId, $left.Day == $right.JobCreationDate\r\n//| where BackupInstanceUniqueId == \"eastus;944400882857245004;iaasvmcontainerv2;azurefiles;afsaccount\"\r\n| sort by BackupInstanceUniqueId, Day desc\r\n| project BackupInstanceUniqueId, BackupInstanceId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup, Day, jobTotalCountInTheTimePeriod = iff(isnull(jobCount), 0, jobCount), isJobSuccessInTheTimePeriod =iff(isnull(jobCount), 0, iff((jobSuccessCount > 1), 1, jobSuccessCount))\r\n| summarize max(Day), min(Day), sum(isJobSuccessInTheTimePeriod), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName),BackupInstanceId = any(BackupInstanceId), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName), ResourceGroup = any(ResourceGroup) by BackupInstanceUniqueId, bin_at(Day, bin_Value, RangeEnd + 1d)\r\n| project BackupInstanceUniqueId, BackupInstanceId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup, Period = iff(@\"{AggregationType}\" == \"Weekly\" or @\"{AggregationType}\" == \"Monthly\", strcat(format_datetime(todatetime(min_Day),\"yyyy/MM/dd\"), \" - \", format_datetime(todatetime(max_Day),\"yyyy/MM/dd\")), format_datetime(todatetime(min_Day),\"yyyy/MM/dd\")), sum_isJobSuccessInTheTimePeriod, duration = max_Day - min_Day, Day\r\n// Exclude partial week/month\r\n| where duration == duration_Value\r\n| summarize sum_isJobSuccessInTheTimePeriod = countif(sum_isJobSuccessInTheTimePeriod == sum_isJobSuccessInTheTimePeriod_Value), Day= (any(Day)), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName), BackupInstanceId = any(BackupInstanceId), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName), ResourceGroup = any(ResourceGroup) by BackupInstanceUniqueId, Period\r\n| evaluate pivot(Period, any(sum_isJobSuccessInTheTimePeriod), BackupInstanceFriendlyName, BackupInstanceId, BackupInstanceUniqueId, DatasourceSetFriendlyName, ResourceGroup)\r\n| sort by BackupInstanceUniqueId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{PolicyAdherenceTab_RowsPerPage_2b} + 1))\r\n| where page_num has ('{PolicyAdherenceTab_Page_2b}') or '*' in ('{PolicyAdherenceTab_Page_2b}')",
                                            "size": 3,
                                            "exportedParameters": [
                                              {
                                                "fieldName": "DatasourceSetFriendlyName",
                                                "parameterName": "PolicyAdherence_DailyBackup_DatasourceSetFriendlyName",
                                                "parameterType": 1
                                              },
                                              {
                                                "fieldName": "BackupInstanceFriendlyName",
                                                "parameterName": "PolicyAdherence_DailyBackup_BackupInstanceFriendlyName",
                                                "parameterType": 1
                                              }
                                            ],
                                            "showExportToExcel": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces",
                                            "crossComponentResources": [
                                              "{Workspaces}"
                                            ],
                                            "gridSettings": {
                                              "formatters": [
                                                {
                                                  "columnMatch": "BackupInstanceFriendlyName",
                                                  "formatter": 16,
                                                  "formatOptions": {
                                                    "linkColumn": "BackupInstanceId",
                                                    "linkTarget": "Resource",
                                                    "showIcon": true
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Name of the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "BackupInstanceId",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "BackupInstanceUniqueId",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "DatasourceSetFriendlyName",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Protected Container associated with the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "ResourceGroup",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Resource group associated with the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "[0-9][0-9][0-9][0-9]/[0-9][0-9]/[0-9][0-9]|[0-9][0-9][0-9][0-9]/[0-9][0-9]/[0-9][0-9]-[0-9][0-9][0-9][0-9]/[0-9][0-9]/[0-9][0-9]",
                                                  "formatter": 18,
                                                  "formatOptions": {
                                                    "thresholdsOptions": "colors",
                                                    "thresholdsGrid": [
                                                      {
                                                        "operator": ">",
                                                        "thresholdValue": "0",
                                                        "representation": "green",
                                                        "text": "."
                                                      },
                                                      {
                                                        "operator": "Default",
                                                        "thresholdValue": null,
                                                        "representation": "redBright",
                                                        "text": "."
                                                      }
                                                    ]
                                                  }
                                                },
                                                {
                                                  "columnMatch": "row_num",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "page_num",
                                                  "formatter": 5
                                                }
                                              ],
                                              "filter": true,
                                              "labelSettings": [
                                                {
                                                  "columnId": "BackupInstanceFriendlyName",
                                                  "label": "Backup Instance"
                                                },
                                                {
                                                  "columnId": "DatasourceSetFriendlyName",
                                                  "label": "Container"
                                                },
                                                {
                                                  "columnId": "ResourceGroup",
                                                  "label": "Resource Group"
                                                }
                                              ]
                                            }
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Backup Instance"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Daily"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "showPin": false,
                                          "name": "PolicyAdherenceByBackupInstance-DailyBackup-Grid1"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "The below grid is displayed in **Weekly view** due to your time range selection. Backup Instances which have had **atleast one** successful backup in a given week are marked green (compliant) for that week.  [Learn more](https://aka.ms/AzureBackupReportDailyBackupWeeklyView2)",
                                            "style": "info"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Weekly"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Backup Instance"
                                            },
                                            {
                                              "parameterName": "AggregationType",
                                              "comparison": "isNotEqualTo",
                                              "value": "Monthly"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByBackupInstance-WeeklyBackup-AggregationType-Weekly-Text"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "The below grid is displayed in **Monthly view** due to your time range selection. Backup Instances which have had **atleast one** successful backup in every week in a given month (28 days) are marked green (compliant) for that week.  [Learn more](https://aka.ms/AzureBackupReportWeeklyBackupMonthlyView2)",
                                            "style": "info"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Weekly"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Backup Instance"
                                            },
                                            {
                                              "parameterName": "AggregationType",
                                              "comparison": "isEqualTo",
                                              "value": "Monthly"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByBackupInstance-WeeklyBackup-AggregationType-Weekly-Text - Copy"
                                        },
                                        {
                                          "type": 9,
                                          "content": {
                                            "version": "KqlParameterItem/1.0",
                                            "crossComponentResources": [
                                              "{Workspaces}"
                                            ],
                                            "parameters": [
                                              {
                                                "id": "cb015b28-ef63-4003-8cdd-afc04992841a",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_SearchBackupInstanceOrDatasourceSet_2c",
                                                "label": "Search Instance or Container",
                                                "type": 1,
                                                "description": "Use to search for a backup instance by name. <br/> To search for a specific instance in a container, use the syntax [container name];[instance name] <br/> To search for all instances in a container, use the syntax [container name];",
                                                "timeContext": {
                                                  "durationMs": 604800000
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "9597943f-e990-4c14-967d-36b971159676",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_RowsPerPage_2c",
                                                "label": "Rows per Page",
                                                "type": 2,
                                                "description": "Number of rows to display in grid view",
                                                "isRequired": true,
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[\r\n    { \"value\":10, \"label\":\"10\", \"selected\":true  },\r\n    { \"value\":25, \"label\":\"25\" },\r\n    { \"value\":50, \"label\":\"50\" },\r\n    { \"value\":100, \"label\":\"100\" },\r\n    { \"value\":250, \"label\":\"250\" },\r\n    { \"value\":500, \"label\":\"500\" },\r\n    { \"value\":1000, \"label\":\"1000\" }\r\n]",
                                                "timeContext": {
                                                  "durationMs": 0
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "fbb06ba5-20eb-41d5-ad52-a0d883c83f48",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_Page_2c",
                                                "label": "Page",
                                                "type": 2,
                                                "description": "Select Page Number",
                                                "isRequired": true,
                                                "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet Item_search =  @\"{PolicyAdherenceTab_SearchBackupInstanceOrDatasourceSet_2c}\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\n// BackupJob\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\n// Grid specific params\r\nlet bin_Value =  iff(@\"{AggregationType}\" == \"Monthly\", 28d, 7d);\r\nlet sum_isJobSuccessInTheTimePeriod_Value = iff(@\"{AggregationType}\" == \"Monthly\", \"4\", \"1\"); \r\nlet duration_Value = iff(@\"{AggregationType}\" == \"Monthly\", \"27.00:00:00\", \"6.00:00:00\"); \r\nlet BackupInstanceWithWeeklyBackup = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == \"Weekly\"\r\n};\r\n// Grid Logic\r\nlet JobInfo = ()\r\n{\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithWeeklyBackup) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| summarize jobCount = count(), jobSuccessCount = countif(Status == \"Completed\" or Status == \"CompletedWithWarnings\"), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName), BackupSolution =  any(BackupSolution), DatasourceSetResourceId = any(DatasourceSetResourceId), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName) by BackupInstanceUniqueId, JobCreationDate = startofday(StartTime)\r\n| project ResourceGroup=iff(BackupSolution ==\"Azure Backup Agent\" or BackupSolution ==\"Azure Backup Server\" or BackupSolution ==\"DPM\",\"(none)\",split(split(tostring(tolower(DatasourceSetResourceId)), '/resourcegroups/')[1],'/')[0]), jobCount, jobSuccessCount, BackupInstanceFriendlyName, BackupInstanceUniqueId, DatasourceSetFriendlyName, JobCreationDate\r\n};\r\nJobInfo\r\n| summarize by BackupInstanceUniqueId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup\r\n| extend Day = range(RangeEnd, RangeStart, -1d)\r\n| mv-expand Day\r\n| project BackupInstanceUniqueId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup, todatetime(Day)\r\n| join kind = leftouter \r\n( JobInfo\r\n) on BackupInstanceUniqueId, $left.Day == $right.JobCreationDate\r\n| sort by BackupInstanceUniqueId, Day desc\r\n// Create weekly buckets to check if SLA met\r\n| summarize max(Day), min(Day), sum(jobSuccessCount), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName), ResourceGroup = any(ResourceGroup) by BackupInstanceUniqueId, bin_at(Day, 7d, RangeEnd + 1d)\r\n| project BackupInstanceUniqueId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup, Day, sum_isJobSuccessInTheTimePeriod = iff(sum_jobSuccessCount > 1, 1, sum_jobSuccessCount), max_Day, min_Day\r\n| summarize max_Day = max(max_Day), min_Day = min(min_Day), sum_isJobSuccessInTheTimePeriod = sum(sum_isJobSuccessInTheTimePeriod), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName), ResourceGroup = any(ResourceGroup) by BackupInstanceUniqueId, Day = bin_at(Day, bin_Value, RangeEnd + 1d)\r\n| project BackupInstanceUniqueId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup, Period =  strcat(format_datetime(todatetime(min_Day),\"yyyy/MM/dd\"), \" - \", format_datetime(todatetime(max_Day),\"yyyy/MM/dd\")), sum_isJobSuccessInTheTimePeriod, duration = max_Day - min_Day, Day\r\n// Exclude partial week/month\r\n| where duration == duration_Value\r\n| summarize sum_isJobSuccessInTheTimePeriod = countif(sum_isJobSuccessInTheTimePeriod == sum_isJobSuccessInTheTimePeriod_Value), Day= (any(Day)), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName), ResourceGroup = any(ResourceGroup) by BackupInstanceUniqueId, Period\r\n| evaluate pivot(Period, any(sum_isJobSuccessInTheTimePeriod), BackupInstanceFriendlyName, BackupInstanceUniqueId, DatasourceSetFriendlyName, ResourceGroup)\r\n| summarize c=count()\r\n| project num = (c-1)/{PolicyAdherenceTab_RowsPerPage_2b} + 1\r\n| project nums = range(1,num,1), num\r\n| mvexpand nums\r\n| project nums = tostring(nums), num = strcat(tostring(nums),\" of \",tostring(num))",
                                                "crossComponentResources": [
                                                  "{Workspaces}"
                                                ],
                                                "value": "1",
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "timeContext": {
                                                  "durationMs": 0
                                                },
                                                "timeContextFromParameter": "TimeRange",
                                                "queryType": 0,
                                                "resourceType": "microsoft.operationalinsights/workspaces"
                                              }
                                            ],
                                            "style": "pills",
                                            "doNotRunWhenHidden": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces"
                                          },
                                          "customWidth": "90",
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Backup Instance"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Weekly"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByBackupInstance-WeeklyBackup-Grid1ParameterBlock",
                                          "styleSettings": {
                                            "padding": "0% 0% 0% 0%"
                                          }
                                        },
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet Item_search =  @\"{PolicyAdherenceTab_SearchBackupInstanceOrDatasourceSet_2c}\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\n// BackupJob\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\n// Grid specific params\r\nlet bin_Value =  iff(@\"{AggregationType}\" == \"Monthly\", 28d, 7d);\r\nlet sum_isJobSuccessInTheTimePeriod_Value = iff(@\"{AggregationType}\" == \"Monthly\", \"4\", \"1\"); \r\nlet duration_Value = iff(@\"{AggregationType}\" == \"Monthly\", \"27.00:00:00\", \"6.00:00:00\"); \r\nlet BackupInstanceWithWeeklyBackup = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == \"Weekly\"\r\n};\r\n// Grid Logic\r\nlet JobInfo = ()\r\n{\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithWeeklyBackup) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| summarize jobCount = count(), jobSuccessCount = countif(Status == \"Completed\" or Status == \"CompletedWithWarnings\"), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName), BackupInstanceId = any(BackupInstanceId), BackupSolution =  any(BackupSolution), DatasourceSetResourceId = any(DatasourceSetResourceId), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName) by BackupInstanceUniqueId, JobCreationDate = startofday(StartTime)\r\n| project ResourceGroup=iff(BackupSolution ==\"Azure Backup Agent\" or BackupSolution ==\"Azure Backup Server\" or BackupSolution ==\"DPM\",\"(none)\",split(split(tostring(tolower(DatasourceSetResourceId)), '/resourcegroups/')[1],'/')[0]), jobCount, jobSuccessCount, BackupInstanceFriendlyName, BackupInstanceUniqueId, DatasourceSetFriendlyName, JobCreationDate, BackupInstanceId\r\n};\r\nJobInfo\r\n| summarize by BackupInstanceUniqueId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup, BackupInstanceId\r\n| extend Day = range(RangeEnd, RangeStart, -1d)\r\n| mv-expand Day\r\n| project BackupInstanceUniqueId, BackupInstanceId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup, todatetime(Day)\r\n| join kind = leftouter \r\n( JobInfo\r\n) on BackupInstanceUniqueId, $left.Day == $right.JobCreationDate\r\n| sort by BackupInstanceUniqueId, Day desc\r\n// Create weekly buckets to check if SLA met\r\n| summarize max(Day), min(Day), sum(jobSuccessCount), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName),BackupInstanceId = any(BackupInstanceId), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName), ResourceGroup = any(ResourceGroup) by BackupInstanceUniqueId, bin_at(Day, 7d, RangeEnd + 1d)\r\n| project BackupInstanceUniqueId, BackupInstanceId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup, Day, sum_isJobSuccessInTheTimePeriod = iff(sum_jobSuccessCount > 1, 1, sum_jobSuccessCount), max_Day, min_Day\r\n| summarize max_Day = max(max_Day), min_Day = min(min_Day), sum_isJobSuccessInTheTimePeriod = sum(sum_isJobSuccessInTheTimePeriod), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName), BackupInstanceId = any(BackupInstanceId), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName), ResourceGroup = any(ResourceGroup) by BackupInstanceUniqueId, Day = bin_at(Day, bin_Value, RangeEnd + 1d)\r\n| project BackupInstanceUniqueId, BackupInstanceId, BackupInstanceFriendlyName, DatasourceSetFriendlyName, ResourceGroup, Period =  strcat(format_datetime(todatetime(min_Day),\"yyyy/MM/dd\"), \" - \", format_datetime(todatetime(max_Day),\"yyyy/MM/dd\")), sum_isJobSuccessInTheTimePeriod, duration = max_Day - min_Day, Day\r\n// Exclude partial week/month\r\n| where duration == duration_Value\r\n| summarize sum_isJobSuccessInTheTimePeriod = countif(sum_isJobSuccessInTheTimePeriod == sum_isJobSuccessInTheTimePeriod_Value), Day= (any(Day)), BackupInstanceFriendlyName = any(BackupInstanceFriendlyName), BackupInstanceId = any(BackupInstanceId), DatasourceSetFriendlyName = any(DatasourceSetFriendlyName), ResourceGroup = any(ResourceGroup) by BackupInstanceUniqueId, Period\r\n| evaluate pivot(Period, any(sum_isJobSuccessInTheTimePeriod), BackupInstanceFriendlyName, BackupInstanceId, BackupInstanceUniqueId, DatasourceSetFriendlyName, ResourceGroup)\r\n| sort by BackupInstanceUniqueId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{PolicyAdherenceTab_RowsPerPage_2c} + 1))\r\n| where page_num has ('{PolicyAdherenceTab_Page_2c}') or '*' in ('{PolicyAdherenceTab_Page_2c}') | project-away row_num, page_num\r\n",
                                            "size": 3,
                                            "noDataMessage": "No records found for the selected scope and time range. Note that data for partial weeks is not displayed.",
                                            "exportedParameters": [
                                              {
                                                "fieldName": "DatasourceSetFriendlyName",
                                                "parameterName": "PolicyAdherence_WeeklyBackup_DatasourceSetFriendlyName",
                                                "parameterType": 1
                                              },
                                              {
                                                "fieldName": "BackupInstanceFriendlyName",
                                                "parameterName": "PolicyAdherence_WeeklyBackup_BackupInstanceFriendlyName",
                                                "parameterType": 1
                                              }
                                            ],
                                            "showExportToExcel": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces",
                                            "crossComponentResources": [
                                              "{Workspaces}"
                                            ],
                                            "gridSettings": {
                                              "formatters": [
                                                {
                                                  "columnMatch": "BackupInstanceFriendlyName",
                                                  "formatter": 16,
                                                  "formatOptions": {
                                                    "linkColumn": "BackupInstanceId",
                                                    "linkTarget": "Resource",
                                                    "showIcon": true
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Name of the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "BackupInstanceId",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "BackupInstanceUniqueId",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "DatasourceSetFriendlyName",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Protected Container associated with the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "ResourceGroup",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Resource group associated with the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "[0-9][0-9][0-9][0-9]/[0-9][0-9]/[0-9][0-9]|[0-9][0-9][0-9][0-9]/[0-9][0-9]/[0-9][0-9] - [0-9][0-9][0-9][0-9]/[0-9][0-9]/[0-9][0-9]",
                                                  "formatter": 18,
                                                  "formatOptions": {
                                                    "thresholdsOptions": "colors",
                                                    "thresholdsGrid": [
                                                      {
                                                        "operator": ">",
                                                        "thresholdValue": "0",
                                                        "representation": "green",
                                                        "text": "."
                                                      },
                                                      {
                                                        "operator": "Default",
                                                        "thresholdValue": null,
                                                        "representation": "redBright",
                                                        "text": "."
                                                      }
                                                    ]
                                                  }
                                                }
                                              ],
                                              "labelSettings": [
                                                {
                                                  "columnId": "BackupInstanceFriendlyName",
                                                  "label": "Backup Instance"
                                                },
                                                {
                                                  "columnId": "DatasourceSetFriendlyName",
                                                  "label": "Container"
                                                },
                                                {
                                                  "columnId": "ResourceGroup",
                                                  "label": "Resource Group"
                                                }
                                              ]
                                            },
                                            "sortBy": []
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Backup Instance"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_DailyOrWeeklyBackup",
                                              "comparison": "isEqualTo",
                                              "value": "Weekly"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "showPin": true,
                                          "name": "PolicyAdherenceByBackupInstance-WeeklyBackup-Grid1",
                                          "styleSettings": {
                                            "showBorder": true
                                          }
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "<span style=\"font-size:12px;font-style:italic\"> Click on any row above to see details of all backup jobs that were triggered in the selected period for the given backup instance. </span>"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Backup Instance"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByBackupInstance-PromptText"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "<div style=\"text-align:left\"><span style=\"font-size:14px;font-weight:600;\">List of Backup Jobs in Period</span> </div>"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Backup Instance"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_DailyBackup_BackupInstanceFriendlyName",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByBackupInstance-Grid2Title"
                                        },
                                        {
                                          "type": 9,
                                          "content": {
                                            "version": "KqlParameterItem/1.0",
                                            "parameters": [
                                              {
                                                "id": "0a8a7ff6-2849-46e2-8b52-4750eed51a8b",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_SortBy_2a",
                                                "label": "Sort By",
                                                "type": 2,
                                                "description": "Use to sort by a certain column",
                                                "isRequired": true,
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[{ \"value\": \"DurationInSecs\", \"label\": \"Job Duration (hrs)\" },\r\n{ \"value\": \"DataTransferredInMBs\", \"label\": \"Data Transferred (MB)\", \"selected\": \"true\" }]",
                                                "timeContext": {
                                                  "durationMs": 604800000
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "941ce741-3f2f-44fe-bd1b-f44d2d7abc0d",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_Order_2a",
                                                "label": "Order",
                                                "type": 2,
                                                "description": "Use to specify the sort order: Ascending/Descending",
                                                "isRequired": true,
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[\r\n    { \"value\":\"Ascending\"},\r\n    { \"value\":\"Descending\", \"selected\":true}\r\n]",
                                                "timeContext": {
                                                  "durationMs": 0
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "7e9d2fe4-d0bd-4c29-81f0-823dda4337d5",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_RowsPerPage_2a",
                                                "label": "Rows per Page",
                                                "type": 2,
                                                "description": "Number of rows to display in grid view",
                                                "isRequired": true,
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[\r\n    { \"value\":10, \"label\":\"10\", \"selected\":true  },\r\n    { \"value\":25, \"label\":\"25\" },\r\n    { \"value\":50, \"label\":\"50\" },\r\n    { \"value\":100, \"label\":\"100\" },\r\n    { \"value\":250, \"label\":\"250\" },\r\n    { \"value\":500, \"label\":\"500\" },\r\n    { \"value\":1000, \"label\":\"1000\" }\r\n]",
                                                "timeContext": {
                                                  "durationMs": 0
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "fa53c49c-3992-4413-bd0e-fb639de3e0e9",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_Page_2a",
                                                "label": "Page",
                                                "type": 2,
                                                "description": "Select Page Number",
                                                "isRequired": true,
                                                "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet BackupInstanceName = @\"{PolicyAdherence_DailyBackup_BackupInstanceFriendlyName}\";\r\nlet DatasourceSetName = @\"{PolicyAdherence_DailyBackup_DatasourceSetFriendlyName}\";\r\nlet JobOperationList = \"Backup\";\r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\nlet PolicyAdherence_DailyOrWeeklyBackup_Value = @\"{PolicyAdherence_DailyOrWeeklyBackup}\";\r\nlet BackupInstanceWithSelectedBackupFrequency = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == PolicyAdherence_DailyOrWeeklyBackup_Value\r\n};\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithSelectedBackupFrequency) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| summarize c=count()\r\n| project num = (c-1)/{PolicyAdherenceTab_RowsPerPage_2a} + 1\r\n| project nums = range(1,num,1), num\r\n| mvexpand nums\r\n| project nums = tostring(nums), num = strcat(tostring(nums),\" of \",tostring(num)) ",
                                                "crossComponentResources": [
                                                  "{Workspaces}"
                                                ],
                                                "value": "1",
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "queryType": 0,
                                                "resourceType": "microsoft.operationalinsights/workspaces"
                                              }
                                            ],
                                            "style": "pills",
                                            "doNotRunWhenHidden": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces"
                                          },
                                          "customWidth": "90",
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyBackup_BackupInstanceFriendlyName",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByBackupInstance-DailyBackup-Grid2ParameterBlock",
                                          "styleSettings": {
                                            "padding": "0% 0% 0% 0%"
                                          }
                                        },
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet BackupInstanceName = @\"{PolicyAdherence_DailyBackup_BackupInstanceFriendlyName}\";\r\nlet DatasourceSetName = @\"{PolicyAdherence_DailyBackup_DatasourceSetFriendlyName}\";\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\nlet PolicyAdherence_DailyOrWeeklyBackup_Value = @\"{PolicyAdherence_DailyOrWeeklyBackup}\";\r\nlet BackupInstanceWithSelectedBackupFrequency = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == PolicyAdherence_DailyOrWeeklyBackup_Value\r\n};\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithSelectedBackupFrequency) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| extend TempColumn = column_ifexists(tostring('{PolicyAdherenceTab_SortBy_2a}'), \"DataTransferredInMBs\")\r\n| extend ColumnToBeSorted = iff(tostring('{PolicyAdherenceTab_Order_2a}') == \"Ascending\", todouble(TempColumn) - 90000000, 90000000 - todouble(TempColumn))\r\n| sort by ColumnToBeSorted asc nulls last, UniqueId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{PolicyAdherenceTab_RowsPerPage_2a} + 1))\r\n| where page_num has ('{PolicyAdherenceTab_Page_2a}') or '*' in ('{PolicyAdherenceTab_Page_2a}')\r\n| project BackupInstance=BackupInstanceFriendlyName, BackupInstanceId, Container=DatasourceSetFriendlyName, ResourceGroup=iff(DatasourceType==\"Azure Backup Agent\" or DatasourceType==\"Azure Backup Server\" or DatasourceType==\"DPM\",\"(none)\",split(split(tostring(tolower(DatasourceSetResourceId)), '/resourcegroups/')[1],'/')[0]\r\n), OperationCategory, JobStatus=Status,  JobStartDateTime=StartTime, JobDuration=DurationInSecs/3600, ErrorTitle, DataTransferred=DataTransferredInMBs, AzureResource=DatasourceSetResourceId, DatasourceType \r\n",
                                            "size": 3,
                                            "showExportToExcel": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces",
                                            "crossComponentResources": [
                                              "{Workspaces}"
                                            ],
                                            "gridSettings": {
                                              "formatters": [
                                                {
                                                  "columnMatch": "BackupInstance",
                                                  "formatter": 16,
                                                  "formatOptions": {
                                                    "linkColumn": "BackupInstanceId",
                                                    "linkTarget": "Resource",
                                                    "showIcon": true
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Name of the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "BackupInstanceId",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "Container",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Protected Container associated with the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "ResourceGroup",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Resource group associated with the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "OperationCategory",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Operation Category"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "JobStatus",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Job Status"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "JobStartDateTime",
                                                  "formatter": 6,
                                                  "dateFormat": {
                                                    "showUtcTime": true,
                                                    "formatName": "shortDateTimePattern"
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Start date and time of the Job"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "JobDuration",
                                                  "formatter": 4,
                                                  "formatOptions": {
                                                    "min": 0,
                                                    "palette": "blue"
                                                  },
                                                  "numberFormat": {
                                                    "unit": 0,
                                                    "options": {
                                                      "style": "decimal",
                                                      "maximumFractionDigits": 2
                                                    }
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Job Duration"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "ErrorTitle",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Job Failure Code"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "DataTransferred",
                                                  "formatter": 4,
                                                  "formatOptions": {
                                                    "min": 0,
                                                    "palette": "blue"
                                                  },
                                                  "numberFormat": {
                                                    "unit": 0,
                                                    "options": {
                                                      "style": "decimal",
                                                      "maximumFractionDigits": 2
                                                    }
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Amount of data transferred by the job"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "AzureResource",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Azure Resource associated with the backup instance. For Azure VM Backup, SQL in Azure VM backup and SAP database in Azure VM backup, the Azure Resource is the Azure VM. For Azure Files Share backup, the Azure Resource is the Azure Storage account. For on-premises backup instances, this field is blank."
                                                  }
                                                },
                                                {
                                                  "columnMatch": "DatasourceType",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Datasource Type"
                                                  }
                                                }
                                              ],
                                              "filter": true,
                                              "labelSettings": [
                                                {
                                                  "columnId": "OperationCategory",
                                                  "label": "Operation Category"
                                                },
                                                {
                                                  "columnId": "ErrorTitle",
                                                  "label": "Error Title"
                                                },
                                                {
                                                  "columnId": "DatasourceType",
                                                  "label": "Datasource Type"
                                                }
                                              ]
                                            },
                                            "sortBy": []
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_DailyBackup_BackupInstanceFriendlyName",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "showPin": false,
                                          "name": "PolicyAdherenceByBackupInstance-DailyBackup-Grid2"
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "<div style=\"text-align:left\"><span style=\"font-size:14px;font-weight:600;\">List of Backup Jobs in Period</span> </div>"
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_SubTab",
                                              "comparison": "isEqualTo",
                                              "value": "Policy Adherence by Backup Instance"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "PolicyAdherence_WeeklyBackup_BackupInstanceFriendlyName",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByBackupInstance-WeeklyBackup-Grid2Title"
                                        },
                                        {
                                          "type": 9,
                                          "content": {
                                            "version": "KqlParameterItem/1.0",
                                            "parameters": [
                                              {
                                                "id": "1d337e2a-8cf3-48b1-ab33-e94e0dd62b46",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_SortBy_2d",
                                                "label": "Sort By",
                                                "type": 2,
                                                "description": "Use to sort by a certain column",
                                                "isRequired": true,
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[{ \"value\": \"DurationInSecs\", \"label\": \"Job Duration (hrs)\" },\r\n{ \"value\": \"DataTransferredInMBs\", \"label\": \"Data Transferred (MB)\", \"selected\": \"true\" }]",
                                                "timeContext": {
                                                  "durationMs": 604800000
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "5b6194ab-e6fe-4e97-8ab5-2d2a5f35dbc9",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_Order_2d",
                                                "label": "Order",
                                                "type": 2,
                                                "description": "Use to specify the sort order: Ascending/Descending",
                                                "isRequired": true,
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[\r\n    { \"value\":\"Ascending\"},\r\n    { \"value\":\"Descending\", \"selected\":true}\r\n]",
                                                "timeContext": {
                                                  "durationMs": 0
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "f0dade2b-e0c3-4dc9-8fe2-cdeff6773082",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_RowsPerPage_2d",
                                                "label": "Rows per Page",
                                                "type": 2,
                                                "description": "Number of rows to display in grid view",
                                                "isRequired": true,
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "jsonData": "[\r\n    { \"value\":10, \"label\":\"10\", \"selected\":true  },\r\n    { \"value\":25, \"label\":\"25\" },\r\n    { \"value\":50, \"label\":\"50\" },\r\n    { \"value\":100, \"label\":\"100\" },\r\n    { \"value\":250, \"label\":\"250\" },\r\n    { \"value\":500, \"label\":\"500\" },\r\n    { \"value\":1000, \"label\":\"1000\" }\r\n]",
                                                "timeContext": {
                                                  "durationMs": 0
                                                },
                                                "timeContextFromParameter": "TimeRange"
                                              },
                                              {
                                                "id": "7357c97e-59fd-4df0-a979-560063c13c0c",
                                                "version": "KqlParameterItem/1.0",
                                                "name": "PolicyAdherenceTab_Page_2d",
                                                "label": "Page",
                                                "type": 2,
                                                "description": "Select Page Number",
                                                "isRequired": true,
                                                "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet BackupInstanceName = @\"{PolicyAdherence_WeeklyBackup_BackupInstanceFriendlyName}\";\r\nlet DatasourceSetName = @\"{PolicyAdherence_WeeklyBackup_DatasourceSetFriendlyName}\";\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\nlet PolicyAdherence_DailyOrWeeklyBackup_Value = @\"{PolicyAdherence_DailyOrWeeklyBackup}\";\r\nlet BackupInstanceWithSelectedBackupFrequency = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == PolicyAdherence_DailyOrWeeklyBackup_Value\r\n};\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithSelectedBackupFrequency) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| summarize c=count()\r\n| project num = (c-1)/{PolicyAdherenceTab_RowsPerPage_2d} + 1\r\n| project nums = range(1,num,1), num\r\n| mvexpand nums\r\n| project nums = tostring(nums), num = strcat(tostring(nums),\" of \",tostring(num)) ",
                                                "crossComponentResources": [
                                                  "{Workspaces}"
                                                ],
                                                "value": "1",
                                                "typeSettings": {
                                                  "additionalResourceOptions": [],
                                                  "showDefault": false
                                                },
                                                "queryType": 0,
                                                "resourceType": "microsoft.operationalinsights/workspaces"
                                              }
                                            ],
                                            "style": "pills",
                                            "doNotRunWhenHidden": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces"
                                          },
                                          "customWidth": "90",
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_WeeklyBackup_BackupInstanceFriendlyName",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "name": "PolicyAdherenceByBackupInstance-WeeklyBackup-Grid2ParameterBlock",
                                          "styleSettings": {
                                            "padding": "0% 0% 0% 0%"
                                          }
                                        },
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet DisplayAllFields = false;\r\nlet BackupInstanceName = @\"{PolicyAdherence_WeeklyBackup_BackupInstanceFriendlyName}\";\r\nlet DatasourceSetName = @\"{PolicyAdherence_WeeklyBackup_DatasourceSetFriendlyName}\";\r\nlet JobOperationList = \"Backup\"; \r\nlet JobStatusList = \"*\";\r\nlet JobFailureCodeList = \"*\";\r\nlet ExcludeLog = true; \r\nlet PolicyAdherence_DailyOrWeeklyBackup_Value = @\"{PolicyAdherence_DailyOrWeeklyBackup}\";\r\nlet BackupInstanceWithSelectedBackupFrequency = (){\r\n_AzureBackup_GetBackupInstances(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, ProtectionInfoList, DatasourceSetName, BackupInstanceName, DisplayAllFields)\r\n| join kind = inner (\r\n// calling LA System Function\r\n_AzureBackup_GetPolicies(RangeEnd, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList)\r\n) on $left.PolicyUniqueId == $right.UniqueId, $left.VaultResourceId == $right.VaultResourceId\r\n| where parse_json(ExtendedProperties).BackupFrequency == PolicyAdherence_DailyOrWeeklyBackup_Value\r\n};\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n| join kind = inner (BackupInstanceWithSelectedBackupFrequency) on $left.BackupInstanceUniqueId == $right.UniqueId\r\n| extend TempColumn = column_ifexists(tostring('{PolicyAdherenceTab_SortBy_2d}'), \"DataTransferredInMBs\")\r\n| extend ColumnToBeSorted = iff(tostring('{PolicyAdherenceTab_Order_2d}') == \"Ascending\", todouble(TempColumn) - 90000000, 90000000 - todouble(TempColumn))\r\n| sort by ColumnToBeSorted asc nulls last, UniqueId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{PolicyAdherenceTab_RowsPerPage_2d} + 1))\r\n| where page_num has ('{PolicyAdherenceTab_Page_2d}') or '*' in ('{PolicyAdherenceTab_Page_2d}')\r\n| project BackupInstance=BackupInstanceFriendlyName, BackupInstanceId, Container=DatasourceSetFriendlyName, ResourceGroup=iff(DatasourceType==\"Azure Backup Agent\" or DatasourceType==\"Azure Backup Server\" or DatasourceType==\"DPM\",\"(none)\",split(split(tostring(tolower(DatasourceSetResourceId)), '/resourcegroups/')[1],'/')[0]\r\n), OperationCategory, JobStatus=Status,  JobStartDateTime=StartTime, JobDuration=DurationInSecs/3600, ErrorTitle, DataTransferred=DataTransferredInMBs, AzureResource=DatasourceSetResourceId, DatasourceType \r\n",
                                            "size": 3,
                                            "showExportToExcel": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces",
                                            "crossComponentResources": [
                                              "{Workspaces}"
                                            ],
                                            "gridSettings": {
                                              "formatters": [
                                                {
                                                  "columnMatch": "BackupInstance",
                                                  "formatter": 16,
                                                  "formatOptions": {
                                                    "linkColumn": "BackupInstanceId",
                                                    "linkTarget": "Resource",
                                                    "showIcon": true
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Name of the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "BackupInstanceId",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "Container",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Protected Container associated with the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "ResourceGroup",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Resource group associated with the backup instance"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "OperationCategory",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Operation Category"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "JobStatus",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Job Status"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "JobStartDateTime",
                                                  "formatter": 6,
                                                  "dateFormat": {
                                                    "showUtcTime": true,
                                                    "formatName": "shortDateTimePattern"
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Start date and time of the Job"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "JobDuration",
                                                  "formatter": 4,
                                                  "formatOptions": {
                                                    "min": 0,
                                                    "palette": "blue"
                                                  },
                                                  "numberFormat": {
                                                    "unit": 0,
                                                    "options": {
                                                      "style": "decimal",
                                                      "maximumFractionDigits": 2
                                                    }
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Job Duration"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "ErrorTitle",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Job Failure Code"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "DataTransferred",
                                                  "formatter": 4,
                                                  "formatOptions": {
                                                    "min": 0,
                                                    "palette": "blue"
                                                  },
                                                  "numberFormat": {
                                                    "unit": 0,
                                                    "options": {
                                                      "style": "decimal",
                                                      "maximumSignificantDigits": 2
                                                    }
                                                  },
                                                  "tooltipFormat": {
                                                    "tooltip": "Amount of data transferred by the job"
                                                  }
                                                },
                                                {
                                                  "columnMatch": "AzureResource",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Azure Resource associated with the backup instance. For Azure VM Backup, SQL in Azure VM backup and SAP database in Azure VM backup, the Azure Resource is the Azure VM. For Azure Files Share backup, the Azure Resource is the Azure Storage account. For on-premises backup instances, this field is blank."
                                                  }
                                                },
                                                {
                                                  "columnMatch": "DatasourceType",
                                                  "formatter": 0,
                                                  "tooltipFormat": {
                                                    "tooltip": "Datasource Type"
                                                  }
                                                }
                                              ],
                                              "labelSettings": [
                                                {
                                                  "columnId": "BackupInstance",
                                                  "label": "Backup Instance"
                                                },
                                                {
                                                  "columnId": "ResourceGroup",
                                                  "label": "Resource Group"
                                                },
                                                {
                                                  "columnId": "OperationCategory",
                                                  "label": "Operation Category"
                                                },
                                                {
                                                  "columnId": "JobStatus",
                                                  "label": "Job Status"
                                                },
                                                {
                                                  "columnId": "JobStartDateTime",
                                                  "label": "Job Start Date Time"
                                                },
                                                {
                                                  "columnId": "JobDuration",
                                                  "label": "Job Duration (hrs)"
                                                },
                                                {
                                                  "columnId": "ErrorTitle",
                                                  "label": "Job Failure Code"
                                                },
                                                {
                                                  "columnId": "DataTransferred",
                                                  "label": "Data Transferred"
                                                },
                                                {
                                                  "columnId": "AzureResource",
                                                  "label": "Azure Resource"
                                                },
                                                {
                                                  "columnId": "DatasourceType",
                                                  "label": "Datasource Type"
                                                }
                                              ]
                                            },
                                            "sortBy": []
                                          },
                                          "conditionalVisibilities": [
                                            {
                                              "parameterName": "PolicyAdherence_WeeklyBackup_BackupInstanceFriendlyName",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "Workspaces",
                                              "comparison": "isNotEqualTo"
                                            },
                                            {
                                              "parameterName": "DatasourceType",
                                              "comparison": "isNotEqualTo"
                                            }
                                          ],
                                          "showPin": true,
                                          "name": "PolicyAdherenceByBackupInstance-WeeklyBackup-Grid2",
                                          "styleSettings": {
                                            "showBorder": true
                                          }
                                        }
                                      ]
                                    },
                                    "name": "group - 0"
                                  }
                                ]
                              },
                              "name": "PolicyAdherence-group"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "submenu",
                          "comparison": "isEqualTo",
                          "value": "adhearance"
                        },
                        "name": "Adhearance"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "backuptab",
                    "comparison": "isEqualTo",
                    "value": "policies"
                  },
                  "name": "Backup Policies"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "2ab526a9-2062-46bb-835a-4db33f003ae5",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "value": {
                                "durationMs": 5184000000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "conditionalVisibility": {
                          "parameterName": "Tabname",
                          "comparison": "isNotEqualTo",
                          "value": "summary"
                        },
                        "name": "parameters - 1 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/alerts\"\r\n| where properties.sourceType == \"IaaSVM\"\r\n| where todatetime(properties.initialOccurrenceTime) {TimeRange}\r\n| extend vaultId = tolower(replace(\"\\\\/alerts.*\",\"\",id))\r\n| extend Items = \"Backup Alerts\", SubText = \"Total\"\r\n| summarize c = count()\r\n| extend Item = \"Backup Alerts\", SubText = \"Total\", Key = 3",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "c",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "name": "Jobs"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/alerts\"\r\n| where properties.sourceType == \"IaaSVM\"\r\n| where todatetime(properties.initialOccurrenceTime) {TimeRange}\r\n| extend vaultId = tolower(replace(\"\\\\/alerts.*\",\"\",id))\r\n\r\n| extend SubText = \"Alerts\", severity = iff(tolong(properties.severity) == 1, \"Critical\", iff(tolong(properties.severity) == 2, \"Warining\", \"Info\"))\r\n| summarize c=count() by severity\r\n| sort by severity\r\n",
                          "size": 4,
                          "title": "By Severity",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "Critical",
                                "color": "redBright"
                              },
                              {
                                "seriesName": "Warning",
                                "color": "orange"
                              },
                              {
                                "seriesName": "Info",
                                "color": "lightBlue"
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "By Severity"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/alerts\"\r\n| where properties.sourceType == \"IaaSVM\"\r\n| where todatetime(properties.initialOccurrenceTime) {TimeRange}\r\n| extend vaultId = tolower(replace(\"\\\\/alerts.*\",\"\",id))\r\n| extend SubText = \"Alerts\", severity = iff(tolong(properties.severity) == 1, \"Critical\", iff(tolong(properties.severity) == 2, \"Warining\", \"Info\"))\r\n\r\n| summarize c=count() by AlertName = tostring(properties.alertTitle)\r\n| sort by AlertName\r\n",
                          "size": 4,
                          "title": "By Type",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "Delete Backup Data",
                                "label": "Delete Backup Data",
                                "color": "redBright"
                              },
                              {
                                "seriesName": "Backup failure",
                                "label": "Backup failure",
                                "color": "orange"
                              },
                              {
                                "seriesName": "Restore failure",
                                "color": "lightBlue"
                              },
                              {
                                "seriesName": "Backup completed with warnings",
                                "color": "green"
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "By Type"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "RecoveryServicesResources\r\n| where type == \"microsoft.recoveryservices/vaults/alerts\"\r\n| where properties.sourceType == \"IaaSVM\"\r\n| where todatetime(properties.initialOccurrenceTime) {TimeRange}\r\n| extend vaultId = tolower(replace(\"\\\\/alerts.*\",\"\",id))\r\n| project backupItemId = strcat(vaultId,\"/backupFabrics/Azure/protectionContainers/IaasVMContainer;\",tostring(properties.firstLevelContainerId),\"/protectedItems/VM;\",tostring(properties.firstLevelContainerId)),\r\n          Item = tostring(split(tostring(properties.firstLevelContainerId),\";\")[2]),\r\n          ResourceGroup = tostring(split(tostring(properties.firstLevelContainerId),\";\")[1]),\r\n\t\t  HostHash = hash(tolower(strcat(subscriptionId, tostring(split(tostring(properties.firstLevelContainerId),\";\")[1]), tostring(split(tostring(properties.firstLevelContainerId),\";\")[2])))),\r\n          alertId = id, \r\n\t\t  backupItemHostId = strcat(\r\n\t\t  replace(\"\\\\/resourcegroups.*\",\"\",tolower(id)),\"/resourceGroups/\",tostring(split(tostring(properties.firstLevelContainerId),\";\")[1]),\r\n\t\t  \"/providers/Microsoft.\",\r\n\t\t  iff(tostring(properties.firstLevelContainerId) contains \"iaasvmcontainerv2;\", \"Compute/virtualMachines/\", \"ClassicCompute/virtualMachines/\"),             tostring(split(tostring(properties.firstLevelContainerId),\";\")[2])\r\n\t\t  ),\r\n\t\t  AlertName = tostring(properties.alertTitle),\r\n          CreationTime = todatetime(properties.initialOccurrenceTime),\r\n\t\t  Duration = replace(\"\\\\..*\",\"\",tostring(properties.duration)),\r\n\t\t  Severity = iff(tolong(properties.severity) == 1, \"Critical\", iff(tolong(properties.severity) == 2, \"Warining\", \"Info\")),\r\n\t\t  Status = iff(tolong(properties.status) == 1, \"Active\", \"Resolved\"),\r\n\t\t  ResolutionTime = todatetime(properties.resolutionTime),\r\n\t\t  vaultId\r\n| project backupItemId, Item, ResourceGroup, alertId, AlertName, CreationTime, Duration, Severity, Status, vaultId\r\n| sort by Item asc, alertId asc\r\n",
                          "size": 0,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Severity",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "Critical",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "Warning",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "info",
                                      "representation": "1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "more",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Status",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "Active",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "Resolved",
                                      "representation": "Close",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "more",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        "name": "query - 4"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "backuptab",
                    "comparison": "isEqualTo",
                    "value": "alerts"
                  },
                  "name": "Alerts"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// function Params - Report Filters\r\nlet RangeStart = startofday({TimeRange:start});\r\nlet RangeEnd = iff(startofday({TimeRange:end}) == startofday(now()) ,startofday({TimeRange:end}) - 1d , startofday({TimeRange:end}));\r\nlet VaultSubscriptionList = todynamic( replace(\"/subscriptions/\", \"\", @\"{VaultSubscription}\"));\r\nlet VaultLocationList = todynamic( @\"{VaultLocation}\"); \r\nlet VaultTypeList = \"*\";\r\nlet VaultList = todynamic( @\"{VaultName}\");\r\nlet ExcludeLegacyEvent = @\"{ExcludeLegacyEvent}\";\r\nlet BackupSolutionList = @\"{DatasourceType}\";\r\n// function Params - other Filters\r\nlet ProtectionInfoList = \"*\";\r\nlet Item_search =  @\"{JobTab_SearchBackupInstanceOrDatasourceSet}\";\r\nlet ItemArray = split(Item_search, \";\");\r\nlet ItemArray_length = array_length(ItemArray);\r\nlet BackupInstanceName = iff(ItemArray_length == 2, ItemArray[1], ItemArray[0] );\r\nlet DatasourceSetName = iff(ItemArray_length == 2, ItemArray[0], \"\");\r\nlet JobOperationList = todynamic( @\"{JobTab_JobOperation}\"); \r\nlet JobStatusList = todynamic( @\"{JobTab_JobStatus}\");\r\nlet JobFailureCodeList = todynamic( @\"{JobTab_JobFailureCode}\");\r\nlet ExcludeLog = true; \r\n// local Params\r\nlet BackupInstanceUniqueIdParam =  @\"{JobTab_SearchBackupInstanceUniqueId}\";\r\n// calling LA System Function\r\n_AzureBackup_GetJobs(RangeStart, RangeEnd, VaultSubscriptionList, VaultLocationList, VaultList, VaultTypeList, ExcludeLegacyEvent, BackupSolutionList, JobOperationList, JobStatusList, JobFailureCodeList, DatasourceSetName, BackupInstanceName, ExcludeLog)\r\n// query to transform function output\r\n| where BackupInstanceUniqueId == (BackupInstanceUniqueIdParam) or '*' in (BackupInstanceUniqueIdParam)\r\n| extend TempColumn = column_ifexists(tostring('{JobTab_SortBy_2}'), \"DataTransferredInMBs\")\r\n| extend ColumnToBeSorted = iff(tostring('{JobTab_Order_2}') == \"Ascending\", todouble(TempColumn) - 90000000, 90000000 - todouble(TempColumn))\r\n| sort by ColumnToBeSorted asc nulls last, UniqueId asc\r\n| extend row_num = row_number()\r\n| extend page_num = tostring(((row_num-1)/{JobTab_RowsPerPage_2} + 1))\r\n| where page_num has ('{JobTab_Page_2}') or '*' in ('{JobTab_Page_2}')\r\n| project BackupInstance=BackupInstanceFriendlyName, BackupInstanceId, Container=DatasourceSetFriendlyName, ResourceGroup=iff(DatasourceType==\"Azure Backup Agent\" or DatasourceType==\"Azure Backup Server\" or DatasourceType==\"DPM\",\"(none)\",split(split(tostring(tolower(DatasourceSetResourceId)), '/resourcegroups/')[1],'/')[0]\r\n), OperationCategory, JobStatus=Status,  JobStartDateTime=StartTime, JobDuration=DurationInSecs/3600, ErrorTitle, DataTransferred=DataTransferredInMBs, AzureResource=DatasourceSetResourceId, DatasourceType ",
                    "size": 3,
                    "noDataMessage": "No records found for the selected time range and scope",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "BackupInstance",
                          "formatter": 16,
                          "formatOptions": {
                            "linkColumn": "BackupInstanceId",
                            "linkTarget": "Resource",
                            "showIcon": true
                          },
                          "tooltipFormat": {
                            "tooltip": "Name of the backup instance"
                          }
                        },
                        {
                          "columnMatch": "BackupInstanceId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Container",
                          "formatter": 0,
                          "tooltipFormat": {
                            "tooltip": "Protected Container associated with the backup instance"
                          }
                        },
                        {
                          "columnMatch": "ResourceGroup",
                          "formatter": 0,
                          "tooltipFormat": {
                            "tooltip": "Resource group associated with the backup instance"
                          }
                        },
                        {
                          "columnMatch": "OperationCategory",
                          "formatter": 0,
                          "tooltipFormat": {
                            "tooltip": "Operation Category"
                          }
                        },
                        {
                          "columnMatch": "JobStatus",
                          "formatter": 0,
                          "tooltipFormat": {
                            "tooltip": "Job Status"
                          }
                        },
                        {
                          "columnMatch": "JobStartDateTime",
                          "formatter": 6,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          },
                          "dateFormat": {
                            "showUtcTime": true,
                            "formatName": "shortDateTimePattern"
                          },
                          "tooltipFormat": {
                            "tooltip": "Start date and time of the Job"
                          }
                        },
                        {
                          "columnMatch": "JobDuration",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "minimumFractionDigits": 2,
                              "maximumFractionDigits": 2
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "Job Duration"
                          }
                        },
                        {
                          "columnMatch": "ErrorTitle",
                          "formatter": 0,
                          "tooltipFormat": {
                            "tooltip": "Job Failure Code"
                          }
                        },
                        {
                          "columnMatch": "DataTransferred",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue"
                          },
                          "tooltipFormat": {
                            "tooltip": "Amount of data transferred by the job"
                          }
                        },
                        {
                          "columnMatch": "AzureResource",
                          "formatter": 0,
                          "tooltipFormat": {
                            "tooltip": "Azure Resource associated with the backup instance. For Azure VM Backup, SQL in Azure VM backup and SAP database in Azure VM backup, the Azure Resource is the Azure VM. For Azure Files Share backup, the Azure Resource is the Azure Storage account. For on-premises backup instances, this field is blank."
                          }
                        },
                        {
                          "columnMatch": "DatasourceType",
                          "formatter": 0,
                          "tooltipFormat": {
                            "tooltip": "Datasource Type"
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "BackupInstance",
                          "label": "Backup Instance"
                        },
                        {
                          "columnId": "ResourceGroup",
                          "label": "Resource Group"
                        },
                        {
                          "columnId": "OperationCategory",
                          "label": "Operation Category"
                        },
                        {
                          "columnId": "JobStatus",
                          "label": "Job Status"
                        },
                        {
                          "columnId": "JobStartDateTime",
                          "label": "Job Start Date Time"
                        },
                        {
                          "columnId": "JobDuration",
                          "label": "Job Duration (hrs)"
                        },
                        {
                          "columnId": "ErrorTitle",
                          "label": "Job Failure Code"
                        },
                        {
                          "columnId": "DataTransferred",
                          "label": "Data Transferred (MB)"
                        },
                        {
                          "columnId": "AzureResource",
                          "label": "Azure Resource"
                        },
                        {
                          "columnId": "DatasourceType",
                          "label": "Datasource Type"
                        }
                      ]
                    }
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "TabName",
                      "comparison": "isEqualTo",
                      "value": "JobDistribution"
                    },
                    {
                      "parameterName": "Workspaces",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "JobTab_SearchBackupInstanceUniqueId",
                      "comparison": "isNotEqualTo",
                      "value": "*"
                    },
                    {
                      "parameterName": "DatasourceType",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "showPin": true,
                  "name": "JobDistribution-Grid2",
                  "styleSettings": {
                    "margin": "-30px 0% 0% 0%",
                    "padding": "0% 0% -20px 0%",
                    "showBorder": true
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tabname",
              "comparison": "isEqualTo",
              "value": "backup"
            },
            "name": "Backup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "5e65113d-e7b6-4bb2-87e9-aaec919d3ea0",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Overview",
                        "subTarget": "overview",
                        "style": "link"
                      },
                      {
                        "id": "51e5f689-2f65-4166-8dd8-bf1394004b3a",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "VM View",
                        "subTarget": "vmview",
                        "style": "link"
                      },
                      {
                        "id": "f74ae523-02e0-4ddb-b5a1-718adfe11122",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Category View",
                        "subTarget": "categoryview",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 8"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "275e7403-ff7a-45cb-97c5-8d6ed2846758",
                              "version": "KqlParameterItem/1.0",
                              "name": "Workspace",
                              "label": "Choose a workspace",
                              "type": 5,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "Resources\r\n| where type =~ \"Microsoft.operationalinsights/workspaces\"\r\n| summarize by id",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "conditionalVisibilities": [
                          {
                            "parameterName": "submenu",
                            "comparison": "isNotEqualTo",
                            "value": "categoryview"
                          },
                          {
                            "parameterName": "submenu",
                            "comparison": "isNotEqualTo",
                            "value": "vmview"
                          }
                        ],
                        "name": "parameters - 1 - Copy - Copy"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "securityresources\r\n| where type == \"microsoft.security/assessments\"\r\n| where name == \"4ab6e3c5-74dd-8b35-9ab9-f61b30875b27\"\r\n| project state = tostring(properties.status.code)\r\n| summarize ResourcesCount = count() by tostring(state)",
                                "size": 1,
                                "title": "Count of resources by health",
                                "noDataMessage": "No unhealthy resources found",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Workspace}"
                                ],
                                "visualization": "piechart",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "state",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "==",
                                          "thresholdValue": "Unhealthy",
                                          "representation": "4",
                                          "text": ""
                                        },
                                        {
                                          "operator": "==",
                                          "thresholdValue": "NotApplicable",
                                          "representation": "cancelled"
                                        },
                                        {
                                          "operator": "==",
                                          "thresholdValue": "Healthy",
                                          "representation": "success"
                                        },
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Normal",
                                          "text": "{0}{1}"
                                        }
                                      ],
                                      "compositeBarSettings": {
                                        "labelText": "",
                                        "columnSettings": [
                                          {
                                            "columnName": "state",
                                            "color": "blue"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "rightContent": {
                                    "columnMatch": "count_",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "none",
                                      "compositeBarSettings": {
                                        "labelText": "",
                                        "columnSettings": []
                                      }
                                    }
                                  },
                                  "showBorder": true,
                                  "size": "auto"
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "state",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "count_",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "chartSettings": {
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "Unhealthy",
                                      "color": "red"
                                    },
                                    {
                                      "seriesName": "Healthy",
                                      "color": "green"
                                    },
                                    {
                                      "seriesName": "NotApplicable",
                                      "label": "Not Applicable",
                                      "color": "gray"
                                    }
                                  ]
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "count_",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "count_",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "count_",
                                    "heatmapPalette": "greenRed"
                                  }
                                }
                              },
                              "name": "ResourceHealth"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "securityresources\r\n| where type == \"microsoft.security/assessments\"\r\n| where name == \"4ab6e3c5-74dd-8b35-9ab9-f61b30875b27\"\r\n| extend ResourceId = extract(\"^(.+)/providers/Microsoft.Security/assessments/.+$\",1,id)\r\n| project state = tostring(properties.status.code), ResourceId = tolower(tostring(ResourceId))\r\n| where state == \"Unhealthy\"\r\n| join kind=inner (\r\n    securityresources \r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n| extend Name = extract(\".*assessments/(.+?)/.*\",1,  id) \r\n| where Name == \"4ab6e3c5-74dd-8b35-9ab9-f61b30875b27\" \r\n| extend State = tostring(properties.status.code), ResourceId = tolower(tostring(properties.resourceDetails.id)), OsType = tostring(properties.additionalData.data.OsType)) on ResourceId\r\n| summarize UnhelathyMachinesByOperatingSystemCount = dcount(ResourceId) by OsType",
                                "size": 1,
                                "title": "Count of unhealthy machines by operating system",
                                "noDataMessage": "No unhealthy resources found",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Workspace}"
                                ],
                                "visualization": "piechart",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "OsType",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "count_",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": false,
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "OsType",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "count_",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "OS"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id), severity = tostring(properties.status.severity)\r\n| where assessmentKey == \"4ab6e3c5-74dd-8b35-9ab9-f61b30875b27\" and properties.status.code == \"Unhealthy\"\r\n| summarize AssessmentsCount = count() by severity",
                                "size": 1,
                                "title": "Count of missing updates by severity",
                                "noDataMessage": "No unhealthy resources found",
                                "exportFieldName": "label",
                                "exportParameterName": "selectedSeverity",
                                "exportDefaultValue": "All",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Workspace}"
                                ],
                                "visualization": "piechart",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "severity",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "count_",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "chartSettings": {
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "Medium",
                                      "color": "yellow"
                                    },
                                    {
                                      "seriesName": "High",
                                      "color": "redBright"
                                    },
                                    {
                                      "seriesName": "Low",
                                      "color": "blueDark"
                                    }
                                  ]
                                }
                              },
                              "name": "Severity"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "Graph"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"4ab6e3c5-74dd-8b35-9ab9-f61b30875b27\" and properties.status.code == 'Unhealthy'\r\n| project Resource = iif(isempty(properties.resourceDetails.id),strcat(split(properties.resourceDetails.workspaceId, '/')[8]), properties.resourceDetails.id), subscriptionId, severity = tostring(parse_json(properties).status.severity), status = tostring(parse_json(properties).status.code), description = tostring(parse_json(properties).displayName), VulnId = tostring(parse_json(properties).id), resourceGroup = substring(id, 0, indexof(id, '/providers'))\r\n| summarize dcount(VulnId) by Resource, severity, VulnId, description\r\n| summarize  sevH=countif(severity=='High'), sevM=countif(severity=='Medium'), sevL=countif(severity=='Low') ,Total = count(dcount_VulnId) by Resource\r\n| order by sevH desc",
                          "size": 3,
                          "title": "Missing Patches Count",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "sevH",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "0",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "sevM",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "sevL",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Total",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ],
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "Resource",
                                "label": "VM"
                              },
                              {
                                "columnId": "sevH",
                                "label": "High"
                              },
                              {
                                "columnId": "sevM",
                                "label": "Medium"
                              },
                              {
                                "columnId": "sevL",
                                "label": "Low"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Resource",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": true
                              }
                            },
                            "leftContent": {
                              "columnMatch": "sevH",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "rightContent": {
                              "columnMatch": "sevM"
                            },
                            "secondaryContent": {
                              "columnMatch": "sevL"
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 8"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"4ab6e3c5-74dd-8b35-9ab9-f61b30875b27\"\r\n| project   Severity = tostring(properties.status.severity),\r\n            Resource = iif(isempty(properties.resourceDetails.id),strcat(split(properties.resourceDetails.workspaceId, '/')[8]), properties.resourceDetails.id),\r\n            ResourceGroup = toupper(substring(id, 0, indexof(id, '/providers'))),\r\n            Category = tostring(properties.category),\r\n\t\t\tSource = tostring(properties.resourceDetails.source),\r\n\t\t\tDescription = tostring(properties.description),\r\n            \t\tOsType = tostring(properties.additionalData.data.OsType),\r\n\t\t\tOperatingSystem = tostring(properties.additionalData.data.OperatingSystem)\r\n\t\r\n         \r\n| order by Severity asc",
                          "size": 3,
                          "title": "Detailed View",
                          "noDataMessage": "No unhealthy resources found",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "Severity",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Resource",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "OpenBlade",
                                  "linkIsContextBlade": false,
                                  "showIcon": true,
                                  "bladeOpenContext": {
                                    "bladeName": "GenericResourceHealthDetailsBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "resourceId",
                                        "source": "cell",
                                        "value": "%2Fsubscriptions%2F3b5bc982-20bc-4b59-b1ca-f8488bb86736%2FresourceGroups%2Fdemo%2Fproviders%2FMicrosoft.HybridCompute%2Fmachines%2FW2019"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "ResourceGroup",
                                "formatter": 14,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true,
                                  "customColumnWidthSetting": "25ch"
                                }
                              },
                              {
                                "columnMatch": "Category",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "Source",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "OperatingSystem",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "25ch"
                                }
                              },
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "Remediation",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "RemediationSteps",
                                "formatter": 11,
                                "formatOptions": {
                                  "linkColumn": "Remediation",
                                  "linkTarget": "Url"
                                },
                                "tooltipFormat": {
                                  "tooltip": "Click to view remediation steps"
                                }
                              },
                              {
                                "columnMatch": "Code",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Healthy",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Unhealthy",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "resourceGroup",
                                "formatter": 14,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              }
                            ],
                            "rowLimit": 1000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Severity"
                              ],
                              "expandTopLevel": false
                            },
                            "labelSettings": [
                              {
                                "columnId": "ResourceGroup",
                                "label": "Resource group"
                              },
                              {
                                "columnId": "OsType",
                                "label": "OS type"
                              },
                              {
                                "columnId": "OperatingSystem",
                                "label": "Operating system"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "name": "Missing Patches"
                      }
                    ],
                    "exportParameters": true
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "overview"
                  },
                  "name": "Overview"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "7bd0f21c-30f8-44e1-9e91-f9e87118bea9",
                              "version": "KqlParameterItem/1.0",
                              "name": "VirtualMachines",
                              "label": "Virtual Machines",
                              "type": 5,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "where type =~ 'microsoft.compute/virtualmachines'\r\n\t| order by name asc\r\n\t| extend Rank = row_number()\r\n\t| project value = id, label = id, selected = Rank <= 25",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::5",
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::5",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "920babe0-e044-45a5-bbfe-cc6ddfb12679",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 172800000
                              }
                            },
                            {
                              "id": "1cece63d-effc-4422-b1e1-43bfd5a87891",
                              "version": "KqlParameterItem/1.0",
                              "name": "Message",
                              "type": 1,
                              "query": "where type == 'microsoft.compute/virtualmachines' \r\n| summarize Selected = countif(id in ({VirtualMachines:value})), Total = count()\r\n| project Message = strcat('# ', Selected, ' / ', Total)",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": null
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "conditionalVisibility": {
                          "parameterName": "submenu",
                          "comparison": "isEqualTo",
                          "value": "vmview"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Update\r\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification) by Computer, SourceComputerId, Product, ProductArch, _ResourceId\r\n| where UpdateState=~\"Needed\"\r\n| project Product, ProductArch, Classification, Computer, _ResourceId\r\n| summarize count() by _ResourceId",
                                "size": 0,
                                "timeContextFromParameter": "TimeRange",
                                "queryType": 0,
                                "resourceType": "microsoft.resources/subscriptions",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "table",
                                "graphSettings": {
                                  "type": 2,
                                  "topContent": {
                                    "columnMatch": "Computer",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "count_",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "nodeIdField": "Computer",
                                  "graphOrientation": 3,
                                  "showOrientationToggles": false,
                                  "nodeSize": null,
                                  "staticNodeSize": 100,
                                  "colorSettings": {
                                    "nodeColorField": "count_",
                                    "type": 4,
                                    "heatmapPalette": "greenRed",
                                    "heatmapMin": 0,
                                    "heatmapMax": 5,
                                    "emptyValueColor": "green"
                                  },
                                  "hivesMargin": 5
                                }
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "Number of Patches"
                            },
                            {
                              "type": 10,
                              "content": {
                                "chartId": "workbook2932b309-c598-450d-bcd3-c0acbf6b821a",
                                "version": "MetricsItem/2.0",
                                "size": 0,
                                "chartType": 0,
                                "resourceType": "microsoft.compute/virtualmachines",
                                "metricScope": 0,
                                "resourceParameter": "VirtualMachines",
                                "resourceIds": [
                                  "{VirtualMachines}"
                                ],
                                "timeContextFromParameter": "TimeRange",
                                "timeContext": {
                                  "durationMs": 172800000
                                },
                                "metrics": [
                                  {
                                    "namespace": "microsoft.compute/virtualmachines",
                                    "metric": "microsoft.compute/virtualmachines--Percentage CPU",
                                    "aggregation": 4
                                  }
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "Subscription",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Name",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource"
                                      }
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--Percentage CPU Timeline",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "microsoft.compute/virtualmachines--Percentage CPU",
                                      "formatter": 1,
                                      "numberFormat": {
                                        "unit": 1,
                                        "options": null
                                      }
                                    }
                                  ],
                                  "rowLimit": 10000,
                                  "labelSettings": [
                                    {
                                      "columnId": "Subscription",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "Name",
                                      "label": "Storage Name"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Percentage CPU",
                                      "label": "Percentage CPU (Average)"
                                    },
                                    {
                                      "columnId": "microsoft.compute/virtualmachines--Percentage CPU Timeline",
                                      "label": "Percentage CPU Timeline"
                                    }
                                  ]
                                }
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tab Name",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "Virtual Machine List"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"c5b3741f-00a8-46fd-8e7d-8b6e2d0010f8\",\"mergeType\":\"leftouter\",\"leftTable\":\"Virtual Machine List\",\"rightTable\":\"Number of Patches\",\"leftColumn\":\"Name\",\"rightColumn\":\"_ResourceId\"}],\"projectRename\":[{\"originalName\":\"[Virtual Machine List].Subscription\",\"mergedName\":\"Subscription Name\",\"fromId\":\"c5b3741f-00a8-46fd-8e7d-8b6e2d0010f8\"},{\"originalName\":\"[Virtual Machine List].Name\",\"mergedName\":\"Virtual Machine Name\",\"fromId\":\"c5b3741f-00a8-46fd-8e7d-8b6e2d0010f8\"},{\"originalName\":\"[Number of Patches].count_\",\"mergedName\":\"Number Of Patches\",\"fromId\":\"c5b3741f-00a8-46fd-8e7d-8b6e2d0010f8\"},{\"originalName\":\"[VM List].microsoft.compute/virtualmachines--Percentage CPU\"},{\"originalName\":\"[VM List].microsoft.compute/virtualmachines--Percentage CPU Timeline\"},{\"originalName\":\"[num of patches]._ResourceId\"},{\"originalName\":\"[Virtual Machine List].microsoft.compute/virtualmachines--Percentage CPU Timeline\"},{\"originalName\":\"[Virtual Machine List].microsoft.compute/virtualmachines--Percentage CPU\"},{\"originalName\":\"[Number of Patches]._ResourceId\"}]}",
                                "size": 3,
                                "queryType": 7,
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Virtual Machine Name",
                                    "formatter": 13,
                                    "formatOptions": {
                                      "linkTarget": null,
                                      "showIcon": true
                                    }
                                  },
                                  "leftContent": {
                                    "columnMatch": "Number Of Patches",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "==",
                                          "thresholdValue": "0",
                                          "representation": "success",
                                          "text": "Patched"
                                        },
                                        {
                                          "operator": ">",
                                          "thresholdValue": "0",
                                          "representation": "4",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "success",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "secondaryContent": {
                                    "columnMatch": "Subscription Name",
                                    "formatter": 13,
                                    "formatOptions": {
                                      "linkTarget": null,
                                      "showIcon": true
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 2,
                                  "topContent": {
                                    "columnMatch": "Virtual Machine Name",
                                    "formatter": 13,
                                    "formatOptions": {
                                      "linkTarget": null,
                                      "showIcon": false
                                    }
                                  },
                                  "centerContent": {
                                    "columnMatch": "Number Of Patches",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal"
                                      },
                                      "emptyValCustomText": "0"
                                    }
                                  },
                                  "nodeIdField": "Virtual Machine Name",
                                  "graphOrientation": 3,
                                  "showOrientationToggles": false,
                                  "nodeSize": null,
                                  "staticNodeSize": 100,
                                  "colorSettings": {
                                    "nodeColorField": "Number Of Patches",
                                    "type": 4,
                                    "heatmapPalette": "greenRed",
                                    "heatmapMin": 0,
                                    "heatmapMax": 1,
                                    "emptyValueColor": "green"
                                  },
                                  "hivesMargin": 2
                                }
                              },
                              "showPin": false,
                              "name": "query - 2"
                            }
                          ]
                        },
                        "name": "group - 4"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "vmview"
                  },
                  "name": "VM View"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "ab447ded-30a6-4ece-8730-323f730a7c56",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 172800000
                              }
                            },
                            {
                              "id": "293412ac-973c-411d-8654-3e7b3fe72de4",
                              "version": "KqlParameterItem/1.0",
                              "name": "Message",
                              "type": 1,
                              "query": "where type == 'microsoft.compute/virtualmachines' \r\n| summarize Selected = countif(id in ({VirtualMachines:value})), Total = count()\r\n| project Message = strcat('# ', Selected, ' / ', Total)",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "conditionalVisibility": {
                          "parameterName": "submenu",
                          "comparison": "isEqualTo",
                          "value": "categoryview"
                        },
                        "name": "parameters - 1 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Summary of updates available across machines \r\n// Count of updates available under various categories for each machine. \r\n// To create an alert for this query, click '+ New alert rule'\r\nUpdateSummary \r\n| where TimeGenerated>ago(14h) \r\n\r\n| summarize by ResourceId, CriticalUpdatesMissing, SecurityUpdatesMissing, SubscriptionId,WindowsUpdateSetting,LastUpdateApplied,SourceSystem,RestartPending",
                          "size": 0,
                          "title": "Missing Update Counts",
                          "timeContextFromParameter": "TimeRange",
                          "exportFieldName": "VM",
                          "exportParameterName": "VM",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "CriticalUpdatesMissing",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "SecurityUpdatesMissing",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "OtherUpdatesMissing",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "TotalUpdatesMissing",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "SubscriptionId",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              }
                            ],
                            "rowLimit": 999,
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "ResourceId",
                                "label": "VM"
                              }
                            ]
                          }
                        },
                        "name": "Category View"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Missing security or critical updates \r\n// Count how many security or other critical updates are missing. \r\n// To create an alert for this query, click '+ New alert rule'\r\nUpdate\r\n| where Classification in (\"Security Updates\", \"Critical Updates\")\r\n| where UpdateState == 'Needed' and Optional == false and Approved == true\r\n| summarize count() by _ResourceId,  Computer, Classification , Title ,TimeGenerated , UpdateState ,Product,ResourceType,ComputerEnvironment , MSRCSeverity,KBID,RevisionNumber\r\n",
                          "size": 0,
                          "title": "Missing Security/Critical Updates",
                          "noDataMessageStyle": 3,
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Group",
                                "formatter": 1
                              }
                            ],
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Computer"
                              ]
                            },
                            "sortBy": [
                              {
                                "itemKey": "Classification",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "_ResourceId",
                                "label": "VM"
                              },
                              {
                                "columnId": "Computer",
                                "label": "VM"
                              },
                              {
                                "columnId": "Classification",
                                "label": "Classificaiton"
                              },
                              {
                                "columnId": "Title",
                                "label": "Title"
                              },
                              {
                                "columnId": "TimeGenerated",
                                "label": "Time Generated"
                              },
                              {
                                "columnId": "UpdateState",
                                "label": "Status"
                              },
                              {
                                "columnId": "ComputerEnvironment",
                                "label": "Computer Environment"
                              },
                              {
                                "columnId": "MSRCSeverity",
                                "label": "MSRC Severity"
                              },
                              {
                                "columnId": "KBID",
                                "label": "KBID"
                              },
                              {
                                "columnId": "RevisionNumber",
                                "label": "Revision Number"
                              },
                              {
                                "columnId": "count_",
                                "label": "Count"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "Classification",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "name": "Critical Missing Update"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Missing update rollups \r\n// All computers with missing update rollups. \r\n// To create an alert for this query, click '+ New alert rule'\r\nUpdate\r\n| where OSType != \"Linux\" and Optional == \"false\" and Classification == \"Update Rollups\" and UpdateState == \"Needed\" \r\n| project TimeGenerated, _ResourceId,Computer, Title, KBID, Classification, MSRCSeverity, PublishedDate\r\n| sort by TimeGenerated desc",
                          "size": 3,
                          "title": "Missing RollUps",
                          "noDataMessageStyle": 3,
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Computer"
                              ]
                            },
                            "sortBy": [
                              {
                                "itemKey": "Classification",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "TimeGenerated",
                                "label": "Time Generated"
                              },
                              {
                                "columnId": "_ResourceId",
                                "label": "VM"
                              },
                              {
                                "columnId": "Computer",
                                "label": "Hostname"
                              },
                              {
                                "columnId": "Classification",
                                "label": "Classificaiton"
                              },
                              {
                                "columnId": "MSRCSeverity",
                                "label": "MSRC Severity"
                              },
                              {
                                "columnId": "PublishedDate",
                                "label": "Published Date"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "Classification",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "name": "Update Role-Up"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "categoryview"
                  },
                  "name": "Category View"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tabname",
              "comparison": "isEqualTo",
              "value": "patching"
            },
            "name": "Patching"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "2e3a76d1-1d02-4fb4-9ed1-55e08030a428",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Workspace",
                        "subTarget": "workspace",
                        "style": "link"
                      },
                      {
                        "id": "3e9f3110-18f2-41e9-bffb-fff0ce77c33a",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "VM Extension",
                        "subTarget": "vmextension",
                        "style": "link"
                      },
                      {
                        "id": "58c65554-1db0-447f-a341-29f6a391b362",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Native Alarm",
                        "subTarget": "nativealarm",
                        "style": "link"
                      },
                      {
                        "id": "e44c1402-e631-488b-a3bf-1edc79ed2926",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Bilable Data",
                        "subTarget": "bilabledata",
                        "style": "link"
                      },
                      {
                        "id": "d95b2835-0b83-4e72-b830-50595dabd656",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Agent Status",
                        "subTarget": "agentstatus",
                        "style": "link"
                      },
                      {
                        "id": "35ba1fef-6b99-4a85-a2af-441b00db83f8",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Agent Health",
                        "subTarget": "agenthealth",
                        "style": "link"
                      },
                      {
                        "id": "769e87df-7cff-40c7-8540-b990709f2deb",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Audit Logs",
                        "subTarget": "auditlog",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 0"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources\r\n| where type == 'microsoft.compute/virtualmachines'\r\n| extend\r\n    JoinID = toupper(id),\r\n    OSName = tostring(properties.osProfile.computerName),\r\n    OSType = tostring(properties.storageProfile.osDisk.osType),\r\n    VMSize = tostring(properties.hardwareProfile.vmSize)\r\n| join kind=leftouter(\r\n    Resources\r\n    | where type == 'microsoft.compute/virtualmachines/extensions'\r\n    | extend\r\n        VMId = toupper(substring(id, 0, indexof(id, '/extensions')))\r\n        ,ExtensionName = name\r\n    , provisioningState = tostring(properties.provisioningState), autoUpgradeMinorVersion= tostring(properties.autoUpgradeMinorVersion), typeHandlerVersion= tostring(properties.typeHandlerVersion)\r\n) on $left.JoinID == $right.VMId\r\n| summarize Extensions = make_list(ExtensionName) by id, VMSize, OSType, provisioningState, autoUpgradeMinorVersion, typeHandlerVersion\r\n| summarize count() by provisioningState",
                          "size": 1,
                          "title": "VM Extensions Status",
                          "noDataMessage": "No VM Extensions",
                          "exportToExcelOptions": "all",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "categoricalbar",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "id",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": true,
                                  "showIcon": true,
                                  "customColumnWidthSetting": "18ch"
                                }
                              },
                              {
                                "columnMatch": "provisioningState",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Succeeded",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Failed",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Updating",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "autoUpgradeMinorVersion",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "false",
                                      "representation": "Sev1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "true",
                                      "representation": "Sev3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "provisioningState",
                                "label": "Extension State"
                              }
                            ]
                          },
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "provisioningState",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "provisioningState",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "count_",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "chartSettings": {
                            "xAxis": "provisioningState",
                            "showLegend": true,
                            "seriesLabelSettings": [
                              {
                                "seriesName": "Updating",
                                "color": "orange"
                              },
                              {
                                "seriesName": "Failed",
                                "color": "redBright"
                              },
                              {
                                "seriesName": "Succeeded",
                                "color": "green"
                              }
                            ]
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "count_",
                            "sizeAggregation": "Sum",
                            "legendMetric": "count_",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "count_",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": " Failed VM Extension  - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources\r\n| where type == 'microsoft.compute/virtualmachines'\r\n| extend\r\n    JoinID = toupper(id),\r\n    OSName = tostring(properties.osProfile.computerName),\r\n    OSType = tostring(properties.storageProfile.osDisk.osType),\r\n    VMSize = tostring(properties.hardwareProfile.vmSize)\r\n| join kind=leftouter(\r\n    Resources\r\n    | where type == 'microsoft.compute/virtualmachines/extensions'\r\n    | extend\r\n        VMId = toupper(substring(id, 0, indexof(id, '/extensions')))\r\n        ,ExtensionName = name\r\n    , provisioningState = tostring(properties.provisioningState), autoUpgradeMinorVersion= tostring(properties.autoUpgradeMinorVersion), typeHandlerVersion= tostring(properties.typeHandlerVersion)\r\n) on $left.JoinID == $right.VMId\r\n| summarize Extensions = make_list(ExtensionName) by id, VMSize, OSType, provisioningState, autoUpgradeMinorVersion, typeHandlerVersion",
                          "size": 0,
                          "title": "VM Extensions Status",
                          "noDataMessage": "No VM Extensions",
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "id",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": true,
                                  "showIcon": true,
                                  "customColumnWidthSetting": "18ch"
                                }
                              },
                              {
                                "columnMatch": "provisioningState",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Succeeded",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Failed",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Updating",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "autoUpgradeMinorVersion",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "false",
                                      "representation": "Sev1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "true",
                                      "representation": "Sev3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "id",
                                "label": "VM Name"
                              },
                              {
                                "columnId": "VMSize",
                                "label": "VM SKU"
                              },
                              {
                                "columnId": "OSType",
                                "label": "Operating System"
                              },
                              {
                                "columnId": "provisioningState",
                                "label": "Extension State"
                              },
                              {
                                "columnId": "autoUpgradeMinorVersion",
                                "label": "AutoUpgrade"
                              },
                              {
                                "columnId": "typeHandlerVersion",
                                "label": "Version"
                              },
                              {
                                "columnId": "Extensions",
                                "label": "Extension Name"
                              }
                            ]
                          }
                        },
                        "name": " Failed VM Extension "
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "vmextension"
                  },
                  "name": "VM Extension"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "a0dd103e-87b8-4b51-8227-6f535d56389f",
                              "version": "KqlParameterItem/1.0",
                              "name": "Workspace",
                              "type": 5,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| project id",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "parameters - 3 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n        or type =~ 'microsoft.insights/components'\r\n        or type has 'microsoft.insights/'\r\n        or type has 'microsoft.alertsmanagement/smartdetectoralertrules'\r\n        or type has 'microsoft.portal/dashboards'\r\n| summarize count() by type\r\n| extend type = case(\r\ntype == 'microsoft.insights/components', \"Application Insights\",\r\ntype == 'microsoft.operationalinsights/workspaces', \"Log Analytics workspaces\",\r\ntype == 'microsoft.insights/workbooks', \"Workbooks\",\r\n\ttype == 'microsoft.insights/activitylogalerts', \"Activity Log Alerts\",\r\n\ttype == 'microsoft.insights/scheduledqueryrules', \"Log Search Alerts\",\r\n\ttype == 'microsoft.insights/actiongroups', \"Action Groups\",\r\n\ttype == 'microsoft.insights/metricalerts', \"Metric Alerts\",\r\n\ttype =~ 'microsoft.alertsmanagement/smartdetectoralertrules','Smart Detection Rules',\r\n    type =~ 'microsoft.insights/webtests', 'URL Web Tests',\r\n    type =~ 'microsoft.portal/dashboards', 'Portal Dashboards',\r\n    type =~ 'microsoft.insights/datacollectionrules', 'Data Collection Rules',\r\n    type =~ 'microsoft.insights/autoscalesettings', 'Auto Scale Settings',\r\n    type =~ 'microsoft.insights/alertrules', 'Alert Rules',\r\nstrcat(type, type))",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Solutions",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "AzureSecurityCenter",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "representation": "disabled",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Available",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AzureSecurityCenterFree",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "disabled",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Available",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AzureSentinel",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "disabled",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Available",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AzureMonitorVMs",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "disabled",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Available",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "ServiceDesk",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "disabled",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Available",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AzureAutomation",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "disabled",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Available",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "ChangeTracking",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "disabled",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Available",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "UpdateManagement",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "disabled",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Available",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "UpdateCompliance",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "disabled",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Available",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AzureMonitorContainers",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "disabled",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Available",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "KeyVaultAnalytics",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "disabled",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Available",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "SQLHealthCheck",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "disabled",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Available",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ]
                          },
                          "sortBy": [],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "type",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "selectedTab",
                          "comparison": "isEqualTo",
                          "value": "monitor"
                        },
                        "name": "query - Monitoring Security Overview - Copy - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| where '{Workspace:name}' has name\r\n| extend \r\n  state = trim(' ', tostring(properties.provisioningState)),\r\n  sku = trim(' ', tostring(properties.sku.name)),\r\n  skuUpdate = trim(' ', tostring(properties.sku.lastSkuUpdate)),\r\n  retentionDays = trim(' ', tostring(properties.retentionInDays)),\r\n  dailyquotaGB  = trim(' ', tostring(properties.workspaceCapping.dailyQuotaGb))\r\n| extend dailyquotaGB = iif(dailyquotaGB !=-1.0, dailyquotaGB,\"--\")\r\n| project ['Workspace']=id,  ['Resource Group']=strcat(\"/subscriptions/\", subscriptionId, \"/resourceGroups/\", resourceGroup), ['Location']=location, ['Retention (days)']=retentionDays, ['Daily Cap (GB)']=dailyquotaGB, ['Licence']=sku, Subscription=strcat(\"/subscriptions/\", subscriptionId)\r\n\r\n",
                          "size": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Licence",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "pergb2018",
                                      "representation": "turquoise",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "premium",
                                      "representation": "blue",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "standard",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "free",
                                      "representation": "green",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "capacityreservation",
                                      "representation": "orange",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "pernode",
                                      "representation": "yellow",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "standalone",
                                      "representation": "pink",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "gray",
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "10%"
                                }
                              },
                              {
                                "columnMatch": "Subscription",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "name": "query - 3",
                        "styleSettings": {
                          "margin": "2px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.operationsmanagement/solutions\"\r\n| project Solution=plan.name, Workspace=tolower(tostring(properties.workspaceResourceId)), subscriptionId\r\n| join kind=leftouter(\r\nresources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| where '{Workspace:name}' has name\r\n| project  Workspace=tolower(tostring(id)),subscriptionId) on Workspace\r\n| summarize Solutions = strcat_array (make_list(Solution), \",\") by Workspace, subscriptionId \r\n| extend AzureSecurityCenter = iif(Solutions has 'Security','Enabled','Not Enabled')\r\n| extend AzureSecurityCenterFree = iif(Solutions has 'SecurityCenterFree','Enabled','Not Enabled')\r\n| extend AzureSentinel = iif(Solutions has \"SecurityInsights\",'Enabled','Not Enabled')\r\n| extend AzureMonitorVMs = iif(Solutions has \"VMInsights\",'Enabled','Not Enabled')\r\n| extend ServiceDesk = iif(Solutions has \"ITSM Connector\",'Enabled','Not Enabled')\r\n| extend AzureAutomation = iif(Solutions has \"AzureAutomation\",'Enabled','Not Enabled')\r\n| extend ChangeTracking = iif(Solutions has 'ChangeTracking','Enabled','Not Enabled')\r\n| extend UpdateManagement = iif(Solutions has 'Updates','Enabled','Not Enabled')\r\n| extend UpdateCompliance = iif(Solutions has 'WaaSUpdateInsights','Enabled','Not Enabled')\r\n| extend AzureMonitorContainers = iif(Solutions has 'ContainerInsights','Enabled','Not Enabled')\r\n| extend KeyVaultAnalytics = iif(Solutions has 'KeyVaultAnalytics','Enabled','Not Enabled')\r\n| extend SQLHealthCheck = iif(Solutions has 'SQLAssessment','Enabled','Not Enabled')\r\n",
                          "size": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "AzureSecurityCenter",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Enabled",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AzureSecurityCenterFree",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Enabled",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AzureSentinel",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Enabled",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AzureMonitorVMs",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Enabled",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "ServiceDesk",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Enabled",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AzureAutomation",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Enabled",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "ChangeTracking",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Enabled",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "UpdateManagement",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Enabled",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "UpdateCompliance",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Enabled",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AzureMonitorContainers",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Enabled",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "KeyVaultAnalytics",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Enabled",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "SQLHealthCheck",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Enabled",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Not Enabled",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ],
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "subscriptionId",
                                "label": "Subscription ID"
                              },
                              {
                                "columnId": "AzureSecurityCenter",
                                "label": "Security Center"
                              },
                              {
                                "columnId": "AzureSecurityCenterFree",
                                "label": "Security Center Free"
                              },
                              {
                                "columnId": "AzureSentinel",
                                "label": "Sentinel"
                              },
                              {
                                "columnId": "AzureMonitorVMs",
                                "label": "Azure Monitor VM's"
                              },
                              {
                                "columnId": "ServiceDesk",
                                "label": "Service Desk"
                              },
                              {
                                "columnId": "AzureAutomation",
                                "label": "Automation"
                              },
                              {
                                "columnId": "ChangeTracking",
                                "label": "Chanage Tracking"
                              },
                              {
                                "columnId": "UpdateManagement",
                                "label": "Update Management"
                              },
                              {
                                "columnId": "UpdateCompliance",
                                "label": "Update Compliance"
                              },
                              {
                                "columnId": "AzureMonitorContainers",
                                "label": "Containers"
                              },
                              {
                                "columnId": "KeyVaultAnalytics",
                                "label": "Key Vault Analytics"
                              },
                              {
                                "columnId": "SQLHealthCheck",
                                "label": "SQL Health Check"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Solutions"
                            },
                            "leftContent": {
                              "columnMatch": "Solutions"
                            },
                            "showBorder": false
                          }
                        },
                        "name": "query - 8"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "2b5a7606-137c-46a1-8946-dab9caa41636",
                              "version": "KqlParameterItem/1.0",
                              "name": "Workspace",
                              "type": 5,
                              "isRequired": true,
                              "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| project id",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::1",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "69f581d3-9b04-4ce8-987d-25d5ebc43255",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimePeriod",
                              "type": 4,
                              "isRequired": true,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ],
                                "allowCustom": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 86400000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "union withsource=['Table Name'] *\r\n| summarize Entries = count(), Size = sum(estimate_data_size(*)) by ['Table Name']\r\n| order by Size desc\r\n| project ['Table Name'], ['Table Entries'] = Entries, ['Table Size'] = Size, ['Size per Entry'] = 1.0 * Size / Entries\r\n",
                          "size": 3,
                          "timeContextFromParameter": "TimePeriod",
                          "exportFieldName": "Table Name",
                          "exportParameterName": "Table",
                          "exportDefaultValue": "All Tables",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Table Entries",
                                "formatter": 3,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "green",
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 17,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Table Size",
                                "formatter": 3,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Size per Entry",
                                "formatter": 3,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "orange",
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 2,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 2
                                  }
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "name": "query - 2"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "workspace"
                  },
                  "name": "workspace"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "9ab02b50-ee2f-4110-96a2-7855ba5b57c5",
                              "version": "KqlParameterItem/1.0",
                              "name": "timeRange",
                              "label": "Time Range",
                              "type": 4,
                              "isRequired": true,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 43200000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AlertsManagementResources\r\n| where todatetime(properties.essentials.startDateTime) {timeRange}  \r\n| extend AlertStatus = properties.essentials.monitorCondition\r\n| extend AlertState = properties.essentials.alertState\r\n| extend AlertTime = properties.essentials.startDateTime\r\n| extend AlertSuppressed = properties.essentials.actionStatus.isSuppressed\r\n| extend Severity = properties.essentials.severity\r\n\r\n| extend Details = pack_all()\r\n| project id, name, subscriptionId, resourceGroup, AlertStatus, AlertState, AlertTime, AlertSuppressed, Severity\r\n| summarize count() by tostring(AlertStatus)\r\n",
                          "size": 4,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "sortBy": []
                        },
                        "customWidth": "50",
                        "name": "query - 1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AlertsManagementResources\r\n| where todatetime(properties.essentials.startDateTime) {timeRange}  \r\n| where type =~ 'microsoft.alertsmanagement/alerts'\r\n| extend State=tostring(properties.essentials.alertState)\r\n| summarize Count=count(), New=countif(State==\"New\"), \r\nAcknowledged=countif(State==\"Acknowledged\"), \r\nClosed=countif(State==\"Closed\") \r\nby Severity=tostring(properties.essentials.severity)\r\n| order by Severity asc",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Count",
                                "formatter": 3,
                                "formatOptions": {
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AlertsManagementResources\r\n| where type =~ 'microsoft.alertsmanagement/alerts'\r\n| where todatetime(properties.essentials.startDateTime) {timeRange}  \r\n| extend State=tostring(properties.essentials.alertState)\r\n| summarize Count=count(), New=countif(State==\"New\"), \r\nAcknowledged=countif(State==\"Acknowledged\"), \r\nClosed=countif(State==\"Closed\") \r\nby name\r\n| order by name asc",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Count",
                                "formatter": 3,
                                "formatOptions": {
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "name",
                                "label": "Name"
                              }
                            ]
                          }
                        },
                        "name": "query - 2 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AlertsManagementResources\r\n| where todatetime(properties.essentials.startDateTime) {timeRange}  \r\n| extend AlertStatus = properties.essentials.monitorCondition\r\n| extend AlertState = properties.essentials.alertState\r\n| extend AlertTime = properties.essentials.startDateTime\r\n| extend AlertSuppressed = properties.essentials.actionStatus.isSuppressed\r\n| extend Severity = properties.essentials.severity\r\n\r\n| extend Details = pack_all()\r\n| project id, name, subscriptionId, resourceGroup, AlertStatus, AlertState, AlertTime,  Severity\r\n",
                          "size": 3,
                          "title": "Open Alerts",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Severity"
                              ]
                            },
                            "labelSettings": [
                              {
                                "columnId": "id",
                                "label": "ID"
                              },
                              {
                                "columnId": "name",
                                "label": "Name"
                              },
                              {
                                "columnId": "subscriptionId",
                                "label": "Subscription ID"
                              },
                              {
                                "columnId": "resourceGroup",
                                "label": "Resource Group"
                              },
                              {
                                "columnId": "AlertStatus",
                                "label": "Alert Status"
                              },
                              {
                                "columnId": "AlertState",
                                "label": "Alert State"
                              },
                              {
                                "columnId": "AlertTime",
                                "label": "Time"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "name": "query - 1 - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "nativealarm"
                  },
                  "name": "Overview"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "f60ea0a0-3703-44ca-a59b-df0246423f41",
                              "version": "KqlParameterItem/1.0",
                              "name": "Workspace",
                              "type": 5,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| where resourceGroup in ({ResourceGroup:value})\r\n| order by name asc\r\n| extend Rank = row_number()\r\n| project value = id, label = id, selected = Rank <= 5",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "value": [
                                "value::all"
                              ]
                            },
                            {
                              "id": "182d6324-854c-4cc0-802a-de4f3bee9f76",
                              "version": "KqlParameterItem/1.0",
                              "name": "timeRange",
                              "label": "Time range",
                              "type": 4,
                              "isRequired": true,
                              "value": {
                                "durationMs": 86400000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  }
                                ],
                                "allowCustom": true
                              }
                            },
                            {
                              "id": "5ab45df9-371b-4dba-8ee3-6ec9fbb33ff9",
                              "version": "KqlParameterItem/1.0",
                              "name": "Message",
                              "type": 1,
                              "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| summarize Selected = countif(id in ({Workspace:value})), Total = count()\r\n| extend Selected = iff(Selected > 200, 200, Selected)\r\n| project Message = strcat('# ', Selected, ' / ', Total)",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "46dfcfa4-d5d4-47c2-9dfd-ca0fcb935dc7",
                              "version": "KqlParameterItem/1.0",
                              "name": "ResourceName",
                              "type": 1,
                              "description": "Used for 'No Subscriptions' workbook template",
                              "isRequired": true,
                              "isHiddenWhenLocked": true,
                              "criteriaData": [
                                {
                                  "criteriaContext": {
                                    "operator": "Default",
                                    "rightValType": "param",
                                    "resultValType": "static",
                                    "resultVal": "Log Analytics Workspace"
                                  }
                                }
                              ]
                            },
                            {
                              "id": "1c84117c-7449-4484-b693-00f41a578bd6",
                              "version": "KqlParameterItem/1.0",
                              "name": "ResourceImageUrl",
                              "type": 1,
                              "description": "Used for 'No Subscriptions' workbook template",
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange"
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "conditionalVisibilities": [
                          {
                            "parameterName": "submenu",
                            "comparison": "isNotEqualTo",
                            "value": "agenthealth"
                          },
                          {
                            "parameterName": "submenu",
                            "comparison": "isNotEqualTo",
                            "value": "servicehealth"
                          },
                          {
                            "parameterName": "submenu",
                            "comparison": "isNotEqualTo",
                            "value": "worspaceusage"
                          },
                          {
                            "parameterName": "submenu",
                            "comparison": "isNotEqualTo",
                            "value": "agentstatus"
                          }
                        ],
                        "name": "Log Analytics Workspace parameters",
                        "styleSettings": {
                          "margin": "15px 0 0 0"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Billable performance data \r\n// Calculate the volume of billable data (in GB) for Perf data, over the last day. \r\nUsage\r\n| where TimeGenerated > ago(1d)\r\n| where IsBillable == true\r\n| where DataType == \"Perf\"\r\n| summarize TotalVolumeGB = sum(Quantity) / 1024\r\n| extend Item = \"Billable Performance Data (GB)\",  Key = 1",
                          "size": 3,
                          "timeContextFromParameter": "timeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "TotalVolumeGB",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "customWidth": "20",
                        "name": "Billable Pefromance Data"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Volume of solutions' data \r\n// Chart the volume of data (in Mb) sent by each\r\nUsage\r\n| summarize total_MBytes=sum(Quantity) by Solution\r\n| sort by total_MBytes desc nulls last\r\n| render barchart\r\n| extend Item = \"Billable Performance Data\",  Key = 1",
                          "size": 3,
                          "title": "Volumetric Solution Data (Mb)",
                          "timeContextFromParameter": "timeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "TotalVolumeGB",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "customWidth": "40",
                        "name": "Volumetric Solution Data"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type has 'microsoft.insights/'\r\n        or type has 'microsoft.alertsmanagement/ smartdetectoralertrules'\r\n        or type has 'microsoft.portal/dashboards'\r\n        or type has 'microsoft.operationalinsights/workspaces'\r\n            or type has 'microsoft.insights/components'\r\n| where type != 'microsoft.insights/components'\r\n| extend type = case(\r\n              type == 'microsoft.insights/workbooks', \"Workbooks\",\r\n              type == 'microsoft.insights/activitylogalerts', \"Activity Log Alerts\",\r\n              type == 'microsoft.insights/scheduledqueryrules', \"Log Search Alerts\",\r\n              type == 'microsoft.insights/actiongroups', \"Action Groups\",\r\n              type == 'microsoft.insights/metricalerts', \"Metric Alerts\",\r\n              type =~ 'microsoft.alertsmanagement/smartdetectoralertrules','Smart Detection Rules',\r\n              type =~ 'microsoft.insights/webtests', 'URL Web Tests',\r\n              type =~ 'microsoft.portal/dashboards', 'Portal Dashboards',\r\n              type =~ 'microsoft.insights/datacollectionrules', 'Data Collection Rules',\r\n              type == 'microsoft.insights/components', \"Application Insights\",\r\n              type == 'microsoft.operationalinsights/workspaces', \"Log Analytics workspaces\",\r\n              type == 'microsoft.insights/actiongroups', \"Action Groups\",\r\nstrcat(\"Not Translated: \", type))\r\n| summarize count() by type",
                          "size": 3,
                          "title": "Summary of Azure Montior Resoruces",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "type",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "40",
                        "name": "Summary of Azure Monitor Resources"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "bilabledata"
                  },
                  "name": "Monitoring Data"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "17fe2b22-f4b9-4c64-8515-5aa96f87ca3c",
                              "version": "KqlParameterItem/1.0",
                              "name": "workspace",
                              "label": "Work Space",
                              "type": 5,
                              "description": "Choose LA Workspace",
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "Resources\r\n| where type =~ \"Microsoft.operationalinsights/workspaces\"\r\n| summarize by id",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "parameters - 2"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "title": "Windows Machines",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ConfigurationData\r\n| where ConfigDataType == \"WindowsServices\" and SvcDisplayName == \"Windows Azure Guest Agent\" and SvcState != \"\"\r\n| summarize arg_max(TimeGenerated, *) by Computer \r\n| project _ResourceId, WinGuestAgent=SvcState",
                                "size": 3,
                                "timeContext": {
                                  "durationMs": 2592000000
                                },
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{workspace}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "query - 0"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Heartbeat\r\n| summarize LastHeartbeat = max(TimeGenerated) by _ResourceId\r\n| extend State = iff(LastHeartbeat < ago(5m), 'Stopped', 'Running')\r\n| project _ResourceId, State",
                                "size": 3,
                                "timeContext": {
                                  "durationMs": 2592000000
                                },
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{workspace}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "query - 1"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ConfigurationData\r\n| where ConfigDataType == \"WindowsServices\" and SvcDisplayName == \"Windows Remote Management (WS-Management)\" and SvcState != \"\"\r\n| summarize arg_max(TimeGenerated, *) by Computer \r\n| project _ResourceId, WindowsRemoteManagment=SvcState",
                                "size": 0,
                                "timeContext": {
                                  "durationMs": 2592000000
                                },
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{workspace}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "query - 2"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ConfigurationData\r\n| where ConfigDataType == \"WindowsServices\" and SvcDisplayName == \"Microsoft Monitoring Agent Azure VM Extension Heartbeat Service\" and SvcState != \"\"\r\n| summarize arg_max(TimeGenerated, *) by Computer \r\n| project _ResourceId, HeartbeatService=SvcState",
                                "size": 3,
                                "timeContext": {
                                  "durationMs": 2592000000
                                },
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{workspace}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "query - 3"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ConfigurationData\r\n| where ConfigDataType == \"WindowsServices\" and SvcDisplayName == \"Windows Azure Guest Agent\" and SvcState != \"\"\r\n| summarize arg_max(TimeGenerated, *) by Computer \r\n| project _ResourceId, AzureGuestAgent=SvcState",
                                "size": 3,
                                "timeContext": {
                                  "durationMs": 2592000000
                                },
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{workspace}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "query - 4"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ConfigurationData\r\n| where ConfigDataType == \"WindowsServices\" and SvcDisplayName == \"Microsoft Dependency Agent\"\r\n| summarize arg_max(TimeGenerated, *) by Computer \r\n| project _ResourceId, MsDependencyAgent=SvcState",
                                "size": 3,
                                "timeContext": {
                                  "durationMs": 2592000000
                                },
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{workspace}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "query - 5"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ConfigurationData\r\n| where ConfigDataType == \"WindowsServices\" and SvcDisplayName == \"Windows Azure Network Agent\" and SvcState != \"\"\r\n| summarize arg_max(TimeGenerated, *) by Computer \r\n| project _ResourceId, MsNetworkAgent=SvcState",
                                "size": 0,
                                "timeContext": {
                                  "durationMs": 2592000000
                                },
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{workspace}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "showPin": false,
                              "name": "query - 6"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ \"microsoft.compute/virtualmachines\"\r\n| where properties.storageProfile.osDisk.osType == '{OSType}'\r\n| extend vm_status = properties.extended.instanceView.powerState.displayStatus\r\n| where vm_status == \"VM running\"\r\n| project id",
                                "size": 0,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "sortBy": []
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "query - 8"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"4bac0709-9f4b-481f-8ec8-65cade45e163\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - 8\",\"rightTable\":\"query - 3\",\"leftColumn\":\"id\",\"rightColumn\":\"_ResourceId\"},{\"id\":\"4bac0709-9f4b-481f-8ec8-65cade45e168\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - 8\",\"rightTable\":\"query - 0\",\"leftColumn\":\"id\",\"rightColumn\":\"_ResourceId\"},{\"id\":\"4bac0709-9f4b-481f-8ec8-65cade45e16d\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - 8\",\"rightTable\":\"query - 1\",\"leftColumn\":\"id\",\"rightColumn\":\"_ResourceId\"},{\"id\":\"4bac0709-9f4b-481f-8ec8-65cade45e170\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - 8\",\"rightTable\":\"query - 2\",\"leftColumn\":\"id\",\"rightColumn\":\"_ResourceId\"},{\"id\":\"4bac0709-9f4b-481f-8ec8-65cade45e171\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - 8\",\"rightTable\":\"query - 4\",\"leftColumn\":\"id\",\"rightColumn\":\"_ResourceId\"},{\"id\":\"4bac0709-9f4b-481f-8ec8-65cade45e172\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - 8\",\"rightTable\":\"query - 5\",\"leftColumn\":\"id\",\"rightColumn\":\"_ResourceId\"},{\"id\":\"4bac0709-9f4b-481f-8ec8-65cade45e179\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - 8\",\"rightTable\":\"query - 6\",\"leftColumn\":\"id\",\"rightColumn\":\"_ResourceId\"}],\"projectRename\":[{\"originalName\":\"[query - 8].id\",\"mergedName\":\"id\",\"fromId\":\"4bac0709-9f4b-481f-8ec8-65cade45e163\"},{\"originalName\":\"[query - 0].WinGuestAgent\",\"mergedName\":\"WinGuestAgent\",\"fromId\":\"unknown\"},{\"originalName\":\"WinGuestAgent\",\"mergedName\":\"WinGuestAgent\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 1].State\",\"mergedName\":\"MsMonitoringAgent\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 3].HeartbeatService\",\"mergedName\":\"HeartbeatService\",\"fromId\":\"4bac0709-9f4b-481f-8ec8-65cade45e163\"},{\"originalName\":\"[query - 1].MsMonitoringAgent\",\"mergedName\":\"MsMonitoringAgent\",\"fromId\":\"4bac0709-9f4b-481f-8ec8-65cade45e16d\"},{\"originalName\":\"[query - 6].MsNetworkAgent\",\"mergedName\":\"MsNetworkAgent\",\"fromId\":\"4bac0709-9f4b-481f-8ec8-65cade45e179\"},{\"originalName\":\"[query - 2].WindowsRemoteManagment\",\"mergedName\":\"WindowsRemoteManagment\",\"fromId\":\"4bac0709-9f4b-481f-8ec8-65cade45e170\"},{\"originalName\":\"[query - 5].MsDependencyAgent\",\"mergedName\":\"MsDependencyAgent\",\"fromId\":\"4bac0709-9f4b-481f-8ec8-65cade45e172\"},{\"originalName\":\"[query - 4].AzureGuestAgent\",\"mergedName\":\"AzureGuestAgent\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 0]._ResourceId\"},{\"originalName\":\"[query - 3]._ResourceId\"},{\"originalName\":\"[query - 1]._ResourceId\"},{\"originalName\":\"[query - 2]._ResourceId\"},{\"originalName\":\"[query - 4]._ResourceId\"},{\"originalName\":\"[query - 5]._ResourceId\"},{\"originalName\":\"[query - 6]._ResourceId\"},{\"originalName\":\"[query - 4].MsMonitoringAgent\"}]}",
                                "size": 3,
                                "queryType": 7,
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "WinGuestAgent",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Running",
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Stopped",
                                            "representation": "2",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "unknown",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        },
                                        "emptyValCustomText": "Service not available"
                                      }
                                    },
                                    {
                                      "columnMatch": "HeartbeatService",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Running",
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Stopped",
                                            "representation": "2",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "unknown",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        },
                                        "emptyValCustomText": "Service not available"
                                      }
                                    },
                                    {
                                      "columnMatch": "MsMonitoringAgent",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Running",
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Stopped",
                                            "representation": "2",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "unknown",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        },
                                        "emptyValCustomText": "Service not available"
                                      }
                                    },
                                    {
                                      "columnMatch": "MsNetworkAgent",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Running",
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Stopped",
                                            "representation": "2",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "unknown",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        },
                                        "emptyValCustomText": "Service not available"
                                      }
                                    },
                                    {
                                      "columnMatch": "WindowsRemoteManagment",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Running",
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Stopped",
                                            "representation": "2",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "Unknown",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        },
                                        "emptyValCustomText": "Service not available"
                                      }
                                    },
                                    {
                                      "columnMatch": "MsDependencyAgent",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Running",
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Stopped",
                                            "representation": "2",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "unknown",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        },
                                        "emptyValCustomText": "Service not available"
                                      }
                                    },
                                    {
                                      "columnMatch": "AzureGuestAgent",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Running",
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "Unknown",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        },
                                        "emptyValCustomText": "Service not available"
                                      },
                                      "tooltipFormat": {}
                                    }
                                  ]
                                },
                                "sortBy": []
                              },
                              "name": "query - 7",
                              "styleSettings": {
                                "showBorder": true
                              }
                            }
                          ]
                        },
                        "name": "group - 1"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "title": "Linux Machines",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ConfigurationData\r\n| where ConfigDataType == \"Daemons\" and SvcName contains \"waagent\" and SvcName != \"\"\r\n| summarize arg_max(TimeGenerated, *) by _ResourceId \r\n| project _ResourceId, waagent=SvcState",
                                "size": 0,
                                "timeContext": {
                                  "durationMs": 2592000000
                                },
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{workspace}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "showPin": false,
                              "name": "query - 0"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ConfigurationData\r\n| where ConfigDataType == \"Daemons\" and SvcName contains \"rsyslog\" \r\n| summarize arg_max(TimeGenerated, *) by Computer \r\n| project _ResourceId, rsyslog=SvcState",
                                "size": 0,
                                "timeContext": {
                                  "durationMs": 2592000000
                                },
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{workspace}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "query - 1"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ConfigurationData \r\n| where ConfigDataType == \"Daemons\" and SvcName == \"sshd\" and SvcState != \"\"\r\n| summarize arg_max(TimeGenerated, *) by _ResourceId \r\n| project _ResourceId, SSH=SvcState",
                                "size": 0,
                                "timeContext": {
                                  "durationMs": 2592000000
                                },
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{workspace}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "query - 2"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ \"microsoft.compute/virtualmachines\"\r\n| where properties.storageProfile.osDisk.osType == '{OSType}'\r\n| extend vm_status = properties.extended.instanceView.powerState.displayStatus\r\n| where vm_status == \"VM running\"\r\n| project id",
                                "size": 0,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "Tabname",
                                "comparison": "isEqualTo",
                                "value": "AlwaysHide"
                              },
                              "name": "query - 3"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"5e354f9e-ff7c-4a76-bc07-9582bcc6a078\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - 3\",\"rightTable\":\"query - 0\",\"leftColumn\":\"id\",\"rightColumn\":\"_ResourceId\"},{\"id\":\"5e354f9e-ff7c-4a76-bc07-9582bcc6a079\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - 3\",\"rightTable\":\"query - 1\",\"leftColumn\":\"id\",\"rightColumn\":\"_ResourceId\"},{\"id\":\"5e354f9e-ff7c-4a76-bc07-9582bcc6a07a\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - 3\",\"rightTable\":\"query - 2\",\"leftColumn\":\"id\",\"rightColumn\":\"_ResourceId\"}],\"projectRename\":[{\"originalName\":\"[query - 3].id\",\"mergedName\":\"id\",\"fromId\":\"5e354f9e-ff7c-4a76-bc07-9582bcc6a078\"},{\"originalName\":\"[query - 1].rsyslog\",\"mergedName\":\"rsyslog\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 0].waagent\",\"mergedName\":\"waagent\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 2].SSH\",\"mergedName\":\"SSH\",\"fromId\":\"5e354f9e-ff7c-4a76-bc07-9582bcc6a07a\"},{\"originalName\":\"[query - 0]._ResourceId\"},{\"originalName\":\"[query - 1]._ResourceId\"},{\"originalName\":\"[query - 2]._ResourceId\"}]}",
                                "size": 3,
                                "queryType": 7,
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "SSH",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Running",
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Stopped",
                                            "representation": "2",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "unknown",
                                            "text": "{0}{1}"
                                          }
                                        ],
                                        "customColumnWidthSetting": "150px"
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        },
                                        "emptyValCustomText": "Service not available"
                                      }
                                    },
                                    {
                                      "columnMatch": "rsyslog",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Running",
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Stopped",
                                            "representation": "warning",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "Unavailable",
                                            "text": "{0}{1}"
                                          }
                                        ],
                                        "customColumnWidthSetting": "150px"
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        },
                                        "emptyValCustomText": "Service not available"
                                      }
                                    },
                                    {
                                      "columnMatch": "waagent",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Running",
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Stopped",
                                            "representation": "2",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "unknown",
                                            "text": "{0}{1}"
                                          }
                                        ],
                                        "customColumnWidthSetting": "150px"
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        },
                                        "emptyValCustomText": "Service not available"
                                      }
                                    },
                                    {
                                      "columnMatch": "WinGuestAgent",
                                      "formatter": 0,
                                      "formatOptions": {
                                        "customColumnWidthSetting": "150px"
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        },
                                        "emptyValCustomText": "Service not available"
                                      }
                                    },
                                    {
                                      "columnMatch": "WinGuestAgent1",
                                      "formatter": 0,
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        },
                                        "emptyValCustomText": "Service not available"
                                      },
                                      "tooltipFormat": {}
                                    }
                                  ],
                                  "sortBy": [
                                    {
                                      "itemKey": "$gen_thresholds_waagent_2",
                                      "sortOrder": 2
                                    }
                                  ]
                                },
                                "sortBy": [
                                  {
                                    "itemKey": "$gen_thresholds_waagent_2",
                                    "sortOrder": 2
                                  }
                                ]
                              },
                              "showPin": false,
                              "name": "query - 4",
                              "styleSettings": {
                                "showBorder": true
                              }
                            }
                          ]
                        },
                        "name": "group - 2"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "agentstatus"
                  },
                  "name": "Agent Status"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "2b50b5c4-3841-4c7d-8aea-baa0ad8b1f8e",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 43200000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Spikes Status",
                          "style": "info"
                        },
                        "name": "text - 6"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Agent latency spikes - by data type \r\n// Check for agent latency spikes per data type, in the last 24 hour. \r\nlet StartTime = ago(24h);\r\nlet EndTime = now();\r\nlet MinRSquare = 0.8; // Tune the sensitivity of the detection sensor\r\nunion withsource=source_table *\r\n| where TimeGenerated between (StartTime .. EndTime)\r\n// calculate ingestion duration in seconds\r\n| extend AgentLatencySeconds = (_TimeReceived-TimeGenerated)/1s\r\n// Create a time series for each source table\r\n| make-series RatioSeries=avg(AgentLatencySeconds) default=0 on TimeGenerated in range(StartTime, EndTime,10m) by source_table\r\n// Apply a 2-line regression to the time series\r\n| extend (RSquare2, SplitIdx, Variance2, RVariance2, LineFit2) = series_fit_2lines(RatioSeries)\r\n// Find out if our 2-line is trending up or down\r\n| extend (Slope, Interception, RSquare, Variance, RVariance, LineFit) = series_fit_line(LineFit2)\r\n// Check whether the line fit reaches the threshold, and if the spike represents an increase (rather than a decrease)\r\n| project source_table, PatternMatch = iff(RSquare2 > MinRSquare and Slope>0, \"Spike detected\", \"No spike\") \r\n|order by PatternMatch asc \r\n| where PatternMatch == \"Spike detected\"",
                          "size": 3,
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "PatternMatch",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Spike detected",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "No spike",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "source_table",
                                "label": "Source"
                              },
                              {
                                "columnId": "PatternMatch",
                                "label": "Result"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "source_table"
                            },
                            "leftContent": {
                              "columnMatch": "PatternMatch",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Spike detected",
                                    "representation": "error",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "No spike",
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "name": "query - 0"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Agent Status",
                          "style": "info"
                        },
                        "name": "text - 7"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ConfigurationChange \r\n| where ConfigChangeType == \"WindowsServices\"  and SvcState == \"Stopped\"\r\n| where  SvcDisplayName == \"Microsoft Monitoring Agent Azure VM Extension Heartbeat Service\" or SvcDisplayName == \"Microsoft Dependency Agent\" or SvcDisplayName == \"Windows Remote Management (WS-Management)\" or SvcDisplayName == \"Windows Azure Guest Agent\" or SvcDisplayName == \"Microsoft Monitoring Agent\"\r\n\r\n",
                          "size": 3,
                          "noDataMessage": "No Issue Found",
                          "noDataMessageStyle": 3,
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "_ResourceId",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            "subtitleContent": {
                              "columnMatch": "SvcDisplayName"
                            },
                            "rightContent": {
                              "columnMatch": "SvcState",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "critical",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            "secondaryContent": {
                              "columnMatch": "TimeGenerated",
                              "formatter": 2
                            },
                            "showBorder": true
                          }
                        },
                        "name": "Microsoft Monitoring Agent Azure VM Extension Heartbeat Down"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Agent Health",
                          "style": "info"
                        },
                        "name": "text - 8"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "value::selected"
                          ],
                          "parameters": [
                            {
                              "id": "15920bec-4a72-4e23-a0ee-c7b4e0b7acb4",
                              "version": "KqlParameterItem/1.0",
                              "name": "UnhealthyCriteria",
                              "label": "Unhealthy Criteria",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"1m\", \"label\":\"1 minute without heartbeat\", \"selected\":false },\r\n    { \"value\":\"5m\", \"label\":\"5 minutes without heartbeat\", \"selected\":false },\r\n    { \"value\":\"30m\", \"label\":\"30 minutes without heartbeat\", \"selected\":false },\r\n    { \"value\":\"1h\", \"label\":\"1 hour without heartbeat\", \"selected\":true },\r\n    { \"value\":\"2h\", \"label\":\"2 hours without heartbeat\", \"selected\":false },\r\n    { \"value\":\"8h\", \"label\":\"8 hours without heartbeat\", \"selected\":false },\r\n    { \"value\":\"1d\", \"label\":\"1 day without heartbeat\", \"selected\":false },\r\n    { \"value\":\"2d\", \"label\":\"2 days without heartbeat\", \"selected\":false },\r\n    { \"value\":\"7d\", \"label\":\"7 days without heartbeat\", \"selected\":false }\r\n]",
                              "value": "30m"
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.insights/components"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "datatable(State:string, Rank:int)[\"Unhealthy\", 0, \"Healthy\", 1]\r\n| join kind = leftouter (Heartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| summarize LastHeartbeat = max(TimeGenerated) by Computer\r\n| extend State = iff(LastHeartbeat < ago({UnhealthyCriteria}), 'Unhealthy', 'Healthy')\r\n| summarize Count = dcount(Computer) by State) on State\r\n| extend Count = iff(isempty(State1), 0, Count)\r\n| project-away State1\r\n| extend Rank = iff(State == 'Unhealthy' and Count == 0, 2, Rank)\r\n| order by Rank asc",
                          "size": 3,
                          "noDataMessage": "Looks like you have no agents sending heartbeat information in this time range. Pick a larger time range or a different workspace.",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "State",
                              "formatter": 1,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "showIcon": true
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false,
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "rightContent": {
                              "columnMatch": "State",
                              "formatter": 18,
                              "formatOptions": {
                                "showIcon": true,
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Unhealthy",
                                    "representation": "critical",
                                    "text": ""
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": ""
                                  }
                                ]
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "name": "AgentHealthStateQuery",
                        "styleSettings": {
                          "padding": "0px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Heartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| summarize LastHeartbeat = max(TimeGenerated) by Computer\r\n| extend State = iff(LastHeartbeat < ago({UnhealthyCriteria}), 'Unhealthy', 'Healthy')\r\n| extend TimeFromNow = now() - LastHeartbeat\r\n| extend [\"TimeAgo\"] = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\r\n| join (\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| extend Packed = pack_all()\r\n) on Computer\r\n| where TimeGenerated == LastHeartbeat\r\n| join (\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| make-series InternalTrend=iff(count() > 0, 1, 0) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {UnhealthyCriteria} by Computer\r\n| extend Trend=array_slice(InternalTrend, array_length(InternalTrend) - 30, array_length(InternalTrend)-1)\r\n| extend (s_min, s_minId, s_max, s_maxId, s_avg, s_var, s_stdev) = series_stats(Trend)\r\n| project Computer, Trend, s_avg\r\n) on Computer\r\n| order by State, s_avg asc, TimeAgo\r\n| project  [\"Azure Resource\"]=ResourceId,State, [\"Environment\"] = iff(ComputerEnvironment == \"Azure\", ComputerEnvironment, Category), [\"OS\"]=iff(isempty(OSName), OSType, OSName),  Version, [\"Time\"]=strcat('🕒 ', TimeAgo), [\"Heartbeat Trend\"]=Trend, [\"Details\"]=Packed\r\n",
                          "size": 3,
                          "title": "Agent Details",
                          "noDataMessage": "Looks like you have no agents sending heartbeat information to this workspace. Pick a different workspace.",
                          "timeContextFromParameter": "TimeRange",
                          "exportFieldName": "_ComputerName_",
                          "exportParameterName": "ComputerName",
                          "exportDefaultValue": "\"\"",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "_ComputerName_",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 18,
                                "formatOptions": {
                                  "showIcon": true,
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Unhealthy",
                                      "representation": "4",
                                      "text": "{0}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}"
                                    }
                                  ]
                                },
                                "tooltipFormat": {
                                  "tooltip": "Click to see details of the last event sent by this computer."
                                }
                              },
                              {
                                "columnMatch": "Heartbeat Trend",
                                "formatter": 10,
                                "formatOptions": {
                                  "palette": "redGreen",
                                  "showIcon": true
                                },
                                "tooltipFormat": {
                                  "tooltip": "Each bar represents the bucket of time based on the Unhealthy Criteria. Showing last 30 buckets max."
                                }
                              },
                              {
                                "columnMatch": "Details",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              }
                            ],
                            "filter": true
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Computer",
                              "formatter": 1,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "subtitleContent": {
                              "columnMatch": "LastCall",
                              "formatter": 6,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "showBorder": false
                          },
                          "graphSettings": {
                            "type": 0
                          }
                        },
                        "name": "AgentDetailsQuery"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "agenthealth"
                  },
                  "name": "Agent Health"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "27ea0e2b-e148-4500-a9a6-8c4ed2db18c4",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 300000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// All Azure Activity \r\n// The query presents all AzureActivity events. \r\nAzureActivity\r\n| project TimeGenerated, Caller, OperationName, ActivityStatus, _ResourceId",
                          "size": 1,
                          "title": "Azure Activity",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "TimeGenerated",
                                "label": "Time Generated"
                              },
                              {
                                "columnId": "Caller",
                                "label": "Caller"
                              },
                              {
                                "columnId": "OperationName",
                                "label": "Operation Name"
                              },
                              {
                                "columnId": "ActivityStatus",
                                "label": "Activity Status"
                              },
                              {
                                "columnId": "_ResourceId",
                                "label": "Resource ID"
                              }
                            ]
                          }
                        },
                        "name": "Azure Activity"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "auditlog"
                  },
                  "name": "Audit Logs"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tabname",
              "comparison": "isEqualTo",
              "value": "observability"
            },
            "name": "Observability"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "c362a8ff-9321-4919-b818-70652ce2df57",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "User Signin",
                        "subTarget": "usersignin",
                        "style": "link"
                      },
                      {
                        "id": "256ca655-e827-4208-975d-c2a8837d9b92",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Device Signin",
                        "subTarget": "devicesignin",
                        "style": "link"
                      },
                      {
                        "id": "74df56da-cee3-41bc-9275-a96b87ac09a1",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Location Signin",
                        "subTarget": "locationsignin",
                        "style": "link"
                      },
                      {
                        "id": "9ed9fec8-f57c-4b02-b21c-be30c22d5d8c",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Resource Signin",
                        "subTarget": "resourcesigning",
                        "style": "link"
                      },
                      {
                        "id": "f30749be-babb-4ffd-85ba-b83f610cfeef",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Conditional Access & MFA",
                        "subTarget": "conditionalaccess",
                        "style": "link"
                      },
                      {
                        "id": "fabba53d-5e44-4355-93a3-b53764714a6d",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Common Singing Issues",
                        "subTarget": "signinissues",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 2"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "ea72c9f7-8881-41e4-a346-3fd1853594ef",
                        "version": "KqlParameterItem/1.0",
                        "name": "Subscription",
                        "type": 6,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::1",
                            "value::3",
                            "value::all"
                          ],
                          "includeAll": true,
                          "showDefault": false
                        },
                        "defaultValue": "value::3"
                      },
                      {
                        "id": "006f3abf-ac3b-4072-b809-17fc42f4e187",
                        "version": "KqlParameterItem/1.0",
                        "name": "Workspace",
                        "type": 5,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "Resources\r\n| where type =~ \"Microsoft.operationalinsights/workspaces\"\r\n| summarize by id",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ]
                        },
                        "defaultValue": "value::all",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "13f56671-7604-4427-a4d8-663f3da0cbc5",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRange",
                        "type": 4,
                        "isRequired": true,
                        "value": {
                          "durationMs": 604800000
                        },
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 300000,
                              "createdTime": "2018-11-13T19:33:10.162Z",
                              "isInitialTime": false,
                              "grain": 1,
                              "useDashboardTimeRange": false
                            },
                            {
                              "durationMs": 900000,
                              "createdTime": "2018-11-13T19:33:10.164Z",
                              "isInitialTime": false,
                              "grain": 1,
                              "useDashboardTimeRange": false
                            },
                            {
                              "durationMs": 1800000,
                              "createdTime": "2018-11-13T19:33:10.164Z",
                              "isInitialTime": false,
                              "grain": 1,
                              "useDashboardTimeRange": false
                            },
                            {
                              "durationMs": 3600000,
                              "createdTime": "2018-11-13T19:33:10.164Z",
                              "isInitialTime": false,
                              "grain": 1,
                              "useDashboardTimeRange": false
                            },
                            {
                              "durationMs": 14400000,
                              "createdTime": "2018-11-13T19:33:10.164Z",
                              "isInitialTime": false,
                              "grain": 1,
                              "useDashboardTimeRange": false
                            },
                            {
                              "durationMs": 43200000,
                              "createdTime": "2018-11-13T19:33:10.164Z",
                              "isInitialTime": false,
                              "grain": 1,
                              "useDashboardTimeRange": false
                            },
                            {
                              "durationMs": 86400000,
                              "createdTime": "2018-11-13T19:33:10.165Z",
                              "isInitialTime": false,
                              "grain": 1,
                              "useDashboardTimeRange": false
                            },
                            {
                              "durationMs": 172800000,
                              "createdTime": "2018-11-13T19:33:10.166Z",
                              "isInitialTime": false,
                              "grain": 1,
                              "useDashboardTimeRange": false
                            },
                            {
                              "durationMs": 259200000,
                              "createdTime": "2018-11-13T19:33:10.166Z",
                              "isInitialTime": false,
                              "grain": 1,
                              "useDashboardTimeRange": false
                            },
                            {
                              "durationMs": 604800000,
                              "createdTime": "2018-11-13T19:33:10.166Z",
                              "isInitialTime": false,
                              "grain": 1,
                              "useDashboardTimeRange": false
                            },
                            {
                              "durationMs": 1209600000,
                              "createdTime": "2018-11-13T19:33:10.166Z",
                              "isInitialTime": false,
                              "grain": 1,
                              "useDashboardTimeRange": false
                            },
                            {
                              "durationMs": 2592000000,
                              "createdTime": "2018-11-13T19:33:10.167Z",
                              "isInitialTime": false,
                              "grain": 1,
                              "useDashboardTimeRange": false
                            }
                          ],
                          "allowCustom": true
                        }
                      },
                      {
                        "id": "3b5cc420-8ad8-4523-ba28-a54910756794",
                        "version": "KqlParameterItem/1.0",
                        "name": "Apps",
                        "type": 2,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "SigninLogs\r\n| summarize Count = count() by AppDisplayName\r\n| order by Count desc, AppDisplayName asc\r\n| project Value = AppDisplayName, Label = strcat(AppDisplayName, ' - ', Count, ' sign-ins'), Selected = false\r\n",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "typeSettings": {
                          "limitSelectTo": 10,
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "selectAllValue": "*",
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "0611ecce-d6a0-4a6f-a1bc-6be314ae36a7",
                        "version": "KqlParameterItem/1.0",
                        "name": "UserNamePrefix",
                        "type": 2,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "SigninLogs\r\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n| summarize Count = count() by UserDisplayName\r\n| order by Count desc, UserDisplayName asc\r\n| project Value = UserDisplayName, Label = strcat(UserDisplayName, ' - ', Count, ' sign-ins'), Selected = false\r\n| extend prefix = substring(Value, 0, 1)\r\n| distinct prefix\r\n| sort by prefix asc",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "selectAllValue": "*",
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "f7f7970b-58c1-474f-9043-62243d2d4edd",
                        "version": "KqlParameterItem/1.0",
                        "name": "Users",
                        "label": "UserName",
                        "type": 2,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "SigninLogs\r\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n| summarize Count = count() by UserDisplayName\r\n| order by Count desc, UserDisplayName asc\r\n| project Value = UserDisplayName, Label = strcat(UserDisplayName, ' - ', Count, ' sign-ins'), Selected = false\r\n| where (substring(Value, 0, 1) in ({UserNamePrefix})) or ('*' in ({UserNamePrefix}))\r\n| sort by Value asc\r\n",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "typeSettings": {
                          "limitSelectTo": 10000000,
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "selectAllValue": "",
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "85568f4e-9ad4-46c5-91d4-0ee1b2c8f3aa",
                        "version": "KqlParameterItem/1.0",
                        "name": "Category",
                        "type": 2,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "value": [
                          "value::all"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "selectAllValue": ""
                        },
                        "jsonData": "[\"SignInLogs\", \"NonInteractiveUserSignInLogs\"]"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "name": "parameters - 1"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let data = \r\nunion SigninLogs,AADNonInteractiveUserSignInLogs\r\n| where Category in ({Category})\r\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users});\r\ndata\r\n| summarize count() by UserPrincipalName, bin (TimeGenerated,5m)\r\n",
                          "size": 0,
                          "title": "User Signin Activities",
                          "timeContextFromParameter": "TimeRange",
                          "timeBrushParameterName": "TimeBrush",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "count_",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 1,
                                  "max": 25,
                                  "palette": "greenRed"
                                }
                              }
                            ],
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "UserPrincipalName",
                                "label": "User Name"
                              },
                              {
                                "columnId": "TimeGenerated",
                                "label": "Time"
                              },
                              {
                                "columnId": "count_",
                                "label": "Recurrence"
                              }
                            ]
                          }
                        },
                        "name": "query - 19"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "usersignin"
                  },
                  "name": "User Signin"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status);\r\nlet data = \r\nunion SigninLogs,nonInteractive\r\n| where Category in ({Category})\r\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n|extend errorCode = Status.errorCode\r\n|extend SigninStatus = case(errorCode == 0, \"Success\", errorCode == 50058, \"Pending user action\",errorCode == 50140, \"Pending user action\", errorCode == 51006, \"Pending user action\", errorCode == 50059, \"Pending user action\",errorCode == 65001, \"Pending user action\", errorCode == 52004, \"Pending user action\", errorCode == 50055, \"Pending user action\", errorCode == 50144, \"Pending user action\", errorCode == 50072, \"Pending user action\", errorCode == 50074, \"Pending user action\", errorCode == 16000, \"Pending user action\", errorCode == 16001, \"Pending user action\", errorCode == 16003, \"Pending user action\", errorCode == 50127, \"Pending user action\", errorCode == 50125, \"Pending user action\", errorCode == 50129, \"Pending user action\", errorCode == 50143, \"Pending user action\", errorCode == 81010, \"Pending user action\", errorCode == 81014, \"Pending user action\", errorCode == 81012 ,\"Pending user action\", \"Failure\");\r\ndata\r\n| summarize Count = count() by SigninStatus\r\n| join kind = fullouter (datatable(SigninStatus:string)['Success', 'Pending action (Interrupts)', 'Failure']) on SigninStatus\r\n| project SigninStatus = iff(SigninStatus == '', SigninStatus1, SigninStatus), Count = iff(SigninStatus == '', 0, Count)\r\n| join kind = inner (data\r\n    | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SigninStatus)\r\n    on SigninStatus\r\n| project-away SigninStatus1, TimeGenerated\r\n| extend Status = SigninStatus\r\n| union (\r\n    data \r\n    | summarize Count = count()\r\n    | extend jkey = 1\r\n    | join kind=inner (data\r\n        | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\r\n        | extend jkey = 1) on jkey\r\n    | extend SigninStatus = 'All Sign-ins', Status = '*'    \r\n)\r\n| order by Count desc",
                          "size": 3,
                          "exportFieldName": "Status",
                          "exportParameterName": "SigninStatus",
                          "exportDefaultValue": "*",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "/subscriptions/b661db5b-6c7e-435f-a989-6de3b26c40d3/resourceGroups/vpk-eun-pr-sec-sentinel-rg/providers/Microsoft.OperationalInsights/workspaces/vpk-eun-pr-sec-sentinel-la"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "SigninStatus",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Success",
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Failure",
                                    "representation": "4",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Pending user action",
                                    "representation": "error",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "uninitialized",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "none",
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": []
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "name": "query - 5"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs | extend LocationDetails = parse_json(LocationDetails), Status = parse_json(Status), DeviceDetail = parse_json(DeviceDetail);\r\nlet data = \r\nunion SigninLogs,nonInteractive\r\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n    | extend errorCode = Status.errorCode\r\n    | extend SigninStatus = case(errorCode == 0, \"Success\", errorCode == 50058, \"Pending user action\", errorCode == 50140, \"Pending user action\", errorCode == 51006, \"Pending user action\", errorCode == 50059, \"Pending user action\", errorCode == 65001, \"Pending user action\", errorCode == 52004, \"Pending user action\", errorCode == 50055, \"Pending user action\", errorCode == 50144, \"Pending user action\", errorCode == 50072, \"Pending user action\", errorCode == 50074, \"Pending user action\", errorCode == 16000, \"Pending user action\", errorCode == 16001, \"Pending user action\", errorCode == 16003, \"Pending user action\", errorCode == 50127, \"Pending user action\", errorCode == 50125, \"Pending user action\", errorCode == 50129, \"Pending user action\", errorCode == 50143, \"Pending user action\", errorCode == 81010, \"Pending user action\", errorCode == 81014, \"Pending user action\", errorCode == 81012, \"Pending user action\", \"Failure\")\r\n| where SigninStatus == '{SigninStatus}' or '{SigninStatus}' == '*' or '{SigninStatus}' == 'All Sign-ins';\r\nlet appData = data\r\n    | summarize TotalCount = count(), SuccessCount = countif(SigninStatus == \"Success\"), FailureCount = countif(SigninStatus == \"Failure\"), InterruptCount = countif(SigninStatus == \"Pending user action\") by Os = tostring(DeviceDetail.operatingSystem) ,Category\r\n    | where Os != ''\r\n    | join kind=inner (data\r\n        | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Os = tostring(DeviceDetail.operatingSystem)\r\n        | project-away TimeGenerated)\r\n        on Os\r\n    | order by TotalCount desc, Os asc\r\n    | project Os, TotalCount, SuccessCount, FailureCount, InterruptCount, Category\r\n    | serialize Id = row_number();\r\ndata\r\n| summarize TotalCount = count(), SuccessCount = countif(SigninStatus == \"Success\"), FailureCount = countif(SigninStatus == \"Failure\"), InterruptCount = countif(SigninStatus == \"Pending user action\") by Os = tostring(DeviceDetail.operatingSystem), Browser = tostring(DeviceDetail.browser),Category\r\n| join kind=inner (data\r\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain})by Os = tostring(DeviceDetail.operatingSystem), Browser = tostring(DeviceDetail.browser)\r\n    | project-away TimeGenerated)\r\n    on Os, Browser\r\n| order by TotalCount desc, Os asc\r\n| project Os, Browser, TotalCount, SuccessCount, FailureCount, InterruptCount, Category\r\n| serialize Id = row_number(1000000)\r\n| join kind=inner (appData) on Os\r\n| project Id, Name = Browser, Type = 'Browser', ['Sign-in Count'] = TotalCount,  ['Failure Count'] = FailureCount, ['Interrupt Count'] = InterruptCount, ['Success Rate'] = 1.0 * SuccessCount / TotalCount, ParentId = Id1,Category\r\n| union (appData \r\n    | project Id, Name = Os, Type = 'Operating System', ['Sign-in Count'] = TotalCount,  ['Failure Count'] = FailureCount, ['Interrupt Count'] = InterruptCount, ['Success Rate'] = 1.0 * SuccessCount / TotalCount, ParentId = -1,Category)\r\n| where Category in ({Category})\r\n| order by ['Sign-in Count'] desc, Name asc\r\n",
                          "size": 3,
                          "title": "Device Signin",
                          "timeContextFromParameter": "TimeRange",
                          "exportedParameters": [
                            {
                              "parameterName": "DeviceDetail",
                              "defaultValue": "{ \"Name\":\"\", \"Type\":\"*\"}"
                            },
                            {
                              "fieldName": "Category",
                              "parameterName": "exportCategory",
                              "parameterType": 1,
                              "defaultValue": "*"
                            },
                            {
                              "fieldName": "Name",
                              "parameterName": "exportName",
                              "parameterType": 1,
                              "defaultValue": "*"
                            }
                          ],
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Id",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Type",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Sign-in Count",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 17,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Trend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 17,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Failure Count|Interrupt Count",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "orange",
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 17,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Success Rate",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "percent"
                                  }
                                }
                              },
                              {
                                "columnMatch": "ParentId",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              }
                            ],
                            "filter": true,
                            "hierarchySettings": {
                              "idColumn": "Id",
                              "parentColumn": "ParentId",
                              "treeType": 0,
                              "expanderColumn": "Name",
                              "expandTopLevel": false
                            },
                            "sortBy": [
                              {
                                "itemKey": "Category",
                                "sortOrder": 2
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "Category",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "customWidth": "50",
                        "showPin": false,
                        "name": "query - 9"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails),Status = parse_json(Status),ConditionalAccessPolicies = parse_json(ConditionalAccessPolicies),DeviceDetail =parse_json(DeviceDetail);\r\nlet details = dynamic({ \"Name\":\"\", \"Type\":\"*\"});\r\nlet data = union SigninLogs,nonInteractive\r\n| extend AppDisplayName = iff(AppDisplayName == '', 'Unknown', AppDisplayName)\r\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n| extend Country = tostring(LocationDetails.countryOrRegion)\r\n| extend City = tostring(LocationDetails.city)\r\n| extend errorCode = Status.errorCode\r\n| extend SigninStatus = case(errorCode == 0, \"Success\", errorCode == 50058, \"Pending user action\",errorCode == 50140, \"Pending user action\", errorCode == 51006, \"Pending user action\", errorCode == 50059, \"Pending user action\",errorCode == 65001, \"Pending user action\", errorCode == 52004, \"Pending user action\", errorCode == 50055, \"Pending user action\", errorCode == 50144, \"Pending user action\", errorCode == 50072, \"Pending user action\", errorCode == 50074, \"Pending user action\", errorCode == 16000, \"Pending user action\", errorCode == 16001, \"Pending user action\", errorCode == 16003, \"Pending user action\", errorCode == 50127, \"Pending user action\", errorCode == 50125, \"Pending user action\", errorCode == 50129, \"Pending user action\", errorCode == 50143, \"Pending user action\", errorCode == 81010, \"Pending user action\", errorCode == 81014, \"Pending user action\", errorCode == 81012 ,\"Pending user action\", \"Failure\")\r\n| where SigninStatus == '{SigninStatus}' or '{SigninStatus}' == '*' or '{SigninStatus}' == 'All Sign-ins'\r\n| where details.Type == '*' or (details.Type == 'Country' and Country == details.Name) or (details.Type == 'City' and City == details.Name);\r\ndata\r\n| top 200 by TimeGenerated desc\r\n| extend TimeFromNow = now() - TimeGenerated\r\n| extend TimeAgo = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\r\n| project User = UserDisplayName, ['Sign-in Status'] = strcat(iff(SigninStatus == 'Success', '✔️', '❌'), ' ', SigninStatus), ['Sign-in Time'] = TimeAgo, App = AppDisplayName, ['Error code'] = errorCode, ['Result type'] = ResultType, ['Result signature'] = ResultSignature, ['Result description'] = ResultDescription, ['Conditional access policies'] = ConditionalAccessPolicies, ['Conditional access status'] = ConditionalAccessStatus, ['Operating system'] = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser, ['Country or region'] = LocationDetails.countryOrRegion, ['State'] = LocationDetails.state, ['City'] = LocationDetails.city, ['Time generated'] = TimeGenerated, Status, ['User principal name'] = UserPrincipalName, Category, Name = tostring(DeviceDetail.operatingSystem)\r\n| where Category in ('{exportCategory}') or \"*\" in ('{exportCategory}')\r\n| where Name in ('{exportName}') or \"*\" in ('{exportName}')",
                          "size": 2,
                          "title": "Impacted Users",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Sign-in Status",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "CellDetails"
                                }
                              },
                              {
                                "columnMatch": "App",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Error code",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Result type",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Result signature",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Result description",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Conditional access policies",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Conditional access status",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Operating system",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Browser",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Country or region",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "City",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Time generated",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Status",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "User principal name",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Category",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Name",
                                "formatter": 5
                              }
                            ],
                            "filter": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 8 - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "devicesignin"
                  },
                  "name": "Device Signin"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status);\r\nlet data = \r\nunion SigninLogs,nonInteractive\r\n| where Category in ({Category})\r\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n|extend errorCode = Status.errorCode\r\n|extend SigninStatus = case(errorCode == 0, \"Success\", errorCode == 50058, \"Pending user action\",errorCode == 50140, \"Pending user action\", errorCode == 51006, \"Pending user action\", errorCode == 50059, \"Pending user action\",errorCode == 65001, \"Pending user action\", errorCode == 52004, \"Pending user action\", errorCode == 50055, \"Pending user action\", errorCode == 50144, \"Pending user action\", errorCode == 50072, \"Pending user action\", errorCode == 50074, \"Pending user action\", errorCode == 16000, \"Pending user action\", errorCode == 16001, \"Pending user action\", errorCode == 16003, \"Pending user action\", errorCode == 50127, \"Pending user action\", errorCode == 50125, \"Pending user action\", errorCode == 50129, \"Pending user action\", errorCode == 50143, \"Pending user action\", errorCode == 81010, \"Pending user action\", errorCode == 81014, \"Pending user action\", errorCode == 81012 ,\"Pending user action\", \"Failure\");\r\ndata\r\n| summarize Count = count() by SigninStatus\r\n| join kind = fullouter (datatable(SigninStatus:string)['Success', 'Pending action (Interrupts)', 'Failure']) on SigninStatus\r\n| project SigninStatus = iff(SigninStatus == '', SigninStatus1, SigninStatus), Count = iff(SigninStatus == '', 0, Count)\r\n| join kind = inner (data\r\n    | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SigninStatus)\r\n    on SigninStatus\r\n| project-away SigninStatus1, TimeGenerated\r\n| extend Status = SigninStatus\r\n| union (\r\n    data \r\n    | summarize Count = count()\r\n    | extend jkey = 1\r\n    | join kind=inner (data\r\n        | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\r\n        | extend jkey = 1) on jkey\r\n    | extend SigninStatus = 'All Sign-ins', Status = '*'    \r\n)\r\n| order by Count desc",
                          "size": 3,
                          "exportFieldName": "Status",
                          "exportParameterName": "SigninStatus",
                          "exportDefaultValue": "*",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "/subscriptions/b661db5b-6c7e-435f-a989-6de3b26c40d3/resourceGroups/vpk-eun-pr-sec-sentinel-rg/providers/Microsoft.OperationalInsights/workspaces/vpk-eun-pr-sec-sentinel-la"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "SigninStatus",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Success",
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Failure",
                                    "representation": "4",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Pending user action",
                                    "representation": "error",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "uninitialized",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "none",
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": []
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "name": "query - 5"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status);\r\nlet data = \r\nunion SigninLogs,nonInteractive\r\n| extend AppDisplayName = iff(AppDisplayName == '', 'Unknown', AppDisplayName)\r\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n| extend Country = iff(LocationDetails.countryOrRegion == '', 'Unknown country', tostring(LocationDetails.countryOrRegion))\r\n| extend City = iff(LocationDetails.city == '', 'Unknown city', tostring(LocationDetails.city))\r\n| extend errorCode = Status.errorCode\r\n| extend SigninStatus = case(errorCode == 0, \"Success\", errorCode == 50058, \"Pending user action\",errorCode == 50140, \"Pending user action\", errorCode == 51006, \"Pending user action\", errorCode == 50059, \"Pending user action\",errorCode == 65001, \"Pending user action\", errorCode == 52004, \"Pending user action\", errorCode == 50055, \"Pending user action\", errorCode == 50144, \"Pending user action\", errorCode == 50072, \"Pending user action\", errorCode == 50074, \"Pending user action\", errorCode == 16000, \"Pending user action\", errorCode == 16001, \"Pending user action\", errorCode == 16003, \"Pending user action\", errorCode == 50127, \"Pending user action\", errorCode == 50125, \"Pending user action\", errorCode == 50129, \"Pending user action\", errorCode == 50143, \"Pending user action\", errorCode == 81010, \"Pending user action\", errorCode == 81014, \"Pending user action\", errorCode == 81012 ,\"Pending user action\", \"Failure\")\r\n| where SigninStatus == '{SigninStatus}' or '{SigninStatus}' == '*' or '{SigninStatus}' == 'All Sign-ins';\r\nlet countryData = data\r\n| summarize TotalCount = count(), SuccessCount = countif(SigninStatus == \"Success\"), FailureCount = countif(SigninStatus == \"Failure\"), InterruptCount = countif(SigninStatus == \"Pending user action\") by Country,Category\r\n| join kind=inner\r\n(\r\n    data\r\n| make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by  Country\r\n| project-away TimeGenerated\r\n)\r\non Country\r\n| project Country, TotalCount, SuccessCount,FailureCount,InterruptCount,Trend,Category\r\n| order by TotalCount desc, Country asc;\r\ndata\r\n| summarize TotalCount = count(), SuccessCount = countif(SigninStatus == \"Success\"), FailureCount = countif(SigninStatus == \"Failure\"), InterruptCount = countif(SigninStatus == \"Pending user action\") by Country, City,Category\r\n| join kind=inner\r\n(\r\n    data    \r\n| make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Country, City\r\n| project-away TimeGenerated\r\n)\r\non Country, City\r\n| order by TotalCount desc, Country asc\r\n| project Country, City,TotalCount, SuccessCount,FailureCount,InterruptCount, Category\r\n| join kind=inner\r\n(\r\n    countryData\r\n)\r\non Country\r\n| project Id = City, Name = City, Type = 'City', ['Sign-in Count'] = TotalCount,  ['Failure Count'] = FailureCount, ['Interrupt Count'] = InterruptCount, ['Success Rate'] = 1.0 * SuccessCount / TotalCount, ParentId = Country,Category\r\n| union (countryData\r\n| project Id = Country, Name = Country, Type = 'Country', ['Sign-in Count'] = TotalCount,  ['Failure Count'] = FailureCount, ['Interrupt Count'] = InterruptCount, ['Success Rate'] = 1.0 * SuccessCount / TotalCount, ParentId = 'root',Category)\r\n| where Category in ({Category})\r\n| order by ['Sign-in Count'] desc, Name asc\r\n",
                          "size": 0,
                          "title": "Location Signin",
                          "timeContextFromParameter": "TimeRange",
                          "exportMultipleValues": true,
                          "exportedParameters": [
                            {
                              "fieldName": "Name",
                              "parameterName": "LocationDetail",
                              "parameterType": 1
                            }
                          ],
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Id",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Type",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Sign-in Count",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 17,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Trend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Failure Count|Interrupt Count",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "orange",
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 17,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Success Rate",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "percent"
                                  }
                                }
                              },
                              {
                                "columnMatch": "ParentId",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              }
                            ],
                            "filter": true,
                            "hierarchySettings": {
                              "idColumn": "Id",
                              "parentColumn": "ParentId",
                              "treeType": 0,
                              "expanderColumn": "Name",
                              "expandTopLevel": false
                            }
                          }
                        },
                        "customWidth": "60",
                        "showPin": false,
                        "name": "query - 8"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let selectedCountry = dynamic([{LocationDetail}]);\r\nlet nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails),Status = parse_json(Status),ConditionalAccessPolicies = parse_json(ConditionalAccessPolicies),DeviceDetail =parse_json(DeviceDetail);\r\nlet details = dynamic({ \"Name\":\"\", \"Type\":\"*\"});\r\nlet data = union SigninLogs,nonInteractive\r\n| extend AppDisplayName = iff(AppDisplayName == '', 'Unknown', AppDisplayName)\r\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n| extend Country = tostring(LocationDetails.countryOrRegion)\r\n| where array_length(selectedCountry) == 0 or \"*\" in (selectedCountry) or Country in (selectedCountry)\r\n| extend City = tostring(LocationDetails.city)\r\n| extend errorCode = Status.errorCode\r\n| extend SigninStatus = case(errorCode == 0, \"Success\", errorCode == 50058, \"Pending user action\",errorCode == 50140, \"Pending user action\", errorCode == 51006, \"Pending user action\", errorCode == 50059, \"Pending user action\",errorCode == 65001, \"Pending user action\", errorCode == 52004, \"Pending user action\", errorCode == 50055, \"Pending user action\", errorCode == 50144, \"Pending user action\", errorCode == 50072, \"Pending user action\", errorCode == 50074, \"Pending user action\", errorCode == 16000, \"Pending user action\", errorCode == 16001, \"Pending user action\", errorCode == 16003, \"Pending user action\", errorCode == 50127, \"Pending user action\", errorCode == 50125, \"Pending user action\", errorCode == 50129, \"Pending user action\", errorCode == 50143, \"Pending user action\", errorCode == 81010, \"Pending user action\", errorCode == 81014, \"Pending user action\", errorCode == 81012 ,\"Pending user action\", \"Failure\")\r\n| where SigninStatus == '{SigninStatus}' or '{SigninStatus}' == '*' or '{SigninStatus}' == 'All Sign-ins'\r\n| where details.Type == '*' or (details.Type == 'Country' and Country == details.Name) or (details.Type == 'City' and City == details.Name);\r\ndata\r\n| top 200 by TimeGenerated desc\r\n| extend TimeFromNow = now() - TimeGenerated\r\n| extend TimeAgo = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\r\n| project User = UserDisplayName, ['Sign-in Status'] = strcat(iff(SigninStatus == 'Success', '✔️', '❌'), ' ', SigninStatus), ['Sign-in Time'] = TimeAgo, App = AppDisplayName, ['Error code'] = errorCode, ['Result type'] = ResultType, ['Result signature'] = ResultSignature, ['Result description'] = ResultDescription, ['Conditional access policies'] = ConditionalAccessPolicies, ['Conditional access status'] = ConditionalAccessStatus, ['Operating system'] = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser, ['Country or region'] = LocationDetails.countryOrRegion, ['State'] = LocationDetails.state, ['City'] = LocationDetails.city, ['Time generated'] = TimeGenerated, Status, ['User principal name'] = UserPrincipalName\r\n\r\n\r\n\r\n",
                          "size": 0,
                          "title": "Impacted Users",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Sign-in Status",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "CellDetails",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "App",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Error code",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Result type",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Result signature",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Result description",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Conditional access policies",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Conditional access status",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Operating system",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Browser",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Country or region",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "City",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Time generated",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Status",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "User principal name",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "TimeGenerated",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "customWidth": "40",
                        "name": "query - 8"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Signin Locations \r\n// Failed and successful sig ins by source location. \r\nSigninLogs\r\n| summarize Successful=countif(ResultType==0), Failed=countif(ResultType!=0) by Location\r\n| where Location != \"\"\r\n",
                          "size": 3,
                          "title": "Country Based Success and Failed Signings",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Location",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "Successful",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            "rightContent": {
                              "columnMatch": "Failed",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "4",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            "showBorder": true
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "Location",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "Successful",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "mapSettings": {
                            "locInfo": "AzureLoc",
                            "locInfoColumn": "Location",
                            "sizeSettings": "Successful",
                            "sizeAggregation": "Sum",
                            "labelSettings": "Location",
                            "legendMetric": "Successful",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "nodeColorField": "Successful",
                              "colorAggregation": "Sum",
                              "type": "heatmap",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "name": "Signin Locaitons"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// All SiginLogs events \r\n// All Azure signin events. \r\nSigninLogs\r\n| project  TimeGenerated ,  Location , Identity,UserPrincipalName,  AppDisplayName, AppId, ResourceDisplayName,ConditionalAccessStatus,IPAddress",
                          "size": 1,
                          "title": "Detailed View",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "TimeGenerated",
                                "label": "TIme"
                              },
                              {
                                "columnId": "Location",
                                "label": "Country"
                              },
                              {
                                "columnId": "Identity",
                                "label": "Name"
                              },
                              {
                                "columnId": "UserPrincipalName",
                                "label": "UPN"
                              },
                              {
                                "columnId": "AppDisplayName",
                                "label": "App Name"
                              },
                              {
                                "columnId": "AppId",
                                "label": "App ID"
                              },
                              {
                                "columnId": "ResourceDisplayName",
                                "label": "Resource Name"
                              },
                              {
                                "columnId": "ConditionalAccessStatus",
                                "label": "Conditional Access Status"
                              },
                              {
                                "columnId": "IPAddress",
                                "label": "IP Address"
                              }
                            ]
                          }
                        },
                        "showPin": false,
                        "name": "Signing Activities"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "locationsignin"
                  },
                  "name": "Location Signin"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Failed login Count \r\n// Resources with most failed log in attempts. \r\nSigninLogs\r\n| where ResultType !=0\r\n| summarize FailedLoginCount=count() by ResourceDisplayName\r\n| sort by FailedLoginCount desc nulls last",
                          "size": 4,
                          "title": "Failed Login Count",
                          "timeContext": {
                            "durationMs": 2592000000
                          },
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "piechart"
                        },
                        "name": "query - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// User count per Resource \r\n// Distinct count if users by resource. \r\nSigninLogs\r\n| project UserDisplayName, Identity,UserPrincipalName,  AppDisplayName, AppId, ResourceDisplayName\r\n| summarize UserCount=dcount(UserPrincipalName) by ResourceDisplayName",
                          "size": 3,
                          "title": "Resource Wise User Signing",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "ResourceDisplayName",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "UserCount",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "name": "User Count Per Resource"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "resourcesigning"
                  },
                  "name": "Resources Signing"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status)\r\n| extend ConditionalAccessPolicies = parse_json(ConditionalAccessPolicies);\r\nlet data = \r\nunion SigninLogs,nonInteractive\r\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n|extend CAStatus = case(ConditionalAccessStatus ==\"success\",\"Successful\",\r\n                    ConditionalAccessStatus == \"failure\", \"Failed\",                                     \r\n                    ConditionalAccessStatus == \"notApplied\", \"Not applied\",                                     \r\n                    isempty(ConditionalAccessStatus), \"Not applied\", \r\n                    \"Disabled\")\r\n|mvexpand ConditionalAccessPolicies\r\n|extend CAGrantControlName = tostring(ConditionalAccessPolicies.enforcedGrantControls[0])\r\n|extend CAGrantControl = case(CAGrantControlName contains \"MFA\", \"Require MFA\", \r\n                            CAGrantControlName contains \"Terms of Use\", \"Require Terms of Use\", \r\n                            CAGrantControlName contains \"Privacy\", \"Require Privacy Statement\", \r\n                            CAGrantControlName contains \"Device\", \"Require Device Compliant\", \r\n                            CAGrantControlName contains \"Azure AD Joined\", \"Require Hybird Azure AD Joined Device\", \r\n                            CAGrantControlName contains \"Apps\", \"Require Approved Apps\",\r\n                            \"Other\");\r\ndata\r\n| where Category in ({Category})\r\n| summarize Count = dcount(Id) by CAStatus\r\n| join kind = inner (data\r\n                    | make-series Trend = dcount(Id) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by CAStatus\r\n                    ) on CAStatus\r\n| project-away CAStatus1, TimeGenerated\r\n| order by Count desc",
                          "size": 4,
                          "title": "Conditional access status",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "CAStatus",
                              "formatter": 1
                            },
                            "subtitleContent": {
                              "columnMatch": "Category"
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 9"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status)\r\n| extend ConditionalAccessPolicies = parse_json(ConditionalAccessPolicies);\r\nlet data = \r\nunion SigninLogs,nonInteractive|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n|extend errorCode = toint(Status.errorCode)\r\n|extend Reason = tostring(Status.failureReason)\r\n|extend CAStatus = case(ConditionalAccessStatus ==0,\"✔️ Success\",                                     \r\n                        ConditionalAccessStatus == 1, \"❌ Failure\",                                     \r\n                        ConditionalAccessStatus == 2, \"⚠️ Not Applied\",                                     \r\n                        ConditionalAccessStatus == \"\", \"⚠️ Not Applied\", \r\n                        \"🚫 Disabled\")\r\n|mvexpand ConditionalAccessPolicies\r\n|extend CAGrantControlName = tostring(ConditionalAccessPolicies.enforcedGrantControls[0])\r\n|extend CAGrantControl = case(CAGrantControlName contains \"MFA\", \"Require MFA\", \r\n                            CAGrantControlName contains \"Terms of Use\", \"Require Terms of Use\", \r\n                            CAGrantControlName contains \"Privacy\", \"Require Privacy Statement\", \r\n                            CAGrantControlName contains \"Device\", \"Require Device Compliant\", \r\n                            CAGrantControlName contains \"Azure AD Joined\", \"Require Hybird Azure AD Joined Device\", \r\n                            CAGrantControlName contains \"Apps\", \"Require Approved Apps\",\"Other\");\r\ndata\r\n| summarize Count = dcount(Id) by CAStatus, CAGrantControl\r\n| project Id = strcat(CAStatus, '/', CAGrantControl), Name = CAGrantControl, Parent = CAStatus, Count, Type = 'CAGrantControl'\r\n| join kind = inner (data\r\n                    | make-series Trend = dcount(Id) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by CAStatus, CAGrantControl\r\n                    | project Id = strcat(CAStatus, '/', CAGrantControl), Trend\r\n                    ) on Id\r\n| project-away Id1\r\n| union (data\r\n    | where Category in ({Category})\r\n    | summarize Count = dcount(Id) by CAStatus\r\n    | project Id = CAStatus, Name = CAStatus, Parent = '', Count, Type = 'CAStatus'\r\n    | join kind = inner (data\r\n                        | make-series Trend = dcount(Id) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by CAStatus\r\n                        | project Id = CAStatus, Trend\r\n                        ) on Id\r\n    | project-away Id1)\r\n| order by Count desc",
                          "size": 3,
                          "timeContextFromParameter": "TimeRange",
                          "exportParameterName": "Detail",
                          "exportDefaultValue": "{ \"Name\":\"\", \"Type\":\"*\", \"Parent\":\"*\"}",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Id",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Parent",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Count",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "showIcon": true
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Type",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Trend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "showIcon": true
                                }
                              }
                            ],
                            "hierarchySettings": {
                              "idColumn": "Id",
                              "parentColumn": "Parent",
                              "treeType": 0,
                              "expanderColumn": "Name",
                              "expandTopLevel": true
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 10",
                        "styleSettings": {
                          "margin": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let details = dynamic({Detail});\r\nlet nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status)\r\n| extend ConditionalAccessPolicies = parse_json(ConditionalAccessPolicies);\r\nlet data = \r\nunion SigninLogs,nonInteractive\r\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n|extend errorCode = toint(Status.errorCode)\r\n|extend Reason = tostring(Status.failureReason)\r\n|extend CAStatus = case(ConditionalAccessStatus ==\"success\",\"✔️ Success\",                                     \r\n                        ConditionalAccessStatus == \"failure\", \"❌ Failure\",                                     \r\n                        ConditionalAccessStatus == \"notApplied\", \"⚠️ Not Applied\",                                     \r\n                        ConditionalAccessStatus == \"\", \"⚠️ Not Applied\", \r\n                        \"🚫 Disabled\")\r\n|mvexpand ConditionalAccessPolicies\r\n|extend CAGrantControlName = tostring(ConditionalAccessPolicies.enforcedGrantControls[0])\r\n|extend CAGrantControl = case(CAGrantControlName contains \"MFA\", \"Require MFA\", \r\n                            CAGrantControlName contains \"Terms of Use\", \"Require Terms of Use\", \r\n                            CAGrantControlName contains \"Privacy\", \"Require Privacy Statement\", \r\n                            CAGrantControlName contains \"Device\", \"Require Device Compliant\", \r\n                            CAGrantControlName contains \"Azure AD Joined\", \"Require Hybird Azure AD Joined Device\", \r\n                            CAGrantControlName contains \"Apps\", \"Require Approved Apps\",\r\n                            \"Other\")\r\n|extend CAGrantControlRank = case(CAGrantControlName contains \"MFA\", 1, \r\n                            CAGrantControlName contains \"Terms of Use\", 2, \r\n                            CAGrantControlName contains \"Privacy\", 3, \r\n                            CAGrantControlName contains \"Device\", 4, \r\n                            CAGrantControlName contains \"Azure AD Joined\", 5, \r\n                            CAGrantControlName contains \"Apps\", 6,\r\n                            7)\r\n| where details.Type == '*' or (details.Type == 'CAStatus' and CAStatus == details.Name) or (details.Type == 'CAGrantControl' and CAGrantControl == details.Name and CAStatus == details.Parent);\r\ndata\r\n| order by CAGrantControlRank desc\r\n| summarize CAGrantControls = make_set(CAGrantControl) by AppDisplayName, CAStatus, TimeGenerated, UserDisplayName, Category\r\n| extend CAGrantControlText = replace(@\",\", \", \", replace(@'\"', @'', replace(@\"\\]\", @\"\", replace(@\"\\[\", @\"\", tostring(CAGrantControls)))))\r\n| extend CAGrantControlSummary = case(array_length(CAGrantControls) > 1, strcat(CAGrantControls[0], ' + ', array_length(CAGrantControls) - 1, ' more'), array_length(CAGrantControls) == 1, tostring(CAGrantControls[0]), 'None')\r\n| top 200 by TimeGenerated desc\r\n| extend TimeFromNow = now() - TimeGenerated\r\n| extend TimeAgo = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\r\n| project Application = AppDisplayName, ['CA Status'] = CAStatus, ['CA Grant Controls'] = CAGrantControlSummary, ['All CA Grant Controls'] = CAGrantControlText, ['Sign-in Time'] = TimeAgo, ['User'] = UserDisplayName, Category\r\n| where Category in ({Category})",
                          "size": 0,
                          "title": "Detailed View",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "CA Grant Controls",
                                "formatter": 1,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "All CA Grant Controls",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "User",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "showPin": false,
                        "name": "query - 7 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Failed MFA challenge \r\n// Highlights sign in failures caused by failed MFA challenge. \r\nSigninLogs\r\n| where ResultType == 50074\r\n| project UserDisplayName, Identity,UserPrincipalName, ResultDescription,  AppDisplayName, AppId, ResourceDisplayName\r\n| summarize FailureCount=count(), FailedResources=dcount(ResourceDisplayName), ResultDescription=any(ResultDescription) by UserDisplayName",
                          "size": 0,
                          "title": "Failed MFA Chalange",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "UserDisplayName",
                                "label": "User Name"
                              },
                              {
                                "columnId": "FailureCount",
                                "label": "Failure Count"
                              },
                              {
                                "columnId": "FailedResources",
                                "label": "Failed Resources"
                              },
                              {
                                "columnId": "ResultDescription",
                                "label": "Final Result"
                              }
                            ]
                          }
                        },
                        "name": "Failed MFA Chalange"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "conditionalaccess"
                  },
                  "name": "Condtional Access MFA"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status);\r\nlet data = \r\nunion SigninLogs,nonInteractive|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n|extend errorCode = Status.errorCode\r\n|extend SigninStatus = case(errorCode == 0, \"Success\", errorCode == 50058, \"Pending action (Interrupts)\",errorCode == 50140, \"Pending action (Interrupts)\", errorCode == 51006, \"Pending action (Interrupts)\", errorCode == 50059, \"Pending action (Interrupts)\",errorCode == 65001, \"Pending action (Interrupts)\", errorCode == 52004, \"Pending action (Interrupts)\", errorCode == 50055, \"Pending action (Interrupts)\", errorCode == 50144, \"Pending action (Interrupts)\", errorCode == 50072, \"Pending action (Interrupts)\", errorCode == 50074, \"Pending action (Interrupts)\", errorCode == 16000, \"Pending action (Interrupts)\", errorCode == 16001, \"Pending action (Interrupts)\", errorCode == 16003, \"Pending action (Interrupts)\", errorCode == 50127, \"Pending action (Interrupts)\", errorCode == 50125, \"Pending action (Interrupts)\", errorCode == 50129, \"Pending action (Interrupts)\", errorCode == 50143, \"Pending action (Interrupts)\", errorCode == 81010, \"Pending action (Interrupts)\", errorCode == 81014, \"Pending action (Interrupts)\", errorCode == 81012 ,\"Pending action (Interrupts)\", \"Failure\");\r\ndata\r\n| summarize Count = count() by SigninStatus, Category\r\n| join kind = fullouter (datatable(SigninStatus:string)['Success', 'Pending action (Interrupts)', 'Failure']) on SigninStatus\r\n| project SigninStatus = iff(SigninStatus == '', SigninStatus1, SigninStatus), Count = iff(SigninStatus == '', 0, Count), Category\r\n| join kind = inner (data\r\n    | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SigninStatus)\r\n    on SigninStatus\r\n| project-away SigninStatus1, TimeGenerated\r\n| extend Status = SigninStatus\r\n| union (\r\n    data \r\n    | summarize Count = count() \r\n    | extend jkey = 1\r\n    | join kind=inner (data\r\n        | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\r\n        | extend jkey = 1) on jkey\r\n    | extend SigninStatus = 'All Sign-ins', Status = '*'    \r\n)\r\n| where Category in ({Category})\r\n| order by Count desc\r\n\r\n\r\n\r\n",
                          "size": 3,
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "tiles",
                          "gridSettings": {
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "ResultDescription"
                              ]
                            },
                            "labelSettings": [
                              {
                                "columnId": "ResultDescription",
                                "label": "Authentication Failed Reason"
                              },
                              {
                                "columnId": "ResultType",
                                "label": "Result Type"
                              },
                              {
                                "columnId": "Count",
                                "label": "Count"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "SigninStatus",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Success",
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Failure",
                                    "representation": "4",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Pending action (Interrupts)",
                                    "representation": "3",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "1",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "none"
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "name": "query - 5"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status);\r\nlet data = \r\nunion SigninLogs,nonInteractive|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n| extend ErrorCode = tostring(Status.errorCode) \r\n| extend FailureReason = tostring(Status.failureReason) \r\n| where ErrorCode !in (\"0\",\"50058\",\"50148\",\"50140\", \"51006\", \"50059\", \"65001\", \"52004\", \"50055\", \"50144\",\"50072\", \"50074\", \"16000\",\"16001\", \"16003\", \"50127\", \"50125\", \"50129\",\"50143\", \"81010\", \"81014\", \"81012\") \r\n|summarize errCount = count() by ErrorCode, tostring(FailureReason), Category| sort by errCount, Category\r\n|project ['Error Code'] = ErrorCode, ['Reason']= FailureReason, ['Error Count'] = toint(errCount), Category\r\n|where Category in ({Category});\r\ndata",
                          "size": 1,
                          "title": "Summary of top errors",
                          "timeContextFromParameter": "TimeRange",
                          "exportFieldName": "❌ Error Code",
                          "exportParameterName": "ErrorCode",
                          "exportDefaultValue": "*",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Error Count",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "orange",
                                  "showIcon": true
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "showPin": false,
                        "name": "query - 5"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status)\r\n| extend DeviceDetail = parse_json(DeviceDetail)\r\n| extend ConditionalAccessPolicies = parse_json(ConditionalAccessPolicies);\r\nlet data=\r\nunion SigninLogs,nonInteractive\r\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n| extend ErrorCode = tostring(Status.errorCode) \r\n| extend FailureReason = tostring(Status.failureReason) \r\n| where ErrorCode !in (\"0\",\"50058\",\"50148\",\"50140\", \"51006\", \"50059\", \"65001\", \"52004\", \"50055\", \"50144\",\"50072\", \"50074\", \"16000\",\"16001\", \"16003\", \"50127\", \"50125\", \"50129\",\"50143\", \"81010\", \"81014\", \"81012\") \r\n| where '{ErrorCode}' == '*' or '{ErrorCode}' == ErrorCode\r\n| top 200 by TimeGenerated desc\r\n| extend TimeFromNow = now() - TimeGenerated\r\n| extend TimeAgo = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\r\n| project User = UserDisplayName, IPAddress, ['Error Code'] = ErrorCode, ['Sign-in Time'] = TimeAgo, App = AppDisplayName, ['Error code'] = ErrorCode, ['Result type'] = ResultType, ['Result signature'] = ResultSignature, ['Result description'] = ResultDescription, ['Conditional access policies'] = ConditionalAccessPolicies, ['Conditional access status'] = ConditionalAccessStatus, ['Operating system'] = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser, ['Country or region'] = LocationDetails.countryOrRegion, ['State'] = LocationDetails.state, ['City'] = LocationDetails.city, ['Time generated'] = TimeGenerated, Status, ['User principal name'] = UserPrincipalName, Category\r\n| where Category in ({Category});\r\ndata\r\n\r\n\r\n",
                          "size": 1,
                          "title": "Impacted Users",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "❌ Error Code",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "GenericDetails",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "App",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Error code",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Result type",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Result signature",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Result description",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Conditional access policies",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Conditional access status",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Operating system",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Browser",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Country or region",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "City",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Time generated",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Status",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "User principal name",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "name": "query - 5 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status);\r\nlet data = \r\nunion SigninLogs,nonInteractive|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n| extend ErrorCode = tostring(Status.errorCode) \r\n| extend FailureReason = Status.failureReason \r\n| where ErrorCode in (\"50058\",\"50140\", \"51006\", \"50059\", \"65001\", \"52004\", \"50055\", \"50144\",\"50072\", \"50074\", \"16000\",\"16001\", \"16003\", \"50127\", \"50125\", \"50129\",\"50143\", \"81010\", \"81014\", \"81012\") \r\n|summarize errCount = count() by ErrorCode, tostring(FailureReason), Category\r\n| sort by errCount\r\n|project ['Error Code'] = ErrorCode, ['Reason'] = FailureReason, ['Interrupt Count'] = toint(errCount), Category\r\n| where Category in ({Category});\r\ndata",
                          "size": 1,
                          "title": "Summary of sign-ins waiting on user action",
                          "timeContextFromParameter": "TimeRange",
                          "exportFieldName": "❌ Error Code",
                          "exportParameterName": "InterruptErrorCode",
                          "exportDefaultValue": "*",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Interrupt Count",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "orange"
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "showPin": false,
                        "name": "query - 7"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend ConditionalAccessPolicies = parse_json(ConditionalAccessPolicies)\r\n| extend DeviceDetail = parse_json(DeviceDetail)\r\n| extend Status = parse_json(Status);\r\nlet data = \r\nunion SigninLogs,nonInteractive \r\n|where AppDisplayName in ({Apps}) or '*' in ({Apps})\r\n|where UserDisplayName in ({Users}) \r\n| extend ErrorCode = tostring(Status.errorCode) \r\n| extend FailureReason = Status.failureReason \r\n| where ErrorCode in (\"50058\",\"50140\", \"51006\", \"50059\", \"65001\", \"52004\", \"50055\", \"50144\",\"50072\", \"50074\", \"16000\",\"16001\", \"16003\", \"50127\", \"50125\", \"50129\",\"50143\", \"81010\", \"81014\", \"81012\") \r\n| where '{InterruptErrorCode}' == '*' or '{InterruptErrorCode}' == ErrorCode\r\n| top 200 by TimeGenerated desc\r\n| extend TimeFromNow = now() - TimeGenerated\r\n| extend TimeAgo = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\r\n| project User = UserDisplayName, IPAddress, ['Error Code'] = ErrorCode, ['Sign-in Time'] = TimeAgo, App = AppDisplayName, ['Error code'] = ErrorCode, ['Result type'] = ResultType, ['Result signature'] = ResultSignature, ['Result description'] = ResultDescription, ['Conditional access policies'] = ConditionalAccessPolicies, ['Conditional access status'] = ConditionalAccessStatus, ['Operating system'] = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser, ['Country or region'] = LocationDetails.countryOrRegion, ['State'] = LocationDetails.state, ['City'] = LocationDetails.city, ['Time generated'] = TimeGenerated, Status, ['User principal name'] = UserPrincipalName, Category\r\n| where Category in ({Category});\r\ndata\r\n\r\n",
                          "size": 1,
                          "title": "Impacted Users",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "❌ Error Code",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "GenericDetails",
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "App",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Error code",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Result type",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Result signature",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Result description",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Conditional access policies",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Conditional access status",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Operating system",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Browser",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Country or region",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "City",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Time generated",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Status",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "User principal name",
                                "formatter": 5,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "showPin": false,
                        "name": "query - 7 - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "signinissues"
                  },
                  "name": "Signin Issues"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tabname",
              "comparison": "isEqualTo",
              "value": "iam"
            },
            "name": "IAM"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "12722401-e598-4a42-912d-3284b2862bad",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Hybrid Benifit",
                        "subTarget": "hybridbenifit",
                        "preText": "",
                        "postText": "",
                        "style": "link"
                      },
                      {
                        "id": "a3889eb4-eea8-4da0-a198-ab19f748ac2e",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Utagged Items",
                        "subTarget": "untaggeditems",
                        "style": "link"
                      },
                      {
                        "id": "9e4855dd-7d72-4c42-a112-2f455583bde6",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Public Exposure",
                        "subTarget": "publicexposure",
                        "style": "link"
                      },
                      {
                        "id": "6dd552d2-1767-4d45-89cc-de6dcbc81822",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Performance",
                        "subTarget": "performance",
                        "style": "link"
                      },
                      {
                        "id": "f42a3509-f058-4f56-a73a-1fd23a0f46b1",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Reliability",
                        "subTarget": "reliability",
                        "style": "link"
                      },
                      {
                        "id": "fde70c54-9f57-48eb-82d7-5d56a0dcf699",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Cost",
                        "subTarget": "cost",
                        "style": "link"
                      },
                      {
                        "id": "f4df991d-26c0-4085-bc07-92aedfe90b64",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Security",
                        "subTarget": "security",
                        "style": "link"
                      },
                      {
                        "id": "30d30edd-e180-4e28-9eee-d81ffde2cb67",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Compliance",
                        "subTarget": "compliance",
                        "style": "link"
                      },
                      {
                        "id": "810dc019-fc47-400c-84bf-1e2d9713c98c",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Protection",
                        "subTarget": "protection",
                        "style": "link"
                      },
                      {
                        "id": "f88c9ec7-778a-4865-8497-884c1aa0eef1",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Vulnerabilities",
                        "subTarget": "vulnerabilities",
                        "style": "link"
                      },
                      {
                        "id": "eff11f73-adbc-4559-a103-28958b006bb2",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Overpermissive NSG",
                        "subTarget": "overpermissivensg",
                        "style": "link"
                      },
                      {
                        "id": "38a43bf6-9484-4144-bdbf-d4c9ba3d646d",
                        "cellValue": "submenu",
                        "linkTarget": "parameter",
                        "linkLabel": "Orphan Items",
                        "subTarget": "orphanresources",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 0"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | extend SubscriptionName=name | join ( resources | where type =~ 'microsoft.compute/virtualmachines' and  tostring(properties.storageProfile.osDisk.osType) == 'Windows' and tostring(properties.['licenseType']) !has 'Windows' | extend WindowsId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType'])) on subscriptionId \r\n| project id1, id ,type1,location1,VMSize,OSType,OsVersion, LicenseType\r\n\r\n   ",
                          "size": 3,
                          "title": "Virtual Machines without Azure Hybrid Benefit ",
                          "noDataMessage": "You are Good",
                          "noDataMessageStyle": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Group",
                                "formatter": 1
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "VMSize",
                                "sortOrder": 1
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "VMSize",
                              "sortOrder": 1
                            }
                          ],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "WindowsId",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            "subtitleContent": {
                              "columnMatch": "SubscriptionName",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": false
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "name": "query - 3 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | extend SubscriptionName=name | join ( resources | where type =~ 'microsoft.compute/virtualmachines' and properties.storageProfile.imageReference.publisher == 'suse' or properties.storageProfile.imageReference.publisher=='RedHat' and tostring(properties.['licenseType']) != 'SLES_BYOS' and tostring(properties.['licenseType']) != 'REHL_BYOS' | extend WindowsId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType'])) on subscriptionId \r\n| project id1, id ,type1,location1,VMSize,OSType,OsVersion, LicenseType\r\n",
                          "size": 3,
                          "title": "Linux Machine not Running with Azure Hybrid Benifits",
                          "noDataMessage": "You are Good",
                          "noDataMessageStyle": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Group",
                                "formatter": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "VMSize",
                                "label": "Size"
                              },
                              {
                                "columnId": "OSType",
                                "label": "OS"
                              },
                              {
                                "columnId": "OsVersion",
                                "label": "Version"
                              },
                              {
                                "columnId": "LicenseType",
                                "label": "Licence Type"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "WindowsId",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": false
                              }
                            },
                            "subtitleContent": {
                              "columnMatch": "SubscriptionName"
                            },
                            "showBorder": true
                          }
                        },
                        "name": "query - 6"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | extend SubscriptionName=name | join ( resources | where type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines' and tostring(properties.['sqlServerLicenseType']) != 'AHUB'  | extend SQLID=id, VMName = name, VMRG = resourceGroup, VMLocation = location, LicenseType = tostring(properties.['sqlServerLicenseType']), OSType=tostring(properties.storageProfile.imageReference.offer), SQLAgentType = tostring(properties.['sqlManagement']), SQLVersion = tostring(properties.['sqlImageOffer']), SQLSKU=tostring(properties.['sqlImageSku'])) on subscriptionId \r\n    | order by id asc    \r\n    | project SQLID,VMName,VMRG, VMLocation, SQLVersion, SQLSKU, SQLAgentType, LicenseType, SubscriptionName\r\n    | where SQLSKU != \"Developer\" and SQLSKU != \"Express\"",
                          "size": 3,
                          "title": "DB without Azure Hybrid Benifit",
                          "noDataMessage": "You are Good Here",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles"
                        },
                        "name": "query - 3"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "![alt text](https://raw.githubusercontent.com/dshirdho/CloudOpsDashboard/main/highlyrecommended.png) \r\n<hr>\r\nCloudOps Recommended to Leverage Azure Hybrid Benefit which is a licensing offer that helps you migrate and save to Azure. \r\n\r\nBenefit : By using Azure Hybrid Benefit, you can achieve cost savings, modernise and maintain a flexible hybrid environment while optimising business applications. Explore savings with the Azure Hybrid Benefit Savings Calculator.\r\n"
                        },
                        "conditionalVisibility": {
                          "parameterName": "recommendation",
                          "comparison": "isEqualTo",
                          "value": "Yes"
                        },
                        "name": "text - 2"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "hybridbenifit"
                  },
                  "name": "hybridbenifit"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers\r\n| where type =~ 'microsoft.resources/subscriptions/resourcegroups'\r\n| extend TagBool = iff(tags != '' and tags != '[]', \"Tagged\",\"Untagged\")\r\n| summarize count() by TagBool\r\n//| project resourceGroup, tags\r\n",
                          "size": 4,
                          "title": "Resource Group Tagging",
                          "exportParameterName": "tagtab1",
                          "exportDefaultValue": "untaggedresourcegroups",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "TagBool",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true
                          },
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "Tagged",
                                "color": "green"
                              },
                              {
                                "seriesName": "Untagged",
                                "color": "redBright"
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources | extend TagBool = iff(tags != '' and tags != '[]', \"Tagged\",\"Untagged\") | summarize count() by TagBool\r\n\r\n",
                          "size": 4,
                          "title": "Resource Tagging",
                          "exportParameterName": "tagtab2",
                          "exportDefaultValue": "untaggedresources",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "TagBool",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true
                          },
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "Tagged",
                                "color": "green"
                              },
                              {
                                "seriesName": "Untagged",
                                "color": "redBright"
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 1"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ResourceContainers\r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| extend SubscriptionName=name \r\n| join  ( ResourceContainers | where type =~ 'microsoft.resources/subscriptions/resourcegroups'  \r\n    | where tags ==\"\"\r\n| extend resourceGroupName=id, RGLocation=location, RGTags=tags) on subscriptionId\r\n| project resourceGroupName, RGLocation, SubscriptionName\r\n",
                                "size": 3,
                                "title": "Untagged Resource Groups",
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "gridSettings": {
                                  "filter": true,
                                  "labelSettings": [
                                    {
                                      "columnId": "resourceGroupName",
                                      "label": "Resoruce Group"
                                    },
                                    {
                                      "columnId": "RGLocation",
                                      "label": "Location"
                                    },
                                    {
                                      "columnId": "SubscriptionName",
                                      "label": "Subscription"
                                    }
                                  ]
                                }
                              },
                              "name": "query - 3"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "Untagged Resource Group"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Resources \r\n\r\n |extend TagBool = iff(tags != '' and tags != '[]', \"Tagged\",\"Untagged\") \r\n | where tags ==\"\"\r\n| project id,type ,subscriptionId\r\n\r\n\r\n",
                                "size": 3,
                                "title": "Untagged Resources",
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "Group",
                                      "formatter": 1
                                    },
                                    {
                                      "columnMatch": "type",
                                      "formatter": 14,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 15,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 999,
                                  "filter": true,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "type"
                                    ]
                                  }
                                }
                              },
                              "name": "Untagged Resources"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "Untagged Resource Group - Copy"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "![alt text](https://raw.githubusercontent.com/dshirdho/CloudOpsDashboard/main/highlyrecommended.png) \r\n<hr>\r\nCloudOps Recommended to Leverage Tags for all of your Cloud Resources.\r\n\r\nBenefit : Tagging is a critical part of an overall governance policy which help you to achieve operation excellence and decide accontability of each cloud resources. Tagging is also complement  automation stratgey\r\n"
                        },
                        "conditionalVisibility": {
                          "parameterName": "recommendation",
                          "comparison": "isEqualTo",
                          "value": "Yes"
                        },
                        "name": "text - 2"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "untaggeditems"
                  },
                  "name": "Untagged Items"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources\r\n    | where type =~ 'microsoft.network/publicipaddresses' and isnotempty(properties.ipAddress)\r\n",
                          "size": 3,
                          "exportToExcelOptions": "all",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "id",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "name",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "type",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "tenantId",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "kind",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": true,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "managedBy",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "sku",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "plan",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "properties",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "tags",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "identity",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "extendedLocation",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "-- Group By --",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": true,
                                  "showIcon": true
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "labelSettings": [
                              {
                                "columnId": "resourceGroup",
                                "label": "Resource Group"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "id",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            "subtitleContent": {
                              "columnMatch": "type",
                              "formatter": 16,
                              "formatOptions": {
                                "showIcon": false
                              }
                            },
                            "leftContent": {
                              "columnMatch": "subscriptionId",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": true
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "name": " resources with Public IP"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "![alt text](https://raw.githubusercontent.com/dshirdho/CloudOpsDashboard/main/highlyrecommended.png) \r\n<hr>\r\nCloudOps Recommended to Assess each resource which is exoposed to external world against your business need.\r\n\r\nBenefit : Securing overall Infrastructure landscape "
                        },
                        "conditionalVisibility": {
                          "parameterName": "recommendation",
                          "comparison": "isEqualTo",
                          "value": "Yes"
                        },
                        "name": "text - 2"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "publicexposure"
                  },
                  "name": "Public Exposure"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AdvisorResources\r\n| where type == 'microsoft.advisor/recommendations'\r\n| where properties.category == 'Performance'\r\n| extend\r\n\tresources = tostring(properties.resourceMetadata.resourceId),\r\n\tsavings = todouble(properties.extendedProperties.savingsAmount),\r\n\tsolution = tostring(properties.shortDescription.solution),\r\n\tcurrency = tostring(properties.extendedProperties.savingsCurrency)\r\n| summarize\r\n\tdcount(resources),\r\n\tbin(sum(savings), 0.01)\r\n\tby solution, currency\r\n| project solution, dcount_resources\r\n| count \r\n| extend Item = \"Performance Recommendations\",  Key = 3\r\n",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": false,
                            "size": "auto"
                          }
                        },
                        "name": "query - 0"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AdvisorResources\r\n| where type == 'microsoft.advisor/recommendations'\r\n| where properties.category == 'Performance'\r\n| extend\r\n\tresources = tostring(properties.resourceMetadata.resourceId),\r\n\tsavings = todouble(properties.extendedProperties.savingsAmount),\r\n\tsolution = tostring(properties.shortDescription.solution),\r\n\tcurrency = tostring(properties.extendedProperties.savingsCurrency)\r\n| summarize\r\n\tdcount(resources),\r\n\tbin(sum(savings), 0.01)\r\n\tby solution, currency\r\n| project solution, dcount_resources\r\n\r\n\r\n\r\n",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "labelSettings": [
                              {
                                "columnId": "solution",
                                "label": "Recommendation"
                              },
                              {
                                "columnId": "dcount_resources",
                                "label": "Impacted Resources"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "solution",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "dcount_resources",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "name": "query - 0 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AdvisorResources\r\n| where type == 'microsoft.advisor/recommendations'\r\n| where properties.category == 'Performance'\r\n| extend\r\n\tresources = tostring(properties.resourceMetadata.resourceId),\r\n\tsavings = todouble(properties.extendedProperties.savingsAmount),\r\n\tsolution = tostring(properties.shortDescription.solution),\r\n\tcurrency = tostring(properties.extendedProperties.savingsCurrency)\r\n| project solution ,resources \r\n| order by solution \r\n\r\n\r\n\r\n\r\n",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Group",
                                "formatter": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "solution",
                                "label": "Recommendation"
                              },
                              {
                                "columnId": "resources",
                                "label": "Impacted Resource"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "solution",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "dcount_resources",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "name": "query - 0 - Copy - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "performance"
                  },
                  "name": "Performance"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "parameters": [
                            {
                              "id": "ac7e3b53-0894-4426-bc96-4e91af261f53",
                              "version": "KqlParameterItem/1.0",
                              "name": "ResourceGroup",
                              "label": "Resource Group",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "resources\r\n| distinct resourceGroup",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "972eba34-11d9-42e3-8005-b0334b3a301b",
                              "version": "KqlParameterItem/1.0",
                              "name": "Criticality",
                              "type": 2,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "resources\r\n| extend Criticality = case(tags.Criticality <> \"\", tags.Criticality,\r\n\t\t    \"Undefined\")\r\n| distinct Criticality",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "5c4674db-3151-4a5f-bb5a-e5e886cc2c17",
                              "version": "KqlParameterItem/1.0",
                              "name": "Environment",
                              "type": 2,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "resources\r\n| extend Environment = case(\r\ntags.Environment <> \"\", tags.Environment,\r\ntags.environment <> \"\", tags.environment,\r\ntags.Env <> \"\", tags.Env,\r\ntags.env <> \"\", tags.env,\r\ntolower(name) contains \"prod\", \"Production\",\r\ntolower(name) contains \"dev\", \"Development\",\r\ntolower(name) contains \"qa\", \"QA\",\r\ntolower(name) contains \"uat\", \"UAT\",\r\ntolower(name) contains \"sit\", \"SIT\",\r\ntolower(name) contains \"test\", \"Test\",\r\n\"Undefined\")\r\n| distinct Environment",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources"
                            },
                            {
                              "id": "945162bf-cf6d-4956-952c-606acfd2c5e5",
                              "version": "KqlParameterItem/1.0",
                              "name": "Help",
                              "label": "Show Help",
                              "type": 10,
                              "description": "This will show additional information, and any prerequisites that may apply to the workbook.",
                              "isRequired": true,
                              "isHiddenWhenLocked": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[{ \"value\": \"Yes\", \"label\": \"Yes\"},\r\n {\"value\": \"No\", \"label\": \"No\", \"selected\":true }]",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources"
                        },
                        "name": "parameters - 0 - Copy - Copy - Copy - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "advisorresources\r\n| extend Category = tostring(properties.category)\r\n| extend Description = tostring(properties.shortDescription.problem)\r\n| extend ImpactedField = tostring(properties.impactedField)\r\n| extend ImpactedValue = tostring(properties.impactedValue)\r\n| extend Impact = tostring(properties.impact)\r\n| extend LastUpdated = tostring(properties.lastUpdated)\r\n| project ImpactedValue, resourceGroup, Category, Impact, ImpactedField, Description, LastUpdated\r\n| where Category == \"HighAvailability\" \r\n| where resourceGroup in ({ResourceGroup})\r\n| summarize count() by Description",
                          "size": 4,
                          "title": "Reliability Recommendations",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart"
                        },
                        "customWidth": "50",
                        "name": "advisorbyrecstep",
                        "styleSettings": {
                          "margin": "5px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "advisorresources\r\n| extend Category = tostring(properties.category)\r\n| extend Description = tostring(properties.shortDescription.problem)\r\n| extend ImpactedField = tostring(properties.impactedField)\r\n| extend ImpactedValue = tostring(properties.impactedValue)\r\n| extend Impact = tostring(properties.impact)\r\n| extend LastUpdated = tostring(properties.lastUpdated)\r\n| project ImpactedValue, resourceGroup, Category, Impact, ImpactedField, Description, LastUpdated\r\n| where Category == \"HighAvailability\" \r\n| where resourceGroup in ({ResourceGroup})\r\n| summarize count() by ImpactedField\r\n",
                          "size": 4,
                          "title": "By Resource Type",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "chartSettings": {
                            "yAxis": [
                              "count_"
                            ]
                          }
                        },
                        "customWidth": "50",
                        "name": "advisorbyresourcestep",
                        "styleSettings": {
                          "margin": "5px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\n| where resourceGroup in ({ResourceGroup})\n| extend criticality = case(tags.Criticality <> \"\", tags.Criticality,\n    \"Undefined\")\n| extend environment = case(\n    tags.Environment <> \"\", tags.Environment,\n    tags.environment <> \"\", tags.environment,\n    tags.Env <> \"\", tags.Env,\n    tags.env <> \"\", tags.env,\n    tolower(name) contains \"prod\", \"Production\",\n    tolower(name) contains \"dev\", \"Development\",\n    tolower(name) contains \"qa\", \"QA\",\n    tolower(name) contains \"uat\", \"UAT\",\n    tolower(name) contains \"sit\", \"SIT\",\n    tolower(name) contains \"test\", \"Test\",\n    \"Undefined\")\n| where criticality in ({Criticality})\n| where environment in ({Environment})\n| where \n    (type == 'microsoft.compute/virtualmachines') or \n    (type == \"microsoft.compute/virtualmachinescalesets\" and tags.aksEngineVersion !contains \"aks-gomod\") or\n    (type == 'microsoft.web/sites') or \n    (type == \"microsoft.containerservice/managedclusters\") or \n    (type == 'microsoft.sql/servers/databases') or \n    (type == 'microsoft.documentdb/databaseaccounts') or \n    (type == 'microsoft.dbformysql/servers') or \n    (type == 'microsoft.dbformysql/flexibleservers') or \n    (type == \"microsoft.apimanagement/service\") or \n    (type == \"microsoft.storage/storageaccounts\" or type == \"microsoft.classicstorage/storageaccounts\") or \n    (type == \"microsoft.network/azurefirewalls\") or \n    (type == \"microsoft.network/frontdoors\") or \n    (type == \"microsoft.network/applicationgateways\") or \n    (type == \"microsoft.network/loadbalancers\") or \n    (type == \"microsoft.recoveryservices/vaults\")\n| extend aksname = case(\n    type == \"microsoft.containerservice/managedclusters\", tolower(tostring(name)),\n    \"Undefined\"\n    )\n| join kind = leftouter (\n    resources \n    | where type == \"microsoft.compute/virtualmachinescalesets\"\n    | extend aksname = tolower(tostring(split(resourceGroup, \"_\")[2]))\n    | extend AvZones = coalesce(tostring(array_length(parse_json(zones))), 'Not Configured'), AvSets = \"Scale Sets\"\n    )\n    on aksname\n| extend state = case(\n    type == 'microsoft.compute/virtualmachines', tostring(properties.extended.instanceView.powerState.displayStatus),\n    type == 'microsoft.compute/virtualmachinescalesets', tostring(properties.provisioningState),\n    type == 'microsoft.web/sites', tostring(properties.state),\n    type == 'microsoft.containerservice/managedclusters', tostring(properties.provisioningState),\n    type == 'microsoft.sql/servers/databases', tostring(properties.status),\n    type == 'microsoft.documentdb/databaseaccounts', tostring(properties.provisioningState),\n    type == 'microsoft.dbformysql/servers', tostring(properties.userVisibleState),\n    type == 'microsoft.dbformysql/flexibleservers', tostring(properties.state),\n    type == \"microsoft.apimanagement/service\", tostring(properties.provisioningState),\n    type contains \"storageaccounts\", tostring(properties.provisioningState),\n    type == \"microsoft.network/azurefirewalls\", tostring(properties.provisioningState),\n    type == \"microsoft.network/frontdoors\", tostring(properties.resourceState),\n    type == \"microsoft.network/applicationgateways\", tostring(properties.operationalState),\n    type == \"microsoft.network/loadbalancers\", tostring(properties.provisioningState),\n    type == \"microsoft.recoveryservices/vaults\", tostring(properties.provisioningState),\n    \"Undefined\"\n    )\n| extend skuName = case(\n    type == 'microsoft.compute/virtualmachines', tostring(properties.hardwareProfile.vmSize),\n    type == 'microsoft.compute/virtualmachinescalesets', tostring(sku.name),\n    type == 'microsoft.web/sites', tostring(properties.sku),\n    type == 'microsoft.containerservice/managedclusters', tostring(properties.agentPoolProfiles[0].vmSize),\n    type == 'microsoft.sql/servers/databases', tostring(sku.tier),\n    type == 'microsoft.documentdb/databaseaccounts', tostring(properties.databaseAccountOfferType),\n    type == 'microsoft.dbformysql/servers', tostring(sku.tier),\n    type == 'microsoft.dbformysql/flexibleservers', tostring(sku.tier),\n    type == \"microsoft.apimanagement/service\", tostring(sku.name),\n    type contains 'storageaccounts', tostring(replace('-', '_', tostring(iff(type =~ \"microsoft.storage/storageaccounts\", sku.name, properties.accountType)))),\n    type == \"microsoft.network/azurefirewalls\", tostring(properties.sku.name),\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", tostring(properties.sku.name),\n    type == \"microsoft.network/loadbalancers\", tostring(sku.name),\n    type == \"microsoft.recoveryservices/vaults\", tostring(iif(isnotnull(sku.tier), sku.tier, sku.name)),\n    \"Undefined\"\n    )\n| extend avZones = case(\n    location !in~ ('brazilsouth', 'canadacentral', 'centralus', 'eastus', 'eastus2', 'southcentralus', 'usgovvirginia', 'westus2', 'westus3', 'francecentral', 'germanywestcentral', 'northeurope', 'norwayeast', 'uksouth', 'westeurope', 'swedencentral', 'southafricanorth', 'australiaeast', 'centralindia', 'japaneast', 'koreacentral', 'southeastasia', 'eastasia'), 'Not Applicable',\n    (type == 'microsoft.compute/virtualmachines'), coalesce(tostring(zones[0]), 'Not Configured'),\n    (type == 'microsoft.compute/virtualmachinescalesets'), coalesce(tostring(array_length(parse_json(zones))), 'Not Configured'),\n    (type == 'microsoft.containerservice/managedclusters' and AvZones <> \"\"), AvZones,\n    (type == 'microsoft.containerservice/managedclusters' and isempty(AvZones)), \"Not Configured\",\n    (type == 'microsoft.web/sites'), \"Not Applicable\",\n    (type == 'microsoft.sql/servers/databases' and sku.tier <> 'DataWarehouse'), iif(isempty(properties.zoneRedundant) or properties.zoneRedundant == \"false\", 'Not Configured', 'Configured'),\n    (type == 'microsoft.sql/servers/databases' and sku.tier == 'DataWarehouse'), \"Not Applicable\",\n    (type == 'microsoft.documentdb/databaseaccounts'), iif(properties.locations[0].isZoneRedundant == \"false\", 'Not Configured', 'Configured'), \n    (type == 'microsoft.dbformysql/servers'), \"Not Applicable\",\n    (type == 'microsoft.dbformysql/flexibleservers'), iif(properties.haEnabled == \"Enabled\", 'Configured', 'Not Configured'),\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains 'storageaccounts'), case(split(skuName, '_', 1)[0] =~ \"zrs\", \"Configured\", \"Not Configured\"),\n    (type == \"microsoft.network/azurefirewalls\"), iif(isnotnull(zones), \"Configured\", \"Not Configured\"),\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), iif(isnotnull(zones), \"Configured\", \"Not Configured\"),\n    (type == \"microsoft.network/loadbalancers\"), case( \n        skuName =~ \"Basic\", \"Not Applicable\",\n        skuName =~ \"Standard\" and isnotnull(zones), \"Configured\",\n        \"Not Configured\"\n    ),\n    (type == \"microsoft.recoveryservices/vaults\"), \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend avSets = case(\n    type == 'microsoft.compute/virtualmachines' and avZones in ('1', '2', '3'), \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachines', (coalesce(extract('/availabilitySets/(.*)', 1, tostring(properties.availabilitySet.id)), 'Not Configured')),\n    type == 'microsoft.compute/virtualmachinescalesets' and avZones in ('1', '2', '3'), \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachinescalesets', 'A regional (non-zonal) scale set uses placement groups, which act as an implicit availability set with five fault domains and five update domains.',\n    type == 'microsoft.web/sites', 'Not Applicable',\n    type == 'microsoft.containerservice/managedclusters', case(\n        AvSets == 'Scale Sets' and avZones in ('1', '2', '3'), \"Not Applicable\",\n        AvSets == 'Scale Sets', \"A regional (non-zonal) scale set uses placement groups, which act as an implicit availability set with five fault domains and five update domains.\",\n        \"Scale Sets Not Configured\"\n    ),\n    type == 'microsoft.sql/servers/databases', 'Not Applicable',\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', \"Not Applicable\",\n    type == 'microsoft.dbformysql/flexibleservers', \"Not Applicable\",\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", \"Not Applicable\",\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend Capacity = case(\n    type == 'microsoft.compute/virtualmachines', \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachinescalesets', tostring(sku.capacity),\n    type == 'microsoft.web/sites', \"Not Applicable\",\n    type == 'microsoft.containerservice/managedclusters', iif(isnotempty(sku1.capacity), tostring(sku1.capacity), \"0\"), // AKS with or without VMSS\n    type == 'microsoft.sql/servers/databases', tostring(sku.capacity),\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', tostring(sku.capacity),\n    type == 'microsoft.dbformysql/flexibleservers', tostring(sku.capacity),\n    type == \"microsoft.apimanagement/service\", tostring(sku.capacity),\n    type contains \"storageaccounts\", \"Not Applicable\", \n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", tostring(iif(isnotempty(properties.autoscaleConfiguration), properties.autoscaleConfiguration.minCapacity, properties.sku.capacity)),\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend FaultDomain = case(\n    type == 'microsoft.compute/virtualmachines', \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachinescalesets', iif(isnotempty(properties.platformFaultDomainCount), properties.platformFaultDomainCount, \"0\"),  // 1 - AZ, 5 - Regional VMSS\n    type == 'microsoft.web/sites', \"Not Applicable\",\n    type == 'microsoft.containerservice/managedclusters', iif(isnotempty(properties1.platformFaultDomainCount), properties1.platformFaultDomainCount, \"0\"),\n    type == 'microsoft.sql/servers/databases', \"Not Applicable\",\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', 'Not Applicable',\n    type == 'microsoft.dbformysql/flexibleservers', 'Not Applicable',\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", \"Not Applicable\",\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend osDisk = case(\n    type == 'microsoft.compute/virtualmachines', iif(properties.storageProfile.osDisk.diffDiskSettings.option == \"Local\", \"Ephemeral\",  properties.storageProfile.osDisk.managedDisk.storageAccountType),\n    type == 'microsoft.compute/virtualmachinescalesets', iif(properties.virtualMachineProfile.storageProfile.osDisk.diffDiskSettings.option == \"Local\", \"Ephemeral\",  properties.virtualMachineProfile.storageProfile.osDisk.managedDisk.storageAccountType),\n    type == 'microsoft.web/sites', 'Not Applicable',\n    type == 'microsoft.containerservice/managedclusters', iff(properties.agentPoolProfiles[0].osDiskType == 'Ephemeral', 'Ephemeral', properties1.virtualMachineProfile.storageProfile.osDisk.managedDisk.storageAccountType),\n    type == 'microsoft.sql/servers/databases', properties.storageAccountType,\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', 'Not Applicable',\n    type == 'microsoft.dbformysql/flexibleservers', 'Not Applicable',\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", tostring(split(skuName, '_', 0)[0]),\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    'Not Applicable'\n    )\n| extend OSDisk = case(\n    isnotempty(osDisk), osDisk,\n    isempty(osDisk) and (type == 'microsoft.compute/virtualmachines') and state <> 'VM running', 'Unknown, start VM to get disk information.',\n    isempty(osDisk) and (type == 'microsoft.compute/virtualmachines') and isnotempty(properties.storageProfile.osDisk.vhd.uri), 'Unmanaged',\n    \"Unknown\")\n| extend ReadReplica = case (\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters'), \"Not Applicable\",\n    (type == 'microsoft.sql/servers/databases' and sku.tier <> 'DataWarehouse'), tostring(properties.readReplicaCount), // SQL DB\n    (type == 'microsoft.sql/servers/databases' and sku.tier == 'DataWarehouse'), \"Not Applicable\", // Synapse\n    type == 'microsoft.documentdb/databaseaccounts', tostring(array_length(parse_json(properties.readLocations))),\n    type == 'microsoft.dbformysql/servers', \"Not Applicable\",\n    type == 'microsoft.dbformysql/flexibleservers', \"Not Applicable\",\n    type == \"microsoft.apimanagement/service\", tostring(properties.additionalLocations),\n    type contains \"storageaccounts\", case(split(skuName, '_', 1)[0] =~ \"ragrs\", \"Configured\", \"Not Configured\"),\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend AutomaticFailover = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.sql/servers/databases'), \"Not Applicable\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableAutomaticFailover == \"false\" and properties.enableMultipleWriteLocations == \"false\" and toint(ReadReplica) > 1), \"Not Configured\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableAutomaticFailover == \"true\"), \"Configured\",\n    (type == 'microsoft.documentdb/databaseaccounts'), \"Not Applicable\",\n    type == 'microsoft.dbformysql/servers', \"Not Applicable\",\n    type == 'microsoft.dbformysql/flexibleservers', case(properties.haEnabled == \"Enabled\", \"Configured\", \"Not Applicable\"),\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", \"Not Applicable\",\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", iif(isnotempty(properties.autoscaleConfiguration), \"Configured\", \"Not Configured\"),\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend MultipleWriteLocations = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.sql/servers/databases', 'microsoft.dbformysql/servers', 'microsoft.dbformysql/flexibleservers'), \"Not Applicable\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableMultipleWriteLocations == \"false\"), \"Not Enabled\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableMultipleWriteLocations == \"true\"), \"Enabled\",\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains \"storageaccounts\"), \"Not Applicable\",\n    (type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), \"Not Applicable\",\n    (type == \"microsoft.network/loadbalancers\"), \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend StorageAutogrow = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.sql/servers/databases', 'microsoft.documentdb/databaseaccounts'), \"Not Applicable\",\n    (type == 'microsoft.dbformysql/servers'), tostring(properties.storageProfile.storageAutogrow),\n    (type == 'microsoft.dbformysql/flexibleservers'), \"Not Applicable\",\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains \"storageaccounts\"), \"Not Applicable\",\n    (type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), \"Not Applicable\",\n    (type == \"microsoft.network/loadbalancers\"), \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend ReplicationRole = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.documentdb/databaseaccounts'), \"Not Applicable\",\n\t(type == 'microsoft.sql/servers/databases' and sku.tier <> 'DataWarehouse'), iif(isnotempty(properties.secondaryType), \"replica\", \"master\"),\n\t(type == 'microsoft.sql/servers/databases' and sku.tier == 'DataWarehouse'), \"Not Applicable\",\n    (type == 'microsoft.dbformysql/servers'), tostring(properties.replicationRole),\n    (type == 'microsoft.dbformysql/flexibleservers'), iif(properties.haEnabled == \"Enabled\", 'Not Applicable', tostring(properties.replicationRole)),\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains \"storageaccounts\"), tostring(split(skuName, '_', 1)[0]),\n    (type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), \"Not Applicable\",\n    (type == \"microsoft.network/loadbalancers\"), \"Not Applicable\",\n    (type == \"microsoft.recoveryservices/vaults\"), \"Not Applicable\",\n    \"Undefined\"\n    )\n| project \n    Type = tolower(type),\n    SkuName = tolower(skuName),\n    Kind = tolower(kind),\n    SubscriptionId = subscriptionId,\n    Name = tolower(name),\n    State = tolower(state),\n    Location = tolower(location),\n    ResourceGroup = resourceGroup,\n    Zones = tolower(tostring(zones)),\n    AvailabilityZone = tolower(avZones),\n    AvailabilitySet = tolower(avSets),\n    Capacity = tolower(Capacity),\n    FaultDomain = tolower(FaultDomain),\n    OSDisk = tolower(OSDisk),\n    ReadReplica = tolower(ReadReplica), \n    AutomaticFailover = tolower(AutomaticFailover),\n    MultipleWriteLocations = tolower(MultipleWriteLocations),\n    StorageAutogrow = tolower(StorageAutogrow),\n    ReplicationRole = tolower(ReplicationRole),\n    Criticality = criticality,\n    Environment = environment,\n    ResourceId = tolower(tostring(id)),\n    properties\n| join kind = leftouter (\n    securityresources\n    | where properties.displayName contains \"Azure Backup should\"\n    | extend Backup = tostring(properties.status.code)\n    | project ResourceId = tolower(tostring(properties.resourceDetails.Id)), Backup\n    )\n    on ResourceId\n| extend Backup = case(\n    Backup == \"Healthy\" or Backup == \"Unhealthy\", Backup,\n    \"Unknown\")\n| extend Backup = case(\n    (Type == 'microsoft.compute/virtualmachines') and (Backup == \"Healthy\" or Backup == \"Unhealthy\"), Backup, \n    (Type == \"microsoft.compute/virtualmachinescalesets\"), \"Not Applicable\", \n    (Type == \"microsoft.containerservice/managedclusters\"), \"Not Applicable\",\n    (Type == 'microsoft.sql/servers/databases'), \"Not Applicable\", \n    (Type == 'microsoft.documentdb/databaseaccounts'), iif(properties.backupPolicy.periodicModeProperties.backupStorageRedundancy == \"Geo\", \"Healthy\", \"Unhealthy\"),\n    (Type == 'microsoft.dbformysql/servers'), iif(properties.storageProfile.geoRedundantBackup == \"Enabled\", \"Healthy\", \"Unhealthy\"),\n    (Type contains \"storageaccounts\"), \"Not Applicable\",\n    (Type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (Type == \"microsoft.recoveryservices/vaults\"), \"Not Applicable\",\n    \"Unknown\"\n    )\n| extend AvailabilitySet = case(\n    AvailabilitySet == '-', 'None',\n    isnotempty(AvailabilitySet), AvailabilitySet,\n    \"Unknown\")\n| project Type, SkuName, Kind, SubscriptionId, Name, State, Location, ResourceGroup, Zones, AvailabilityZone, AvailabilitySet, Capacity, FaultDomain, OSDisk, ReadReplica, AutomaticFailover, MultipleWriteLocations, StorageAutogrow, ReplicationRole, Backup = tolower(Backup), Criticality, Environment, ResourceId\n| summarize \n    ResourceTotal=count(ResourceId),\n    OtherSku=dcountif(ResourceId, ((SkuName !contains \"shared\") and (SkuName !contains \"free\") and (SkuName !contains \"basic\") and (SkuName !contains \"develop\"))),\n    DevelopmentSkuCount=dcountif(ResourceId, SkuName contains \"develop\"), \n    SharedSkuCount=dcountif(ResourceId, SkuName contains \"shared\"),\n    FreeSkuCount=dcountif(ResourceId, SkuName contains \"free\"),\n    BasicSkuCount=dcountif(ResourceId, SkuName contains \"basic\"), \n    SqlPremiumOrBusinessCriticalOrDwh=dcountif(ResourceId, Type == 'microsoft.sql/servers/databases' and (SkuName contains \"premium\" or SkuName contains \"businesscritical\" or SkuName contains \"datawarehouse\")), \n    VMDeallocatedStateCount=dcountif(ResourceId, State contains \"vm deallocated\"),\n    NoAvZoneCount=dcountif(ResourceId, (AvailabilityZone contains \"not configured\")),\n    NAAvZoneCount=dcountif(ResourceId, (AvailabilityZone contains \"not applicable\")),\n    AvZoneCount=dcountif(ResourceId, (AvailabilityZone in ('1', '2', '3', 'configured'))),\n    NoAvSetCount=dcountif(ResourceId, (AvailabilitySet contains \"none\") or (AvailabilitySet contains \"not configured\")),\n    NAAvSetCount=dcountif(ResourceId, AvailabilitySet contains \"not applicable\"),\n    AvSetCount=dcountif(ResourceId, (AvailabilitySet !contains \"none\") and (AvailabilitySet !contains \"not applicable\") and (AvailabilitySet !contains \"not configured\")),\n    NACapacityCount=dcountif(ResourceId, (Capacity contains \"not applicable\")),\n    ZeroCapacityCount=dcountif(ResourceId, (Capacity contains \"0\")),\n    Gt1CapacityCount=dcountif(ResourceId, (Capacity !contains \"not applicable\") and (Capacity !contains \"0\") and (Capacity !contains \"1\") and (Capacity !contains \"undefined\")),\n    NAFaultDomainCount=dcountif(ResourceId, (FaultDomain contains \"not applicable\")),\n    ZeroFaultDomainCount=dcountif(ResourceId, (FaultDomain contains \"0\")),\n    Gt0FaultDomainCount=dcountif(ResourceId, (FaultDomain !contains \"not applicable\") and (FaultDomain !contains \"0\") and (FaultDomain !contains \"undefined\")),\n    NAOSDiskCount=dcountif(ResourceId, (OSDisk contains \"not applicable\")),\n    UnknownOSDiskCount=dcountif(ResourceId, (OSDisk contains \"Unknown\")),\n    OtherOSDiskCount=dcountif(ResourceId, (OSDisk !contains \"premium\") and (OSDisk !contains \"ultra\") and (OSDisk !contains \"ephemeral\") and (OSDisk !contains \"not applicable\")),\n    PremorUltOSDiskCount=dcountif(ResourceId, (OSDisk contains \"premium\") or (OSDisk contains \"ultra\") or (OSDisk contains \"ephemeral\")),\n    NABackupCount=dcountif(ResourceId, (Backup contains \"not applicable\")),\n    UnknownBackupCount=dcountif(ResourceId, (Backup contains \"Unknown\")),\n    HealthyBackupCount=dcountif(ResourceId, (Backup == \"healthy\")),\n    UnhealthyBackupCount=dcountif(ResourceId, (Backup == \"unhealthy\")),\n    RunningState=dcountif(ResourceId, State contains \"running\"),\n    DBOnlineStateCount=dcountif(ResourceId, State contains \"online\" or State contains \"ready\"), // online - SQL, Ready - MySQL\n    DBPausedStateCount=dcountif(ResourceId, State contains \"paused\"),\n    DBGeoStorage=dcountif(ResourceId, OSDisk == \"grs\"),\n    DBLrsStorage=dcountif(ResourceId, OSDisk == \"lrs\"),\n    Gt0DbReplica=dcountif(ResourceId, (ReadReplica !contains \"not applicable\") and (ReadReplica !contains \"0\") and (ReadReplica !contains \"undefined\")),\n    Lt1DbReplica=dcountif(ResourceId, ReadReplica contains \"0\"),\n    NotEnabledDbMultiWrite=dcountif(ResourceId, MultipleWriteLocations contains \"not enabled\"),\n    NADbMultiWrite=dcountif(ResourceId, MultipleWriteLocations contains \"not applicable\"),\n    EnabledDbMultiWrite=dcountif(ResourceId, MultipleWriteLocations == \"enabled\"),\n    NotConfiguredAutomaticFailover=dcountif(ResourceId, AutomaticFailover == \"not configured\"),\n    ConfiguredAutomaticFailover=dcountif(ResourceId, AutomaticFailover == \"configured\"),\n    NAAutomaticFailover=dcountif(ResourceId, AutomaticFailover == \"not applicable\"),\n    EnabledStorageAutogrow=dcountif(ResourceId, StorageAutogrow == \"enabled\"),\n    NotEnabledStorageAutogrow=dcountif(ResourceId, StorageAutogrow != \"enabled\" and Type != \"microsoft.dbformysql/flexibleservers\"),\n    ReplicationEnabled=dcountif(ResourceId, ReplicationRole == \"master\" or ReplicationRole == \"replica\"),\n    NAReplicationEnabled=dcountif(ResourceId, ReplicationRole == \"none\" and AvailabilityZone != \"enabled\" and Type == \"microsoft.dbformysql/flexibleservers\"),\n    NoReplicationEnabled=dcountif(ResourceId, ReplicationRole == \"none\" and AvailabilityZone != \"enabled\"),\n    RAStorageEnabled=dcountif(ResourceId, ReplicationRole startswith \"ra\" and Type contains 'storageaccounts'),\n    NoRAStorageEnabled=dcountif(ResourceId, ReplicationRole !startswith \"ra\" and Type contains 'storageaccounts'),\n    V2StorageEnabled=dcountif(ResourceId, Kind == \"StorageV2\" and Type contains 'storageaccounts'),\n    NoV2StorageEnabled=dcountif(ResourceId, Kind != \"StorageV2\" and Type contains 'storageaccounts'),\n    AFDEnabledStateCount=dcountif(ResourceId, State == \"enabled\" and Type == 'microsoft.network/frontdoors'),\n    NoAFDEnabledStateCount=dcountif(ResourceId, State != \"enabled\" and Type == 'microsoft.network/frontdoors'),\n    SmallAppGwSkuCount=dcountif(ResourceId, SkuName contains \"small\" and Type == 'microsoft.network/applicationgateways'), \n    OtherAppGwSkuCount=dcountif(ResourceId, SkuName !contains \"small\" and Type == 'microsoft.network/applicationgateways'),\n    AutoScaleAppGwCount=dcountif(ResourceId, AutomaticFailover == \"configured\" and Type == 'microsoft.network/applicationgateways'),\n    NoAutoScaleAppGwCount=dcountif(ResourceId, AutomaticFailover == \"not configured\" and Type == 'microsoft.network/applicationgateways'),\n    AsrSucceededState=dcountif(ResourceId, State == \"succeeded\" and Type == 'microsoft.recoveryservices/vaults'),\n    NoAsrSucceededState=dcountif(ResourceId, State != \"succeeded\" and Type == 'microsoft.recoveryservices/vaults')\n    by Type, Environment, Criticality\n| extend ReliabilityScore = case(\n    // VM - 4 checks // score = (\"AZ + AS + Disk + Backup\") * 100 / (3 * ResourceTotal) // AZ or AS is mutually exclusive, so VM should have either one\n    Type == 'microsoft.compute/virtualmachines', (AvZoneCount + AvSetCount + PremorUltOSDiskCount + HealthyBackupCount) * 100 / (3 * ResourceTotal), \n    // VMSS - 3 checks  // score = (Capacity + Fault Domains + managed disk type) * 100 / (3 * ResourceTotal) //********* Future - Overprovision, Fault Domain State\n    Type == 'microsoft.compute/virtualmachinescalesets', (Gt1CapacityCount + Gt0FaultDomainCount + PremorUltOSDiskCount) * 100 / (3 * ResourceTotal),\n    // AppService & Function App - 2 checks // score = (\"non dev/shared/free/ basic sku\" + AppServiceRunningState) * 100 / (2 * ResourceTotal)\n    Type == 'microsoft.web/sites', (OtherSku + RunningState) * 100 / (2 * ResourceTotal),\n    // AKS - 4 checks // score = (\"AZ\" + \"AS\" + \"Capacity\" + \"Disk\") * 100 / (4 * ResourceTotal)  //********* Future - LB SKU\n    Type == 'microsoft.containerservice/managedclusters', (AvZoneCount + AvSetCount + Gt1CapacityCount + PremorUltOSDiskCount) * 100 / (4 * ResourceTotal),\n    // SQLDB - 4 checks  // score = (\"status\" + \"tier\" + \"storage acct. type\"  + \"AZ\")* 100 / (5 * ResourceTotal)  //********* Future - \"read replica count\"\n    Type == 'microsoft.sql/servers/databases', (DBOnlineStateCount + SqlPremiumOrBusinessCriticalOrDwh + DBGeoStorage + AvZoneCount + NAAvZoneCount) * 100 / (4 * ResourceTotal),\n    // CosmosDB - 4 checks // score = ( \"readreplicacount\" + \"AZ\" + \"multiWrite\" + \"AutoFailover\") * 100 / (4 * ResourceTotal) // included NA items to show compliance\n    Type == 'microsoft.documentdb/databaseaccounts', (Gt0DbReplica + AvZoneCount + NAAvZoneCount + EnabledDbMultiWrite + NADbMultiWrite + ConfiguredAutomaticFailover + NAAutomaticFailover) * 100 / (4 * ResourceTotal),\n    // MySQL - 5 checks // score = (\"status\" + \"sku\" + \"grsbackup\" + \"storageautogrow\" + \"replication\") * 100 / (5 * ResourceTotal) //********* Future - \"Sku family Gen5\", read replica\n    Type == 'microsoft.dbformysql/servers', (DBOnlineStateCount + OtherSku + HealthyBackupCount + EnabledStorageAutogrow + ReplicationEnabled) * 100 / (5 * ResourceTotal),\n    // MySQL Flexible - 4 checks  // score = (\"status\" + \"sku\"  + \"replication\" + \"HaEnabled\") * 100 / (4 * ResourceTotal)    // included NA items to show compliance  //********* Future - \"read replica\", \"automatic failover\", \"backup\"\n    Type == 'microsoft.dbformysql/flexibleservers', (DBOnlineStateCount + OtherSku + ReplicationEnabled + NAReplicationEnabled + AvZoneCount + NAAvZoneCount) * 100 / (4 * ResourceTotal),\n    // APIM - 2 checks // score = (\"Tier\" + \"capacity\") * 100 / (2 * ResourceTotal) \n    Type == 'microsoft.apimanagement/service', (OtherSku + Gt1CapacityCount) * 100 / (2 * ResourceTotal),\n    // Storage - 2 checks // score = ( \"kind\" + \"replication type\") * 100 / (2 * ResourceTotal)    //********* Future - \"access tier hot\"\n    Type == 'microsoft.storage/storageaccounts' or Type == 'microsoft.classicstorage/storageaccounts', (V2StorageEnabled + RAStorageEnabled) * 100 / (2 * ResourceTotal),\n    // AzureFirewall - 1 check // score = (AZ) * 100 / (1 * ResourceTotal)\n    Type == 'microsoft.network/azurefirewalls', (AvZoneCount + NAAvZoneCount)* 100 / ResourceTotal,\n    // AFD - 1 check // score = state  * 100 / (1 * ResourceTotal)\n    Type == 'microsoft.network/frontdoors', AFDEnabledStateCount * 100 / ResourceTotal,\n    // AppGW - 5 checks    // score = (state + AZ + Tier + autoscaling + capacity) * 100 / (5 * ResourceTotal)\n    Type == 'microsoft.network/applicationgateways', (RunningState + AvZoneCount + NAAvZoneCount + OtherAppGwSkuCount + AutoScaleAppGwCount + Gt1CapacityCount) * 100 / (5 * ResourceTotal),\n    // LB - 2 checks  // score = (SKU + AZ) * 100 / (2 * ResourceTotal)\n    Type == 'microsoft.network/loadbalancers', (OtherSku + AvZoneCount + NAAvZoneCount) * 100 / (2 * ResourceTotal),\n    // ASR - 1 check  // score = status * 100 / (1 * ResourceTotal)\n    Type == 'microsoft.recoveryservices/vaults', (AsrSucceededState) * 100 / (1 * ResourceTotal),\n    0)\n    | project Type, Environment, Criticality, ResourceTotal, score=toint(ReliabilityScore)\n    | summarize WorkbookScore=round(avg(score),1) | project WorkbookScore",
                          "size": 3,
                          "title": "Reliability Score",
                          "exportToExcelOptions": "all",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "gridSettings": {
                            "rowLimit": 10000,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Type"
                              ],
                              "expandTopLevel": false
                            }
                          },
                          "sortBy": [],
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "WorkbookScore",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "redGreen"
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal"
                                },
                                "emptyValCustomText": "-"
                              }
                            },
                            "showBorder": false
                          },
                          "textSettings": {
                            "style": "bignumber"
                          }
                        },
                        "customWidth": "25",
                        "name": "kql_summary_workbook_reliability_score"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "💡 \r\n_The Reliability Score given in this workbook represents an indication of the number of configurable reliability options that have been implemented. For instance Availability Zones, Availability Set, Sku, Backup, Site Recovery, etc._\r\n\r\n_The Reliability Score does not include a number for the 'default' reliability for any given resource type. For instance, the current lowest default SLA for any Single Instance Virtual Machine using Standard HDD Managed Disks for Operating System Disks and Data Disks, have an SLA of at least 95%._ \r\n\r\n_The Reliability Score in this workbook will be 0% for such a Virtual Machine. The intention of the workbook is to provide visibility of the configurable options that can increase reliability._\r\n<br />"
                        },
                        "customWidth": "75",
                        "name": "text - 1",
                        "styleSettings": {
                          "margin": "65"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\n| where resourceGroup in ({ResourceGroup})\n| extend criticality = case(tags.Criticality <> \"\", tags.Criticality,\n    \"Undefined\")\n| extend environment = case(\n    tags.Environment <> \"\", tags.Environment,\n    tags.environment <> \"\", tags.environment,\n    tags.Env <> \"\", tags.Env,\n    tags.env <> \"\", tags.env,\n    tolower(name) contains \"prod\", \"Production\",\n    tolower(name) contains \"dev\", \"Development\",\n    tolower(name) contains \"qa\", \"QA\",\n    tolower(name) contains \"uat\", \"UAT\",\n    tolower(name) contains \"sit\", \"SIT\",\n    tolower(name) contains \"test\", \"Test\",\n    \"Undefined\")\n| where criticality in ({Criticality})\n| where environment in ({Environment})\n| where \n    (type == 'microsoft.compute/virtualmachines') or \n    (type == \"microsoft.compute/virtualmachinescalesets\" and tags.aksEngineVersion !contains \"aks-gomod\") or\n    (type == 'microsoft.web/sites') or \n    (type == \"microsoft.containerservice/managedclusters\") or \n    (type == 'microsoft.sql/servers/databases') or \n    (type == 'microsoft.documentdb/databaseaccounts') or \n    (type == 'microsoft.dbformysql/servers') or \n    (type == 'microsoft.dbformysql/flexibleservers') or \n    (type == \"microsoft.apimanagement/service\") or \n    (type == \"microsoft.storage/storageaccounts\" or type == \"microsoft.classicstorage/storageaccounts\") or \n    (type == \"microsoft.network/azurefirewalls\") or \n    (type == \"microsoft.network/frontdoors\") or \n    (type == \"microsoft.network/applicationgateways\") or \n    (type == \"microsoft.network/loadbalancers\") or \n    (type == \"microsoft.recoveryservices/vaults\")\n| extend aksname = case(\n    type == \"microsoft.containerservice/managedclusters\", tolower(tostring(name)),\n    \"Undefined\"\n    )\n| join kind = leftouter (\n    resources \n    | where type == \"microsoft.compute/virtualmachinescalesets\"\n    | extend aksname = tolower(tostring(split(resourceGroup, \"_\")[2]))\n    | extend AvZones = coalesce(tostring(array_length(parse_json(zones))), 'Not Configured'), AvSets = \"Scale Sets\"\n    )\n    on aksname\n| extend state = case(\n    type == 'microsoft.compute/virtualmachines', tostring(properties.extended.instanceView.powerState.displayStatus),\n    type == 'microsoft.compute/virtualmachinescalesets', tostring(properties.provisioningState),\n    type == 'microsoft.web/sites', tostring(properties.state),\n    type == 'microsoft.containerservice/managedclusters', tostring(properties.provisioningState),\n    type == 'microsoft.sql/servers/databases', tostring(properties.status),\n    type == 'microsoft.documentdb/databaseaccounts', tostring(properties.provisioningState),\n    type == 'microsoft.dbformysql/servers', tostring(properties.userVisibleState),\n    type == 'microsoft.dbformysql/flexibleservers', tostring(properties.state),\n    type == \"microsoft.apimanagement/service\", tostring(properties.provisioningState),\n    type contains \"storageaccounts\", tostring(properties.provisioningState),\n    type == \"microsoft.network/azurefirewalls\", tostring(properties.provisioningState),\n    type == \"microsoft.network/frontdoors\", tostring(properties.resourceState),\n    type == \"microsoft.network/applicationgateways\", tostring(properties.operationalState),\n    type == \"microsoft.network/loadbalancers\", tostring(properties.provisioningState),\n    type == \"microsoft.recoveryservices/vaults\", tostring(properties.provisioningState),\n    \"Undefined\"\n    )\n| extend skuName = case(\n    type == 'microsoft.compute/virtualmachines', tostring(properties.hardwareProfile.vmSize),\n    type == 'microsoft.compute/virtualmachinescalesets', tostring(sku.name),\n    type == 'microsoft.web/sites', tostring(properties.sku),\n    type == 'microsoft.containerservice/managedclusters', tostring(properties.agentPoolProfiles[0].vmSize),\n    type == 'microsoft.sql/servers/databases', tostring(sku.tier),\n    type == 'microsoft.documentdb/databaseaccounts', tostring(properties.databaseAccountOfferType),\n    type == 'microsoft.dbformysql/servers', tostring(sku.tier),\n    type == 'microsoft.dbformysql/flexibleservers', tostring(sku.tier),\n    type == \"microsoft.apimanagement/service\", tostring(sku.name),\n    type contains 'storageaccounts', tostring(replace('-', '_', tostring(iff(type =~ \"microsoft.storage/storageaccounts\", sku.name, properties.accountType)))),\n    type == \"microsoft.network/azurefirewalls\", tostring(properties.sku.name),\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", tostring(properties.sku.name),\n    type == \"microsoft.network/loadbalancers\", tostring(sku.name),\n    type == \"microsoft.recoveryservices/vaults\", tostring(iif(isnotnull(sku.tier), sku.tier, sku.name)),\n    \"Undefined\"\n    )\n| extend avZones = case(\n    location !in~ ('brazilsouth', 'canadacentral', 'centralus', 'eastus', 'eastus2', 'southcentralus', 'usgovvirginia', 'westus2', 'westus3', 'francecentral', 'germanywestcentral', 'northeurope', 'norwayeast', 'uksouth', 'westeurope', 'swedencentral', 'southafricanorth', 'australiaeast', 'centralindia', 'japaneast', 'koreacentral', 'southeastasia', 'eastasia'), 'Not Applicable',\n    (type == 'microsoft.compute/virtualmachines'), coalesce(tostring(zones[0]), 'Not Configured'),\n    (type == 'microsoft.compute/virtualmachinescalesets'), coalesce(tostring(array_length(parse_json(zones))), 'Not Configured'),\n    (type == 'microsoft.containerservice/managedclusters' and AvZones <> \"\"), AvZones,\n    (type == 'microsoft.containerservice/managedclusters' and isempty(AvZones)), \"Not Configured\",\n    (type == 'microsoft.web/sites'), \"Not Applicable\",\n    (type == 'microsoft.sql/servers/databases' and sku.tier <> 'DataWarehouse'), iif(isempty(properties.zoneRedundant) or properties.zoneRedundant == \"false\", 'Not Configured', 'Configured'),\n    (type == 'microsoft.sql/servers/databases' and sku.tier == 'DataWarehouse'), \"Not Applicable\",\n    (type == 'microsoft.documentdb/databaseaccounts'), iif(properties.locations[0].isZoneRedundant == \"false\", 'Not Configured', 'Configured'), \n    (type == 'microsoft.dbformysql/servers'), \"Not Applicable\",\n    (type == 'microsoft.dbformysql/flexibleservers'), iif(properties.haEnabled == \"Enabled\", 'Configured', 'Not Configured'),\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains 'storageaccounts'), case(split(skuName, '_', 1)[0] =~ \"zrs\", \"Configured\", \"Not Configured\"),\n    (type == \"microsoft.network/azurefirewalls\"), iif(isnotnull(zones), \"Configured\", \"Not Configured\"),\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), iif(isnotnull(zones), \"Configured\", \"Not Configured\"),\n    (type == \"microsoft.network/loadbalancers\"), case( \n        skuName =~ \"Basic\", \"Not Applicable\",\n        skuName =~ \"Standard\" and isnotnull(zones), \"Configured\",\n        \"Not Configured\"\n    ),\n    (type == \"microsoft.recoveryservices/vaults\"), \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend avSets = case(\n    type == 'microsoft.compute/virtualmachines' and avZones in ('1', '2', '3'), \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachines', (coalesce(extract('/availabilitySets/(.*)', 1, tostring(properties.availabilitySet.id)), 'Not Configured')),\n    type == 'microsoft.compute/virtualmachinescalesets' and avZones in ('1', '2', '3'), \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachinescalesets', 'A regional (non-zonal) scale set uses placement groups, which act as an implicit availability set with five fault domains and five update domains.',\n    type == 'microsoft.web/sites', 'Not Applicable',\n    type == 'microsoft.containerservice/managedclusters', case(\n        AvSets == 'Scale Sets' and avZones in ('1', '2', '3'), \"Not Applicable\",\n        AvSets == 'Scale Sets', \"A regional (non-zonal) scale set uses placement groups, which act as an implicit availability set with five fault domains and five update domains.\",\n        \"Scale Sets Not Configured\"\n    ),\n    type == 'microsoft.sql/servers/databases', 'Not Applicable',\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', \"Not Applicable\",\n    type == 'microsoft.dbformysql/flexibleservers', \"Not Applicable\",\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", \"Not Applicable\",\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend Capacity = case(\n    type == 'microsoft.compute/virtualmachines', \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachinescalesets', tostring(sku.capacity),\n    type == 'microsoft.web/sites', \"Not Applicable\",\n    type == 'microsoft.containerservice/managedclusters', iif(isnotempty(sku1.capacity), tostring(sku1.capacity), \"0\"), // AKS with or without VMSS\n    type == 'microsoft.sql/servers/databases', tostring(sku.capacity),\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', tostring(sku.capacity),\n    type == 'microsoft.dbformysql/flexibleservers', tostring(sku.capacity),\n    type == \"microsoft.apimanagement/service\", tostring(sku.capacity),\n    type contains \"storageaccounts\", \"Not Applicable\", \n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", tostring(iif(isnotempty(properties.autoscaleConfiguration), properties.autoscaleConfiguration.minCapacity, properties.sku.capacity)),\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend FaultDomain = case(\n    type == 'microsoft.compute/virtualmachines', \"Not Applicable\",\n    type == 'microsoft.compute/virtualmachinescalesets', iif(isnotempty(properties.platformFaultDomainCount), properties.platformFaultDomainCount, \"0\"),  // 1 - AZ, 5 - Regional VMSS\n    type == 'microsoft.web/sites', \"Not Applicable\",\n    type == 'microsoft.containerservice/managedclusters', iif(isnotempty(properties1.platformFaultDomainCount), properties1.platformFaultDomainCount, \"0\"),\n    type == 'microsoft.sql/servers/databases', \"Not Applicable\",\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', 'Not Applicable',\n    type == 'microsoft.dbformysql/flexibleservers', 'Not Applicable',\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", \"Not Applicable\",\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend osDisk = case(\n    type == 'microsoft.compute/virtualmachines', iif(properties.storageProfile.osDisk.diffDiskSettings.option == \"Local\", \"Ephemeral\",  properties.storageProfile.osDisk.managedDisk.storageAccountType),\n    type == 'microsoft.compute/virtualmachinescalesets', iif(properties.virtualMachineProfile.storageProfile.osDisk.diffDiskSettings.option == \"Local\", \"Ephemeral\",  properties.virtualMachineProfile.storageProfile.osDisk.managedDisk.storageAccountType),\n    type == 'microsoft.web/sites', 'Not Applicable',\n    type == 'microsoft.containerservice/managedclusters', iff(properties.agentPoolProfiles[0].osDiskType == 'Ephemeral', 'Ephemeral', properties1.virtualMachineProfile.storageProfile.osDisk.managedDisk.storageAccountType),\n    type == 'microsoft.sql/servers/databases', properties.storageAccountType,\n    type == 'microsoft.documentdb/databaseaccounts', 'Not Applicable',\n    type == 'microsoft.dbformysql/servers', 'Not Applicable',\n    type == 'microsoft.dbformysql/flexibleservers', 'Not Applicable',\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", tostring(split(skuName, '_', 0)[0]),\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    'Not Applicable'\n    )\n| extend OSDisk = case(\n    isnotempty(osDisk), osDisk,\n    isempty(osDisk) and (type == 'microsoft.compute/virtualmachines') and state <> 'VM running', 'Unknown, start VM to get disk information.',\n    isempty(osDisk) and (type == 'microsoft.compute/virtualmachines') and isnotempty(properties.storageProfile.osDisk.vhd.uri), 'Unmanaged',\n    \"Unknown\")\n| extend ReadReplica = case (\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters'), \"Not Applicable\",\n    (type == 'microsoft.sql/servers/databases' and sku.tier <> 'DataWarehouse'), tostring(properties.readReplicaCount), // SQL DB\n    (type == 'microsoft.sql/servers/databases' and sku.tier == 'DataWarehouse'), \"Not Applicable\", // Synapse\n    type == 'microsoft.documentdb/databaseaccounts', tostring(array_length(parse_json(properties.readLocations))),\n    type == 'microsoft.dbformysql/servers', \"Not Applicable\",\n    type == 'microsoft.dbformysql/flexibleservers', \"Not Applicable\",\n    type == \"microsoft.apimanagement/service\", tostring(properties.additionalLocations),\n    type contains \"storageaccounts\", case(split(skuName, '_', 1)[0] =~ \"ragrs\", \"Configured\", \"Not Configured\"),\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", \"Not Applicable\",\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend AutomaticFailover = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.sql/servers/databases'), \"Not Applicable\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableAutomaticFailover == \"false\" and properties.enableMultipleWriteLocations == \"false\" and toint(ReadReplica) > 1), \"Not Configured\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableAutomaticFailover == \"true\"), \"Configured\",\n    (type == 'microsoft.documentdb/databaseaccounts'), \"Not Applicable\",\n    type == 'microsoft.dbformysql/servers', \"Not Applicable\",\n    type == 'microsoft.dbformysql/flexibleservers', case(properties.haEnabled == \"Enabled\", \"Configured\", \"Not Applicable\"),\n    type == \"microsoft.apimanagement/service\", \"Not Applicable\",\n    type contains \"storageaccounts\", \"Not Applicable\",\n    type == \"microsoft.network/azurefirewalls\", \"Not Applicable\",\n    type == \"microsoft.network/frontdoors\", \"Not Applicable\",\n    type == \"microsoft.network/applicationgateways\", iif(isnotempty(properties.autoscaleConfiguration), \"Configured\", \"Not Configured\"),\n    type == \"microsoft.network/loadbalancers\", \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend MultipleWriteLocations = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.sql/servers/databases', 'microsoft.dbformysql/servers', 'microsoft.dbformysql/flexibleservers'), \"Not Applicable\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableMultipleWriteLocations == \"false\"), \"Not Enabled\",\n    (type == 'microsoft.documentdb/databaseaccounts' and properties.enableMultipleWriteLocations == \"true\"), \"Enabled\",\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains \"storageaccounts\"), \"Not Applicable\",\n    (type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), \"Not Applicable\",\n    (type == \"microsoft.network/loadbalancers\"), \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend StorageAutogrow = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.sql/servers/databases', 'microsoft.documentdb/databaseaccounts'), \"Not Applicable\",\n    (type == 'microsoft.dbformysql/servers'), tostring(properties.storageProfile.storageAutogrow),\n    (type == 'microsoft.dbformysql/flexibleservers'), \"Not Applicable\",\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains \"storageaccounts\"), \"Not Applicable\",\n    (type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), \"Not Applicable\",\n    (type == \"microsoft.network/loadbalancers\"), \"Not Applicable\",\n    type == \"microsoft.recoveryservices/vaults\", \"Not Applicable\",\n    \"Undefined\"\n    )\n| extend ReplicationRole = case(\n    type in ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.web/sites', 'microsoft.containerservice/managedclusters', 'microsoft.documentdb/databaseaccounts'), \"Not Applicable\",\n\t(type == 'microsoft.sql/servers/databases' and sku.tier <> 'DataWarehouse'), iif(isnotempty(properties.secondaryType), \"replica\", \"master\"),\n\t(type == 'microsoft.sql/servers/databases' and sku.tier == 'DataWarehouse'), \"Not Applicable\",\n    (type == 'microsoft.dbformysql/servers'), tostring(properties.replicationRole),\n    (type == 'microsoft.dbformysql/flexibleservers'), iif(properties.haEnabled == \"Enabled\", 'Not Applicable', tostring(properties.replicationRole)),\n    (type == \"microsoft.apimanagement/service\"), \"Not Applicable\",\n    (type contains \"storageaccounts\"), tostring(split(skuName, '_', 1)[0]),\n    (type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (type == \"microsoft.network/frontdoors\"), \"Not Applicable\",\n    (type == \"microsoft.network/applicationgateways\"), \"Not Applicable\",\n    (type == \"microsoft.network/loadbalancers\"), \"Not Applicable\",\n    (type == \"microsoft.recoveryservices/vaults\"), \"Not Applicable\",\n    \"Undefined\"\n    )\n| project \n    Type = tolower(type),\n    SkuName = tolower(skuName),\n    Kind = tolower(kind),\n    SubscriptionId = subscriptionId,\n    Name = tolower(name),\n    State = tolower(state),\n    Location = tolower(location),\n    ResourceGroup = resourceGroup,\n    Zones = tolower(tostring(zones)),\n    AvailabilityZone = tolower(avZones),\n    AvailabilitySet = tolower(avSets),\n    Capacity = tolower(Capacity),\n    FaultDomain = tolower(FaultDomain),\n    OSDisk = tolower(OSDisk),\n    ReadReplica = tolower(ReadReplica), \n    AutomaticFailover = tolower(AutomaticFailover),\n    MultipleWriteLocations = tolower(MultipleWriteLocations),\n    StorageAutogrow = tolower(StorageAutogrow),\n    ReplicationRole = tolower(ReplicationRole),\n    Criticality = criticality,\n    Environment = environment,\n    ResourceId = tolower(tostring(id)),\n    properties\n| join kind = leftouter (\n    securityresources\n    | where properties.displayName contains \"Azure Backup should\"\n    | extend Backup = tostring(properties.status.code)\n    | project ResourceId = tolower(tostring(properties.resourceDetails.Id)), Backup\n    )\n    on ResourceId\n| extend Backup = case(\n    Backup == \"Healthy\" or Backup == \"Unhealthy\", Backup,\n    \"Unknown\")\n| extend Backup = case(\n    (Type == 'microsoft.compute/virtualmachines') and (Backup == \"Healthy\" or Backup == \"Unhealthy\"), Backup, \n    (Type == \"microsoft.compute/virtualmachinescalesets\"), \"Not Applicable\", \n    (Type == \"microsoft.containerservice/managedclusters\"), \"Not Applicable\",\n    (Type == 'microsoft.sql/servers/databases'), \"Not Applicable\", \n    (Type == 'microsoft.documentdb/databaseaccounts'), iif(properties.backupPolicy.periodicModeProperties.backupStorageRedundancy == \"Geo\", \"Healthy\", \"Unhealthy\"),\n    (Type == 'microsoft.dbformysql/servers'), iif(properties.storageProfile.geoRedundantBackup == \"Enabled\", \"Healthy\", \"Unhealthy\"),\n    (Type contains \"storageaccounts\"), \"Not Applicable\",\n    (Type == \"microsoft.network/azurefirewalls\"), \"Not Applicable\",\n    (Type == \"microsoft.recoveryservices/vaults\"), \"Not Applicable\",\n    \"Unknown\"\n    )\n| extend AvailabilitySet = case(\n    AvailabilitySet == '-', 'None',\n    isnotempty(AvailabilitySet), AvailabilitySet,\n    \"Unknown\")\n| project Type, SkuName, Kind, SubscriptionId, Name, State, Location, ResourceGroup, Zones, AvailabilityZone, AvailabilitySet, Capacity, FaultDomain, OSDisk, ReadReplica, AutomaticFailover, MultipleWriteLocations, StorageAutogrow, ReplicationRole, Backup = tolower(Backup), Criticality, Environment, ResourceId\n| summarize \n    ResourceTotal=count(ResourceId),\n    OtherSku=dcountif(ResourceId, ((SkuName !contains \"shared\") and (SkuName !contains \"free\") and (SkuName !contains \"basic\") and (SkuName !contains \"develop\"))),\n    DevelopmentSkuCount=dcountif(ResourceId, SkuName contains \"develop\"), \n    SharedSkuCount=dcountif(ResourceId, SkuName contains \"shared\"),\n    FreeSkuCount=dcountif(ResourceId, SkuName contains \"free\"),\n    BasicSkuCount=dcountif(ResourceId, SkuName contains \"basic\"), \n    SqlPremiumOrBusinessCriticalOrDwh=dcountif(ResourceId, Type == 'microsoft.sql/servers/databases' and (SkuName contains \"premium\" or SkuName contains \"businesscritical\" or SkuName contains \"datawarehouse\")), \n    VMDeallocatedStateCount=dcountif(ResourceId, State contains \"vm deallocated\"),\n    NoAvZoneCount=dcountif(ResourceId, (AvailabilityZone contains \"not configured\")),\n    NAAvZoneCount=dcountif(ResourceId, (AvailabilityZone contains \"not applicable\")),\n    AvZoneCount=dcountif(ResourceId, (AvailabilityZone in ('1', '2', '3', 'configured'))),\n    NoAvSetCount=dcountif(ResourceId, (AvailabilitySet contains \"none\") or (AvailabilitySet contains \"not configured\")),\n    NAAvSetCount=dcountif(ResourceId, AvailabilitySet contains \"not applicable\"),\n    AvSetCount=dcountif(ResourceId, (AvailabilitySet !contains \"none\") and (AvailabilitySet !contains \"not applicable\") and (AvailabilitySet !contains \"not configured\")),\n    NACapacityCount=dcountif(ResourceId, (Capacity contains \"not applicable\")),\n    ZeroCapacityCount=dcountif(ResourceId, (Capacity contains \"0\")),\n    Gt1CapacityCount=dcountif(ResourceId, (Capacity !contains \"not applicable\") and (Capacity !contains \"0\") and (Capacity !contains \"1\") and (Capacity !contains \"undefined\")),\n    NAFaultDomainCount=dcountif(ResourceId, (FaultDomain contains \"not applicable\")),\n    ZeroFaultDomainCount=dcountif(ResourceId, (FaultDomain contains \"0\")),\n    Gt0FaultDomainCount=dcountif(ResourceId, (FaultDomain !contains \"not applicable\") and (FaultDomain !contains \"0\") and (FaultDomain !contains \"undefined\")),\n    NAOSDiskCount=dcountif(ResourceId, (OSDisk contains \"not applicable\")),\n    UnknownOSDiskCount=dcountif(ResourceId, (OSDisk contains \"Unknown\")),\n    OtherOSDiskCount=dcountif(ResourceId, (OSDisk !contains \"premium\") and (OSDisk !contains \"ultra\") and (OSDisk !contains \"ephemeral\") and (OSDisk !contains \"not applicable\")),\n    PremorUltOSDiskCount=dcountif(ResourceId, (OSDisk contains \"premium\") or (OSDisk contains \"ultra\") or (OSDisk contains \"ephemeral\")),\n    NABackupCount=dcountif(ResourceId, (Backup contains \"not applicable\")),\n    UnknownBackupCount=dcountif(ResourceId, (Backup contains \"Unknown\")),\n    HealthyBackupCount=dcountif(ResourceId, (Backup == \"healthy\")),\n    UnhealthyBackupCount=dcountif(ResourceId, (Backup == \"unhealthy\")),\n    RunningState=dcountif(ResourceId, State contains \"running\"),\n    DBOnlineStateCount=dcountif(ResourceId, State contains \"online\" or State contains \"ready\"), // online - SQL, Ready - MySQL\n    DBPausedStateCount=dcountif(ResourceId, State contains \"paused\"),\n    DBGeoStorage=dcountif(ResourceId, OSDisk == \"grs\"),\n    DBLrsStorage=dcountif(ResourceId, OSDisk == \"lrs\"),\n    Gt0DbReplica=dcountif(ResourceId, (ReadReplica !contains \"not applicable\") and (ReadReplica !contains \"0\") and (ReadReplica !contains \"undefined\")),\n    Lt1DbReplica=dcountif(ResourceId, ReadReplica contains \"0\"),\n    NotEnabledDbMultiWrite=dcountif(ResourceId, MultipleWriteLocations contains \"not enabled\"),\n    NADbMultiWrite=dcountif(ResourceId, MultipleWriteLocations contains \"not applicable\"),\n    EnabledDbMultiWrite=dcountif(ResourceId, MultipleWriteLocations == \"enabled\"),\n    NotConfiguredAutomaticFailover=dcountif(ResourceId, AutomaticFailover == \"not configured\"),\n    ConfiguredAutomaticFailover=dcountif(ResourceId, AutomaticFailover == \"configured\"),\n    NAAutomaticFailover=dcountif(ResourceId, AutomaticFailover == \"not applicable\"),\n    EnabledStorageAutogrow=dcountif(ResourceId, StorageAutogrow == \"enabled\"),\n    NotEnabledStorageAutogrow=dcountif(ResourceId, StorageAutogrow != \"enabled\" and Type != \"microsoft.dbformysql/flexibleservers\"),\n    ReplicationEnabled=dcountif(ResourceId, ReplicationRole == \"master\" or ReplicationRole == \"replica\"),\n    NAReplicationEnabled=dcountif(ResourceId, ReplicationRole == \"none\" and AvailabilityZone != \"enabled\" and Type == \"microsoft.dbformysql/flexibleservers\"),\n    NoReplicationEnabled=dcountif(ResourceId, ReplicationRole == \"none\" and AvailabilityZone != \"enabled\"),\n    RAStorageEnabled=dcountif(ResourceId, ReplicationRole startswith \"ra\" and Type contains 'storageaccounts'),\n    NoRAStorageEnabled=dcountif(ResourceId, ReplicationRole !startswith \"ra\" and Type contains 'storageaccounts'),\n    V2StorageEnabled=dcountif(ResourceId, Kind == \"StorageV2\" and Type contains 'storageaccounts'),\n    NoV2StorageEnabled=dcountif(ResourceId, Kind != \"StorageV2\" and Type contains 'storageaccounts'),\n    AFDEnabledStateCount=dcountif(ResourceId, State == \"enabled\" and Type == 'microsoft.network/frontdoors'),\n    NoAFDEnabledStateCount=dcountif(ResourceId, State != \"enabled\" and Type == 'microsoft.network/frontdoors'),\n    SmallAppGwSkuCount=dcountif(ResourceId, SkuName contains \"small\" and Type == 'microsoft.network/applicationgateways'), \n    OtherAppGwSkuCount=dcountif(ResourceId, SkuName !contains \"small\" and Type == 'microsoft.network/applicationgateways'),\n    AutoScaleAppGwCount=dcountif(ResourceId, AutomaticFailover == \"configured\" and Type == 'microsoft.network/applicationgateways'),\n    NoAutoScaleAppGwCount=dcountif(ResourceId, AutomaticFailover == \"not configured\" and Type == 'microsoft.network/applicationgateways'),\n    AsrSucceededState=dcountif(ResourceId, State == \"succeeded\" and Type == 'microsoft.recoveryservices/vaults'),\n    NoAsrSucceededState=dcountif(ResourceId, State != \"succeeded\" and Type == 'microsoft.recoveryservices/vaults')\n    by Type, Environment, Criticality\n| extend ReliabilityScore = case(\n    // VM - 4 checks // score = (\"AZ + AS + Disk + Backup\") * 100 / (3 * ResourceTotal) // AZ or AS is mutually exclusive, so VM should have either one\n    Type == 'microsoft.compute/virtualmachines', (AvZoneCount + AvSetCount + PremorUltOSDiskCount + HealthyBackupCount) * 100 / (3 * ResourceTotal), \n    // VMSS - 3 checks  // score = (Capacity + Fault Domains + managed disk type) * 100 / (3 * ResourceTotal) //********* Future - Overprovision, Fault Domain State\n    Type == 'microsoft.compute/virtualmachinescalesets', (Gt1CapacityCount + Gt0FaultDomainCount + PremorUltOSDiskCount) * 100 / (3 * ResourceTotal),\n    // AppService & Function App - 2 checks // score = (\"non dev/shared/free/ basic sku\" + AppServiceRunningState) * 100 / (2 * ResourceTotal)\n    Type == 'microsoft.web/sites', (OtherSku + RunningState) * 100 / (2 * ResourceTotal),\n    // AKS - 4 checks // score = (\"AZ\" + \"AS\" + \"Capacity\" + \"Disk\") * 100 / (4 * ResourceTotal)  //********* Future - LB SKU\n    Type == 'microsoft.containerservice/managedclusters', (AvZoneCount + AvSetCount + Gt1CapacityCount + PremorUltOSDiskCount) * 100 / (4 * ResourceTotal),\n    // SQLDB - 4 checks  // score = (\"status\" + \"tier\" + \"storage acct. type\"  + \"AZ\")* 100 / (5 * ResourceTotal)  //********* Future - \"read replica count\"\n    Type == 'microsoft.sql/servers/databases', (DBOnlineStateCount + SqlPremiumOrBusinessCriticalOrDwh + DBGeoStorage + AvZoneCount + NAAvZoneCount) * 100 / (4 * ResourceTotal),\n    // CosmosDB - 4 checks // score = ( \"readreplicacount\" + \"AZ\" + \"multiWrite\" + \"AutoFailover\") * 100 / (4 * ResourceTotal) // included NA items to show compliance\n    Type == 'microsoft.documentdb/databaseaccounts', (Gt0DbReplica + AvZoneCount + NAAvZoneCount + EnabledDbMultiWrite + NADbMultiWrite + ConfiguredAutomaticFailover + NAAutomaticFailover) * 100 / (4 * ResourceTotal),\n    // MySQL - 5 checks // score = (\"status\" + \"sku\" + \"grsbackup\" + \"storageautogrow\" + \"replication\") * 100 / (5 * ResourceTotal) //********* Future - \"Sku family Gen5\", read replica\n    Type == 'microsoft.dbformysql/servers', (DBOnlineStateCount + OtherSku + HealthyBackupCount + EnabledStorageAutogrow + ReplicationEnabled) * 100 / (5 * ResourceTotal),\n    // MySQL Flexible - 4 checks  // score = (\"status\" + \"sku\"  + \"replication\" + \"HaEnabled\") * 100 / (4 * ResourceTotal)    // included NA items to show compliance  //********* Future - \"read replica\", \"automatic failover\", \"backup\"\n    Type == 'microsoft.dbformysql/flexibleservers', (DBOnlineStateCount + OtherSku + ReplicationEnabled + NAReplicationEnabled + AvZoneCount + NAAvZoneCount) * 100 / (4 * ResourceTotal),\n    // APIM - 2 checks // score = (\"Tier\" + \"capacity\") * 100 / (2 * ResourceTotal) \n    Type == 'microsoft.apimanagement/service', (OtherSku + Gt1CapacityCount) * 100 / (2 * ResourceTotal),\n    // Storage - 2 checks // score = ( \"kind\" + \"replication type\") * 100 / (2 * ResourceTotal)    //********* Future - \"access tier hot\"\n    Type == 'microsoft.storage/storageaccounts' or Type == 'microsoft.classicstorage/storageaccounts', (V2StorageEnabled + RAStorageEnabled) * 100 / (2 * ResourceTotal),\n    // AzureFirewall - 1 check // score = (AZ) * 100 / (1 * ResourceTotal)\n    Type == 'microsoft.network/azurefirewalls', (AvZoneCount + NAAvZoneCount)* 100 / ResourceTotal,\n    // AFD - 1 check // score = state  * 100 / (1 * ResourceTotal)\n    Type == 'microsoft.network/frontdoors', AFDEnabledStateCount * 100 / ResourceTotal,\n    // AppGW - 5 checks    // score = (state + AZ + Tier + autoscaling + capacity) * 100 / (5 * ResourceTotal)\n    Type == 'microsoft.network/applicationgateways', (RunningState + AvZoneCount + NAAvZoneCount + OtherAppGwSkuCount + AutoScaleAppGwCount + Gt1CapacityCount) * 100 / (5 * ResourceTotal),\n    // LB - 2 checks  // score = (SKU + AZ) * 100 / (2 * ResourceTotal)\n    Type == 'microsoft.network/loadbalancers', (OtherSku + AvZoneCount + NAAvZoneCount) * 100 / (2 * ResourceTotal),\n    // ASR - 1 check  // score = status * 100 / (1 * ResourceTotal)\n    Type == 'microsoft.recoveryservices/vaults', (AsrSucceededState) * 100 / (1 * ResourceTotal),\n    0)\n    | project Type, Environment, Criticality, ResourceTotal, tostring(ReliabilityScore)\n    | sort by Type",
                          "size": 3,
                          "title": "Reliability Score by Resource Type, Environment and Criticality",
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 16,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Type",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Environment",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "prod",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "Prod",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Criticality",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "Mission Critical",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "contains",
                                      "thresholdValue": "mission critical",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "ResourceTotal",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "blue",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "ReliabilityScore",
                                "formatter": 3,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Type"
                              ],
                              "expandTopLevel": false
                            },
                            "labelSettings": [
                              {
                                "columnId": "ReliabilityScore",
                                "label": "Reliability Score"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "name": "kql_summary_reliability_score_by_resourceType_environment_and_criticality",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "advisorresources\r\n| extend Category = tostring(properties.category)\r\n| extend Description = tostring(properties.shortDescription.problem)\r\n| extend ImpactedField = tostring(properties.impactedField)\r\n| extend ImpactedValue = tostring(properties.impactedValue)\r\n| extend Impact = tostring(properties.impact)\r\n| extend LastUpdated = tostring(properties.lastUpdated)\r\n| project Impact, ImpactedField, ImpactedValue, Description, resourceGroup, subscriptionId, Category, LastUpdated\r\n| where Category == \"HighAvailability\"\r\n| where resourceGroup in ({ResourceGroup})",
                          "size": 3,
                          "title": "Advisor - Reliability",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Impact",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "High",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Medium",
                                      "representation": "orange",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Low",
                                      "representation": "green",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "gray",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "ImpactedField",
                                "formatter": 16,
                                "formatOptions": {
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "ImpactedValue",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Description",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "orange",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "resourceGroup",
                                "formatter": 14,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Category",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "LastUpdated",
                                "formatter": 6
                              }
                            ],
                            "rowLimit": 10000,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "subscriptionId",
                                "Impact",
                                "Description"
                              ]
                            },
                            "labelSettings": [
                              {
                                "columnId": "ImpactedField",
                                "label": "Resource Type"
                              },
                              {
                                "columnId": "ImpactedValue",
                                "label": "Resource"
                              },
                              {
                                "columnId": "resourceGroup",
                                "label": "Resource Group"
                              },
                              {
                                "columnId": "LastUpdated",
                                "label": "Last Updated"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "name": "query - 0"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "reliability"
                  },
                  "name": "Reliability"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AdvisorResources\r\n| where type == 'microsoft.advisor/recommendations'\r\n| where properties.category == 'Cost'\r\n| extend\r\n\tresources = tostring(properties.resourceMetadata.resourceId),\r\n\tsavings = todouble(properties.extendedProperties.savingsAmount),\r\n\tsolution = tostring(properties.shortDescription.solution),\r\n\tcurrency = tostring(properties.extendedProperties.savingsCurrency)\r\n| summarize\r\n\tdcount(resources),\r\n\tbin(sum(savings), 0.01)\r\n\tby solution, currency\r\n| project solution, dcount_resources\r\n| count \r\n| extend Item = \"Cost Recommendations\",  Key = 3\r\n",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": false,
                            "size": "auto"
                          }
                        },
                        "customWidth": "40",
                        "name": "query - 0"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AdvisorResources\r\n| where type == 'microsoft.advisor/recommendations'\r\n| where properties.category == 'Cost'\r\n| extend\r\n\tresources = tostring(properties.resourceMetadata.resourceId),\r\n\tsavings = todouble(properties.extendedProperties.savingsAmount),\r\n\tsolution = tostring(properties.shortDescription.solution),\r\n\tcurrency = tostring(properties.extendedProperties.savingsCurrency)\r\n| summarize bin(sum(savings), 0.01) , c= \"Projectd Saving in USD\"\r\n\r\n\r\n\r\n\r\n\r\n",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "gridSettings": {
                            "sortBy": [
                              {
                                "itemKey": "sum_savings",
                                "sortOrder": 1
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "sum_savings",
                              "sortOrder": 1
                            }
                          ],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "c",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "sum_savings",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": false,
                            "size": "auto"
                          }
                        },
                        "customWidth": "60",
                        "name": "query - 0 - Copy - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AdvisorResources\r\n| where type == 'microsoft.advisor/recommendations'\r\n| where properties.category == 'Cost'\r\n| extend\r\n\tresources = tostring(properties.resourceMetadata.resourceId),\r\n\tsavings = todouble(properties.extendedProperties.savingsAmount),\r\n\tsolution = tostring(properties.shortDescription.solution),\r\n\tcurrency = tostring(properties.extendedProperties.savingsCurrency)\r\n| summarize\r\n\tdcount(resources),\r\n\tbin(sum(savings), 0.01)\r\n\tby solution, currency\r\n| project solution, dcount_resources, sum_savings, currency\r\n\r\n| order by sum_savings \r\n\r\n\r\n",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "sortBy": [
                              {
                                "itemKey": "sum_savings",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "solution",
                                "label": "Recommendation"
                              },
                              {
                                "columnId": "dcount_resources",
                                "label": "Impacted Resources"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "sum_savings",
                              "sortOrder": 1
                            }
                          ],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "solution",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "dcount_resources",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "name": "query - 0 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AdvisorResources\r\n| where type == 'microsoft.advisor/recommendations'\r\n| where properties.category == 'Cost'\r\n| extend\r\n\tresources = tostring(properties.resourceMetadata.resourceId),\r\n\tsavings = todouble(properties.extendedProperties.savingsAmount),\r\n\tsolution = tostring(properties.shortDescription.solution),\r\n\tcurrency = tostring(properties.extendedProperties.savingsCurrency)\r\n| project solution ,resources ,savings, currency\r\n| order by solution \r\n\r\n\r\n\r\n\r\n",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Group",
                                "formatter": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "solution",
                                "label": "Recommendation"
                              },
                              {
                                "columnId": "resources",
                                "label": "Impacted Resource"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "solution",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "dcount_resources",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "name": "query - 0 - Copy - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "cost"
                  },
                  "name": "Cost"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AdvisorResources\r\n| where type == 'microsoft.advisor/recommendations'\r\n| where properties.category == 'Security'\r\n| extend\r\n\tresources = tostring(properties.resourceMetadata.resourceId),\r\n\tsavings = todouble(properties.extendedProperties.savingsAmount),\r\n\tsolution = tostring(properties.shortDescription.solution),\r\n\tcurrency = tostring(properties.extendedProperties.savingsCurrency)\r\n| summarize\r\n\tdcount(resources),\r\n\tbin(sum(savings), 0.01)\r\n\tby solution, currency\r\n| project solution, dcount_resources\r\n| count \r\n| extend Item = \"Security Recommendations\",  Key = 3\r\n",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": false,
                            "size": "auto"
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 0"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "securityresources\r\n| where type =~ 'microsoft.security/securescores'\r\n| where properties.score.current > 0 and properties.environment == 'Azure' and name != 'scoreGraceExcluded'\r\n| extend scoreXweight = todouble(properties.score.percentage) * todouble(properties.weight)\r\n| summarize topi = sum(scoreXweight), bottomi = sum(todouble(properties.weight))\r\n| extend securescore = 100*(topi/bottomi)\r\n| extend Item = \"Overall Security Score\",  Key = 1",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "securescore",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 0
                                }
                              }
                            },
                            "showBorder": false,
                            "size": "auto"
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 0"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityResources\r\n| where type == 'microsoft.security/securescores/securescorecontrols'\r\n| extend SecureControl = properties.displayName, unhealthy = properties.unhealthyResourceCount, currentscore = properties.score.current, maxscore = properties.score.max, subscriptionId\r\n|extend mfascore = currentscore *100 /maxscore\r\n| project subscriptionId, SecureControl , unhealthy, currentscore, maxscore ,mfascore ,title=\"MFA Compliance\"\r\n\r\n| where SecureControl == \"Enable MFA\" \r\n",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "$gen_link_unhealthy_2",
                                "sortOrder": 2
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "subscriptionId",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "SecureControl",
                                "label": "Control"
                              },
                              {
                                "columnId": "unhealthy",
                                "label": "Unhealthy"
                              },
                              {
                                "columnId": "currentscore",
                                "label": "Current Score"
                              },
                              {
                                "columnId": "maxscore",
                                "label": "Max Score"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_link_unhealthy_2",
                              "sortOrder": 2
                            }
                          ],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "title",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "mfascore",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "<",
                                    "thresholdValue": "100",
                                    "representation": "4",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  }
                                ]
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal"
                                }
                              }
                            },
                            "secondaryContent": {
                              "columnMatch": "subscriptionId",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": true
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 3 - Copy"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Security Score of Subscription",
                          "style": "info"
                        },
                        "name": "text - 5"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "securityresources\r\n| where type == \"microsoft.security/securescores\"\r\n| extend subscriptionSecureScore = round(100 * bin((todouble(properties.score.current))/ todouble(properties.score.max), 0.001))\r\n| where subscriptionSecureScore > 0\r\n| project subscriptionId, subscriptionSecureScore\r\n| order by subscriptionSecureScore asc",
                          "size": 3,
                          "aggregation": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "subscriptionId",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": true
                              }
                            },
                            "leftContent": {
                              "columnMatch": "subscriptionSecureScore",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": false,
                            "size": "auto"
                          }
                        },
                        "name": "query - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityResources\r\n| where type == 'microsoft.security/securescores/securescorecontrols'\r\n| extend SecureControl = properties.displayName, unhealthy = properties.unhealthyResourceCount, currentscore = properties.score.current, maxscore = properties.score.max, subscriptionId\r\n| project subscriptionId, SecureControl , unhealthy, currentscore, maxscore",
                          "size": 0,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "unhealthy",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed"
                                }
                              },
                              {
                                "columnMatch": "currentscore",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 10,
                                  "palette": "redGreen",
                                  "compositeBarSettings": {
                                    "labelText": "",
                                    "columnSettings": []
                                  }
                                }
                              },
                              {
                                "columnMatch": "maxscore",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 10,
                                  "palette": "redGreen"
                                }
                              }
                            ],
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "subscriptionId",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "SecureControl",
                                "label": "Control"
                              },
                              {
                                "columnId": "unhealthy",
                                "label": "Unhealthy"
                              },
                              {
                                "columnId": "currentscore",
                                "label": "Current Score"
                              },
                              {
                                "columnId": "maxscore",
                                "label": "Max Score"
                              }
                            ]
                          },
                          "sortBy": [],
                          "tileSettings": {
                            "showBorder": false
                          }
                        },
                        "name": "query - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AdvisorResources\r\n| where type == 'microsoft.advisor/recommendations'\r\n| where properties.category == 'Security'\r\n| extend\r\n\tresources = tostring(properties.resourceMetadata.resourceId),\r\n\tsavings = todouble(properties.extendedProperties.savingsAmount),\r\n\tsolution = tostring(properties.shortDescription.solution),\r\n\tcurrency = tostring(properties.extendedProperties.savingsCurrency)\r\n| summarize\r\n\tdcount(resources),\r\n\tbin(sum(savings), 0.01)\r\n\tby solution, currency\r\n| project solution, dcount_resources\r\n \r\n\r\n\r\n",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Group",
                                "formatter": 1
                              }
                            ],
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "solution"
                              ]
                            },
                            "labelSettings": [
                              {
                                "columnId": "solution",
                                "label": "Recommendation"
                              },
                              {
                                "columnId": "dcount_resources",
                                "label": "Impacted Resources"
                              }
                            ]
                          },
                          "sortBy": [],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "solution",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "dcount_resources",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 0 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AdvisorResources\r\n| where type == 'microsoft.advisor/recommendations'\r\n| where properties.category == 'Security'\r\n| extend\r\n\tresources = tostring(properties.resourceMetadata.resourceId),\r\n\tsavings = todouble(properties.extendedProperties.savingsAmount),\r\n\tsolution = tostring(properties.shortDescription.solution),\r\n\tcurrency = tostring(properties.extendedProperties.savingsCurrency)\r\n| project solution ,resources \r\n| order by solution \r\n\r\n\r\n\r\n\r\n",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Group",
                                "formatter": 1
                              }
                            ],
                            "rowLimit": 999,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "solution"
                              ]
                            },
                            "labelSettings": [
                              {
                                "columnId": "solution",
                                "label": "Recommendation"
                              },
                              {
                                "columnId": "resources",
                                "label": "Impacted Resource"
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "solution",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "dcount_resources",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 0 - Copy - Copy"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "items": [
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "securityresources\r\n    | where type == \"microsoft.security/assessments\"\r\n    | extend Problem=tostring(properties.displayName),AffectedResource=tostring(properties.resourceDetails.Id),Status=properties.status.code,Description=properties.metadata.description,Severity=properties.metadata.severity,Remediation=strcat(\"https://\",properties.links.azurePortal)\r\n    | where Status==\"Unhealthy\" and isnotnull(Severity) and resourceGroup in ({ResourceGroup}) \r\n    | extend ResourceGroup=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",resourceGroup)\r\n    | project AffectedResource,Problem,Severity,Remediation,ResourceGroup,subscriptionId,Description",
                                      "size": 0,
                                      "title": "Azure Advisor recommendations",
                                      "noDataMessage": "You are following all of our security recommendations",
                                      "noDataMessageStyle": 3,
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "Group",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "Problem",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "Severity",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "colors",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "High",
                                                  "representation": "redBright",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Medium",
                                                  "representation": "orange",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Low",
                                                  "representation": "turquoise",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "gray",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "Remediation",
                                            "formatter": 7,
                                            "formatOptions": {
                                              "linkTarget": "Url",
                                              "linkLabel": "Open remediation"
                                            }
                                          },
                                          {
                                            "columnMatch": "subscriptionId",
                                            "formatter": 15,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "Description",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "resourceGroup",
                                            "formatter": 14,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          }
                                        ],
                                        "filter": true,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "Problem"
                                          ],
                                          "expandTopLevel": false
                                        }
                                      }
                                    },
                                    "name": "query - 0"
                                  }
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "RG_Filter",
                                "comparison": "isNotEqualTo",
                                "value": "Tags"
                              },
                              "name": "group - AzureAdvisor-Subscription"
                            },
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "items": [
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "securityresources\r\n    | where type == \"microsoft.security/assessments\"\r\n    | extend Problem=properties.displayName,AffectedResource=tolower(properties.resourceDetails.Id),Status=properties.status.code,Description=properties.metadata.description,Severity=properties.metadata.severity,Remediation=strcat(\"https://\",properties.links.azurePortal)\r\n    | where Status==\"Unhealthy\" and isnotnull(Severity)\r\n    | project AffectedResource,Problem,Severity,Remediation,resourceGroup,subscriptionId,Description\r\n    | join ( resources | mvexpand tags | extend  AffectedResource=tolower(id), Tags=tags, resourceGroup \r\n    | extend tagName = tostring(bag_keys(tags)[0])\r\n    | extend tagValue = tostring(tags[tagName]) ) on AffectedResource\r\n    | extend ResourceGroup=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",resourceGroup)\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | project  AffectedResource,Problem,Severity,Remediation,ResourceGroup,tagName,tagValue,subscriptionId,Description\r\n",
                                      "size": 0,
                                      "title": "Azure Advisor recommendations",
                                      "noDataMessage": "You are following all of our security recommendations",
                                      "noDataMessageStyle": 3,
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "Problem",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "Severity",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "colors",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "High",
                                                  "representation": "redBright",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Medium",
                                                  "representation": "orange",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Low",
                                                  "representation": "turquoise",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "gray",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "Remediation",
                                            "formatter": 7,
                                            "formatOptions": {
                                              "linkTarget": "Url",
                                              "linkLabel": "Open remediation"
                                            }
                                          },
                                          {
                                            "columnMatch": "ResourceGroup",
                                            "formatter": 14,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "tagName",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "Tags",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "tagValue",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "Tags",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "subscriptionId",
                                            "formatter": 15,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "Description",
                                            "formatter": 1
                                          }
                                        ],
                                        "filter": true,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "Problem"
                                          ],
                                          "expandTopLevel": true
                                        }
                                      }
                                    },
                                    "name": "query - 0"
                                  }
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "RG_Filter",
                                "comparison": "isEqualTo",
                                "value": "Tags"
                              },
                              "name": "group - AzureAdvisor-Tags"
                            }
                          ]
                        },
                        "name": "group - AzureAdvisor"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "security"
                  },
                  "name": "Security"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "PolicyResources\r\n| where type == 'microsoft.policyinsights/policystates'\r\n| extend complianceState = tostring(properties.complianceState)\r\n| summarize count() by complianceState",
                          "size": 4,
                          "title": "Resource Compliance Status",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "complianceState",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "Resource Compliance Status"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "items": [
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "securityresources\r\n| where type == \"microsoft.security/regulatorycompliancestandards\"\r\n| extend \r\n\tpassedControls = trim (' ', tostring(properties.passedControls)), \r\n\tfailedControls = trim(' ',tostring(properties.failedControls)), \r\n\tstate \t\t   = trim(' ', tostring(properties.state)), \r\n\tunsupportedControls = trim(' ', tostring(properties.unsupportedControls)), \r\n\tskippedControls     = trim(' ', tostring(properties.skippedControls))\r\n| project subscriptionId, name, passedControls, failedControls, unsupportedControls, skippedControls ,  link = \"https://portal.azure.com/?feature.customportal=false#blade/Microsoft_Azure_Security/SecurityMenuBlade/22\"\r\n| order by passedControls desc",
                                      "size": 0,
                                      "title": "Regulatory Standards Compliance",
                                      "exportedParameters": [
                                        {
                                          "fieldName": "name",
                                          "parameterName": "standardName",
                                          "parameterType": 1
                                        },
                                        {
                                          "fieldName": "subscriptionId",
                                          "parameterName": "subscriptionId",
                                          "parameterType": 1
                                        }
                                      ],
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "$gen_group",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": "Resource",
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "subscriptionId",
                                            "formatter": 5,
                                            "formatOptions": {
                                              "linkTarget": "Resource"
                                            }
                                          },
                                          {
                                            "columnMatch": "name",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "passedControls",
                                            "formatter": 3,
                                            "formatOptions": {
                                              "palette": "green"
                                            }
                                          },
                                          {
                                            "columnMatch": "failedControls",
                                            "formatter": 3,
                                            "formatOptions": {
                                              "palette": "red"
                                            }
                                          },
                                          {
                                            "columnMatch": "link",
                                            "formatter": 5
                                          }
                                        ],
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "subscriptionId"
                                          ],
                                          "expandTopLevel": true
                                        },
                                        "labelSettings": [
                                          {
                                            "columnId": "name",
                                            "label": "Compliance Standard"
                                          },
                                          {
                                            "columnId": "passedControls",
                                            "label": "Passed Controls"
                                          },
                                          {
                                            "columnId": "failedControls",
                                            "label": "Failed Controls"
                                          },
                                          {
                                            "columnId": "unsupportedControls",
                                            "label": "Unsupported Controls"
                                          },
                                          {
                                            "columnId": "skippedControls",
                                            "label": "Skipped Controls"
                                          }
                                        ]
                                      }
                                    },
                                    "name": "query - 0"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "securityresources\r\n| where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n| parse id with * \"/regulatoryComplianceStandards/\" ComplianceStandard \"/\" *\r\n| extend Description = properties.description\r\n| extend State = properties.state\r\n| extend Passed = properties.passedAssessments, Failed = properties.failedAssessments, Skipped = properties.skippedAssessments\r\n| where ComplianceStandard == \"{standardName}\" and subscriptionId==\"{subscriptionId}\"\r\n| project name, ComplianceStandard, Description, State, Passed, Failed, Skipped, subscriptionId\r\n| order by name asc",
                                      "size": 0,
                                      "title": "{standardName}",
                                      "exportedParameters": [
                                        {
                                          "fieldName": "ComplianceStandard",
                                          "parameterName": "complianceStandard",
                                          "parameterType": 1
                                        },
                                        {
                                          "fieldName": "Description",
                                          "parameterName": "Description",
                                          "parameterType": 1
                                        },
                                        {
                                          "fieldName": "subscriptionId",
                                          "parameterName": "subscriptionId",
                                          "parameterType": 1
                                        }
                                      ],
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "$gen_group",
                                            "formatter": 15,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "Description",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "State",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Passed",
                                                  "representation": "success",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Unsupported",
                                                  "representation": "unknown",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Failed",
                                                  "representation": "error",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "success",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "Passed",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "Failed",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "Skipped",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "subscriptionId",
                                            "formatter": 5
                                          }
                                        ],
                                        "filter": true,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "subscriptionId"
                                          ],
                                          "expandTopLevel": true
                                        }
                                      },
                                      "sortBy": []
                                    },
                                    "conditionalVisibility": {
                                      "parameterName": "standardName",
                                      "comparison": "isNotEqualTo"
                                    },
                                    "name": "query - 1"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "securityresources \r\n| where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n| parse id with * \"/regulatoryComplianceStandards/\" ComplianceStandard \"/\" *\r\n//| parse id with * \"/regulatoryComplianceControls/\" ComplianceControl \"/\" *\r\n| where ComplianceStandard == \"{standardName}\"\r\n| extend assessment = name\r\n| join (securityresources| where type == \"microsoft.security/assessments\" | extend assessment=name,Problem=properties.displayName,AffectedResource=properties.resourceDetails.Id,Status=properties.status.code,Remediation=strcat(\"https://\",properties.links.azurePortal),Severity=properties.metadata.severity\r\n| parse AffectedResource with * \"/subscriptions/\" subscriptionId \"/\" *\r\n| parse AffectedResource with * \"/resourcegroups/\" RG \"/\" *) on assessment\r\n| where subscriptionId==\"{subscriptionId}\" and RG in ({ResourceGroup}) and Status != \"Healthy\"\r\n| extend ResourceGroup=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",RG)\r\n| project ComplianceStandard,AffectedResource,Problem,Severity,Status,Remediation,ResourceGroup,subscriptionId\r\n",
                                      "size": 0,
                                      "title": "Affected resources",
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "ComplianceStandard",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "AffectedResource",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": "Resource",
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "Problem",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "Severity",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "colors",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Low",
                                                  "representation": "turquoise",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Medium",
                                                  "representation": "orange",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "High",
                                                  "representation": "redBright",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "blue",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "Status",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "NotApplicable",
                                                  "representation": "unknown",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Healthy",
                                                  "representation": "success",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Unhealthy",
                                                  "representation": "3",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "success",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "Remediation",
                                            "formatter": 7,
                                            "formatOptions": {
                                              "linkTarget": "Url",
                                              "linkLabel": "Open remediation"
                                            }
                                          },
                                          {
                                            "columnMatch": "ResourceGroup",
                                            "formatter": 14,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "subscriptionId",
                                            "formatter": 15,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "ComplianceControl",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Column1",
                                            "formatter": 5
                                          }
                                        ],
                                        "filter": true,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "Problem"
                                          ],
                                          "expandTopLevel": false
                                        }
                                      }
                                    },
                                    "conditionalVisibility": {
                                      "parameterName": "standardName",
                                      "comparison": "isNotEqualTo"
                                    },
                                    "name": "query - 2"
                                  }
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "RG_Filter",
                                "comparison": "isNotEqualTo",
                                "value": "Tags"
                              },
                              "name": "group - regulatorySubscription"
                            },
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "items": [
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "securityresources\r\n| where type == \"microsoft.security/regulatorycompliancestandards\"\r\n| extend \r\n\tpassedControls = trim (' ', tostring(properties.passedControls)), \r\n\tfailedControls = trim(' ',tostring(properties.failedControls)), \r\n\tstate \t\t   = trim(' ', tostring(properties.state)), \r\n\tunsupportedControls = trim(' ', tostring(properties.unsupportedControls)), \r\n\tskippedControls     = trim(' ', tostring(properties.skippedControls))\r\n| project subscriptionId, name, passedControls, failedControls, unsupportedControls, skippedControls ,  link = \"https://portal.azure.com/?feature.customportal=false#blade/Microsoft_Azure_Security/SecurityMenuBlade/22\"\r\n| order by passedControls desc",
                                      "size": 0,
                                      "title": "Regulatory Standards Compliance",
                                      "exportedParameters": [
                                        {
                                          "fieldName": "name",
                                          "parameterName": "standardName",
                                          "parameterType": 1
                                        },
                                        {
                                          "fieldName": "subscriptionId",
                                          "parameterName": "subscriptionId",
                                          "parameterType": 1
                                        }
                                      ],
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "subscriptionId",
                                            "formatter": 15,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "passedControls",
                                            "formatter": 3,
                                            "formatOptions": {
                                              "palette": "green"
                                            }
                                          },
                                          {
                                            "columnMatch": "failedControls",
                                            "formatter": 3,
                                            "formatOptions": {
                                              "palette": "red"
                                            }
                                          },
                                          {
                                            "columnMatch": "link",
                                            "formatter": 5
                                          }
                                        ]
                                      }
                                    },
                                    "name": "query - 0"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "securityresources\r\n| where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n| parse id with * \"/regulatoryComplianceStandards/\" ComplianceStandard \"/\" *\r\n| extend Description = properties.description\r\n| extend State = properties.state\r\n| extend Passed = properties.passedAssessments, Failed = properties.failedAssessments, Skipped = properties.skippedAssessments\r\n| where ComplianceStandard == \"{standardName}\" and subscriptionId==\"{subscriptionId}\"\r\n| project name, ComplianceStandard, Description, State, Passed, Failed, Skipped, subscriptionId\r\n| order by name asc",
                                      "size": 0,
                                      "title": "{standardName}",
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "$gen_group",
                                            "formatter": 15,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "Description",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "State",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Unsupported",
                                                  "representation": "unknown",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Passed",
                                                  "representation": "success",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Failed",
                                                  "representation": "3",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "success",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "Passed",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "Failed",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "Skipped",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "subscriptionId",
                                            "formatter": 5
                                          }
                                        ],
                                        "filter": true,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "subscriptionId"
                                          ],
                                          "expandTopLevel": true
                                        }
                                      }
                                    },
                                    "conditionalVisibility": {
                                      "parameterName": "standardName",
                                      "comparison": "isNotEqualTo"
                                    },
                                    "name": "query - 1"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "securityresources \r\n| where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n| parse id with * \"/regulatoryComplianceStandards/\" ComplianceStandard \"/\" *\r\n//| parse id with * \"/regulatoryComplianceControls/\" ComplianceControl \"/\" *\r\n| where ComplianceStandard == \"{standardName}\"\r\n| extend assessment = name , resourceGroup\r\n| join (securityresources| where type == \"microsoft.security/assessments\" | project assessment=name,Problem=properties.displayName,AffectedResource=tostring(properties.resourceDetails.Id),Status=properties.status.code,Remediation=strcat(\"https://\",properties.links.azurePortal),Severity=properties.metadata.severity\r\n| parse AffectedResource with * \"/subscriptions/\" subscriptionId \"/\" *\r\n| parse AffectedResource with * \"/resourceGroups/\" RG \"/\" *) on assessment\r\n| join ( resources | mvexpand tags | extend  AffectedResource=id, Tags=tags ,resourceGroup\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName]) ) on AffectedResource\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}' and Status != \"Healthy\"\r\n| extend ResourceGroup=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",RG)\r\n| project ComplianceStandard,AffectedResource,Problem,Severity,Status,Remediation,tagName,tagValue,ResourceGroup,subscriptionId\r\n\r\n",
                                      "size": 0,
                                      "title": "Affected resources",
                                      "noDataMessage": "No affected resources",
                                      "noDataMessageStyle": 3,
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "Problem",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "Severity",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "colors",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Low",
                                                  "representation": "turquoise",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Medium",
                                                  "representation": "orange",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "High",
                                                  "representation": "redBright",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "blue",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "Status",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Healthy",
                                                  "representation": "success",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Unhealthy",
                                                  "representation": "3",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "NotApplicable",
                                                  "representation": "unknown",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "success",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "Remediation",
                                            "formatter": 7,
                                            "formatOptions": {
                                              "linkTarget": "Url",
                                              "linkLabel": "Open remediation"
                                            }
                                          },
                                          {
                                            "columnMatch": "tagName",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "Tags",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "tagValue",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "Tags",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "ResourceGroup",
                                            "formatter": 14,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "subscriptionId",
                                            "formatter": 15,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          }
                                        ],
                                        "filter": true,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "Problem"
                                          ],
                                          "expandTopLevel": false
                                        },
                                        "sortBy": [
                                          {
                                            "itemKey": "$gen_count_$gen_group_0",
                                            "sortOrder": 2
                                          }
                                        ]
                                      },
                                      "sortBy": [
                                        {
                                          "itemKey": "$gen_count_$gen_group_0",
                                          "sortOrder": 2
                                        }
                                      ]
                                    },
                                    "conditionalVisibility": {
                                      "parameterName": "standardName",
                                      "comparison": "isNotEqualTo"
                                    },
                                    "name": "query - 2"
                                  }
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "RG_Filter",
                                "comparison": "isEqualTo",
                                "value": "Tags"
                              },
                              "name": "group - regulatoryTags"
                            }
                          ]
                        },
                        "name": "group - regulatoryCompliance",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "PolicyResources\r\n| where type =~ 'Microsoft.PolicyInsights/PolicyStates'\r\n| extend complianceState = tostring(properties.complianceState)\r\n| extend\r\n\tresourceId = tostring(properties.resourceId),\r\n\tresourceType = tolower(tostring(properties.resourceType)),\r\n\tpolicyAssignmentId = tostring(properties.policyAssignmentId),\r\n\tpolicyDefinitionId = tostring(properties.policyDefinitionId),\r\n\tpolicyDefinitionReferenceId = tostring(properties.policyDefinitionReferenceId),\r\n\tstateWeight = iff(complianceState == 'NonCompliant', int(300), iff(complianceState == 'Compliant', int(200), iff(complianceState == 'Conflict', int(100), iff(complianceState == 'Exempt', int(50), int(0)))))\r\n| summarize max(stateWeight) by resourceId, resourceType\r\n| summarize counts = count() by resourceType, max_stateWeight\r\n| summarize overallStateWeight = max(max_stateWeight),\r\n\r\nnonCompliantCount = sumif(counts, max_stateWeight == 300),\r\ncompliantCount = sumif(counts, max_stateWeight == 200),\r\nconflictCount = sumif(counts, max_stateWeight == 100),\r\nexemptCount = sumif(counts, max_stateWeight == 50) by resourceType\r\n| extend totalResources = todouble(nonCompliantCount + compliantCount + conflictCount + exemptCount)\r\n| extend compliancePercentage = iff(totalResources == 0, todouble(100), 100 * todouble(compliantCount + exemptCount) / totalResources)\r\n| project resourceType,\r\noverAllComplianceState = iff(overallStateWeight == 300, 'noncompliant', iff(overallStateWeight == 200, 'compliant', iff(overallStateWeight == 100, 'conflict', iff(overallStateWeight == 50, 'exempt', 'notstarted')))),\r\ncompliancePercentage,\r\ncompliantCount,\r\nnonCompliantCount,\r\nconflictCount,\r\nexemptCount\r\n",
                          "size": 3,
                          "title": "Resource Wise Compliance Status",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "overAllComplianceState",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "compliant",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "noncompliant",
                                      "representation": "4",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "compliancePercentage",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                }
                              },
                              {
                                "columnMatch": "nonCompliantCount",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "0",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "error",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ],
                            "rowLimit": 1000,
                            "filter": true,
                            "sortBy": [
                              {
                                "itemKey": "$gen_heatmap_compliancePercentage_2",
                                "sortOrder": 2
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_heatmap_compliancePercentage_2",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "name": "query - 7"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0 or properties.assessmentType == \"MicrosoftManaged\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = tostring(properties.state)\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = iff(isnull(id1) or isempty(id1), id, id1)\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws' and isnotempty(tostring(properties1.resourceDetails.ConnectorId)), properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(resourceSource =~ \"aws\" and isnotempty(tostring(properties1.resourceDetails.ConnectorId)), tostring(properties1.additionalData.ResourceType), iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\")))\r\n    | extend resourceName = tostring(regexResourceId[2])\r\n    | extend recommendationName = name\r\n    | extend recommendationDisplayName = tostring(iff(isnull(properties1.displayName) or isempty(properties1.displayName), properties.description, properties1.displayName))\r\n    | extend description = tostring(properties1.metadata.description)\r\n    | extend remediationSteps = tostring(properties1.metadata.remediationDescription)\r\n    | extend severity = tostring(properties1.metadata.severity)\r\n    | extend azurePortalRecommendationLink = tostring(properties1.links.azurePortal)\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | mvexpand statusPerInitiative = properties1.statusPerInitiative\r\n                | extend expectedInitiative = statusPerInitiative.policyInitiativeName =~ \"ASC Default\"\r\n                | summarize arg_max(expectedInitiative, *) by complianceControlId, recommendationId\r\n                | extend state = iff(expectedInitiative, tolower(statusPerInitiative.assessmentStatus.code), tolower(properties1.status.code))\r\n                | extend notApplicableReason = iff(expectedInitiative, tostring(statusPerInitiative.assessmentStatus.cause), tostring(properties1.status.cause))\r\n                | project-away expectedInitiative\r\n    | project complianceStandardId, complianceControlId, complianceState, subscriptionId, resourceGroup = resourceGroup1 ,resourceType, resourceName, resourceId, recommendationId, recommendationDisplayName, description, remediationSteps, severity, state,  azurePortalRecommendationLink\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | project-away controlId\r\n    | distinct *\r\n    | order by complianceControlId asc, recommendationId asc",
                          "size": 3,
                          "title": "Compliance Level",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "rowLimit": 1000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "complianceState"
                              ]
                            }
                          }
                        },
                        "name": "query - 11"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "compliance"
                  },
                  "name": "Compliance"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "securityresources\n| where type =~ \"microsoft.security/pricings\"\n| extend pricingTier = properties.pricingTier, subPlan = properties.subPlan\n| extend planSet = pack(name, level = case(isnotempty(subPlan),subPlan,pricingTier))\n| summarize defenderPlans = make_bag(planSet) by subscriptionId\n| project subscriptionId,\n    VirtualMachines = defenderPlans.VirtualMachines,\n    AppServices = defenderPlans.AppServices,\n    SqlServers = defenderPlans.SqlServers,\n    SqlServerVirtualMachines = defenderPlans.SqlServerVirtualMachines,\n    OpenSourceRelationalDatabases = defenderPlans.OpenSourceRelationalDatabases,\n    CosmosDB = defenderPlans.CosmosDbs,\n    StorageAccounts = defenderPlans.StorageAccounts,\n    Containers = defenderPlans.Containers,\n    KeyVaults = defenderPlans.KeyVaults,\n    Arm = defenderPlans.Arm,\n    DNS = defenderPlans.Dns,\n    KubernetesService = defenderPlans.KubernetesService,\n    ContainerRegistry = defenderPlans.ContainerRegistry\n| summarize totalSubs = count(), Servers = countif(VirtualMachines == \"P1\" or VirtualMachines == \"P2\"),\n    AppSrv = countif(AppServices == \"Standard\"),\n    SqlServers = countif(SqlServers == \"Standard\"),\n    SqlServerVirtualMachines = countif(SqlServerVirtualMachines == \"Standard\"),\n    OpenSourceRelationalDatabases = countif(OpenSourceRelationalDatabases == \"Standard\"),\n    CosmosDB = countif(CosmosDB == \"Standard\"),\n    StorageAccounts = countif(StorageAccounts == \"Standard\"),\n    Containers = countif(Containers == \"Standard\"),\n    KeyVaults = countif(KeyVaults == \"Standard\"),\n    Arm = countif(Arm == \"Standard\"),\n    DNS = countif(DNS == \"Standard\"),\n    KubernetesService = countif(KubernetesService == \"Standard\"),\n    ContainerRegistry = countif(ContainerRegistry == \"Standard\")",
                          "size": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "tileSettings": {
                            "showBorder": false
                          },
                          "graphSettings": {
                            "type": 0
                          }
                        },
                        "customWidth": "20",
                        "conditionalVisibility": {
                          "parameterName": "blank",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "Azure numbers"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\",\"mergeType\":\"table\",\"leftTable\":\"Azure numbers\"}],\"projectRename\":[{\"originalName\":\"[Azure numbers].totalSubs\",\"mergedName\":\"totalSubs\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Azure numbers].Servers\",\"mergedName\":\"Servers\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Azure numbers].AppSrv\",\"mergedName\":\"AppSrv\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Azure numbers].SqlServers\",\"mergedName\":\"SqlServers\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Azure numbers].SqlServerVirtualMachines\",\"mergedName\":\"SqlServerVirtualMachines\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Azure numbers].OpenSourceRelationalDatabases\",\"mergedName\":\"OpenSourceRelationalDatabases\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Azure numbers].CosmosDB\",\"mergedName\":\"CosmosDB\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Azure numbers].StorageAccounts\",\"mergedName\":\"StorageAccounts\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Azure numbers].Containers\",\"mergedName\":\"Containers\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Azure numbers].KeyVaults\",\"mergedName\":\"KeyVaults\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Azure numbers].Arm\",\"mergedName\":\"Arm\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Azure numbers].DNS\",\"mergedName\":\"DNS\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Azure numbers].KubernetesService\",\"mergedName\":\"KubernetesService\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Azure numbers].ContainerRegistry\",\"mergedName\":\"ContainerRegistry\",\"fromId\":\"17975ef8-d504-4965-a0ca-3e25f6c5203c\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Servers1\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Servers\\\"]/[\\\"totalSubs\\\"]*100\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"AppSrv1\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"AppSrv\\\"]/[\\\"totalSubs\\\"]*100\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"SQL1\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"SqlServers\\\"]/[\\\"totalSubs\\\"]*100\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"SQL Server on machines\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"SqlServerVirtualMachines\\\"]/[\\\"totalSubs\\\"]*100\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Open-source relational DBs\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"OpenSourceRelationalDatabases\\\"]/[\\\"totalSubs\\\"]*100\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Cosmos DB\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"CosmosDB\\\"]/[\\\"totalSubs\\\"]*100\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Storage1\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"StorageAccounts\\\"]/[\\\"totalSubs\\\"]*100\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Containers1\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Containers\\\"]/[\\\"totalSubs\\\"]*100\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Key Vaults\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"KeyVaults\\\"]/[\\\"totalSubs\\\"]*100\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Resource Manager\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Arm\\\"]/[\\\"totalSubs\\\"]*100\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"DNS1\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"DNS\\\"]/[\\\"totalSubs\\\"]*100\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"K8s (deprecated)\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"KubernetesService\\\"]/[\\\"totalSubs\\\"]*100\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Container Registry (deprecated)\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"ContainerRegistry\\\"]/[\\\"totalSubs\\\"]*100\"}}]}]}",
                          "size": 3,
                          "title": "Relative coverage across Azure subscriptions",
                          "queryType": 7,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "totalSubs",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Servers",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "AppSrv",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "SqlServers",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "SqlServerVirtualMachines",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "OpenSourceRelationalDatabases",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "CosmosDB",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "StorageAccounts",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Containers",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "KeyVaults",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Arm",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "DNS",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "KubernetesService",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ContainerRegistry",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Servers1",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "AppSrv1",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "SQL1",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "SQL Server on machines",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "Open-source relational DBs",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "Cosmos DB",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "Storage1",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "Containers1",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "Key Vaults",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "Resource Manager",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "DNS1",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "K8s (deprecated)",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "Container Registry (deprecated)",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumFractionDigits": 1
                                  }
                                }
                              }
                            ],
                            "rowLimit": 2,
                            "sortBy": [
                              {
                                "itemKey": "$gen_heatmap_Containers1_21",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Servers1",
                                "label": "Servers"
                              },
                              {
                                "columnId": "AppSrv1",
                                "label": "App Services"
                              },
                              {
                                "columnId": "SQL1",
                                "label": "SQL"
                              },
                              {
                                "columnId": "Storage1",
                                "label": "Storage"
                              },
                              {
                                "columnId": "Containers1",
                                "label": "Containers"
                              },
                              {
                                "columnId": "DNS1",
                                "label": "DNS"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_heatmap_Containers1_21",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "showPin": false,
                        "name": "Azure percentage"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "securityresources\n| where type =~ \"microsoft.security/pricings\"\n| extend pricingTier = properties.pricingTier, subPlan = properties.subPlan\n| extend planSet = pack(name, level = case(isnotempty(subPlan),subPlan,pricingTier))\n| summarize defenderPlans = make_bag(planSet) by subscriptionId\n| project subscriptionId,\n    VirtualMachines = defenderPlans.VirtualMachines,\n    AppServices = defenderPlans.AppServices,\n    SqlServers = defenderPlans.SqlServers,\n    SqlServerVirtualMachines = defenderPlans.SqlServerVirtualMachines,\n    OpenSourceRelationalDatabases = defenderPlans.OpenSourceRelationalDatabases,\n    CosmosDB = defenderPlans.CosmosDbs,\n    StorageAccounts = defenderPlans.StorageAccounts,\n    Containers = defenderPlans.Containers,\n    KeyVaults = defenderPlans.KeyVaults,\n    Arm = defenderPlans.Arm,\n    DNS = defenderPlans.Dns,\n    KubernetesService = defenderPlans.KubernetesService,\n    ContainerRegistry = defenderPlans.ContainerRegistry",
                          "size": 3,
                          "title": "Absolute coverage across Azure subscriptions",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "showIcon": true,
                                  "customColumnWidthSetting": "50ch"
                                }
                              },
                              {
                                "columnMatch": "VirtualMachines",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "subscriptionId",
                                  "linkTarget": "OpenBlade",
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "P1",
                                      "representation": "lightBlue",
                                      "text": "Plan 1 on"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "P2",
                                      "representation": "lightBlue",
                                      "text": "Plan 2 on"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "blueDark",
                                      "text": "off"
                                    }
                                  ],
                                  "bladeOpenContext": {
                                    "bladeName": "PolicyPricingWithBundlesBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "subscriptionId",
                                        "source": "column",
                                        "value": "subscriptionId"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "12.5ch"
                                }
                              },
                              {
                                "columnMatch": "AppServices",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "subscriptionId",
                                  "linkTarget": "OpenBlade",
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Standard",
                                      "representation": "green",
                                      "text": "on"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "red",
                                      "text": "off"
                                    }
                                  ],
                                  "bladeOpenContext": {
                                    "bladeName": "PolicyPricingWithBundlesBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "subscriptionId",
                                        "source": "column",
                                        "value": "subscriptionId"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "16ch"
                                }
                              },
                              {
                                "columnMatch": "SqlServers",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "subscriptionId",
                                  "linkTarget": "OpenBlade",
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Standard",
                                      "representation": "green",
                                      "text": "on"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "red",
                                      "text": "off"
                                    }
                                  ],
                                  "bladeOpenContext": {
                                    "bladeName": "PolicyPricingWithBundlesBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "subscriptionId",
                                        "source": "column",
                                        "value": "subscriptionId"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "10ch"
                                }
                              },
                              {
                                "columnMatch": "SqlServerVirtualMachines",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "subscriptionId",
                                  "linkTarget": "OpenBlade",
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Standard",
                                      "representation": "green",
                                      "text": "on"
                                    },
                                    {
                                      "representation": "red",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "blueDark",
                                      "text": "off"
                                    }
                                  ],
                                  "bladeOpenContext": {
                                    "bladeName": "PolicyPricingWithBundlesBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "subscriptionId",
                                        "source": "column",
                                        "value": "subscriptionId"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "26ch"
                                }
                              },
                              {
                                "columnMatch": "OpenSourceRelationalDatabases",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "subscriptionId",
                                  "linkTarget": "OpenBlade",
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Standard",
                                      "representation": "green",
                                      "text": "on"
                                    },
                                    {
                                      "representation": "red",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "blueDark",
                                      "text": "off"
                                    }
                                  ],
                                  "bladeOpenContext": {
                                    "bladeName": "PolicyPricingWithBundlesBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "subscriptionId",
                                        "source": "column",
                                        "value": "subscriptionId"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "29ch"
                                }
                              },
                              {
                                "columnMatch": "CosmosDB",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "subscriptionId",
                                  "linkTarget": "OpenBlade",
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Standard",
                                      "representation": "green",
                                      "text": "on"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "red",
                                      "text": "off"
                                    }
                                  ],
                                  "bladeOpenContext": {
                                    "bladeName": "PolicyPricingWithBundlesBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "subscriptionId",
                                        "source": "column",
                                        "value": "subscriptionId"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "15.5ch"
                                }
                              },
                              {
                                "columnMatch": "StorageAccounts",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "subscriptionId",
                                  "linkTarget": "OpenBlade",
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Standard",
                                      "representation": "green",
                                      "text": "on"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "red",
                                      "text": "off"
                                    }
                                  ],
                                  "bladeOpenContext": {
                                    "bladeName": "PolicyPricingWithBundlesBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "subscriptionId",
                                        "source": "column",
                                        "value": "subscriptionId"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "12ch"
                                }
                              },
                              {
                                "columnMatch": "Containers",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "subscriptionId",
                                  "linkTarget": "OpenBlade",
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Standard",
                                      "representation": "green",
                                      "text": "on"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "red",
                                      "text": "off"
                                    }
                                  ],
                                  "bladeOpenContext": {
                                    "bladeName": "PolicyPricingWithBundlesBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "subscriptionId",
                                        "source": "column",
                                        "value": "subscriptionId"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "KeyVaults",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "subscriptionId",
                                  "linkTarget": "OpenBlade",
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Standard",
                                      "representation": "green",
                                      "text": "on"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "red",
                                      "text": "off"
                                    }
                                  ],
                                  "bladeOpenContext": {
                                    "bladeName": "PolicyPricingWithBundlesBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "subscriptionId",
                                        "source": "column",
                                        "value": "subscriptionId"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "14.7ch"
                                }
                              },
                              {
                                "columnMatch": "Arm",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "subscriptionId",
                                  "linkTarget": "OpenBlade",
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Standard",
                                      "representation": "green",
                                      "text": "on"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "red",
                                      "text": "off"
                                    }
                                  ],
                                  "bladeOpenContext": {
                                    "bladeName": "PolicyPricingWithBundlesBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "subscriptionId",
                                        "source": "column",
                                        "value": "subscriptionId"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "21ch"
                                }
                              },
                              {
                                "columnMatch": "DNS",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "subscriptionId",
                                  "linkTarget": "OpenBlade",
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Standard",
                                      "representation": "green",
                                      "text": "on"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "red",
                                      "text": "off"
                                    }
                                  ],
                                  "bladeOpenContext": {
                                    "bladeName": "PolicyPricingWithBundlesBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "subscriptionId",
                                        "source": "column",
                                        "value": "subscriptionId"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "10.7ch"
                                }
                              },
                              {
                                "columnMatch": "KubernetesService",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "subscriptionId",
                                  "linkTarget": "OpenBlade",
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Standard",
                                      "representation": "green",
                                      "text": "on"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "red",
                                      "text": "off"
                                    }
                                  ],
                                  "bladeOpenContext": {
                                    "bladeName": "PolicyPricingWithBundlesBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "subscriptionId",
                                        "source": "column",
                                        "value": "subscriptionId"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "19.7ch"
                                }
                              },
                              {
                                "columnMatch": "ContainerRegistry",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "subscriptionId",
                                  "linkTarget": "OpenBlade",
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Standard",
                                      "representation": "green",
                                      "text": "on"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "red",
                                      "text": "off"
                                    }
                                  ],
                                  "bladeOpenContext": {
                                    "bladeName": "PolicyPricingWithBundlesBlade",
                                    "extensionName": "Microsoft_Azure_Security",
                                    "bladeParameters": [
                                      {
                                        "name": "subscriptionId",
                                        "source": "column",
                                        "value": "subscriptionId"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "32ch"
                                }
                              },
                              {
                                "columnMatch": "subscriptionName",
                                "formatter": 5,
                                "formatOptions": {
                                  "linkTarget": "Resource"
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "subscriptionId",
                                "label": "Subscription Name"
                              },
                              {
                                "columnId": "VirtualMachines",
                                "label": "Servers"
                              },
                              {
                                "columnId": "AppServices",
                                "label": "App Services"
                              },
                              {
                                "columnId": "SqlServers",
                                "label": "SQL"
                              },
                              {
                                "columnId": "SqlServerVirtualMachines",
                                "label": "SQL Server on machines"
                              },
                              {
                                "columnId": "OpenSourceRelationalDatabases",
                                "label": "Open-source relational DBs"
                              },
                              {
                                "columnId": "CosmosDB",
                                "label": "Cosmos DB"
                              },
                              {
                                "columnId": "StorageAccounts",
                                "label": "Storage"
                              },
                              {
                                "columnId": "Containers",
                                "label": "Containers"
                              },
                              {
                                "columnId": "KeyVaults",
                                "label": "Key Vaults"
                              },
                              {
                                "columnId": "Arm",
                                "label": "Resource Manager"
                              },
                              {
                                "columnId": "DNS",
                                "label": "DNS"
                              },
                              {
                                "columnId": "KubernetesService",
                                "label": "K8s (deprecated)"
                              },
                              {
                                "columnId": "ContainerRegistry",
                                "label": "Container Registry (deprecated)"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "name": "queryAzure"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "83a271ad-ff79-46af-9ffe-69ed2552904b",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "value": {
                                "durationMs": 86400000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ]
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 5"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Malware detection \r\n// Malware detected grouped by threat. \r\n// To create an alert for this query, click '+ New alert rule'\r\nProtectionStatus\r\n| where ThreatStatus != \"No threats detected\" \r\n| summarize AggregatedValue = count() by Threat, Computer, _ResourceId\r\n| summarize c = count()\r\n| extend Item = \"VM's with Detected Threats\",  Key = 1",
                          "size": 3,
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item"
                            },
                            "leftContent": {
                              "columnMatch": "c",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              }
                            },
                            "showBorder": false,
                            "size": "auto"
                          }
                        },
                        "customWidth": "20",
                        "name": "query - 6 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Malware detection \r\n// Malware detected grouped by threat. \r\n// To create an alert for this query, click '+ New alert rule'\r\nProtectionStatus\r\n| where ThreatStatus != \"No threats detected\" \r\n| summarize AggregatedValue = count() by Threat,  _ResourceId\r\n",
                          "size": 3,
                          "title": "Count of Detected Threats",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "_ResourceId",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": true
                              }
                            },
                            "leftContent": {
                              "columnMatch": "AggregatedValue",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "name": "query - 6"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Malware detection \r\n// Malware detected grouped by threat. \r\n// To create an alert for this query, click '+ New alert rule'\r\nProtectionStatus\r\n| where ThreatStatus != \"No threats detected\" \r\n| distinct ResourceId, DeviceName,ComputerIP_Hidden,OSName,ThreatStatusRank,ThreatStatus,ProtectionStatusRank,ProtectionStatus,ProtectionStatusDetails,TypeofProtection\r\n\r\n\r\n",
                          "size": 3,
                          "title": "Detailed View",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.resources/subscriptions",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "rowLimit": 1000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "TypeofProtection"
                              ]
                            },
                            "labelSettings": [
                              {
                                "columnId": "ResourceId",
                                "label": "VM Name"
                              }
                            ]
                          }
                        },
                        "name": "query - 6 - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "protection"
                  },
                  "name": "Protection"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 11,
                        "content": {
                          "version": "LinkItem/1.0",
                          "style": "tabs",
                          "links": [
                            {
                              "id": "d5749b77-230f-45e3-89f5-be4c85ecfa36",
                              "cellValue": "submenu",
                              "linkTarget": "parameter",
                              "linkLabel": "Vartual Machines",
                              "subTarget": "vmvulnerabilities",
                              "preText": "",
                              "style": "link"
                            },
                            {
                              "id": "d2568e3f-dddc-47d7-8bb1-afcbc94c0f97",
                              "cellValue": "submenu",
                              "linkTarget": "parameter",
                              "linkLabel": "Database",
                              "subTarget": "dbvulnerabilities",
                              "style": "link"
                            }
                          ]
                        },
                        "name": "links - 0"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "title": "VM Vulnerabilties",
                          "items": [
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "5e8f8ef7-c57e-4c97-8356-67e34bdd1eb1",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Subscription",
                                    "type": 6,
                                    "isRequired": true,
                                    "multiSelect": true,
                                    "quote": "'",
                                    "delimiter": ",",
                                    "typeSettings": {
                                      "additionalResourceOptions": [
                                        "value::1",
                                        "value::3",
                                        "value::all"
                                      ],
                                      "includeAll": true,
                                      "showDefault": false
                                    },
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "defaultValue": "value::3"
                                  }
                                ],
                                "style": "pills",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "name": "parameters - 5"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"1195afff-c881-495e-9bc5-1486211ae03f\"\r\n| project ResourceType=tostring(split(id,\"/\").[6]), ResourceName=tostring(properties.resourceDetails.id)\r\n| summarize Count=dcount(ResourceName) by ResourceType",
                                "size": 4,
                                "title": "Unhealthy machines",
                                "noDataMessage": "No unhealthy machines found",
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "ResourceType",
                                      "formatter": 16,
                                      "formatOptions": {
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "Count",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "4",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    }
                                  ],
                                  "filter": true
                                },
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "ResourceType",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Resource"
                                    }
                                  },
                                  "leftContent": {
                                    "columnMatch": "count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "showBorder": true,
                                  "sortCriteriaField": "ResourceType",
                                  "sortOrderField": 1,
                                  "size": "auto"
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "ResourceType",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "chartSettings": {
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "High",
                                      "color": "red"
                                    },
                                    {
                                      "color": "orange"
                                    }
                                  ]
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "count",
                                    "heatmapPalette": "greenRed"
                                  }
                                }
                              },
                              "customWidth": "40",
                              "name": "Overview-VMCount"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"1195afff-c881-495e-9bc5-1486211ae03f\"\r\n| extend VulId = tostring(properties.id), Severity = tostring(properties.status.severity), Status = tostring(properties.status.code)\r\n| where Status == 'Unhealthy'\r\n| summarize Count = dcount(VulId) by Severity",
                                "size": 4,
                                "title": "Distinct vulnerabilities by severity",
                                "noDataMessage": "No unhealthy machines found",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "piechart",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "ResourceType",
                                      "formatter": 16,
                                      "formatOptions": {
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "Count",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "4",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                },
                                "tileSettings": {
                                  "showBorder": false,
                                  "titleContent": {
                                    "columnMatch": "Column1",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "IncidentCount",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "chartSettings": {
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "High",
                                      "color": "redBright"
                                    },
                                    {
                                      "seriesName": "Medium",
                                      "color": "yellow"
                                    },
                                    {
                                      "seriesName": "Low",
                                      "color": "blueDark"
                                    }
                                  ]
                                }
                              },
                              "customWidth": "60",
                              "name": "Overview-ServersPie"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"1195afff-c881-495e-9bc5-1486211ae03f\"\r\n| extend Category = tostring(properties.category), Status = tostring(properties.status.code)\r\n| where Status == 'Unhealthy'\r\n| summarize count() by tostring(Category)",
                                "size": 3,
                                "title": "Vulnerabilities by category",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 14,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true,
                                        "customColumnWidthSetting": "25ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "ResourceGroup",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Resource",
                                      "formatter": 0,
                                      "formatOptions": {
                                        "customColumnWidthSetting": "20ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "Total",
                                      "formatter": 1,
                                      "formatOptions": {
                                        "customColumnWidthSetting": "10ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "sevH",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "palette": "red",
                                        "customColumnWidthSetting": "10ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "sevM",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "palette": "orange",
                                        "customColumnWidthSetting": "10ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "sevL",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "palette": "blueDark",
                                        "customColumnWidthSetting": "10ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "patchAvailable",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "pending",
                                            "text": "{0}{1}"
                                          }
                                        ],
                                        "compositeBarSettings": {
                                          "labelText": "",
                                          "columnSettings": []
                                        },
                                        "customColumnWidthSetting": "10ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "CVEcount",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "4",
                                            "text": "{0}{1}"
                                          }
                                        ],
                                        "customColumnWidthSetting": "10ch"
                                      }
                                    }
                                  ],
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "ResourceGroup"
                                    ],
                                    "expandTopLevel": true
                                  }
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Category",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "count_",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": false,
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "showBorder": true
                                }
                              },
                              "name": "MachinesCategoryTiles"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"1195afff-c881-495e-9bc5-1486211ae03f\"\r\n| project Resource = tostring(properties.resourceDetails.id), subscriptionId, Severity = tostring(properties.status.severity), Status = tostring(properties.status.code), VulnId = tostring(properties.id)\r\n| where Status == 'Unhealthy'\r\n| summarize dcount(VulnId) by Resource, Severity, VulnId\r\n| summarize Total=count(Severity), sevH=countif(Severity=='High'), sevM=countif(Severity=='Medium'), sevL=countif(Severity=='Low') by Resource\r\n| order by sevH desc",
                                "size": 1,
                                "title": "Vulnerabilities by severity per machine",
                                "noDataMessage": "No unhealthy machines found",
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "Resource",
                                      "formatter": 0,
                                      "formatOptions": {
                                        "customColumnWidthSetting": "22ch"
                                      },
                                      "tooltipFormat": {
                                        "tooltip": "[\"Total\"] fndings in total"
                                      }
                                    },
                                    {
                                      "columnMatch": "sevH",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "redBright",
                                        "compositeBarSettings": {
                                          "labelText": "",
                                          "columnSettings": []
                                        },
                                        "customColumnWidthSetting": "15ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "sevM",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "yellow",
                                        "customColumnWidthSetting": "15ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "sevL",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "blueDark",
                                        "customColumnWidthSetting": "15ch"
                                      }
                                    }
                                  ],
                                  "rowLimit": 500,
                                  "filter": true,
                                  "labelSettings": [
                                    {
                                      "columnId": "sevH",
                                      "label": "High"
                                    },
                                    {
                                      "columnId": "sevM",
                                      "label": "Medium"
                                    },
                                    {
                                      "columnId": "sevL",
                                      "label": "Low"
                                    }
                                  ]
                                },
                                "sortBy": []
                              },
                              "customWidth": "44",
                              "name": "Overview - ServerTable"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"1195afff-c881-495e-9bc5-1486211ae03f\"\r\n | project Resource = tolower(extract(\"([\\\\s\\\\S]*?)(/providers/Microsoft.Security.*)\",1,id)), ResourceGroup = trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)), ResourceType = tolower(split(id,\"/\").[6]), subscriptionId, severity = tostring(parse_json(properties).status.severity), status = tostring(parse_json(properties).status.code), VulnId = tostring(parse_json(properties).id), description = tostring(parse_json(properties).displayName), patchable = parse_json(properties.additionalData).patchable, cve = parse_json(properties.additionalData).cve\r\n | where status == 'Unhealthy'\r\n | summarize dcount(VulnId) by ResourceGroup, Resource, severity, VulnId, description, tostring(patchable), tostring(cve)\r\n | summarize Total = count(dcount_VulnId), sevH=countif(severity=='High'), sevM=countif(severity=='Medium'), sevL=countif(severity=='Low'), patchAvailable = countif(patchable=='true'), CVEcount =countif(cve!='[]') by ResourceGroup, Resource\r\n | order by sevH desc",
                                "size": 0,
                                "title": "Overview",
                                "exportFieldName": "Resource",
                                "exportParameterName": "selectedServer",
                                "exportDefaultValue": "All",
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkColumn": "Resource",
                                        "linkTarget": "Resource",
                                        "showIcon": true,
                                        "customColumnWidthSetting": "30ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "ResourceGroup",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Resource",
                                      "formatter": 5,
                                      "formatOptions": {
                                        "customColumnWidthSetting": "20ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "Total",
                                      "formatter": 1,
                                      "formatOptions": {
                                        "customColumnWidthSetting": "10ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "sevH",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "palette": "redBright",
                                        "customColumnWidthSetting": "12ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "sevM",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "palette": "yellow",
                                        "customColumnWidthSetting": "13ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "sevL",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "palette": "blueDark",
                                        "customColumnWidthSetting": "10ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "patchAvailable",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "pending",
                                            "text": "{0}{1}"
                                          }
                                        ],
                                        "compositeBarSettings": {
                                          "labelText": "",
                                          "columnSettings": []
                                        },
                                        "customColumnWidthSetting": "20ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "CVEcount",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "4",
                                            "text": "{0}{1}"
                                          }
                                        ],
                                        "customColumnWidthSetting": "10ch"
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "filter": true,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "ResourceGroup"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "Resource"
                                  },
                                  "labelSettings": [
                                    {
                                      "columnId": "ResourceGroup",
                                      "label": "Resource group"
                                    },
                                    {
                                      "columnId": "sevH",
                                      "label": "High"
                                    },
                                    {
                                      "columnId": "sevM",
                                      "label": "Medium"
                                    },
                                    {
                                      "columnId": "sevL",
                                      "label": "Low"
                                    },
                                    {
                                      "columnId": "patchAvailable",
                                      "label": "Available patches"
                                    },
                                    {
                                      "columnId": "CVEcount",
                                      "label": "CVEs"
                                    }
                                  ]
                                },
                                "sortBy": []
                              },
                              "customWidth": "56",
                              "name": "MachinesSummary"
                            },
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "items": [
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"1195afff-c881-495e-9bc5-1486211ae03f\"\r\n| project Resource = tolower(extract(\"([\\\\s\\\\S]*?)(/providers/Microsoft.Security.*)\",1,id)), ResourceGroup = trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)), ResourceType = tolower(split(id,\"/\").[6]), subscriptionId, Severity = tostring(parse_json(properties).status.severity), Status = tostring(parse_json(properties).status.code), VulnId = tostring(parse_json(properties).id), Description = tostring(parse_json(properties).displayName), Patchable = parse_json(properties.additionalData).patchable, CVE = properties.additionalData.cve, Category = tostring(properties.category), TimeGenerated = tostring(properties.timeGenerated), Remediation = tostring(properties.remediation), Impact = tostring(properties.impact), Threat = tostring(properties.additionalData.threat)\r\n| where Status == 'Unhealthy'\r\n| where '{selectedServer}' == 'All' or Resource == '{selectedServer}'\r\n| project Severity, VulnId, Description, tostring(Patchable), Category, Resource, ResourceGroup, CVE, TimeGenerated, Remediation, Impact, Threat\r\n| mv-expand CveExpand = split (CVE, \"},\") to typeof(string)\r\n| parse CveExpand with * '\"title\":\"' singleCve '\"' *\r\n| summarize CVEs = tostring(make_list(singleCve)) by Severity, VulnId, Description, tostring(Patchable), Category, Resource, ResourceGroup, TimeGenerated, Threat, Impact, Remediation",
                                      "size": 3,
                                      "title": "Use the search box to filter vulnerabilities by resource, resource group, CVE, severity, etc.",
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "Severity",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "VulnId",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Resource",
                                            "formatter": 0,
                                            "formatOptions": {
                                              "customColumnWidthSetting": "25ch"
                                            }
                                          },
                                          {
                                            "columnMatch": "TimeGenerated",
                                            "formatter": 6,
                                            "formatOptions": {
                                              "customColumnWidthSetting": "25ch"
                                            }
                                          },
                                          {
                                            "columnMatch": "Remediation",
                                            "formatter": 7,
                                            "formatOptions": {
                                              "linkTarget": "GenericDetails",
                                              "linkIsContextBlade": true
                                            }
                                          }
                                        ],
                                        "rowLimit": 1000,
                                        "filter": true,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "Severity"
                                          ],
                                          "finalBy": "VulnId"
                                        }
                                      },
                                      "sortBy": []
                                    },
                                    "name": "Servers - FullListTable"
                                  }
                                ]
                              },
                              "name": "VulnerabilitiesView"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "submenu",
                          "comparison": "isEqualTo",
                          "value": "vmvulnerabilities"
                        },
                        "name": "VM Vulnerabilities"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "5e8f8ef7-c57e-4c97-8356-67e34bdd1eb1",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "Subscription",
                                    "type": 6,
                                    "isRequired": true,
                                    "multiSelect": true,
                                    "quote": "'",
                                    "delimiter": ",",
                                    "typeSettings": {
                                      "additionalResourceOptions": [
                                        "value::1",
                                        "value::3",
                                        "value::all"
                                      ],
                                      "includeAll": true,
                                      "showDefault": false
                                    },
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "defaultValue": "value::3"
                                  }
                                ],
                                "style": "pills",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "name": "parameters - 5"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "securityresources\r\n | where type == \"microsoft.security/assessments/subassessments\"\r\n | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n | where assessmentKey == \"f97aa83c-9b63-4f9a-99f6-b22c4398f936\" or assessmentKey == \"82e20e14-edc5-4373-bfc4-f13121257c37\"\r\n | project subassessmentKey=name, parse_json(properties) \r\n | extend VulnId = tostring(properties.id), description = tostring(properties.displayName), Severity = tostring(properties.status.severity), Status = tostring(properties.status.code)\r\n | where Status == 'Unhealthy'\r\n | summarize dcount(VulnId) by Severity",
                                "size": 4,
                                "title": "Distinct SQL vulnerabilities by severity",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "piechart",
                                "chartSettings": {
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "High",
                                      "color": "red"
                                    },
                                    {
                                      "color": "orange"
                                    }
                                  ]
                                }
                              },
                              "customWidth": "25",
                              "name": "query - 0"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "securityresources\r\n | where type == \"microsoft.security/assessments\"\r\n | where name == \"f97aa83c-9b63-4f9a-99f6-b22c4398f936\" or name == \"82e20e14-edc5-4373-bfc4-f13121257c37\"\r\n | project ResourceType=tolower(split(id,\"/\").[6]), resourceName=tolower(split(id,\"/\").[8])\r\n | summarize Count=dcount(resourceName) by ResourceType",
                                "size": 3,
                                "title": "Unhealthy SQL resources by type",
                                "noDataMessage": "No unhealthy SQL resources found",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "ResourceType",
                                      "formatter": 16,
                                      "formatOptions": {
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "Count",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "4",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                },
                                "tileSettings": {
                                  "showBorder": false,
                                  "titleContent": {
                                    "columnMatch": "Column1",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "IncidentCount",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "customWidth": "25",
                              "name": "Unhealthy SQL resources by type"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"f97aa83c-9b63-4f9a-99f6-b22c4398f936\" or assessmentKey == \"82e20e14-edc5-4373-bfc4-f13121257c37\"\r\n | project Resource = tolower(extract(\"([\\\\s\\\\S]*?)(/providers/Microsoft.Security.*)\",1,id)), Severity = tostring(parse_json(properties).status.severity), Status = tostring(parse_json(properties).status.code), VulnId = tostring(parse_json(properties).id), Database = parse_json(properties.resourceDetails).id\r\n | where Status == 'Unhealthy'\r\n | summarize dcount(VulnId) by Resource, Severity, VulnId, tostring(Database)\r\n | summarize Total = count(dcount_VulnId), sevH=countif(Severity=='High'), sevM=countif(Severity=='Medium'), sevL=countif(Severity=='Low') by Resource, Database\r\n | order by sevH desc",
                                "size": 3,
                                "title": "Vulnerable databases per server",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "Resource",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Database",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "sevH",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "palette": "redBright"
                                      }
                                    },
                                    {
                                      "columnMatch": "sevM",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "palette": "yellow",
                                        "customColumnWidthSetting": "15ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "sevL",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "palette": "blueDark"
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "Resource"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "Database"
                                  },
                                  "labelSettings": [
                                    {
                                      "columnId": "sevH",
                                      "label": "High"
                                    },
                                    {
                                      "columnId": "sevM",
                                      "label": "Medium"
                                    },
                                    {
                                      "columnId": "sevL",
                                      "label": "Low"
                                    }
                                  ]
                                },
                                "sortBy": []
                              },
                              "customWidth": "50",
                              "name": "Vulnerable databases per server"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "List of Vulnerable DB",
                                "style": "warning"
                              },
                              "name": "text - 5"
                            },
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "parameters": [
                                  {
                                    "id": "d2a731c6-cfc4-43da-8886-ff60a47623a1",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "GroupBy",
                                    "label": "Group by",
                                    "type": 2,
                                    "isRequired": true,
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "jsonData": "[\r\n    { \"value\":\"resource\", \"label\":\"Resource\", \"selected\":true },\r\n    { \"value\":\"severity\", \"label\":\"Severity\" },\r\n    { \"value\":\"category\", \"label\":\"Category\" },\r\n    { \"value\":\"benchmark\", \"label\":\"Benchmark\" }\r\n]",
                                    "timeContext": {
                                      "durationMs": 86400000
                                    },
                                    "value": "severity"
                                  }
                                ],
                                "style": "pills",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "name": "Grouping"
                            },
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "items": [
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"f97aa83c-9b63-4f9a-99f6-b22c4398f936\" or assessmentKey == \"82e20e14-edc5-4373-bfc4-f13121257c37\"\r\n | project Resource = tolower(extract(\"([\\\\s\\\\S]*?)(/providers/Microsoft.Security.*)\",1,id)), ResourceGroup = trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)), ResourceType = tolower(split(id,\"/\").[6]), subscriptionId, Severity = tostring(parse_json(properties).status.severity), status = tostring(parse_json(properties).status.code), VulnId = tostring(parse_json(properties).id), Description = tostring(parse_json(properties).displayName), Category = tostring(properties.category), TimeGenerated = tostring(properties.timeGenerated), Remediation = tostring(properties.remediation), Impact = tostring(properties.impact), Database = parse_json(properties.resourceDetails).id, Benchmarks = parse_json(properties.additionalData).benchmarks\r\n | mvexpand Benchmarks\r\n | extend Benchmark = parse_json(Benchmarks).benchmark \r\n | where status == 'Unhealthy'\r\n | project Severity, VulnId, Description, Category, Resource, Database, ResourceGroup, TimeGenerated, tostring(Benchmark), Remediation, Impact",
                                      "size": 3,
                                      "title": "Grouped by benchmark | Use the search box to filter vulnerabilities by resource, resource group, severity, etc.",
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "$gen_group",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "Database",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "TimeGenerated",
                                            "formatter": 6
                                          }
                                        ],
                                        "rowLimit": 1000,
                                        "filter": true,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "Benchmark"
                                          ],
                                          "expandTopLevel": false
                                        },
                                        "labelSettings": [
                                          {
                                            "columnId": "ResourceGroup",
                                            "label": "Resource group"
                                          },
                                          {
                                            "columnId": "TimeGenerated",
                                            "label": "Time generated"
                                          }
                                        ]
                                      }
                                    },
                                    "conditionalVisibility": {
                                      "parameterName": "GroupBy",
                                      "comparison": "isEqualTo",
                                      "value": "benchmark"
                                    },
                                    "name": "GroupByBenchmark"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"f97aa83c-9b63-4f9a-99f6-b22c4398f936\" or assessmentKey == \"82e20e14-edc5-4373-bfc4-f13121257c37\"\r\n | project Resource = tolower(extract(\"([\\\\s\\\\S]*?)(/providers/Microsoft.Security.*)\",1,id)), ResourceGroup = trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)), ResourceType = tolower(split(id,\"/\").[6]), subscriptionId, Severity = tostring(parse_json(properties).status.severity), status = tostring(parse_json(properties).status.code), VulnId = tostring(parse_json(properties).id), Description = tostring(parse_json(properties).displayName), Category = tostring(properties.category), TimeGenerated = tostring(properties.timeGenerated), Remediation = tostring(properties.remediation), Impact = tostring(properties.impact), Database = parse_json(properties.resourceDetails).id\r\n | where status == 'Unhealthy'\r\n\r\n | project Severity, VulnId, Description, Category, Resource, Database, ResourceGroup, TimeGenerated, Remediation, Impact",
                                      "size": 3,
                                      "title": "Grouped by resource | Use the search box to filter vulnerabilities by resource, resource group, severity, etc.",
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "$gen_group",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "Database",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "TimeGenerated",
                                            "formatter": 6
                                          }
                                        ],
                                        "rowLimit": 1000,
                                        "filter": true,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "Resource"
                                          ],
                                          "expandTopLevel": false
                                        },
                                        "labelSettings": [
                                          {
                                            "columnId": "ResourceGroup",
                                            "label": "Resource group"
                                          },
                                          {
                                            "columnId": "TimeGenerated",
                                            "label": "Time generated"
                                          }
                                        ]
                                      }
                                    },
                                    "conditionalVisibility": {
                                      "parameterName": "GroupBy",
                                      "comparison": "isEqualTo",
                                      "value": "resource"
                                    },
                                    "name": "GroupByResource"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"f97aa83c-9b63-4f9a-99f6-b22c4398f936\" or assessmentKey == \"82e20e14-edc5-4373-bfc4-f13121257c37\"\r\n | project Resource = tolower(extract(\"([\\\\s\\\\S]*?)(/providers/Microsoft.Security.*)\",1,id)), ResourceGroup = trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)), ResourceType = tolower(split(id,\"/\").[6]), subscriptionId, Severity = tostring(parse_json(properties).status.severity), status = tostring(parse_json(properties).status.code), VulnId = tostring(parse_json(properties).id), Description = tostring(parse_json(properties).displayName), Category = tostring(properties.category), TimeGenerated = tostring(properties.timeGenerated), Remediation = tostring(properties.remediation), Impact = tostring(properties.impact), Database = parse_json(properties.resourceDetails).id\r\n | where status == 'Unhealthy'\r\n\r\n | project Severity, VulnId, Description, Category, Resource, Database, ResourceGroup, TimeGenerated, Remediation, Impact",
                                      "size": 3,
                                      "title": "Grouped by severity | Use the search box to filter vulnerabilities by resource, resource group, severity, etc.",
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "$gen_group",
                                            "formatter": 0,
                                            "formatOptions": {
                                              "customColumnWidthSetting": "20ch"
                                            }
                                          },
                                          {
                                            "columnMatch": "Database",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "TimeGenerated",
                                            "formatter": 6
                                          }
                                        ],
                                        "rowLimit": 1000,
                                        "filter": true,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "Severity"
                                          ],
                                          "expandTopLevel": false
                                        },
                                        "labelSettings": [
                                          {
                                            "columnId": "ResourceGroup",
                                            "label": "Resource group"
                                          },
                                          {
                                            "columnId": "TimeGenerated",
                                            "label": "Time generated"
                                          }
                                        ]
                                      }
                                    },
                                    "conditionalVisibility": {
                                      "parameterName": "GroupBy",
                                      "comparison": "isEqualTo",
                                      "value": "severity"
                                    },
                                    "name": "GroupBySeverity"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"f97aa83c-9b63-4f9a-99f6-b22c4398f936\" or assessmentKey == \"82e20e14-edc5-4373-bfc4-f13121257c37\"\r\n | project Resource = tolower(extract(\"([\\\\s\\\\S]*?)(/providers/Microsoft.Security.*)\",1,id)), ResourceGroup = trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)), ResourceType = tolower(split(id,\"/\").[6]), subscriptionId, Severity = tostring(parse_json(properties).status.severity), status = tostring(parse_json(properties).status.code), VulnId = tostring(parse_json(properties).id), Description = tostring(parse_json(properties).displayName), Category = tostring(properties.category), TimeGenerated = tostring(properties.timeGenerated), Remediation = tostring(properties.remediation), Impact = tostring(properties.impact), Database = parse_json(properties.resourceDetails).id, Benchmarks = parse_json(properties.additionalData).benchmarks\r\n | mvexpand Benchmarks\r\n | extend Benchmark = parse_json(Benchmarks).benchmark \r\n | where status == 'Unhealthy'\r\n\r\n | project Severity, VulnId, Description, Category, Resource, Database, ResourceGroup, TimeGenerated, tostring(Benchmark), Remediation, Impact",
                                      "size": 3,
                                      "title": "Grouped by category | Use the search box to filter vulnerabilities by resource, resource group, severity, etc.",
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "$gen_group",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true,
                                              "customColumnWidthSetting": "40ch"
                                            }
                                          },
                                          {
                                            "columnMatch": "Database",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": null,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "TimeGenerated",
                                            "formatter": 6
                                          }
                                        ],
                                        "rowLimit": 1000,
                                        "filter": true,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "Category"
                                          ],
                                          "expandTopLevel": false
                                        },
                                        "labelSettings": [
                                          {
                                            "columnId": "ResourceGroup",
                                            "label": "Resource group"
                                          },
                                          {
                                            "columnId": "TimeGenerated",
                                            "label": "Time generated"
                                          }
                                        ]
                                      }
                                    },
                                    "conditionalVisibility": {
                                      "parameterName": "GroupBy",
                                      "comparison": "isEqualTo",
                                      "value": "category"
                                    },
                                    "name": "GroupByCategory"
                                  }
                                ]
                              },
                              "name": "SQLVulnerabilitiesGroup"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "submenu",
                          "comparison": "isEqualTo",
                          "value": "dbvulnerabilities"
                        },
                        "name": "DB Vulnerabilities"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "vulnerabilities"
                  },
                  "name": "Vulnerabilities"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type =~ \"microsoft.network/networksecuritygroups\"\r\n| join kind=leftouter (resourcecontainers | where type =='microsoft.resources/subscriptions' | project SubscriptionName=name, subscriptionId) on subscriptionId\r\n|mv-expand rules=properties.securityRules\r\n|extend direction=tostring(rules.properties.direction)\r\n|extend priority=toint(rules.properties.priority)\r\n|extend rule_name = rules.name\r\n|extend nsg_name = name\r\n|extend description=rules.properties.description\r\n|extend destination_prefix=iif(rules.properties.destinationAddressPrefixes=='[]', rules.properties.destinationAddressPrefix, strcat_array(rules.properties.destinationAddressPrefixes, \",\"))\r\n|extend destination_asgs=iif(isempty(rules.properties.destinationApplicationSecurityGroups), '', strcat_array(parse_json(rules.properties.destinationApplicationSecurityGroups), \",\"))\r\n|extend destination=iif(isempty(destination_asgs), destination_prefix, destination_asgs)\r\n|extend destination=iif(destination=='*', \"Any\", destination)\r\n|extend destination_port=iif(isempty(rules.properties.destinationPortRange), strcat_array(rules.properties.destinationPortRanges,\",\"), rules.properties.destinationPortRange)\r\n|extend source_prefix=iif(rules.properties.sourceAddressPrefixes=='[]', rules.properties.sourceAddressPrefix, strcat_array(rules.properties.sourceAddressPrefixes, \",\"))\r\n|extend source_asgs=iif(isempty(rules.properties.sourceApplicationSecurityGroups), \"\", strcat_array(parse_json(rules.properties.sourceApplicationSecurityGroups), \",\"))\r\n|extend source=iif(isempty(source_asgs), source_prefix, tostring(source_asgs))\r\n|extend source=iif(source=='*', 'Any', source)\r\n|extend source_port=iif(isempty(rules.properties.sourcePortRange), strcat_array(rules.properties.sourcePortRanges,\",\"), rules.properties.sourcePortRange)\r\n|extend action=rules.properties.access\r\n|extend subnets = strcat_array(properties.subnets, \",\")\r\n|where (destination == \"Any\" and action == \"Allow\")  or (source ==\"Any\" and action == \"Allow\" and direction ==\"Inbound\")  or (destination_port == \"*\" and action == \"Allow\")\r\n| summarize c = count()\r\n| extend Item = \"Over Permissive NSG\",  Key = 1\r\n",
                          "size": 3,
                          "noDataMessageStyle": 5,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "c",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "Count",
                            "sizeAggregation": "Sum",
                            "legendMetric": "Count",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "Count",
                              "heatmapPalette": "greenRed"
                            }
                          },
                          "textSettings": {
                            "style": "bignumber"
                          }
                        },
                        "name": "Count of Rules That Allowing Traffic to Any Destination - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type =~ \"microsoft.network/networksecuritygroups\"\r\n| join kind=leftouter (resourcecontainers | where type =='microsoft.resources/subscriptions' | project SubscriptionName=name, subscriptionId) on subscriptionId\r\n|mv-expand rules=properties.securityRules\r\n|extend direction=tostring(rules.properties.direction)\r\n|extend priority=toint(rules.properties.priority)\r\n|extend rule_name = rules.name\r\n|extend nsg_name = name\r\n|extend description=rules.properties.description\r\n|extend destination_prefix=iif(rules.properties.destinationAddressPrefixes=='[]', rules.properties.destinationAddressPrefix, strcat_array(rules.properties.destinationAddressPrefixes, \",\"))\r\n|extend destination_asgs=iif(isempty(rules.properties.destinationApplicationSecurityGroups), '', strcat_array(parse_json(rules.properties.destinationApplicationSecurityGroups), \",\"))\r\n|extend destination=iif(isempty(destination_asgs), destination_prefix, destination_asgs)\r\n|extend destination=iif(destination=='*', \"Any\", destination)\r\n|extend destination_port=iif(isempty(rules.properties.destinationPortRange), strcat_array(rules.properties.destinationPortRanges,\",\"), rules.properties.destinationPortRange)\r\n|extend source_prefix=iif(rules.properties.sourceAddressPrefixes=='[]', rules.properties.sourceAddressPrefix, strcat_array(rules.properties.sourceAddressPrefixes, \",\"))\r\n|extend source_asgs=iif(isempty(rules.properties.sourceApplicationSecurityGroups), \"\", strcat_array(parse_json(rules.properties.sourceApplicationSecurityGroups), \",\"))\r\n|extend source=iif(isempty(source_asgs), source_prefix, tostring(source_asgs))\r\n|extend source=iif(source=='*', 'Any', source)\r\n|extend source_port=iif(isempty(rules.properties.sourcePortRange), strcat_array(rules.properties.sourcePortRanges,\",\"), rules.properties.sourcePortRange)\r\n|extend action=rules.properties.access\r\n|extend subnets = strcat_array(properties.subnets, \",\")\r\n|where (destination == \"Any\" and action == \"Allow\")  or (source ==\"Any\" and action == \"Allow\" and direction ==\"Inbound\")  or (destination_port == \"*\" and action == \"Allow\")\r\n\r\n|project direction,id ,rule_name, SubscriptionName, resourceGroup,   action, source, source_port, destination, destination_port, description,   priority\r\n|sort by SubscriptionName, resourceGroup asc,  direction asc, priority asc\r\n",
                          "size": 3,
                          "noDataMessageStyle": 5,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Item",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "c",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "Count",
                            "sizeAggregation": "Sum",
                            "legendMetric": "Count",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "Count",
                              "heatmapPalette": "greenRed"
                            }
                          },
                          "textSettings": {
                            "style": "bignumber"
                          }
                        },
                        "name": "Count of Rules That Allowing Traffic to Any Destination - Copy - Copy"
                      },
                      {
                        "type": 11,
                        "content": {
                          "version": "LinkItem/1.0",
                          "style": "paragraph",
                          "links": [
                            {
                              "id": "6fd83c56-0130-451d-a883-8d2ab4e94910",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "Outbound Traffic to All Destination Port's",
                              "subTarget": "Outbound Traffic to All Destination Ports",
                              "preText": "",
                              "style": "primary"
                            },
                            {
                              "id": "57ce2c48-7b3e-4204-809e-0d7e985288e9",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "Inbound Traffic From All Source IP's",
                              "subTarget": "Inbound Traffic From Any IP",
                              "preText": "",
                              "style": "primary"
                            },
                            {
                              "id": "6d587a23-8f5a-4554-9b5d-771719294720",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "Outbound Traffic To All Destinations  IP's",
                              "subTarget": "Outbound Traffic To Any IP",
                              "style": "primary"
                            }
                          ]
                        },
                        "name": "links - 5"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ \"microsoft.network/networksecuritygroups\"\r\n| join kind=leftouter (resourcecontainers | where type =='microsoft.resources/subscriptions' | project SubscriptionName=name, subscriptionId) on subscriptionId\r\n|mv-expand rules=properties.securityRules\r\n|extend direction=tostring(rules.properties.direction)\r\n|extend priority=toint(rules.properties.priority)\r\n|extend rule_name = rules.name\r\n|extend nsg_name = name\r\n|extend description=rules.properties.description\r\n|extend destination_prefix=iif(rules.properties.destinationAddressPrefixes=='[]', rules.properties.destinationAddressPrefix, strcat_array(rules.properties.destinationAddressPrefixes, \",\"))\r\n|extend destination_asgs=iif(isempty(rules.properties.destinationApplicationSecurityGroups), '', strcat_array(parse_json(rules.properties.destinationApplicationSecurityGroups), \",\"))\r\n|extend destination=iif(isempty(destination_asgs), destination_prefix, destination_asgs)\r\n|extend destination=iif(destination=='*', \"Any\", destination)\r\n|extend destination_port=iif(isempty(rules.properties.destinationPortRange), strcat_array(rules.properties.destinationPortRanges,\",\"), rules.properties.destinationPortRange)\r\n|extend source_prefix=iif(rules.properties.sourceAddressPrefixes=='[]', rules.properties.sourceAddressPrefix, strcat_array(rules.properties.sourceAddressPrefixes, \",\"))\r\n|extend source_asgs=iif(isempty(rules.properties.sourceApplicationSecurityGroups), \"\", strcat_array(parse_json(rules.properties.sourceApplicationSecurityGroups), \",\"))\r\n|extend source=iif(isempty(source_asgs), source_prefix, tostring(source_asgs))\r\n|extend source=iif(source=='*', 'Any', source)\r\n|extend source_port=iif(isempty(rules.properties.sourcePortRange), strcat_array(rules.properties.sourcePortRanges,\",\"), rules.properties.sourcePortRange)\r\n|extend action=rules.properties.access\r\n|extend subnets = strcat_array(properties.subnets, \",\")\r\n|where destination_port == \"*\" and action==\"Allow\"\r\n| summarize c = count()\r\n| extend Item = \"Outbound Traffic to All Destination Port's\",  Key = 1",
                                "size": 3,
                                "noDataMessageStyle": 5,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Item",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "c",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "showBorder": true,
                                  "size": "auto"
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "name": "Traffic to All Destination Ports"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "List of Rules That Allowing Outbound Traffic to All Destination Port's",
                                "style": "warning"
                              },
                              "name": "text - 2"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ \"microsoft.network/networksecuritygroups\"\r\n| join kind=leftouter (resourcecontainers | where type =='microsoft.resources/subscriptions' | project SubscriptionName=name, subscriptionId) on subscriptionId\r\n|mv-expand rules=properties.securityRules\r\n|extend direction=tostring(rules.properties.direction)\r\n|extend priority=toint(rules.properties.priority)\r\n|extend rule_name = rules.name\r\n|extend nsg_name = name\r\n|extend description=rules.properties.description\r\n|extend destination_prefix=iif(rules.properties.destinationAddressPrefixes=='[]', rules.properties.destinationAddressPrefix, strcat_array(rules.properties.destinationAddressPrefixes, \",\"))\r\n|extend destination_asgs=iif(isempty(rules.properties.destinationApplicationSecurityGroups), '', strcat_array(parse_json(rules.properties.destinationApplicationSecurityGroups), \",\"))\r\n|extend destination=iif(isempty(destination_asgs), destination_prefix, destination_asgs)\r\n|extend destination=iif(destination=='*', \"Any\", destination)\r\n|extend destination_port=iif(isempty(rules.properties.destinationPortRange), strcat_array(rules.properties.destinationPortRanges,\",\"), rules.properties.destinationPortRange)\r\n|extend source_prefix=iif(rules.properties.sourceAddressPrefixes=='[]', rules.properties.sourceAddressPrefix, strcat_array(rules.properties.sourceAddressPrefixes, \",\"))\r\n|extend source_asgs=iif(isempty(rules.properties.sourceApplicationSecurityGroups), \"\", strcat_array(parse_json(rules.properties.sourceApplicationSecurityGroups), \",\"))\r\n|extend source=iif(isempty(source_asgs), source_prefix, tostring(source_asgs))\r\n|extend source=iif(source=='*', 'Any', source)\r\n|extend source_port=iif(isempty(rules.properties.sourcePortRange), strcat_array(rules.properties.sourcePortRanges,\",\"), rules.properties.sourcePortRange)\r\n|extend action=rules.properties.access\r\n|extend subnets = strcat_array(properties.subnets, \",\")\r\n|where destination_port == \"*\" and action==\"Allow\"\r\n|project direction,id ,rule_name, SubscriptionName, resourceGroup,   action, source, source_port, destination, destination_port, description,   priority\r\n|sort by SubscriptionName, resourceGroup asc,  direction asc, priority asc",
                                "size": 3,
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "SubscriptionName",
                                      "formatter": 16,
                                      "formatOptions": {
                                        "showIcon": true
                                      }
                                    }
                                  ],
                                  "filter": true,
                                  "labelSettings": [
                                    {
                                      "columnId": "direction",
                                      "label": "Direction"
                                    },
                                    {
                                      "columnId": "rule_name",
                                      "label": "Rule"
                                    },
                                    {
                                      "columnId": "SubscriptionName",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "resourceGroup",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "action",
                                      "label": "Action"
                                    },
                                    {
                                      "columnId": "source",
                                      "label": "Source"
                                    },
                                    {
                                      "columnId": "source_port",
                                      "label": "Source Port"
                                    },
                                    {
                                      "columnId": "destination",
                                      "label": "Destination"
                                    },
                                    {
                                      "columnId": "destination_port",
                                      "label": "Destionation Port"
                                    },
                                    {
                                      "columnId": "description",
                                      "label": "Description"
                                    },
                                    {
                                      "columnId": "priority",
                                      "label": "Priority"
                                    }
                                  ]
                                }
                              },
                              "name": "List of Rules That Allowing Traffic to All Ports"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "buttonname",
                          "comparison": "isEqualTo",
                          "value": "Outbound Traffic to All Destination Ports"
                        },
                        "name": "Outbound Traffic to All Destination Ports"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ \"microsoft.network/networksecuritygroups\"\r\n| join kind=leftouter (resourcecontainers | where type =='microsoft.resources/subscriptions' | project SubscriptionName=name, subscriptionId) on subscriptionId\r\n|mv-expand rules=properties.securityRules\r\n|extend direction=tostring(rules.properties.direction)\r\n|extend priority=toint(rules.properties.priority)\r\n|extend rule_name = rules.name\r\n|extend nsg_name = name\r\n|extend description=rules.properties.description\r\n|extend destination_prefix=iif(rules.properties.destinationAddressPrefixes=='[]', rules.properties.destinationAddressPrefix, strcat_array(rules.properties.destinationAddressPrefixes, \",\"))\r\n|extend destination_asgs=iif(isempty(rules.properties.destinationApplicationSecurityGroups), '', strcat_array(parse_json(rules.properties.destinationApplicationSecurityGroups), \",\"))\r\n|extend destination=iif(isempty(destination_asgs), destination_prefix, destination_asgs)\r\n|extend destination=iif(destination=='*', \"Any\", destination)\r\n|extend destination_port=iif(isempty(rules.properties.destinationPortRange), strcat_array(rules.properties.destinationPortRanges,\",\"), rules.properties.destinationPortRange)\r\n|extend source_prefix=iif(rules.properties.sourceAddressPrefixes=='[]', rules.properties.sourceAddressPrefix, strcat_array(rules.properties.sourceAddressPrefixes, \",\"))\r\n|extend source_asgs=iif(isempty(rules.properties.sourceApplicationSecurityGroups), \"\", strcat_array(parse_json(rules.properties.sourceApplicationSecurityGroups), \",\"))\r\n|extend source=iif(isempty(source_asgs), source_prefix, tostring(source_asgs))\r\n|extend source=iif(source=='*', 'Any', source)\r\n|extend source_port=iif(isempty(rules.properties.sourcePortRange), strcat_array(rules.properties.sourcePortRanges,\",\"), rules.properties.sourcePortRange)\r\n|extend action=rules.properties.access\r\n|extend subnets = strcat_array(properties.subnets, \",\")\r\n|where source == \"Any\" and action==\"Allow\" and direction ==\"Inbound\"\r\n|project SubscriptionName, resourceGroup, nsg_name, rule_name, subnets, direction, priority, action, source, source_port, destination, destination_port, description\r\n|sort by SubscriptionName, resourceGroup asc, nsg_name, direction asc, priority asc\r\n| summarize c = count()\r\n| extend Item = \"Traffic From All Source IP's\",  Key = 1",
                                "size": 4,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Item"
                                  },
                                  "leftContent": {
                                    "columnMatch": "c",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    }
                                  },
                                  "showBorder": true,
                                  "size": "auto"
                                }
                              },
                              "name": "Inbound Traffic from Any IP"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "List of Rules That Allowing Inbound Traffic From All Source IP's",
                                "style": "warning"
                              },
                              "name": "text - 2"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ \"microsoft.network/networksecuritygroups\"\r\n| join kind=leftouter (resourcecontainers | where type =='microsoft.resources/subscriptions' | project SubscriptionName=name, subscriptionId) on subscriptionId\r\n|mv-expand rules=properties.securityRules\r\n|extend direction=tostring(rules.properties.direction)\r\n|extend priority=toint(rules.properties.priority)\r\n|extend rule_name = rules.name\r\n|extend nsg_name = name\r\n|extend description=rules.properties.description\r\n|extend destination_prefix=iif(rules.properties.destinationAddressPrefixes=='[]', rules.properties.destinationAddressPrefix, strcat_array(rules.properties.destinationAddressPrefixes, \",\"))\r\n|extend destination_asgs=iif(isempty(rules.properties.destinationApplicationSecurityGroups), '', strcat_array(parse_json(rules.properties.destinationApplicationSecurityGroups), \",\"))\r\n|extend destination=iif(isempty(destination_asgs), destination_prefix, destination_asgs)\r\n|extend destination=iif(destination=='*', \"Any\", destination)\r\n|extend destination_port=iif(isempty(rules.properties.destinationPortRange), strcat_array(rules.properties.destinationPortRanges,\",\"), rules.properties.destinationPortRange)\r\n|extend source_prefix=iif(rules.properties.sourceAddressPrefixes=='[]', rules.properties.sourceAddressPrefix, strcat_array(rules.properties.sourceAddressPrefixes, \",\"))\r\n|extend source_asgs=iif(isempty(rules.properties.sourceApplicationSecurityGroups), \"\", strcat_array(parse_json(rules.properties.sourceApplicationSecurityGroups), \",\"))\r\n|extend source=iif(isempty(source_asgs), source_prefix, tostring(source_asgs))\r\n|extend source=iif(source=='*', 'Any', source)\r\n|extend source_port=iif(isempty(rules.properties.sourcePortRange), strcat_array(rules.properties.sourcePortRanges,\",\"), rules.properties.sourcePortRange)\r\n|extend action=rules.properties.access\r\n|extend subnets = strcat_array(properties.subnets, \",\")\r\n|where source == \"Any\" and action==\"Allow\" and direction ==\"Inbound\"\r\n|project direction,id ,rule_name, SubscriptionName, resourceGroup,   action, source, source_port, destination, destination_port, description,   priority\r\n|sort by SubscriptionName, resourceGroup asc,  direction asc, priority asc",
                                "size": 3,
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "labelSettings": [
                                    {
                                      "columnId": "direction",
                                      "label": "Direction"
                                    },
                                    {
                                      "columnId": "rule_name",
                                      "label": "Rule"
                                    },
                                    {
                                      "columnId": "SubscriptionName",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "resourceGroup",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "action",
                                      "label": "Action"
                                    },
                                    {
                                      "columnId": "source",
                                      "label": "Source"
                                    },
                                    {
                                      "columnId": "source_port",
                                      "label": "Source Port"
                                    },
                                    {
                                      "columnId": "destination",
                                      "label": "Destinmation"
                                    },
                                    {
                                      "columnId": "destination_port",
                                      "label": "Destinmation Port"
                                    },
                                    {
                                      "columnId": "description",
                                      "label": "Description"
                                    },
                                    {
                                      "columnId": "priority",
                                      "label": "Priority"
                                    }
                                  ]
                                }
                              },
                              "name": "Inbound Traffic from Any IP"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "buttonname",
                          "comparison": "isEqualTo",
                          "value": "Inbound Traffic From Any IP"
                        },
                        "name": "Inbound Traffic From Any IP"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ \"microsoft.network/networksecuritygroups\"\r\n| join kind=leftouter (resourcecontainers | where type =='microsoft.resources/subscriptions' | project SubscriptionName=name, subscriptionId) on subscriptionId\r\n|mv-expand rules=properties.securityRules\r\n|extend direction=tostring(rules.properties.direction)\r\n|extend priority=toint(rules.properties.priority)\r\n|extend rule_name = rules.name\r\n|extend nsg_name = name\r\n|extend description=rules.properties.description\r\n|extend destination_prefix=iif(rules.properties.destinationAddressPrefixes=='[]', rules.properties.destinationAddressPrefix, strcat_array(rules.properties.destinationAddressPrefixes, \",\"))\r\n|extend destination_asgs=iif(isempty(rules.properties.destinationApplicationSecurityGroups), '', strcat_array(parse_json(rules.properties.destinationApplicationSecurityGroups), \",\"))\r\n|extend destination=iif(isempty(destination_asgs), destination_prefix, destination_asgs)\r\n|extend destination=iif(destination=='*', \"Any\", destination)\r\n|extend destination_port=iif(isempty(rules.properties.destinationPortRange), strcat_array(rules.properties.destinationPortRanges,\",\"), rules.properties.destinationPortRange)\r\n|extend source_prefix=iif(rules.properties.sourceAddressPrefixes=='[]', rules.properties.sourceAddressPrefix, strcat_array(rules.properties.sourceAddressPrefixes, \",\"))\r\n|extend source_asgs=iif(isempty(rules.properties.sourceApplicationSecurityGroups), \"\", strcat_array(parse_json(rules.properties.sourceApplicationSecurityGroups), \",\"))\r\n|extend source=iif(isempty(source_asgs), source_prefix, tostring(source_asgs))\r\n|extend source=iif(source=='*', 'Any', source)\r\n|extend source_port=iif(isempty(rules.properties.sourcePortRange), strcat_array(rules.properties.sourcePortRanges,\",\"), rules.properties.sourcePortRange)\r\n|extend action=rules.properties.access\r\n|extend subnets = strcat_array(properties.subnets, \",\")\r\n|where destination == \"Any\" and action== \"Allow\"\r\n| summarize c = count() \r\n| extend Item = \"Rules allowing Outbound Traffic To All Destinations  IP's\",  Key = 1\r\n",
                                "size": 3,
                                "noDataMessageStyle": 5,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Item",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "c",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "showBorder": true,
                                  "size": "auto"
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "name": "Count of Rules That Allowing Traffic to Any Destination"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "List of Rules That Allowing Outbound Traffic To All Destinations  IP's",
                                "style": "warning"
                              },
                              "name": "text - 2"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ \"microsoft.network/networksecuritygroups\"\r\n| join kind=leftouter (resourcecontainers | where type =='microsoft.resources/subscriptions' | project SubscriptionName=name, subscriptionId) on subscriptionId\r\n|mv-expand rules=properties.securityRules\r\n|extend direction=tostring(rules.properties.direction)\r\n|extend priority=toint(rules.properties.priority)\r\n|extend rule_name = rules.name\r\n|extend nsg_name = name\r\n|extend description=rules.properties.description\r\n|extend destination_prefix=iif(rules.properties.destinationAddressPrefixes=='[]', rules.properties.destinationAddressPrefix, strcat_array(rules.properties.destinationAddressPrefixes, \",\"))\r\n|extend destination_asgs=iif(isempty(rules.properties.destinationApplicationSecurityGroups), '', strcat_array(parse_json(rules.properties.destinationApplicationSecurityGroups), \",\"))\r\n|extend destination=iif(isempty(destination_asgs), destination_prefix, destination_asgs)\r\n|extend destination=iif(destination=='*', \"Any\", destination)\r\n|extend destination_port=iif(isempty(rules.properties.destinationPortRange), strcat_array(rules.properties.destinationPortRanges,\",\"), rules.properties.destinationPortRange)\r\n|extend source_prefix=iif(rules.properties.sourceAddressPrefixes=='[]', rules.properties.sourceAddressPrefix, strcat_array(rules.properties.sourceAddressPrefixes, \",\"))\r\n|extend source_asgs=iif(isempty(rules.properties.sourceApplicationSecurityGroups), \"\", strcat_array(parse_json(rules.properties.sourceApplicationSecurityGroups), \",\"))\r\n|extend source=iif(isempty(source_asgs), source_prefix, tostring(source_asgs))\r\n|extend source=iif(source=='*', 'Any', source)\r\n|extend source_port=iif(isempty(rules.properties.sourcePortRange), strcat_array(rules.properties.sourcePortRanges,\",\"), rules.properties.sourcePortRange)\r\n|extend action=rules.properties.access\r\n|extend subnets = strcat_array(properties.subnets, \",\")\r\n|where destination == \"Any\" and action== \"Allow\"\r\n|project direction,id ,rule_name, SubscriptionName, resourceGroup,   action, source, source_port, destination, destination_port, description,   priority\r\n|sort by SubscriptionName, resourceGroup asc,  direction asc, priority asc",
                                "size": 3,
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "SubscriptionName",
                                      "formatter": 16,
                                      "formatOptions": {
                                        "showIcon": true
                                      }
                                    }
                                  ],
                                  "filter": true,
                                  "labelSettings": [
                                    {
                                      "columnId": "direction",
                                      "label": "Direction"
                                    },
                                    {
                                      "columnId": "rule_name",
                                      "label": "Rule"
                                    },
                                    {
                                      "columnId": "SubscriptionName",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "resourceGroup",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "action",
                                      "label": "Action"
                                    },
                                    {
                                      "columnId": "source",
                                      "label": "Source"
                                    },
                                    {
                                      "columnId": "source_port",
                                      "label": "Source Port"
                                    },
                                    {
                                      "columnId": "destination",
                                      "label": "Destination"
                                    },
                                    {
                                      "columnId": "destination_port",
                                      "label": "Destination Port"
                                    },
                                    {
                                      "columnId": "description",
                                      "label": "Description"
                                    },
                                    {
                                      "columnId": "priority",
                                      "label": "Priority"
                                    }
                                  ]
                                }
                              },
                              "name": "List Of Rules That Allowing Traffic to All Destinations"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "buttonname",
                          "comparison": "isEqualTo",
                          "value": "Outbound Traffic To Any IP"
                        },
                        "name": "Rules allowing Traffic to All Destination"
                      }
                    ]
                  },
                  "customWidth": "100",
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "overpermissivensg"
                  },
                  "name": "Overpermissive NSG"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 11,
                        "content": {
                          "version": "LinkItem/1.0",
                          "style": "tabs",
                          "links": [
                            {
                              "id": "6fd83c56-0130-451d-a883-8d2ab4e94910",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "Availability Set",
                              "subTarget": "orphanavailabilityset",
                              "preText": "",
                              "style": "secondary"
                            },
                            {
                              "id": "57ce2c48-7b3e-4204-809e-0d7e985288e9",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "Disk",
                              "subTarget": "orphandisk",
                              "preText": "",
                              "style": "secondary"
                            },
                            {
                              "id": "6d587a23-8f5a-4554-9b5d-771719294720",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "IP Addresses",
                              "subTarget": "orphanip",
                              "style": "secondary"
                            },
                            {
                              "id": "2cc0eae2-fa7b-4ae7-b5da-9e71ec702b3e",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "NIC",
                              "subTarget": "orphannic",
                              "style": "secondary"
                            },
                            {
                              "id": "716a5b8a-0c1b-43c1-bb1b-57f0a596bb2e",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "NSG",
                              "subTarget": "orphannsg",
                              "style": "secondary"
                            },
                            {
                              "id": "8240e492-7559-449c-a16e-8fac9993d60e",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "ASG",
                              "subTarget": "orphanasg",
                              "style": "secondary"
                            },
                            {
                              "id": "0053f2bd-f0ca-45ea-8f09-7b1b82a24083",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "LB",
                              "subTarget": "orphanlb",
                              "style": "secondary"
                            },
                            {
                              "id": "25d74e53-eff1-4747-aaec-4dc6c4790428",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "AppGW without Backend Pools",
                              "subTarget": "orphanappgw",
                              "style": "secondary"
                            },
                            {
                              "id": "63e31439-e521-40a3-b4a6-829b959a5582",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "Resource Groups",
                              "subTarget": "resourcegroup",
                              "style": "link"
                            },
                            {
                              "id": "0c3f1177-1ebc-4040-a9c7-ae1fc1ff2cde",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "Route Tables",
                              "subTarget": "routetable",
                              "style": "link"
                            },
                            {
                              "id": "f80a73cf-b312-40f3-9eb2-258f275ae92c",
                              "cellValue": "buttonname",
                              "linkTarget": "parameter",
                              "linkLabel": "App Service Plan",
                              "subTarget": "appserviceplan",
                              "style": "link"
                            }
                          ]
                        },
                        "name": "links - 5"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "\r\nResources\r\n| where type =~ 'Microsoft.Compute/availabilitySets'\r\n| where properties.virtualMachines == \"[]\"\r\n| summarize c = count()\r\n| extend Item = \"Orphan Availability Set\",  Key = 1",
                                "size": 3,
                                "noDataMessageStyle": 5,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Item",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "c",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "showBorder": false,
                                  "size": "auto"
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "customWidth": "50",
                              "name": "Orphan Disk"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Resources\r\n| where type =~ 'Microsoft.Compute/availabilitySets'\r\n| where properties.virtualMachines == \"[]\"\r\n| summarize count(type) by location",
                                "size": 4,
                                "noDataMessage": "No Orphan Availability Set",
                                "noDataMessageStyle": 3,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "piechart",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "id"
                                  }
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "DiskType",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                }
                              },
                              "customWidth": "50",
                              "name": "query - Orphan Availability Set by Location"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Resources\r\n| where type =~ 'Microsoft.Compute/availabilitySets'\r\n| where properties.virtualMachines == \"[]\"\r\n| extend Details = pack_all()\r\n| project subscriptionId, Resource=id, resourceGroup, location, tags, Details",
                                "size": 3,
                                "title": "Orphan Availability Set",
                                "noDataMessage": "You Are Good with this",
                                "noDataMessageStyle": 3,
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "linkIsContextBlade": true,
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Resource",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "filter": true,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "Resource"
                                  },
                                  "labelSettings": [
                                    {
                                      "columnId": "subscriptionId",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "Resource",
                                      "label": "Resource Name"
                                    },
                                    {
                                      "columnId": "resourceGroup",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "location",
                                      "label": "Location"
                                    },
                                    {
                                      "columnId": "tags",
                                      "label": "Tags"
                                    }
                                  ]
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1,
                                    "formatOptions": {
                                      "showIcon": true
                                    }
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto",
                                      "showIcon": true
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "name": " Orphan Availability Set"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "buttonname",
                          "comparison": "isEqualTo",
                          "value": "orphanavailabilityset"
                        },
                        "name": "Orphan Availability Set"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "items": [
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "Resources\r\n| where type has \"microsoft.compute/disks\"\r\n| extend diskState = tostring(properties.diskState)\r\n| where managedBy == \"\"\r\n| where not(name endswith \"-ASRReplica\" or name startswith \"ms-asr-\")\r\n| summarize Count=count(type) by location",
                                      "size": 3,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "visualization": "piechart",
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "$gen_group",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": "Resource",
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "id",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "subscriptionId",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Details",
                                            "formatter": 7,
                                            "formatOptions": {
                                              "linkTarget": "CellDetails",
                                              "linkLabel": "🔍 View Details",
                                              "linkIsContextBlade": true
                                            }
                                          }
                                        ],
                                        "rowLimit": 1000,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "subscriptionId"
                                          ],
                                          "expandTopLevel": true,
                                          "finalBy": "id"
                                        }
                                      },
                                      "sortBy": [],
                                      "tileSettings": {
                                        "titleContent": {
                                          "columnMatch": "DiskType",
                                          "formatter": 1
                                        },
                                        "leftContent": {
                                          "columnMatch": "Count",
                                          "formatter": 12,
                                          "formatOptions": {
                                            "palette": "auto"
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "maximumSignificantDigits": 3,
                                              "maximumFractionDigits": 2
                                            }
                                          }
                                        },
                                        "showBorder": true
                                      },
                                      "graphSettings": {
                                        "type": 0,
                                        "topContent": {
                                          "columnMatch": "vmSize",
                                          "formatter": 1
                                        },
                                        "centerContent": {
                                          "columnMatch": "Count",
                                          "formatter": 1,
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "maximumSignificantDigits": 3,
                                              "maximumFractionDigits": 2
                                            }
                                          }
                                        }
                                      },
                                      "chartSettings": {
                                        "showMetrics": false,
                                        "showLegend": true
                                      },
                                      "mapSettings": {
                                        "locInfo": "LatLong",
                                        "sizeSettings": "Count",
                                        "sizeAggregation": "Sum",
                                        "legendMetric": "Count",
                                        "legendAggregation": "Sum",
                                        "itemColorSettings": {
                                          "type": "heatmap",
                                          "colorAggregation": "Sum",
                                          "nodeColorField": "Count",
                                          "heatmapPalette": "greenRed"
                                        }
                                      }
                                    },
                                    "customWidth": "40",
                                    "name": "query - Orphan Disks by Location"
                                  },
                                  {
                                    "type": 12,
                                    "content": {
                                      "version": "NotebookGroup/1.0",
                                      "groupType": "editable",
                                      "items": [
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "Resources\r\n| where type has \"microsoft.compute/disks\"\r\n| extend diskState = tostring(properties.diskState)\r\n| where managedBy == \"\"\r\n| where not(name endswith \"-ASRReplica\" or name startswith \"ms-asr-\")\r\n| summarize Count=count(type) by DiskType=tostring(sku.name)",
                                            "size": 4,
                                            "queryType": 1,
                                            "resourceType": "microsoft.resourcegraph/resources",
                                            "crossComponentResources": [
                                              "{Subscription}"
                                            ],
                                            "visualization": "tiles",
                                            "gridSettings": {
                                              "formatters": [
                                                {
                                                  "columnMatch": "$gen_group",
                                                  "formatter": 13,
                                                  "formatOptions": {
                                                    "linkTarget": "Resource",
                                                    "showIcon": true
                                                  }
                                                },
                                                {
                                                  "columnMatch": "id",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "subscriptionId",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "Details",
                                                  "formatter": 7,
                                                  "formatOptions": {
                                                    "linkTarget": "CellDetails",
                                                    "linkLabel": "🔍 View Details",
                                                    "linkIsContextBlade": true
                                                  }
                                                }
                                              ],
                                              "rowLimit": 1000,
                                              "hierarchySettings": {
                                                "treeType": 1,
                                                "groupBy": [
                                                  "subscriptionId"
                                                ],
                                                "expandTopLevel": true,
                                                "finalBy": "id"
                                              }
                                            },
                                            "sortBy": [],
                                            "tileSettings": {
                                              "titleContent": {
                                                "columnMatch": "DiskType",
                                                "formatter": 1
                                              },
                                              "leftContent": {
                                                "columnMatch": "Count",
                                                "formatter": 12,
                                                "formatOptions": {
                                                  "palette": "auto"
                                                },
                                                "numberFormat": {
                                                  "unit": 17,
                                                  "options": {
                                                    "maximumSignificantDigits": 3,
                                                    "maximumFractionDigits": 2
                                                  }
                                                }
                                              },
                                              "showBorder": true
                                            },
                                            "graphSettings": {
                                              "type": 0,
                                              "topContent": {
                                                "columnMatch": "vmSize",
                                                "formatter": 1
                                              },
                                              "centerContent": {
                                                "columnMatch": "Count",
                                                "formatter": 1,
                                                "numberFormat": {
                                                  "unit": 17,
                                                  "options": {
                                                    "maximumSignificantDigits": 3,
                                                    "maximumFractionDigits": 2
                                                  }
                                                }
                                              }
                                            },
                                            "chartSettings": {
                                              "showMetrics": false,
                                              "showLegend": true
                                            },
                                            "mapSettings": {
                                              "locInfo": "LatLong",
                                              "sizeSettings": "Count",
                                              "sizeAggregation": "Sum",
                                              "legendMetric": "Count",
                                              "legendAggregation": "Sum",
                                              "itemColorSettings": {
                                                "type": "heatmap",
                                                "colorAggregation": "Sum",
                                                "nodeColorField": "Count",
                                                "heatmapPalette": "greenRed"
                                              }
                                            }
                                          },
                                          "name": "query - Orphan Disks by DiskType"
                                        },
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "Resources\r\n| where type has \"microsoft.compute/disks\"\r\n| extend diskState = tostring(properties.diskState)\r\n| where  diskState == 'Unattached'  or managedBy == \"\"\r\n| where managedBy == \"\"\r\n| where not(name endswith \"-ASRReplica\" or name startswith \"ms-asr-\")\r\n| summarize c = count()\r\n| extend Item = \"Orphan Disk\",  Key = 1\r\n",
                                            "size": 3,
                                            "noDataMessageStyle": 5,
                                            "queryType": 1,
                                            "resourceType": "microsoft.resourcegraph/resources",
                                            "crossComponentResources": [
                                              "{Subscription}"
                                            ],
                                            "visualization": "tiles",
                                            "tileSettings": {
                                              "titleContent": {
                                                "columnMatch": "Item",
                                                "formatter": 1
                                              },
                                              "leftContent": {
                                                "columnMatch": "c",
                                                "formatter": 12,
                                                "formatOptions": {
                                                  "palette": "auto"
                                                },
                                                "numberFormat": {
                                                  "unit": 17,
                                                  "options": {
                                                    "style": "decimal",
                                                    "maximumFractionDigits": 2,
                                                    "maximumSignificantDigits": 3
                                                  }
                                                }
                                              },
                                              "showBorder": false,
                                              "size": "auto"
                                            },
                                            "mapSettings": {
                                              "locInfo": "LatLong",
                                              "sizeSettings": "Count",
                                              "sizeAggregation": "Sum",
                                              "legendMetric": "Count",
                                              "legendAggregation": "Sum",
                                              "itemColorSettings": {
                                                "type": "heatmap",
                                                "colorAggregation": "Sum",
                                                "nodeColorField": "Count",
                                                "heatmapPalette": "greenRed"
                                              }
                                            },
                                            "textSettings": {
                                              "style": "bignumber"
                                            }
                                          },
                                          "customWidth": "50",
                                          "name": "Orphan Disk"
                                        },
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "Resources\r\n| where type has \"microsoft.compute/disks\"\r\n| extend diskState = tostring(properties.diskState)\r\n| where managedBy == \"\"\r\n| where not(name endswith \"-ASRReplica\" or name startswith \"ms-asr-\")\r\n| extend SizeGB = tolong(properties.diskSizeGB)\r\n| summarize ['Total Disk Size (GB)']=sum(SizeGB) \r\n| extend Item= \"Total Disk Size (GB)\",  Key = 1",
                                            "size": 3,
                                            "noDataMessageStyle": 5,
                                            "queryType": 1,
                                            "resourceType": "microsoft.resourcegraph/resources",
                                            "crossComponentResources": [
                                              "{Subscription}"
                                            ],
                                            "visualization": "tiles",
                                            "tileSettings": {
                                              "titleContent": {
                                                "columnMatch": "Item",
                                                "formatter": 1
                                              },
                                              "leftContent": {
                                                "columnMatch": "Total Disk Size (GB)",
                                                "formatter": 12,
                                                "formatOptions": {
                                                  "palette": "auto"
                                                },
                                                "numberFormat": {
                                                  "unit": 17,
                                                  "options": {
                                                    "style": "decimal",
                                                    "maximumFractionDigits": 2,
                                                    "maximumSignificantDigits": 3
                                                  }
                                                }
                                              },
                                              "showBorder": false,
                                              "size": "auto"
                                            },
                                            "mapSettings": {
                                              "locInfo": "LatLong",
                                              "sizeSettings": "Count",
                                              "sizeAggregation": "Sum",
                                              "legendMetric": "Count",
                                              "legendAggregation": "Sum",
                                              "itemColorSettings": {
                                                "type": "heatmap",
                                                "colorAggregation": "Sum",
                                                "nodeColorField": "Count",
                                                "heatmapPalette": "greenRed"
                                              }
                                            },
                                            "textSettings": {
                                              "style": "bignumber"
                                            }
                                          },
                                          "customWidth": "50",
                                          "name": "Orphan Disk - Copy"
                                        }
                                      ]
                                    },
                                    "customWidth": "60",
                                    "name": "Summary"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "ResourceContainers \r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| extend SubscriptionName=name\r\n | join (\r\n \r\n resources\r\n  | where type =~ 'microsoft.compute/disks' and tostring (properties.diskState) == 'Unattached' and name !has '-ASRReplica' \r\n  | where managedBy == \"\"\r\n        | where not(name endswith \"-ASRReplica\" or name startswith \"ms-asr-\")\r\n  | extend DiskID=id, DiskName=name, SKUName=sku.name, SKUTier=sku.tier, DiskSizeGB=tostring(properties.diskSizeGB),DiskRG=resourceGroup, Location=location, TimeCreated=tostring(properties.timeCreated))on subscriptionId \r\n        | order by id asc \r\n        | project DiskID, DiskSizeGB, SKUName, SKUTier, DiskRG, Location, TimeCreated, SubscriptionName",
                                      "size": 3,
                                      "title": "List of Orphan Disk",
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "visualization": "table",
                                      "gridSettings": {
                                        "filter": true,
                                        "sortBy": [
                                          {
                                            "itemKey": "$gen_link_SKUTier_3",
                                            "sortOrder": 2
                                          }
                                        ],
                                        "labelSettings": [
                                          {
                                            "columnId": "DiskID",
                                            "label": "Disk"
                                          },
                                          {
                                            "columnId": "DiskSizeGB",
                                            "label": "Size(GB)"
                                          },
                                          {
                                            "columnId": "SKUName",
                                            "label": "SKU"
                                          },
                                          {
                                            "columnId": "SKUTier",
                                            "label": "SKU Tier"
                                          },
                                          {
                                            "columnId": "DiskRG",
                                            "label": "Resource Group"
                                          },
                                          {
                                            "columnId": "Location",
                                            "label": "Location"
                                          },
                                          {
                                            "columnId": "TimeCreated",
                                            "label": "Creation Time"
                                          },
                                          {
                                            "columnId": "SubscriptionName",
                                            "label": "Subscription"
                                          }
                                        ]
                                      },
                                      "sortBy": [
                                        {
                                          "itemKey": "$gen_link_SKUTier_3",
                                          "sortOrder": 2
                                        }
                                      ]
                                    },
                                    "name": "query - 1"
                                  }
                                ]
                              },
                              "conditionalVisibility": {
                                "parameterName": "buttonname",
                                "comparison": "isEqualTo",
                                "value": "orphandisk"
                              },
                              "name": "Orphan Disk"
                            }
                          ]
                        },
                        "name": "Orphan Disk"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ 'microsoft.network/publicipaddresses'\r\n| where properties.ipConfiguration == \"\"\r\n| extend IpConfig = properties.ipConfiguration.id\r\n| where isempty(IpConfig)\r\n| summarize c = count()\r\n| extend Item = \"Orphan IP Address\",  Key = 1\r\n\r\n",
                                "size": 3,
                                "noDataMessageStyle": 5,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Item",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "c",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "showBorder": false
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "customWidth": "33",
                              "name": "orphan Public IP Count"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Resources\r\n| where type == \"microsoft.network/publicipaddresses\"\r\n| where properties.ipConfiguration == \"\"\r\n| summarize count(type) by tostring(sku.name)",
                                "size": 4,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "piechart",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "id"
                                  }
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "DiskType",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                }
                              },
                              "customWidth": "33",
                              "name": "query - Orphan Public IPs by Type"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Resources\r\n| where type == \"microsoft.network/publicipaddresses\"\r\n| where properties.ipConfiguration == \"\"\r\n| summarize count(type) by location",
                                "size": 4,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "piechart",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "id"
                                  }
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "DiskType",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                }
                              },
                              "customWidth": "30",
                              "name": "query - Orphan Public IPs by Location"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ResourceContainers \r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| extend SubscriptionName=name \r\n| join (resources | where type =~ 'Microsoft.Network/publicIPAddresses' and isempty(properties.ipConfiguration) \r\n| extend ipdetails=id, IPName=name, AllocationMethod=tostring(properties.publicIPAllocationMethod), SKUName=sku.name, PIPRG=resourceGroup, Location=location)on subscriptionId \r\n        | order by ipdetails asc \r\n        | extend Details = pack_all()\r\n        | project ipdetails, SKUName, PIPRG, Location, AllocationMethod, SubscriptionName , Details",
                                "size": 3,
                                "title": "List of Orphan Public IP Address",
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "filter": true,
                                  "sortBy": [
                                    {
                                      "itemKey": "$gen_link_SKUName_1",
                                      "sortOrder": 2
                                    }
                                  ]
                                },
                                "sortBy": [
                                  {
                                    "itemKey": "$gen_link_SKUName_1",
                                    "sortOrder": 2
                                  }
                                ]
                              },
                              "name": "List of Orphan IP"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "buttonname",
                          "comparison": "isEqualTo",
                          "value": "orphanip"
                        },
                        "name": "Orphan Public IP"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ResourceContainers  \r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| extend SubscriptionName=name \r\n| join ( \r\nResources \r\n| where type =~ 'microsoft.network/networkinterfaces' and isempty(properties.virtualMachine) and isnull(properties.privateEndpoint) and properties.hostedWorkloads == \"[]\"\r\nand properties !has 'virtualmachine'\r\n    | extend NIC=id,  NICName=name, NICRG=resourceGroup, NICLocation=location, NICType=tostring(properties.nicType)) on subscriptionId\r\n        | order by id asc\r\n        | project NIC,NICName, NICRG, NICLocation, NICType, SubscriptionName\r\n| summarize c = count()\r\n| extend Item = \"Orphan NIC\",  Key = 1\r\n\r\n\r\n",
                                "size": 3,
                                "noDataMessageStyle": 5,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Item",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "c",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "showBorder": false,
                                  "size": "auto"
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "customWidth": "50",
                              "name": "orphan NIC Count"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Resources\r\n| where type has \"microsoft.network/networkinterfaces\"\r\n| where isnull(properties.privateEndpoint)\r\n| where isnull(properties.privateLinkService)\r\n| where properties.hostedWorkloads == \"[]\"\r\n| where properties !has 'virtualmachine'\r\n| summarize count(type) by location",
                                "size": 4,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "piechart",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "id"
                                  }
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "DiskType",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                }
                              },
                              "customWidth": "30",
                              "name": "query - Orphan Network Interfaces by Location"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ResourceContainers  | where type =~ 'Microsoft.Resources/subscriptions' | extend SubscriptionName=name | join ( Resources | where type =~ 'microsoft.network/networkinterfaces' and isempty(properties.virtualMachine) and isnull(properties.privateEndpoint) and properties.hostedWorkloads == \"[]\"\r\nand properties !has 'virtualmachine'\r\n    | extend NIC=id,  NICName=name, NICRG=resourceGroup, NICLocation=location, NICType=tostring(properties.nicType)) on subscriptionId\r\n        | order by id asc\r\n        | extend Details = pack_all()\r\n        | project NIC,NICName, NICRG, NICLocation, NICType, SubscriptionName,Details",
                                "size": 3,
                                "title": "List of Orphan NIC",
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "filter": true,
                                  "labelSettings": [
                                    {
                                      "columnId": "NIC",
                                      "label": "NIC"
                                    },
                                    {
                                      "columnId": "NICRG",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "NICLocation",
                                      "label": "Location"
                                    },
                                    {
                                      "columnId": "NICType",
                                      "label": "Type"
                                    },
                                    {
                                      "columnId": "SubscriptionName",
                                      "label": "Subscription"
                                    }
                                  ]
                                }
                              },
                              "name": "List of Orphan NIC"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "buttonname",
                          "comparison": "isEqualTo",
                          "value": "orphannic"
                        },
                        "name": "Orphan NIC"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Resources \r\n| where type =~ 'microsoft.network/networksecuritygroups' and isnull(properties.networkInterfaces) and isnull(properties.subnets) \r\n| extend NSG=id, NSGName=name, NSGRG=resourceGroup, NSGLocation=location \r\n| order by id asc\r\n| project NSG,NSGName, NSGRG, NSGLocation\r\n| summarize c = count()\r\n| extend Item = \"Orphan NSG\",  Key = 1\r\n",
                                "size": 3,
                                "noDataMessageStyle": 5,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Item",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "c",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "showBorder": false,
                                  "size": "auto"
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "customWidth": "50",
                              "name": "orphan NSG Count"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Resources\r\n| where type == \"microsoft.network/networksecuritygroups\" and isnull(properties.networkInterfaces) and isnull(properties.subnets)\r\n| summarize count(type) by location",
                                "size": 4,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "piechart",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "id"
                                  }
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "DiskType",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                }
                              },
                              "customWidth": "30",
                              "name": "query - Orphan NSGs by Location"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | extend SubscriptionName=name | join ( Resources | where type =~ 'microsoft.network/networksecuritygroups' and isnull(properties.networkInterfaces) and isnull(properties.subnets) | extend NSG=id, NSGName=name, NSGRG=resourceGroup, NSGLocation=location ) on subscriptionId\r\n    | order by id asc\r\n    | project NSG,NSGName, NSGRG, NSGLocation, SubscriptionName \r\n    | extend Details = pack_all()",
                                "size": 3,
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "filter": true
                                }
                              },
                              "name": "List of Orphan NSG"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "buttonname",
                          "comparison": "isEqualTo",
                          "value": "orphannsg"
                        },
                        "name": "Orphan NSG"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Resources\r\n| where type =~ 'microsoft.network/applicationsecuritygroups' and isnull(properties.networkInterfaces) and isnull(properties.subnets)\r\n| project Resource=id, resourceGroup, subscriptionId, location\r\n| summarize c = count()\r\n| extend Item = \"ASG\",  Key = 1\r\n\r\n\r\n",
                                "size": 3,
                                "noDataMessageStyle": 5,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Item",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "c",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "showBorder": false,
                                  "size": "auto"
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "name": "orphan ASG Count"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "Resources\r\n| where type =~ 'microsoft.network/applicationsecuritygroups' and isnull(properties.networkInterfaces) and isnull(properties.subnets)\r\n| project Resource=id, resourceGroup, subscriptionId, location",
                                "size": 3,
                                "title": "List of Orphan ASG",
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "table"
                              },
                              "name": "List of Orphan ASG"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "buttonname",
                          "comparison": "isEqualTo",
                          "value": "orphanasg"
                        },
                        "name": "Orphan ASG"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "items": [
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "resources\r\n| where type == \"microsoft.network/loadbalancers\"\r\n| where properties.backendAddressPools == \"[]\"\r\n| summarize c=count(type)\r\n\r\n| extend Item = \"Load Balancer\",  Key = 1\r\n",
                                      "size": 3,
                                      "noDataMessageStyle": 5,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "visualization": "tiles",
                                      "tileSettings": {
                                        "titleContent": {
                                          "columnMatch": "Item",
                                          "formatter": 1
                                        },
                                        "leftContent": {
                                          "columnMatch": "c",
                                          "formatter": 12,
                                          "formatOptions": {
                                            "palette": "auto"
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "style": "decimal",
                                              "maximumFractionDigits": 2,
                                              "maximumSignificantDigits": 3
                                            }
                                          }
                                        },
                                        "showBorder": false,
                                        "size": "auto"
                                      },
                                      "mapSettings": {
                                        "locInfo": "LatLong",
                                        "sizeSettings": "Count",
                                        "sizeAggregation": "Sum",
                                        "legendMetric": "Count",
                                        "legendAggregation": "Sum",
                                        "itemColorSettings": {
                                          "type": "heatmap",
                                          "colorAggregation": "Sum",
                                          "nodeColorField": "Count",
                                          "heatmapPalette": "greenRed"
                                        }
                                      },
                                      "textSettings": {
                                        "style": "bignumber"
                                      }
                                    },
                                    "customWidth": "50",
                                    "name": "orphan LB Count"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "resources\r\n| where type == \"microsoft.network/loadbalancers\"\r\n| where properties.backendAddressPools == \"[]\"\r\n| summarize count(type) by location",
                                      "size": 4,
                                      "noDataMessage": "No Orphan Load Balancer",
                                      "noDataMessageStyle": 3,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "visualization": "piechart",
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "$gen_group",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": "Resource",
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "id",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "subscriptionId",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Details",
                                            "formatter": 7,
                                            "formatOptions": {
                                              "linkTarget": "CellDetails",
                                              "linkLabel": "🔍 View Details",
                                              "linkIsContextBlade": true
                                            }
                                          }
                                        ],
                                        "rowLimit": 1000,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "subscriptionId"
                                          ],
                                          "expandTopLevel": true,
                                          "finalBy": "id"
                                        },
                                        "labelSettings": [
                                          {
                                            "columnId": "subscriptionId",
                                            "label": "Subscription"
                                          },
                                          {
                                            "columnId": "Resource",
                                            "label": "Resource Name"
                                          },
                                          {
                                            "columnId": "resourceGroup",
                                            "label": "Resource Group"
                                          },
                                          {
                                            "columnId": "location",
                                            "label": "Location"
                                          },
                                          {
                                            "columnId": "tags",
                                            "label": "Tags"
                                          }
                                        ]
                                      },
                                      "sortBy": [],
                                      "tileSettings": {
                                        "titleContent": {
                                          "columnMatch": "DiskType",
                                          "formatter": 1
                                        },
                                        "leftContent": {
                                          "columnMatch": "Count",
                                          "formatter": 12,
                                          "formatOptions": {
                                            "palette": "auto"
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "maximumSignificantDigits": 3,
                                              "maximumFractionDigits": 2
                                            }
                                          }
                                        },
                                        "showBorder": true
                                      },
                                      "graphSettings": {
                                        "type": 0,
                                        "topContent": {
                                          "columnMatch": "vmSize",
                                          "formatter": 1
                                        },
                                        "centerContent": {
                                          "columnMatch": "Count",
                                          "formatter": 1,
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "maximumSignificantDigits": 3,
                                              "maximumFractionDigits": 2
                                            }
                                          }
                                        }
                                      },
                                      "chartSettings": {
                                        "showMetrics": false,
                                        "showLegend": true
                                      },
                                      "mapSettings": {
                                        "locInfo": "LatLong",
                                        "sizeSettings": "Count",
                                        "sizeAggregation": "Sum",
                                        "legendMetric": "Count",
                                        "legendAggregation": "Sum",
                                        "itemColorSettings": {
                                          "type": "heatmap",
                                          "colorAggregation": "Sum",
                                          "nodeColorField": "Count",
                                          "heatmapPalette": "greenRed"
                                        }
                                      }
                                    },
                                    "customWidth": "50",
                                    "name": "query - Orphan Load Balancers by Location"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "resources\r\n| where type == \"microsoft.network/loadbalancers\"\r\n| where properties.backendAddressPools == \"[]\"\r\n| extend Details = pack_all()\r\n| project subscriptionId, Resource=id, resourceGroup, location, tags, Details",
                                      "size": 3,
                                      "title": "Orphan Load Balances",
                                      "noDataMessage": "Your Are Good Here",
                                      "noDataMessageStyle": 3,
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "$gen_group",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": "Resource",
                                              "linkIsContextBlade": true,
                                              "showIcon": true
                                            }
                                          },
                                          {
                                            "columnMatch": "subscriptionId",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Resource",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Details",
                                            "formatter": 7,
                                            "formatOptions": {
                                              "linkTarget": "CellDetails",
                                              "linkLabel": "🔍 View Details",
                                              "linkIsContextBlade": true
                                            }
                                          }
                                        ],
                                        "rowLimit": 1000,
                                        "filter": true,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "subscriptionId"
                                          ],
                                          "expandTopLevel": true,
                                          "finalBy": "Resource"
                                        },
                                        "labelSettings": [
                                          {
                                            "columnId": "subscriptionId",
                                            "label": "Subscription"
                                          },
                                          {
                                            "columnId": "Resource",
                                            "label": "Resource Name"
                                          },
                                          {
                                            "columnId": "resourceGroup",
                                            "label": "Resource Group"
                                          },
                                          {
                                            "columnId": "location",
                                            "label": "Location"
                                          },
                                          {
                                            "columnId": "tags",
                                            "label": "Tags"
                                          }
                                        ]
                                      },
                                      "sortBy": [],
                                      "tileSettings": {
                                        "titleContent": {
                                          "columnMatch": "vmSize",
                                          "formatter": 1,
                                          "formatOptions": {
                                            "showIcon": true
                                          }
                                        },
                                        "leftContent": {
                                          "columnMatch": "Count",
                                          "formatter": 12,
                                          "formatOptions": {
                                            "palette": "auto",
                                            "showIcon": true
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "maximumSignificantDigits": 3,
                                              "maximumFractionDigits": 2
                                            }
                                          }
                                        },
                                        "showBorder": true
                                      },
                                      "graphSettings": {
                                        "type": 0,
                                        "topContent": {
                                          "columnMatch": "vmSize",
                                          "formatter": 1
                                        },
                                        "centerContent": {
                                          "columnMatch": "Count",
                                          "formatter": 1,
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "maximumSignificantDigits": 3,
                                              "maximumFractionDigits": 2
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "name": "query - Orphan Load Balancers"
                                  }
                                ]
                              },
                              "name": "Orphan LB"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "buttonname",
                          "comparison": "isEqualTo",
                          "value": "orphanlb"
                        },
                        "name": "LB"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources | where type =~ 'Microsoft.Network/applicationGateways'\r\n| extend AppGateway=id, AppGWName=name, SKUName= tostring(properties.sku.name), SKUTier= tostring(properties.sku.tier), APPRG=resourceGroup, APPGWLocation=location ,backendpools = properties.backendAddressPools\r\n| mv-expand backendpools\r\n| extend backendPoolName = backendpools.name ,backendPoolIPTarget = array_length(backendpools.properties.backendAddresses) , backendPoolVMTarget = array_length(backendpools.properties.backendIPConfigurations)\r\n| distinct AppGWName\r\n| summarize c = count()\r\n| extend Item = \"App Gateway Without Pools\",  Key = 1\r\n",
                                "size": 4,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Item",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "c",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    }
                                  },
                                  "showBorder": false,
                                  "size": "auto"
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "name": "query - 3"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources | where type =~ 'Microsoft.Network/applicationGateways'\r\n| extend AppGateway=id, AppGWName=name, SKUName= tostring(properties.sku.name), SKUTier= tostring(properties.sku.tier), APPRG=resourceGroup, APPGWLocation=location ,backendpools = properties.backendAddressPools\r\n| mv-expand backendpools\r\n| extend backendPoolName = backendpools.name ,backendPoolIPTarget = array_length(backendpools.properties.backendAddresses) , backendPoolVMTarget = array_length(backendpools.properties.backendIPConfigurations)\r\n| project AppGateway,AppGWName,backendPoolName,backendPoolIPTarget,backendPoolVMTarget\r\n| order by AppGWName",
                                "size": 3,
                                "title": "List of Application Gateways without Backend Pool",
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "backendPoolIPTarget",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": ">",
                                            "thresholdValue": "0",
                                            "representation": "success",
                                            "text": ""
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "0",
                                            "representation": "disabled",
                                            "text": ""
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "backendPoolVMTarget",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "is Empty",
                                            "representation": "disabled",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": ">",
                                            "thresholdValue": "0",
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    }
                                  ],
                                  "filter": true,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "AppGWName"
                                    ]
                                  },
                                  "labelSettings": [
                                    {
                                      "columnId": "AppGateway",
                                      "label": "App Gateway"
                                    },
                                    {
                                      "columnId": "AppGWName",
                                      "label": "App Gateway Name"
                                    },
                                    {
                                      "columnId": "backendPoolName",
                                      "label": "Backend Pool Name"
                                    },
                                    {
                                      "columnId": "backendPoolIPTarget",
                                      "label": "Backend Pool IP Target"
                                    },
                                    {
                                      "columnId": "backendPoolVMTarget",
                                      "label": "Backend Pool VM Target"
                                    }
                                  ]
                                }
                              },
                              "name": "query - 0"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "buttonname",
                          "comparison": "isEqualTo",
                          "value": "orphanappgw"
                        },
                        "name": "App Gateway Withoutpools"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ResourceContainers\r\n | where type == \"microsoft.resources/subscriptions/resourcegroups\"\r\n | extend rgAndSub = strcat(resourceGroup, \"--\", subscriptionId)\r\n \r\n | join kind=leftouter (\r\n     Resources\r\n     | extend rgAndSub = strcat(resourceGroup, \"--\", subscriptionId)\r\n     | summarize count() by rgAndSub\r\n ) on rgAndSub\r\n | where isnull(count_)\r\n\r\n | summarize count(type)\r\n   |extend Tit = \"Orphan Resource Groups\"\r\n",
                                "size": 4,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "id"
                                  }
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Tit",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "count_type",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    }
                                  },
                                  "showBorder": false,
                                  "sortOrderField": 2,
                                  "size": "auto"
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "customWidth": "50",
                              "name": "query - Orphan Resource Groups Count"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ResourceContainers\r\n | where type == \"microsoft.resources/subscriptions/resourcegroups\"\r\n | extend rgAndSub = strcat(resourceGroup, \"--\", subscriptionId)\r\n | join kind=leftouter (\r\n     Resources\r\n     | extend rgAndSub = strcat(resourceGroup, \"--\", subscriptionId)\r\n     | summarize count() by rgAndSub\r\n ) on rgAndSub\r\n | where isnull(count_)\r\n| summarize count(type) by location",
                                "size": 3,
                                "title": "Count by Location",
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "piechart",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "id"
                                  }
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "DiskType",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                }
                              },
                              "customWidth": "50",
                              "name": "query - Orphan Resource Groups by Location"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ResourceContainers\r\n | where type == \"microsoft.resources/subscriptions/resourcegroups\"\r\n | extend rgAndSub = strcat(resourceGroup, \"--\", subscriptionId)\r\n | join kind=leftouter (\r\n     Resources\r\n     | extend rgAndSub = strcat(resourceGroup, \"--\", subscriptionId)\r\n     | summarize count() by rgAndSub\r\n ) on rgAndSub\r\n | where isnull(count_)\r\n | extend Details = pack_all()\r\n | project resourceGroup,subscriptionId, Resource=id, location, tags ,Details",
                                "size": 3,
                                "title": "Orphan Resource Groups",
                                "noDataMessage": "No oprhan Resource Groups found",
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 15,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "Resource",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "-- Group By --",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "linkIsContextBlade": true,
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "Subscription",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "linkIsContextBlade": true,
                                        "showIcon": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "filter": true,
                                  "labelSettings": [
                                    {
                                      "columnId": "subscriptionId",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "Resource",
                                      "label": "Resource Group Name"
                                    },
                                    {
                                      "columnId": "location",
                                      "label": "Location"
                                    },
                                    {
                                      "columnId": "tags",
                                      "label": "Tags"
                                    }
                                  ]
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1,
                                    "formatOptions": {
                                      "showIcon": true
                                    }
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto",
                                      "showIcon": true
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "query - Orphan Resource Groups"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "buttonname",
                          "comparison": "isEqualTo",
                          "value": "resourcegroup"
                        },
                        "name": "Orphan Resource Grou"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type == \"microsoft.network/routetables\"\r\n| where isnull(properties.subnets)\r\n| summarize count(type)\r\n|extend Tit = \"Orphan Route Tables\"\r\n",
                                "size": 4,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "id"
                                  }
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Tit",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "count_type",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    }
                                  },
                                  "showBorder": false,
                                  "sortOrderField": 2,
                                  "size": "auto"
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "customWidth": "50",
                              "name": "query - Orphan Resource Groups Count"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type == \"microsoft.network/routetables\"\r\n| where isnull(properties.subnets)\r\n| summarize count(type) by location",
                                "size": 4,
                                "noDataMessage": "No Orphan Route Table",
                                "noDataMessageStyle": 3,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "piechart",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "id"
                                  },
                                  "labelSettings": [
                                    {
                                      "columnId": "subscriptionId",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "Resource",
                                      "label": "Resource Name"
                                    },
                                    {
                                      "columnId": "resourceGroup",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "location",
                                      "label": "Location"
                                    },
                                    {
                                      "columnId": "tags",
                                      "label": "Tags"
                                    }
                                  ]
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "DiskType",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                }
                              },
                              "customWidth": "30",
                              "name": "query - Orphan Route Tables by Location"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type == \"microsoft.network/routetables\"\r\n| where isnull(properties.subnets)\r\n| extend Details = pack_all()\r\n| project subscriptionId, Resource=id, resourceGroup, location, tags, Details",
                                "size": 3,
                                "title": "Orphan Route Tables",
                                "noDataMessage": "You are Good Here",
                                "noDataMessageStyle": 3,
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "linkIsContextBlade": true,
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Resource",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "filter": true,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "Resource"
                                  },
                                  "labelSettings": [
                                    {
                                      "columnId": "subscriptionId",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "Resource",
                                      "label": "Resource Name"
                                    },
                                    {
                                      "columnId": "resourceGroup",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "location",
                                      "label": "Location"
                                    },
                                    {
                                      "columnId": "tags",
                                      "label": "Tags"
                                    }
                                  ]
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1,
                                    "formatOptions": {
                                      "showIcon": true
                                    }
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto",
                                      "showIcon": true
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "query - Orphan Route Tables"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "buttonname",
                          "comparison": "isEqualTo",
                          "value": "routetable"
                        },
                        "name": "Route Table"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ \"microsoft.web/serverfarms\"\r\n| where properties.numberOfSites == 0\r\n| summarize count(type)\r\n|extend Tit = \"Orphan App Service Plan\"\r\n",
                                "size": 4,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "tiles",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "id"
                                  }
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Tit",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "count_type",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    }
                                  },
                                  "showBorder": false,
                                  "sortOrderField": 2,
                                  "size": "auto"
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "textSettings": {
                                  "style": "bignumber"
                                }
                              },
                              "customWidth": "20",
                              "name": "query - Orphan Resource Groups Count"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ \"microsoft.web/serverfarms\"\r\n| where properties.numberOfSites == 0\r\n| summarize count(type) by tostring(sku.name)",
                                "size": 4,
                                "noDataMessage": "You Are Good Here",
                                "noDataMessageStyle": 3,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "piechart",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "id"
                                  },
                                  "labelSettings": [
                                    {
                                      "columnId": "subscriptionId",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "Resource",
                                      "label": "Resource Name"
                                    },
                                    {
                                      "columnId": "resourceGroup",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "location",
                                      "label": "Location"
                                    },
                                    {
                                      "columnId": "tags",
                                      "label": "Tags"
                                    }
                                  ]
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "DiskType",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                }
                              },
                              "customWidth": "25",
                              "name": "query - Orphan App Service Plan by sku"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ \"microsoft.web/serverfarms\"\r\n| where properties.numberOfSites == 0\r\n| summarize count(type) by tostring(sku.tier)",
                                "size": 4,
                                "noDataMessage": "You are Good Here",
                                "noDataMessageStyle": 3,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "piechart",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "id"
                                  },
                                  "labelSettings": [
                                    {
                                      "columnId": "subscriptionId",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "Resource",
                                      "label": "Resource Name"
                                    },
                                    {
                                      "columnId": "resourceGroup",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "location",
                                      "label": "Location"
                                    },
                                    {
                                      "columnId": "tags",
                                      "label": "Tags"
                                    }
                                  ]
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "DiskType",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                }
                              },
                              "customWidth": "25",
                              "name": "query - Orphan App Service Plan by Tier"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ \"microsoft.web/serverfarms\"\r\n| where properties.numberOfSites == 0\r\n| summarize count(type) by location",
                                "size": 4,
                                "noDataMessage": "You Are Good Here",
                                "noDataMessageStyle": 3,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "piechart",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "id"
                                  },
                                  "labelSettings": [
                                    {
                                      "columnId": "subscriptionId",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "Resource",
                                      "label": "Resource Name"
                                    },
                                    {
                                      "columnId": "resourceGroup",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "location",
                                      "label": "Location"
                                    },
                                    {
                                      "columnId": "tags",
                                      "label": "Tags"
                                    }
                                  ]
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "DiskType",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                },
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true
                                },
                                "mapSettings": {
                                  "locInfo": "LatLong",
                                  "sizeSettings": "Count",
                                  "sizeAggregation": "Sum",
                                  "legendMetric": "Count",
                                  "legendAggregation": "Sum",
                                  "itemColorSettings": {
                                    "type": "heatmap",
                                    "colorAggregation": "Sum",
                                    "nodeColorField": "Count",
                                    "heatmapPalette": "greenRed"
                                  }
                                }
                              },
                              "customWidth": "30",
                              "name": "query - Orphan App Service Plan by Location"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources\r\n| where type =~ \"microsoft.web/serverfarms\"\r\n| where properties.numberOfSites == 0\r\n| extend Details = pack_all()\r\n| project Resource=id, resourceGroup, location, subscriptionId, Sku=sku.name, Tier=sku.tier, tags ,Details",
                                "size": 3,
                                "title": "Orphan App Service Plan",
                                "noDataMessage": "You are Good Here",
                                "noDataMessageStyle": 3,
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 13,
                                      "formatOptions": {
                                        "linkTarget": "Resource",
                                        "linkIsContextBlade": true,
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Resource",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Details",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "🔍 View Details",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 1000,
                                  "filter": true,
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "subscriptionId"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "Resource"
                                  },
                                  "labelSettings": [
                                    {
                                      "columnId": "resourceGroup",
                                      "label": "Resource Group"
                                    },
                                    {
                                      "columnId": "location",
                                      "label": "Location"
                                    },
                                    {
                                      "columnId": "subscriptionId",
                                      "label": "Subscription"
                                    },
                                    {
                                      "columnId": "tags",
                                      "label": "Tags"
                                    }
                                  ]
                                },
                                "sortBy": [],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1,
                                    "formatOptions": {
                                      "showIcon": true
                                    }
                                  },
                                  "leftContent": {
                                    "columnMatch": "Count",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto",
                                      "showIcon": true
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  "showBorder": true
                                },
                                "graphSettings": {
                                  "type": 0,
                                  "topContent": {
                                    "columnMatch": "vmSize",
                                    "formatter": 1
                                  },
                                  "centerContent": {
                                    "columnMatch": "Count",
                                    "formatter": 1,
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "maximumSignificantDigits": 3,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "query - Orphan App Service Plans"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "buttonname",
                          "comparison": "isEqualTo",
                          "value": "appserviceplan"
                        },
                        "name": "App Service Plan"
                      }
                    ]
                  },
                  "customWidth": "100",
                  "conditionalVisibility": {
                    "parameterName": "submenu",
                    "comparison": "isEqualTo",
                    "value": "orphanresources"
                  },
                  "name": "Orphan Resources"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tabname",
              "comparison": "isEqualTo",
              "value": "advisory"
            },
            "name": "Advisory"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ServiceHealthResources\r\n| where type =~ 'Microsoft.ResourceHealth/events'\r\n| extend eventType = tostring(properties.EventType), status = properties.Status, description = properties.Title, trackingId = properties.TrackingId, summary = properties.Summary, priority = properties.Priority, impactStartTime = properties.ImpactStartTime, impactMitigationTime = todatetime(tolong(properties.ImpactMitigationTime))\r\n| where properties.Status == 'Active' and tolong(impactStartTime) > 1\r\n| summarize count(subscriptionId) by name, eventType",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "value::all"
                    ],
                    "visualization": "piechart",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "name",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_subscriptionId",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "30",
                  "name": "query - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ServiceHealthResources\r\n| where type =~ 'Microsoft.ResourceHealth/events'\r\n| extend eventType = tostring(properties.EventType), status = properties.Status, description = properties.Title, trackingId = properties.TrackingId, summary = properties.Summary, priority = properties.Priority, impactStartTime = properties.ImpactStartTime, impactMitigationTime = todatetime(tolong(properties.ImpactMitigationTime))\r\n| where properties.Status == 'Active' and tolong(impactStartTime) > 1\r\n| summarize count(subscriptionId) by name, eventType",
                    "size": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "value::all"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "name",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_subscriptionId",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "eventType"
                      },
                      "showBorder": false,
                      "sortCriteriaField": "eventType"
                    }
                  },
                  "name": "query - 1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ServiceHealthResources\r\n| where type =~ 'Microsoft.ResourceHealth/events'\r\n| extend eventType = properties.EventType, status = properties.Status, description = properties.Title, trackingId = properties.TrackingId, summary = properties.Summary, priority = properties.Priority, impactStartTime = properties.ImpactStartTime, impactMitigationTime = todatetime(tolong(properties.ImpactMitigationTime))\r\n| where properties.Status == 'Active' and tolong(impactStartTime) > 1 \r\n| project eventType,id ,impactMitigationTime ,location,subscriptionId ,description,summary \r\n",
                    "size": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "value::all"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "impactStartTime",
                          "formatter": 6
                        },
                        {
                          "columnMatch": "impactMitigationTime",
                          "formatter": 6
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_link_eventType_0",
                          "sortOrder": 1
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "eventType",
                          "label": "Event Type"
                        },
                        {
                          "columnId": "id",
                          "label": "Tracking ID"
                        },
                        {
                          "columnId": "impactMitigationTime",
                          "label": "Mitigrtion Time"
                        },
                        {
                          "columnId": "location",
                          "label": "Affected Location"
                        },
                        {
                          "columnId": "subscriptionId",
                          "label": "Subscription"
                        },
                        {
                          "columnId": "description",
                          "label": "Description"
                        },
                        {
                          "columnId": "summary",
                          "label": "Summary"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_link_eventType_0",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "customWidth": "100",
                  "name": "query - 2"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tabname",
              "comparison": "isEqualTo",
              "value": "servicehealth"
            },
            "name": "Service Health"
          }
        ]
      },
      "name": "CloudOpsDashboard",
      "styleSettings": {
        "padding": "-1px"
      }
    },
    {
      "type": 1,
      "content": {
        "json": "![alt text](https://raw.githubusercontent.com/dshirdho/CloudOpsDashboard/main/CloudOps%20Dashboard%20Footer.png)"
      },
      "name": "Footer"
    }
  ],
  "fallbackResourceIds": [
    "azure monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}